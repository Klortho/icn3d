var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(i){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var i,t,n;e=e||{},i=void 0!==e.parent?e.parent:document.body,t=void 0!==e.id?e.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=t,i.appendChild(n)}};if("object"==typeof module&&(module.exports=Detector),THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,i){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function i(){be.setRGB(0,0,0),Ee.setRGB(0,0,0),ye.setRGB(0,0,0);for(var e=0,i=C.length;i>e;e++){var t=C[e],n=t.color;t instanceof THREE.AmbientLight?be.add(n):t instanceof THREE.DirectionalLight?Ee.add(n):t instanceof THREE.PointLight&&ye.add(n)}}function t(e,i,t){for(var n=0,o=C.length;o>n;n++){var r=C[n];if(pe.copy(r.color),r instanceof THREE.DirectionalLight){var s=we.setFromMatrixPosition(r.matrixWorld).normalize(),a=i.dot(s);if(0>=a)continue;a*=r.intensity,t.add(pe.multiplyScalar(a))}else if(r instanceof THREE.PointLight){var s=we.setFromMatrixPosition(r.matrixWorld),a=i.dot(we.subVectors(s,e).normalize());if(0>=a)continue;if(a*=0==r.distance?1:1-Math.min(e.distanceTo(s)/r.distance,1),0==a)continue;a*=r.intensity,t.add(pe.multiplyScalar(a))}}}function n(e,i,t){u(t.opacity),p(t.blending);var n=i.scale.x*U,o=i.scale.y*Y,r=.5*Math.sqrt(n*n+o*o);if(fe.min.set(e.x-r,e.y-r),fe.max.set(e.x+r,e.y+r),t instanceof THREE.SpriteMaterial){var s=t.map;if(null!==s){var a=me[s.id];if((void 0===a||a.version!==s.version)&&(a=l(s),me[s.id]=a),void 0!==a.canvas){b(a.canvas);var c=s.image,d=c.width*s.offset.x,h=c.height*s.offset.y,m=c.width*s.repeat.x,g=c.height*s.repeat.y,v=n/m,E=o/g;J.save(),J.translate(e.x,e.y),0!==t.rotation&&J.rotate(t.rotation),J.translate(-n/2,-o/2),J.scale(v,E),J.translate(-d,-h),J.fillRect(d,h,m,g),J.restore()}}else b(t.color.getStyle()),J.save(),J.translate(e.x,e.y),0!==t.rotation&&J.rotate(t.rotation),J.scale(n,-o),J.fillRect(-.5,-.5,1,1),J.restore()}else t instanceof THREE.SpriteCanvasMaterial&&(f(t.color.getStyle()),b(t.color.getStyle()),J.save(),J.translate(e.x,e.y),0!==t.rotation&&J.rotate(t.rotation),J.scale(n,o),t.program(J),J.restore())}function o(e,i,t,n){if(u(n.opacity),p(n.blending),J.beginPath(),J.moveTo(e.positionScreen.x,e.positionScreen.y),J.lineTo(i.positionScreen.x,i.positionScreen.y),n instanceof THREE.LineBasicMaterial){if(m(n.linewidth),g(n.linecap),v(n.linejoin),n.vertexColors!==THREE.VertexColors)f(n.color.getStyle());else{var o=t.vertexColors[0].getStyle(),r=t.vertexColors[1].getStyle();if(o===r)f(o);else{try{var s=J.createLinearGradient(e.positionScreen.x,e.positionScreen.y,i.positionScreen.x,i.positionScreen.y);s.addColorStop(0,o),s.addColorStop(1,r)}catch(a){s=o}f(s)}}J.stroke(),fe.expandByScalar(2*n.linewidth)}else n instanceof THREE.LineDashedMaterial&&(m(n.linewidth),g(n.linecap),v(n.linejoin),f(n.color.getStyle()),E([n.dashSize,n.gapSize]),J.stroke(),fe.expandByScalar(2*n.linewidth),E([]))}function r(e,i,n,o,r,l,h,m){if(B.info.render.vertices+=3,B.info.render.faces++,u(m.opacity),p(m.blending),H=e.positionScreen.x,x=e.positionScreen.y,A=i.positionScreen.x,$=i.positionScreen.y,O=n.positionScreen.x,M=n.positionScreen.y,s(H,x,A,$,O,M),(m instanceof THREE.MeshLambertMaterial||m instanceof THREE.MeshPhongMaterial)&&null===m.map)he.copy(m.color),ue.copy(m.emissive),m.vertexColors===THREE.FaceColors&&he.multiply(h.color),de.copy(be),_e.copy(e.positionWorld).add(i.positionWorld).add(n.positionWorld).divideScalar(3),t(_e,h.normalModel,de),de.multiply(he).add(ue),m.wireframe===!0?a(de,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):c(de);else if(m instanceof THREE.MeshBasicMaterial||m instanceof THREE.MeshLambertMaterial||m instanceof THREE.MeshPhongMaterial)if(null!==m.map){var g=m.map.mapping;g===THREE.UVMapping&&(L=h.uvs,d(H,x,A,$,O,M,L[o].x,L[o].y,L[r].x,L[r].y,L[l].x,L[l].y,m.map))}else null!==m.envMap?m.envMap.mapping===THREE.SphericalReflectionMapping&&(Ce.copy(h.vertexNormalsModel[o]).applyMatrix3(Se),I=.5*Ce.x+.5,D=.5*Ce.y+.5,Ce.copy(h.vertexNormalsModel[r]).applyMatrix3(Se),z=.5*Ce.x+.5,N=.5*Ce.y+.5,Ce.copy(h.vertexNormalsModel[l]).applyMatrix3(Se),j=.5*Ce.x+.5,q=.5*Ce.y+.5,d(H,x,A,$,O,M,I,D,z,N,j,q,m.envMap)):(de.copy(m.color),m.vertexColors===THREE.FaceColors&&de.multiply(h.color),m.wireframe===!0?a(de,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):c(de));else m instanceof THREE.MeshDepthMaterial?(de.r=de.g=de.b=1-y(e.positionScreen.z*e.positionScreen.w,S.near,S.far),m.wireframe===!0?a(de,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):c(de)):m instanceof THREE.MeshNormalMaterial?(Ce.copy(h.normalModel).applyMatrix3(Se),de.setRGB(Ce.x,Ce.y,Ce.z).multiplyScalar(.5).addScalar(.5),m.wireframe===!0?a(de,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):c(de)):(de.setRGB(1,1,1),m.wireframe===!0?a(de,m.wireframeLinewidth,m.wireframeLinecap,m.wireframeLinejoin):c(de))}function s(e,i,t,n,o,r){J.beginPath(),J.moveTo(e,i),J.lineTo(t,n),J.lineTo(o,r),J.closePath()}function a(e,i,t,n){m(i),g(t),v(n),f(e.getStyle()),J.stroke(),fe.expandByScalar(2*i)}function c(e){b(e.getStyle()),J.fill()}function l(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var i=e.image,t=document.createElement("canvas");t.width=i.width,t.height=i.height;var n=t.getContext("2d");n.setTransform(1,0,0,-1,0,i.height),n.drawImage(i,0,0);var o=e.wrapS===THREE.RepeatWrapping,r=e.wrapT===THREE.RepeatWrapping,s="no-repeat";return o===!0&&r===!0?s="repeat":o===!0?s="repeat-x":r===!0&&(s="repeat-y"),{canvas:J.createPattern(t,s),version:e.version}}function d(e,i,t,n,o,r,s,a,c,d,h,u,p){var m=me[p.id];if((void 0===m||m.version!==p.version)&&(m=l(p),me[p.id]=m),void 0===m.canvas)return b("rgba( 0, 0, 0, 1)"),void J.fill();b(m.canvas);var g,v,f,E,y,w,_,C,S=p.offset.x/p.repeat.x,T=p.offset.y/p.repeat.y,R=p.image.width*p.repeat.x,k=p.image.height*p.repeat.y;s=(s+S)*R,a=(a+T)*k,c=(c+S)*R,d=(d+T)*k,h=(h+S)*R,u=(u+T)*k,t-=e,n-=i,o-=e,r-=i,c-=s,d-=a,h-=s,u-=a,_=c*u-h*d,0!==_&&(C=1/_,g=(u*t-d*o)*C,v=(u*n-d*r)*C,f=(c*o-h*t)*C,E=(c*r-h*n)*C,y=e-g*s-f*a,w=i-v*s-E*a,J.save(),J.transform(g,v,f,E,y,w),J.fill(),J.restore())}function h(e,i,t){var n,o=i.x-e.x,r=i.y-e.y,s=o*o+r*r;0!==s&&(n=t/Math.sqrt(s),o*=n,r*=n,i.x+=o,i.y+=r,e.x-=o,e.y-=r)}function u(e){te!==e&&(J.globalAlpha=e,te=e)}function p(e){ne!==e&&(e===THREE.NormalBlending?J.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?J.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(J.globalCompositeOperation="darker"),ne=e)}function m(e){se!==e&&(J.lineWidth=e,se=e)}function g(e){ae!==e&&(J.lineCap=e,ae=e)}function v(e){ce!==e&&(J.lineJoin=e,ce=e)}function f(e){oe!==e&&(J.strokeStyle=e,oe=e)}function b(e){re!==e&&(J.fillStyle=e,re=e)}function E(e){le.length!==e.length&&(J.setLineDash(e),le=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var y=THREE.Math.smoothstep;e=e||{};var w,_,C,S,T,R,k,H,x,A,$,O,M,L,I,D,z,N,j,q,B=this,P=new THREE.Projector,V=void 0!==e.canvas?e.canvas:document.createElement("canvas"),F=V.width,G=V.height,U=Math.floor(F/2),Y=Math.floor(G/2),W=0,X=0,Z=F,Q=G,K=1,J=V.getContext("2d",{alpha:e.alpha===!0}),ee=new THREE.Color(0),ie=e.alpha===!0?0:1,te=1,ne=0,oe=null,re=null,se=null,ae=null,ce=null,le=[],de=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),he=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),ue=new THREE.Color,pe=new THREE.Color,me={},ge=new THREE.Box2,ve=new THREE.Box2,fe=new THREE.Box2,be=new THREE.Color,Ee=new THREE.Color,ye=new THREE.Color,we=new THREE.Vector3,_e=new THREE.Vector3,Ce=new THREE.Vector3,Se=new THREE.Matrix3;void 0===J.setLineDash&&(J.setLineDash=function(){}),this.domElement=V,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return J},this.getContextAttributes=function(){return J.getContextAttributes()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(e){void 0!==e&&(K=e)},this.setSize=function(e,i,t){F=e*K,G=i*K,V.width=F,V.height=G,U=Math.floor(F/2),Y=Math.floor(G/2),t!==!1&&(V.style.width=e+"px",V.style.height=i+"px"),ge.min.set(-U,-Y),ge.max.set(U,Y),ve.min.set(-U,-Y),ve.max.set(U,Y),te=1,ne=0,oe=null,re=null,se=null,ae=null,ce=null,this.setViewport(0,0,e,i)},this.setViewport=function(e,i,t,n){W=e*K,X=i*K,Z=t*K,Q=n*K},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,i){ee.set(e),ie=void 0!==i?i:1,ve.min.set(-U,-Y),ve.max.set(U,Y)},this.setClearColorHex=function(e,i){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,i)},this.getClearColor=function(){return ee},this.getClearAlpha=function(){return ie},this.getMaxAnisotropy=function(){return 0},this.clear=function(){ve.empty()===!1&&(ve.intersect(ge),ve.expandByScalar(2),ve.min.x=ve.min.x+U,ve.min.y=-ve.min.y+Y,ve.max.x=ve.max.x+U,ve.max.y=-ve.max.y+Y,1>ie&&J.clearRect(0|ve.min.x,0|ve.max.y,ve.max.x-ve.min.x|0,ve.min.y-ve.max.y|0),ie>0&&(p(THREE.NormalBlending),u(1),b("rgba("+Math.floor(255*ee.r)+","+Math.floor(255*ee.g)+","+Math.floor(255*ee.b)+","+ie+")"),J.fillRect(0|ve.min.x,0|ve.max.y,ve.max.x-ve.min.x|0,ve.min.y-ve.max.y|0)),ve.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),B.info.render.vertices=0,B.info.render.faces=0,J.setTransform(Z/F,0,0,-Q/G,W,G-X),J.translate(U,Y),w=P.projectScene(e,t,this.sortObjects,this.sortElements),_=w.elements,C=w.lights,S=t,Se.getNormalMatrix(t.matrixWorldInverse),i();for(var s=0,a=_.length;a>s;s++){var c=_[s],l=c.material;if(void 0!==l&&0!==l.opacity){if(fe.makeEmpty(),c instanceof THREE.RenderableSprite)T=c,T.x*=U,T.y*=Y,n(T,c,l);else if(c instanceof THREE.RenderableLine)T=c.v1,R=c.v2,T.positionScreen.x*=U,T.positionScreen.y*=Y,R.positionScreen.x*=U,R.positionScreen.y*=Y,fe.setFromPoints([T.positionScreen,R.positionScreen]),ge.isIntersectionBox(fe)===!0&&o(T,R,c,l);else if(c instanceof THREE.RenderableFace){if(T=c.v1,R=c.v2,k=c.v3,T.positionScreen.z<-1||T.positionScreen.z>1)continue;if(R.positionScreen.z<-1||R.positionScreen.z>1)continue;if(k.positionScreen.z<-1||k.positionScreen.z>1)continue;T.positionScreen.x*=U,T.positionScreen.y*=Y,R.positionScreen.x*=U,R.positionScreen.y*=Y,k.positionScreen.x*=U,k.positionScreen.y*=Y,l.overdraw>0&&(h(T.positionScreen,R.positionScreen,l.overdraw),h(R.positionScreen,k.positionScreen,l.overdraw),h(k.positionScreen,T.positionScreen,l.overdraw)),fe.setFromPoints([T.positionScreen,R.positionScreen,k.positionScreen]),ge.isIntersectionBox(fe)===!0&&r(T,R,k,0,1,2,c,l)}ve.union(fe)}}J.setTransform(1,0,0,1,0,0)}},THREE.TrackballControls=function(e,i,t){function n(e){u.enabled!==!1&&(window.removeEventListener("keydown",n),g=u._state,u._state===u.STATE.NONE&&(e.keyCode!==u.keys[u.STATE.ROTATE]||u.noRotate?e.keyCode!==u.keys[u.STATE.ZOOM]&&!e.shiftKey||u.noZoom?e.keyCode!==u.keys[u.STATE.PAN]&&!e.ctrlKey||u.noPan||(u._state=u.STATE.PAN):u._state=u.STATE.ZOOM:u._state=u.STATE.ROTATE))}function o(e){u.enabled!==!1&&(u._state=g,window.addEventListener("keydown",n,!1))}function r(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state===u.STATE.NONE&&(u._state=e.button),u._state!==u.STATE.ROTATE||u.noRotate?u._state!==u.STATE.ZOOM||u.noZoom?u._state!==u.STATE.PAN||u.noPan||(u._panStart.copy(_(e.pageX,e.pageY)),u._panEnd.copy(u._panStart)):(u._zoomStart.copy(_(e.pageX,e.pageY)),u._zoomEnd.copy(u._zoomStart)):(u._rotateStart.copy(C(e.pageX,e.pageY)),u._rotateEnd.copy(u._rotateStart)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),u.dispatchEvent(y))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state!==u.STATE.ROTATE||u.noRotate?u._state!==u.STATE.ZOOM||u.noZoom?u._state!==u.STATE.PAN||u.noPan||u._panEnd.copy(_(e.pageX,e.pageY)):u._zoomEnd.copy(_(e.pageX,e.pageY)):u._rotateEnd.copy(C(e.pageX,e.pageY)))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state=u.STATE.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),u.dispatchEvent(w))}function c(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var i=0;e.wheelDelta?i=e.wheelDelta/40:e.detail&&(i=-e.detail/3),u._zoomStart.y=.01*i,u.dispatchEvent(y),u.dispatchEvent(w)}}function l(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._state=u.STATE.TOUCH_ROTATE,u._rotateStart.copy(C(e.touches[0].pageX,e.touches[0].pageY)),u._rotateEnd.copy(u._rotateStart);break;case 2:u._state=u.STATE.TOUCH_ZOOM_PAN;var i=e.touches[0].pageX-e.touches[1].pageX,t=e.touches[0].pageY-e.touches[1].pageY;b=f=Math.sqrt(i*i+t*t);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panStart.copy(_(n,o)),u._panEnd.copy(u._panStart);break;default:u._state=u.STATE.NONE}u.dispatchEvent(y)}}function d(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u._rotateEnd.copy(C(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var i=e.touches[0].pageX-e.touches[1].pageX,t=e.touches[0].pageY-e.touches[1].pageY;b=Math.sqrt(i*i+t*t);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(_(n,o));break;default:u._state=u.STATE.NONE}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._rotateEnd.copy(C(e.touches[0].pageX,e.touches[0].pageY)),u._rotateStart.copy(u._rotateEnd);break;case 2:f=b=0;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,t=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(_(i,t)),u._panStart.copy(u._panEnd)}u._state=u.STATE.NONE,u.dispatchEvent(w)}}var u=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},this.object=e,this.domElement=void 0!==i?i:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=1e-6,m=new THREE.Vector3;this._state=this.STATE.NONE;var g=this.STATE.NONE,v=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var f=0,b=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var E={type:"change"},y={type:"start"},w={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var _=function(){var e=new THREE.Vector2;return function(i,t){return e.set((i-u.screen.left)/u.screen.width,(t-u.screen.top)/u.screen.height),e}}(),C=function(){var e=new THREE.Vector3,i=new THREE.Vector3,t=new THREE.Vector3;return function(n,o){t.set((n-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(.5*u.screen.height+u.screen.top-o)/(.5*u.screen.height),0);var r=t.length();return u.noRoll?r<Math.SQRT1_2?t.z=Math.sqrt(1-r*r):t.z=.5/r:r>1?t.normalize():t.z=Math.sqrt(1-r*r),v.copy(u.object.position).sub(u.target),e.copy(u.object.up).setLength(t.y),e.add(i.copy(u.object.up).cross(v).setLength(t.x)),e.add(v.setLength(t.z)),e}}();this.rotateCamera=function(e,i){var n=new THREE.Vector3,o=new THREE.Quaternion;return function(e,i){var r;void 0===e&&(r=Math.acos(u._rotateStart.dot(u._rotateEnd)/u._rotateStart.length()/u._rotateEnd.length())),(r||void 0!==e)&&(void 0===e?(n.crossVectors(u._rotateStart,u._rotateEnd).normalize(),r*=u.rotateSpeed,o.setFromAxisAngle(n,-r)):o.copy(e),(void 0===i||i===!0)&&t.quaternion.multiplyQuaternions(o,t.quaternion),v.applyQuaternion(o),u.object.up.applyQuaternion(o),u._rotateEnd.applyQuaternion(o),u.staticMoving?u._rotateStart.copy(u._rotateEnd):(o.setFromAxisAngle(n,r*(u.dynamicDampingFactor-1)),u._rotateStart.applyQuaternion(o)))}}(),this.zoomCamera=function(e,i){if(u._state===u.STATE.TOUCH_ZOOM_PAN){var n;void 0!==e?n=e:(n=f/b,f=b),v.multiplyScalar(n),(void 0===i||i===!0)&&(t._zoomFactor*=n)}else{var n;n=void 0!==e?e:1+(u._zoomEnd.y-u._zoomStart.y)*u.zoomSpeed,(void 0===i||i===!0)&&(t._zoomFactor*=n),1!==n&&(v.multiplyScalar(n),u.staticMoving?u._zoomStart.copy(u._zoomEnd):u._zoomStart.y+=(u._zoomEnd.y-u._zoomStart.y)*this.dynamicDampingFactor)}},this.panCamera=function(e,i){var n=new THREE.Vector2,o=new THREE.Vector3,r=new THREE.Vector3;return function(e,i){void 0!==e?(n=e,(void 0===i||i===!0)&&t.mouseChange.add(e)):(n.copy(u._panEnd).sub(u._panStart),(void 0===i||i===!0)&&t.mouseChange.add(u._panEnd).sub(u._panStart)),n.lengthSq()&&(n.multiplyScalar(v.length()*u.panSpeed),r.copy(v).cross(u.object.up).setLength(n.x),r.add(o.copy(u.object.up).setLength(n.y)),u.object.position.add(r),u.target.add(r),u.staticMoving?u._panStart.copy(u._panEnd):u._panStart.add(n.subVectors(u._panEnd,u._panStart).multiplyScalar(u.dynamicDampingFactor)))}}(),this.checkDistances=function(){u.noZoom&&u.noPan||(v.lengthSq()>u.maxDistance*u.maxDistance&&u.object.position.addVectors(u.target,v.setLength(u.maxDistance)),v.lengthSq()<u.minDistance*u.minDistance&&u.object.position.addVectors(u.target,v.setLength(u.minDistance)))},this.update=function(e){v.subVectors(u.object.position,u.target),u.noRotate||(void 0!==e&&void 0!==e.quaternion?u.rotateCamera(e.quaternion,e.update):u.rotateCamera()),u.noZoom||(void 0!==e&&void 0!==e._zoomFactor?u.zoomCamera(e._zoomFactor,e.update):u.zoomCamera()),u.noPan||(void 0!==e&&void 0!==e.mouseChange?u.panCamera(e.mouseChange,e.update):u.panCamera()),u.object.position.addVectors(u.target,v),u.checkDistances(),u.object.lookAt(u.target),m.distanceToSquared(u.object.position)>p&&(u.dispatchEvent(E),m.copy(u.object.position))},this.reset=function(){u._state=u.STATE.NONE,g=u.STATE.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),v.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(E),m.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",d,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.OrthographicTrackballControls=function(e,i,t){function n(e){u.enabled!==!1&&(window.removeEventListener("keydown",n),f=u._state,u._state===p.NONE&&(e.keyCode!==u.keys[p.ROTATE]||u.noRotate?e.keyCode!==u.keys[p.ZOOM]&&!e.shiftKey||u.noZoom?e.keyCode!==u.keys[p.PAN]&&!e.ctrlKey||u.noPan||(u._state=p.PAN):u._state=p.ZOOM:u._state=p.ROTATE))}function o(e){u.enabled!==!1&&(u._state=f,window.addEventListener("keydown",n,!1))}function r(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state===p.NONE&&(u._state=e.button),u._state!==p.ROTATE||u.noRotate?u._state!==p.ZOOM||u.noZoom?u._state!==p.PAN||u.noPan||(u._panStart.copy(T(e.pageX,e.pageY)),u._panEnd.copy(u._panStart)):(u._zoomStart.copy(T(e.pageX,e.pageY)),u._zoomEnd.copy(u._zoomStart)):(u._rotateStart.copy(R(e.pageX,e.pageY)),u._rotateEnd.copy(u._rotateStart)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),u.dispatchEvent(C))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state!==p.ROTATE||u.noRotate?u._state!==p.ZOOM||u.noZoom?u._state!==p.PAN||u.noPan||u._panEnd.copy(T(e.pageX,e.pageY)):u._zoomEnd.copy(T(e.pageX,e.pageY)):u._rotateEnd.copy(R(e.pageX,e.pageY)))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state=p.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),u.dispatchEvent(S))}function c(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var i=0;e.wheelDelta?i=e.wheelDelta/40:e.detail&&(i=-e.detail/3),u._zoomStart.y=.01*i,u.dispatchEvent(C),u.dispatchEvent(S)}}function l(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._state=p.TOUCH_ROTATE,u._rotateStart.copy(R(e.touches[0].pageX,e.touches[0].pageY)),u._rotateEnd.copy(u._rotateStart);break;case 2:u._state=p.TOUCH_ZOOM_PAN;var i=e.touches[0].pageX-e.touches[1].pageX,t=e.touches[0].pageY-e.touches[1].pageY;w=y=Math.sqrt(i*i+t*t);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panStart.copy(T(n,o)),u._panEnd.copy(u._panStart);break;default:u._state=p.NONE}u.dispatchEvent(C)}}function d(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u._rotateEnd.copy(R(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var i=e.touches[0].pageX-e.touches[1].pageX,t=e.touches[0].pageY-e.touches[1].pageY;w=Math.sqrt(i*i+t*t);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(T(n,o));break;default:u._state=p.NONE}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._rotateEnd.copy(R(e.touches[0].pageX,e.touches[0].pageY)),u._rotateStart.copy(u._rotateEnd);break;case 2:y=w=0;var i=(e.touches[0].pageX+e.touches[1].pageX)/2,t=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(T(i,t)),u._panStart.copy(u._panEnd)}u._state=p.NONE,u.dispatchEvent(S)}}var u=this,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==i?i:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=.5,this.zoomSpeed=1.2;var m=.01;this.zoomSpeed*=m,this.panSpeed=.03,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var g=1e-6,v=new THREE.Vector3;this._state=p.NONE;var f=p.NONE,b=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var E=1,y=0,w=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var _={type:"change"},C={type:"start"},S={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-i.clientLeft,this.screen.top=e.top+window.pageYOffset-i.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var T=function(){var e=new THREE.Vector2;return function(i,t){return e.set((i-u.screen.left)/u.screen.width,(t-u.screen.top)/u.screen.height),e}}(),R=function(){var e=new THREE.Vector3,i=new THREE.Vector3,t=new THREE.Vector3;return function(n,o){t.set((n-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(.5*u.screen.height+u.screen.top-o)/(.5*u.screen.height),0);var r=t.length();return u.noRoll?r<Math.SQRT1_2?t.z=Math.sqrt(1-r*r):t.z=.5/r:r>1?t.normalize():t.z=Math.sqrt(1-r*r),b.copy(u.object.position).sub(u.target),e.copy(u.object.up).setLength(t.y),e.add(i.copy(u.object.up).cross(b).setLength(t.x)),e.add(b.setLength(t.z)),e}}();this.rotateCamera=function(e,i){var n=new THREE.Vector3,o=new THREE.Quaternion;return function(e,i){var r;void 0===e&&(r=Math.acos(u._rotateStart.dot(u._rotateEnd)/u._rotateStart.length()/u._rotateEnd.length())),(r||void 0!==e)&&(void 0===e?(n.crossVectors(u._rotateStart,u._rotateEnd).normalize(),r*=u.rotateSpeed,o.setFromAxisAngle(n,-r)):o.copy(e),(void 0===i||i===!0)&&t.quaternion.multiplyQuaternions(o,t.quaternion),b.applyQuaternion(o),u.object.up.applyQuaternion(o),u._rotateEnd.applyQuaternion(o),u.staticMoving?u._rotateStart.copy(u._rotateEnd):(o.setFromAxisAngle(n,r*(u.dynamicDampingFactor-1)),u._rotateStart.applyQuaternion(o)))}}(),this.zoomCamera=function(e,i){var n;u._state===p.TOUCH_ZOOM_PAN?void 0!==e?n=e:(n=y/w,y=w):n=void 0!==e?e:1+(u._zoomEnd.y-u._zoomStart.y)*u.zoomSpeed/m,(void 0===i||i===!0)&&(t._zoomFactor*=n),1!==n&&(E=n,u.object.left=E*u.left0+(1-E)*u.center0.x,u.object.right=E*u.right0+(1-E)*u.center0.x,u.object.top=E*u.top0+(1-E)*u.center0.y,u.object.bottom=E*u.bottom0+(1-E)*u.center0.y,u.staticMoving?u._zoomStart.copy(u._zoomEnd):u._zoomStart.y+=(u._zoomEnd.y-u._zoomStart.y)*this.dynamicDampingFactor)},this.panCamera=function(e,i){var n=new THREE.Vector2,o=new THREE.Vector3,r=new THREE.Vector3;return function(e,i){void 0!==e?(n=e,(void 0===i||i===!0)&&t.mouseChange.add(e)):(n.copy(u._panEnd).sub(u._panStart),(void 0===i||i===!0)&&t.mouseChange.add(u._panEnd).sub(u._panStart)),n.lengthSq()&&(n.multiplyScalar(b.length()*u.panSpeed),r.copy(b).cross(u.object.up).setLength(n.x),r.add(o.copy(u.object.up).setLength(n.y)),u.object.position.add(r),u.target.add(r),u.staticMoving?u._panStart.copy(u._panEnd):u._panStart.add(n.subVectors(u._panEnd,u._panStart).multiplyScalar(u.dynamicDampingFactor)))}}(),this.update=function(e){b.subVectors(u.object.position,u.target),u.noRotate||(void 0!==e&&void 0!==e.quaternion?u.rotateCamera(e.quaternion,e.update):u.rotateCamera()),u.noZoom||(void 0!==e&&void 0!==e._zoomFactor?u.zoomCamera(e._zoomFactor,e.update):u.zoomCamera(),u.object.updateProjectionMatrix()),u.noPan||(void 0!==e&&void 0!==e.mouseChange?u.panCamera(e.mouseChange,e.update):u.panCamera()),u.object.position.addVectors(u.target,b),u.object.lookAt(u.target),v.distanceToSquared(u.object.position)>g&&(u.dispatchEvent(_),v.copy(u.object.position))},this.reset=function(){u._state=p.NONE,f=p.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),b.subVectors(u.object.position,u.target),u.object.left=u.left0,u.object.right=u.right0,u.object.top=u.top0,u.object.bottom=u.bottom0,u.object.lookAt(u.target),u.dispatchEvent(_),v.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",d,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls,THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){function e(){if(c===E){var e=new THREE.RenderableObject;return b.push(e),E++,c++,e}return b[c++]}function i(){if(d===w){var e=new THREE.RenderableVertex;return y.push(e),w++,d++,e}return y[d++]}function t(){if(u===C){var e=new THREE.RenderableFace;return _.push(e),C++,u++,e}return _[u++]}function n(){if(m===T){var e=new THREE.RenderableLine;return S.push(e),T++,m++,e}return S[m++]}function o(){if(v===k){var e=new THREE.RenderableSprite;return R.push(e),k++,v++,e}return R[v++]}function r(e,i){return e.z!==i.z?i.z-e.z:e.id!==i.id?e.id-i.id:0}function s(e,i){var t=0,n=1,o=e.z+e.w,r=i.z+i.w,s=-e.z+e.w,a=-i.z+i.w;return o>=0&&r>=0&&s>=0&&a>=0?!0:0>o&&0>r||0>s&&0>a?!1:(0>o?t=Math.max(t,o/(o-r)):0>r&&(n=Math.min(n,o/(o-r))),0>s?t=Math.max(t,s/(s-a)):0>a&&(n=Math.min(n,s/(s-a))),t>n?!1:(e.lerp(i,t),i.lerp(e,1-n),!0))}var a,c,l,d,h,u,p,m,g,v,f,b=[],E=0,y=[],w=0,_=[],C=0,S=[],T=0,R=[],k=0,H={objects:[],lights:[],elements:[]},x=new THREE.Vector3,A=new THREE.Vector3,$=new THREE.Vector3,O=new THREE.Vector3,M=new THREE.Vector4,L=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),I=new THREE.Box3,D=new Array(3),z=(new Array(4),
new THREE.Matrix4),N=new THREE.Matrix4,j=new THREE.Matrix4,q=new THREE.Matrix3,B=new THREE.Frustum,P=new THREE.Vector4,V=new THREE.Vector4;this.projectVector=function(e,i){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(i)},this.unprojectVector=function(e,i){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(i)},this.pickingRay=function(e,i){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var F=function(){var e=[],o=[],r=null,s=null,a=new THREE.Matrix3,c=function(i){r=i,s=r.material,a.getNormalMatrix(r.matrixWorld),e.length=0,o.length=0},d=function(e){var i=e.position,t=e.positionWorld,n=e.positionScreen;t.copy(i).applyMatrix4(f),n.copy(t).applyMatrix4(N);var o=1/n.w;n.x*=o,n.y*=o,n.z*=o,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1},u=function(e,t,n){l=i(),l.position.set(e,t,n),d(l)},m=function(i,t,n){e.push(i,t,n)},g=function(e,i){o.push(e,i)},v=function(e,i,t){return e.visible===!0||i.visible===!0||t.visible===!0?!0:(D[0]=e.positionScreen,D[1]=i.positionScreen,D[2]=t.positionScreen,L.isIntersectionBox(I.setFromPoints(D)))},b=function(e,i,t){return(t.positionScreen.x-e.positionScreen.x)*(i.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(i.positionScreen.x-e.positionScreen.x)<0},E=function(e,i){var t=y[e],o=y[i];p=n(),p.id=r.id,p.v1.copy(t),p.v2.copy(o),p.z=(t.positionScreen.z+o.positionScreen.z)/2,p.material=r.material,H.elements.push(p)},w=function(i,n,c){var l=y[i],d=y[n],u=y[c];if(v(l,d,u)!==!1&&(s.side===THREE.DoubleSide||b(l,d,u)===!0)){h=t(),h.id=r.id,h.v1.copy(l),h.v2.copy(d),h.v3.copy(u),h.z=(l.positionScreen.z+d.positionScreen.z+u.positionScreen.z)/3;for(var p=0;3>p;p++){var m=3*arguments[p],g=h.vertexNormalsModel[p];g.set(e[m],e[m+1],e[m+2]),g.applyMatrix3(a).normalize();var f=2*arguments[p],E=h.uvs[p];E.set(o[f],o[f+1])}h.vertexNormalsLength=3,h.material=r.material,H.elements.push(h)}};return{setObject:c,projectVertex:d,checkTriangleVisibility:v,checkBackfaceCulling:b,pushVertex:u,pushNormal:m,pushUv:g,pushLine:E,pushTriangle:w}},G=new F;this.projectScene=function(l,b,E,w){u=0,m=0,v=0,H.elements.length=0,l.autoUpdate===!0&&l.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),z.copy(b.matrixWorldInverse.getInverse(b.matrixWorld)),N.multiplyMatrices(b.projectionMatrix,z),B.setFromMatrix(N),c=0,H.objects.length=0,H.lights.length=0,l.traverseVisible(function(i){if(i instanceof THREE.Light)H.lights.push(i);else if(i instanceof THREE.Mesh||i instanceof THREE.Line||i instanceof THREE.Sprite){if(i.material.visible===!1)return;(i.frustumCulled===!1||B.intersectsObject(i)===!0)&&(a=e(),a.id=i.id,a.object=i,O.setFromMatrixPosition(i.matrixWorld),O.applyProjection(N),a.z=O.z,H.objects.push(a))}}),E===!0&&H.objects.sort(r);for(var _=0,C=H.objects.length;C>_;_++){var S=H.objects[_].object,T=S.geometry;if(G.setObject(S),f=S.matrixWorld,d=0,S instanceof THREE.Mesh){if(T instanceof THREE.BufferGeometry){var R=T.attributes,k=T.offsets;if(void 0===R.position)continue;for(var L=R.position.array,I=0,D=L.length;D>I;I+=3)G.pushVertex(L[I],L[I+1],L[I+2]);if(void 0!==R.normal)for(var F=R.normal.array,I=0,D=F.length;D>I;I+=3)G.pushNormal(F[I],F[I+1],F[I+2]);if(void 0!==R.uv)for(var U=R.uv.array,I=0,D=U.length;D>I;I+=2)G.pushUv(U[I],U[I+1]);if(void 0!==R.index){var Y=R.index.array;if(k.length>0)for(var _=0;_<k.length;_++)for(var W=k[_],X=W.index,I=W.start,D=W.start+W.count;D>I;I+=3)G.pushTriangle(Y[I]+X,Y[I+1]+X,Y[I+2]+X);else for(var I=0,D=Y.length;D>I;I+=3)G.pushTriangle(Y[I],Y[I+1],Y[I+2])}else for(var I=0,D=L.length/3;D>I;I+=3)G.pushTriangle(I,I+1,I+2)}else if(T instanceof THREE.Geometry){var Z=T.vertices,Q=T.faces,K=T.faceVertexUvs[0];q.getNormalMatrix(f);for(var J=S.material instanceof THREE.MeshFaceMaterial,ee=J===!0?S.material:null,ie=0,te=Z.length;te>ie;ie++){var ne=Z[ie];G.pushVertex(ne.x,ne.y,ne.z)}for(var oe=0,re=Q.length;re>oe;oe++){var se=Q[oe],ae=J===!0?ee.materials[se.materialIndex]:S.material;if(void 0!==ae){var ce=ae.side,le=y[se.a],de=y[se.b],he=y[se.c];if(ae.morphTargets===!0){var ue=T.morphTargets,pe=S.morphTargetInfluences,me=le.position,ge=de.position,ve=he.position;x.set(0,0,0),A.set(0,0,0),$.set(0,0,0);for(var fe=0,be=ue.length;be>fe;fe++){var Ee=pe[fe];if(0!==Ee){var ye=ue[fe].vertices;x.x+=(ye[se.a].x-me.x)*Ee,x.y+=(ye[se.a].y-me.y)*Ee,x.z+=(ye[se.a].z-me.z)*Ee,A.x+=(ye[se.b].x-ge.x)*Ee,A.y+=(ye[se.b].y-ge.y)*Ee,A.z+=(ye[se.b].z-ge.z)*Ee,$.x+=(ye[se.c].x-ve.x)*Ee,$.y+=(ye[se.c].y-ve.y)*Ee,$.z+=(ye[se.c].z-ve.z)*Ee}}le.position.add(x),de.position.add(A),he.position.add($),G.projectVertex(le),G.projectVertex(de),G.projectVertex(he)}if(G.checkTriangleVisibility(le,de,he)!==!1){var we=G.checkBackfaceCulling(le,de,he);if(ce!==THREE.DoubleSide){if(ce===THREE.FrontSide&&we===!1)continue;if(ce===THREE.BackSide&&we===!0)continue}h=t(),h.id=S.id,h.v1.copy(le),h.v2.copy(de),h.v3.copy(he),h.normalModel.copy(se.normal),we!==!1||ce!==THREE.BackSide&&ce!==THREE.DoubleSide||h.normalModel.negate(),h.normalModel.applyMatrix3(q).normalize();for(var _e=se.vertexNormals,Ce=0,Se=Math.min(_e.length,3);Se>Ce;Ce++){var Te=h.vertexNormalsModel[Ce];Te.copy(_e[Ce]),we!==!1||ce!==THREE.BackSide&&ce!==THREE.DoubleSide||Te.negate(),Te.applyMatrix3(q).normalize()}h.vertexNormalsLength=_e.length;var Re=K[oe];if(void 0!==Re)for(var ke=0;3>ke;ke++)h.uvs[ke].copy(Re[ke]);h.color=se.color,h.material=ae,h.z=(le.positionScreen.z+de.positionScreen.z+he.positionScreen.z)/3,H.elements.push(h)}}}}}else if(S instanceof THREE.Line){if(T instanceof THREE.BufferGeometry){var R=T.attributes;if(void 0!==R.position){for(var L=R.position.array,I=0,D=L.length;D>I;I+=3)G.pushVertex(L[I],L[I+1],L[I+2]);if(void 0!==R.index)for(var Y=R.index.array,I=0,D=Y.length;D>I;I+=2)G.pushLine(Y[I],Y[I+1]);else for(var He=S.mode===THREE.LinePieces?2:1,I=0,D=L.length/3-1;D>I;I+=He)G.pushLine(I,I+1)}}else if(T instanceof THREE.Geometry){j.multiplyMatrices(N,f);var Z=S.geometry.vertices;if(0===Z.length)continue;le=i(),le.positionScreen.copy(Z[0]).applyMatrix4(j);for(var He=S.mode===THREE.LinePieces?2:1,ie=1,te=Z.length;te>ie;ie++)le=i(),le.positionScreen.copy(Z[ie]).applyMatrix4(j),(ie+1)%He>0||(de=y[d-2],P.copy(le.positionScreen),V.copy(de.positionScreen),s(P,V)===!0&&(P.multiplyScalar(1/P.w),V.multiplyScalar(1/V.w),p=n(),p.id=S.id,p.v1.positionScreen.copy(P),p.v2.positionScreen.copy(V),p.z=Math.max(P.z,V.z),p.material=S.material,S.material.vertexColors===THREE.VertexColors&&(p.vertexColors[0].copy(S.geometry.colors[ie]),p.vertexColors[1].copy(S.geometry.colors[ie-1])),H.elements.push(p)))}}else if(S instanceof THREE.Sprite){M.set(f.elements[12],f.elements[13],f.elements[14],1),M.applyMatrix4(N);var xe=1/M.w;M.z*=xe,M.z>=-1&&M.z<=1&&(g=o(),g.id=S.id,g.x=M.x*xe,g.y=M.y*xe,g.z=M.z,g.object=S,g.rotation=S.rotation,g.scale.x=S.scale.x*Math.abs(g.x-(M.x+b.projectionMatrix.elements[0])/(M.w+b.projectionMatrix.elements[12])),g.scale.y=S.scale.y*Math.abs(g.y-(M.y+b.projectionMatrix.elements[5])/(M.w+b.projectionMatrix.elements[13])),g.material=S.material,H.elements.push(g))}}return w===!0&&H.elements.sort(r),H}},"undefined"==typeof jQuery)throw new Error("iCn3D requires jQuery");var iCn3D=function(e){this.REVISION="1",this.id=e,this.container=$("#"+e),this.overdraw=0,this.bHighlight=1,Detector.webgl?(this.renderer=new THREE.WebGLRenderer({canvas:this.container.get(0),antialias:!0,preserveDrawingBuffer:!0}),this.overdraw=0):(alert("Currently your web browser has a problem on WebGL, and CanvasRenderer instead of WebGLRenderer is used. If you are using Chrome, open a new tab for the same URL and WebGL may work again."),this.renderer=new THREE.CanvasRenderer({canvas:this.container.get(0)}),this.overdraw=.5,this.bHighlight=2),this.matShader=this.setOutlineColor("yellow"),this.fractionOfColor=new THREE.Color(.1,.1,.1),this.WIDTH=this.container.width(),this.HEIGHT=this.container.height(),this.setWidthHeight(this.WIDTH,this.HEIGHT),this.axis=!1,this.picking=1,this.pickpair=!1,this.pickedatomNum=0,this.pickedatom=void 0,this.pickedatom2=void 0,this.bStopRotate=!1,this.bCalphaOnly=!1,this.bSSOnly=!1,this.effects={none:this.renderer},this.maxD=500,this.camera_z=2*-this.maxD,this.commands=[],this.logs=[],this.bRender=!0,this.highlightColor=new THREE.Color(16776960),this.sphereGeometry=new THREE.SphereGeometry(1,32,32),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1),this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,!0),this.sphereRadius=1.5,this.cylinderRadius=.4,this.linewidth=1,this.curveWidth=3,this.helixSheetWidth=1.3,this.coilWidth=.3,this.thickness=.4,this.axisDIV=5,this.strandDIV=6,this.tubeDIV=8,this.LABELSIZE=40,this.nucleicAcidStrandDIV=6,this.nucleicAcidWidth=.8,this.options={camera:"perspective",background:"black",color:"spectrum",sidechains:"nothing",secondary:"cylinder & plate",surface:"Van der Waals surface",wireframe:"no",opacity:"0.8",ligands:"stick",water:"nothing",ions:"sphere",hbonds:"no",labels:"no",lines:"no",rotationcenter:"molecule center",axis:"no",picking:"no",nucleotides:"nucleotide cartoon",showsurface:"no"},this._zoomFactor=1,this.mouseChange=new THREE.Vector2(0,0),this.quaternion=new THREE.Quaternion(0,0,0,1);var i=this;this.container.bind("contextmenu",function(e){e.preventDefault()}),i.typetext=!1,$(document).bind("keydown",function(e){if(i.controls&&(i.bStopRotate=!0,$("input, textarea").focus(function(){i.typetext=!0}),$("input, textarea").blur(function(){i.typetext=!1}),!i.typetext)){if(90===e.keyCode){var t={};i.camera===i.perspectiveCamera?t._zoomFactor=.9:i.camera===i.orthographicCamera&&(i._zoomFactor<.1?i._zoomFactor=.1:i._zoomFactor>1&&(i._zoomFactor=1),t._zoomFactor=.9*i._zoomFactor,t._zoomFactor<.1&&(t._zoomFactor=.1)),t.update=!0,i.controls.update(t)}else if(88===e.keyCode){var t={};i.camera===i.perspectiveCamera?t._zoomFactor=1.1:i.camera===i.orthographicCamera&&(i._zoomFactor>20?i._zoomFactor=20:i._zoomFactor<1&&(i._zoomFactor=1),t._zoomFactor=1.03*i._zoomFactor,t._zoomFactor>20&&(t._zoomFactor=20)),t.update=!0,i.controls.update(t)}else if(76===e.keyCode){var n=new THREE.Vector3(0,1,0),o=-5/180*Math.PI;n.applyQuaternion(i.camera.quaternion).normalize();var r=new THREE.Quaternion;r.setFromAxisAngle(n,-o);var t={};t.quaternion=r,t.update=!0,i.controls.update(t)}else if(74===e.keyCode){var n=new THREE.Vector3(0,1,0),o=5/180*Math.PI;n.applyQuaternion(i.camera.quaternion).normalize();var r=new THREE.Quaternion;r.setFromAxisAngle(n,-o);var t={};t.quaternion=r,t.update=!0,i.controls.update(t)}else if(73===e.keyCode){var n=new THREE.Vector3(1,0,0),o=-5/180*Math.PI;n.applyQuaternion(i.camera.quaternion).normalize();var r=new THREE.Quaternion;r.setFromAxisAngle(n,-o);var t={};t.quaternion=r,t.update=!0,i.controls.update(t)}else if(77===e.keyCode){var n=new THREE.Vector3(1,0,0),o=5/180*Math.PI;n.applyQuaternion(i.camera.quaternion).normalize();var r=new THREE.Quaternion;r.setFromAxisAngle(n,-o);var t={};t.quaternion=r,t.update=!0,i.controls.update(t)}else if(37===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.x-=.01;var t={};t.mouseChange=s,t.update=!0,i.controls.update(t)}else if(39===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.x+=.01;var t={};t.mouseChange=s,t.update=!0,i.controls.update(t)}else if(38===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.y-=.01;var t={};t.mouseChange=s,t.update=!0,i.controls.update(t)}else if(40===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.y+=.01;var t={};t.mouseChange=s,t.update=!0,i.controls.update(t)}i.render()}}),this.container.bind("mouseup touchend",function(e){i.isDragging=!1}),this.container.bind("mousedown touchstart",function(e){if(e.preventDefault(),i.scene){i.bStopRotate=!0;var t=e.pageX,n=e.pageY;if(e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]&&(t=e.originalEvent.targetTouches[0].pageX,n=e.originalEvent.targetTouches[0].pageY),i.isDragging=!0,i.picking){i.mouse.x=(t-i.container.offset().left)/i.container.width()*2-1,i.mouse.y=2*-((n-i.container.offset().top)/i.container.height())+1;var o=new THREE.Vector3;o.x=i.mouse.x,o.y=i.mouse.y,this.camera_z>0?o.z=-1:o.z=1,i.camera===i.perspectiveCamera?(this.camera_z>0?o.z=-1:o.z=1,o.unproject(i.camera),i.raycaster.set(i.camera.position,o.sub(i.camera.position).normalize())):i.camera===i.orthographicCamera&&(this.camera_z>0?o.z=1:o.z=-1,o.unproject(i.camera),i.raycaster.set(o,new THREE.Vector3(0,0,-1).transformDirection(i.camera.matrixWorld)));var r=i.raycaster.intersectObjects(i.objects);if(r.length>0){r[0].point.sub(i.mdl.position);for(var s=1,a=i.getAtomsFromPosition(r[0].point,s);!a&&10>s;)++s,a=i.getAtomsFromPosition(r[0].point,s);a?(i.pickpair?(i.pickedatomNum%2===0?i.pickedatom=a:i.pickedatom2=a,++i.pickedatomNum):i.pickedatom=a,i.showPicking(a)):console.log("No atoms were found in 10 andstrom range")}}i.controls.handleResize(),i.controls.update(),i.render()}}),this.container.bind("mousemove touchmove",function(e){e.preventDefault(),i.scene&&i.isDragging&&(i.controls.handleResize(),i.controls.update(),i.render())}),this.container.bind("mousewheel",function(e){e.preventDefault(),i.scene&&(i.bStopRotate=!0,i.controls.handleResize(),i.controls.update(),i.render())}),this.container.bind("DOMMouseScroll",function(e){e.preventDefault(),i.scene&&(i.bStopRotate=!0,i.controls.handleResize(),i.controls.update(),i.render())})};if(iCn3D.prototype={constructor:iCn3D,setOutlineColor:function(e){var i={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};"yellow"===e?i.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"green"===e?i.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"red"===e&&(i.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n"));var t={offset:{type:"f",value:.5}},n=i.outline,o=new THREE.ShaderMaterial({uniforms:t,vertexShader:n.vertex_shader,fragmentShader:n.fragment_shader,depthTest:!1,depthWrite:!1,needsUpdate:!0});return o},setWidthHeight:function(e,i){this.renderer.setSize(e,i),this.container.widthInv=1/e,this.container.heightInv=1/i,this.container.whratio=e/i},nucleotidesArray:["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU"],ionsArray:[" NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I"],vdwRadii:{H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56},covalentRadii:{H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69},atomColors:{H:new THREE.Color(16777215),He:new THREE.Color(16761035),HE:new THREE.Color(16761035),Li:new THREE.Color(11674146),LI:new THREE.Color(11674146),B:new THREE.Color(65280),C:new THREE.Color(13158600),N:new THREE.Color(9408511),O:new THREE.Color(15728640),F:new THREE.Color(14329120),Na:new THREE.Color(255),NA:new THREE.Color(255),Mg:new THREE.Color(2263842),MG:new THREE.Color(2263842),Al:new THREE.Color(8421520),AL:new THREE.Color(8421520),Si:new THREE.Color(14329120),SI:new THREE.Color(14329120),P:new THREE.Color(16753920),S:new THREE.Color(16762930),Cl:new THREE.Color(65280),CL:new THREE.Color(65280),Ca:new THREE.Color(8421520),CA:new THREE.Color(8421520),Ti:new THREE.Color(8421520),TI:new THREE.Color(8421520),Cr:new THREE.Color(8421520),CR:new THREE.Color(8421520),Mn:new THREE.Color(8421520),MN:new THREE.Color(8421520),Fe:new THREE.Color(16753920),FE:new THREE.Color(16753920),Ni:new THREE.Color(10824234),NI:new THREE.Color(10824234),Cu:new THREE.Color(10824234),CU:new THREE.Color(10824234),Zn:new THREE.Color(10824234),ZN:new THREE.Color(10824234),Br:new THREE.Color(10824234),BR:new THREE.Color(10824234),Ag:new THREE.Color(8421520),AG:new THREE.Color(8421520),I:new THREE.Color(10494192),Ba:new THREE.Color(16753920),BA:new THREE.Color(16753920),Au:new THREE.Color(14329120),AU:new THREE.Color(14329120)},defaultAtomColor:new THREE.Color(13421772),stdChainColors:[new THREE.Color(3329330),new THREE.Color(2003199),new THREE.Color(16416882),new THREE.Color(16753920),new THREE.Color(52945),new THREE.Color(16738740),new THREE.Color(65280),new THREE.Color(255),new THREE.Color(16711680),new THREE.Color(16776960),new THREE.Color(65535),new THREE.Color(16711935),new THREE.Color(3978097),new THREE.Color(4620980),new THREE.Color(13458524),new THREE.Color(16770229),new THREE.Color(11529966),new THREE.Color(15631086),new THREE.Color(25600),new THREE.Color(139),new THREE.Color(9109504),new THREE.Color(13468991),new THREE.Color(35723),new THREE.Color(9699539)],backgroundColors:{black:new THREE.Color(0),grey:new THREE.Color(13421772),white:new THREE.Color(16777215)},residueColors:{ALA:new THREE.Color(13158600),ARG:new THREE.Color(1334015),ASN:new THREE.Color(56540),ASP:new THREE.Color(15075850),CYS:new THREE.Color(15132160),GLN:new THREE.Color(56540),GLU:new THREE.Color(15075850),GLY:new THREE.Color(15461355),HIS:new THREE.Color(8553170),ILE:new THREE.Color(1016335),LEU:new THREE.Color(1016335),LYS:new THREE.Color(1334015),MET:new THREE.Color(15132160),PHE:new THREE.Color(3289770),PRO:new THREE.Color(14456450),SER:new THREE.Color(16422400),THR:new THREE.Color(16422400),TRP:new THREE.Color(11819700),TYR:new THREE.Color(3289770),VAL:new THREE.Color(1016335),ASX:new THREE.Color(16738740),GLX:new THREE.Color(16738740)},defaultResidueColor:new THREE.Color(12492910),polarityColors:{ARG:new THREE.Color(13369344),HIS:new THREE.Color(13369344),LYS:new THREE.Color(13369344),ASP:new THREE.Color(13369344),GLU:new THREE.Color(13369344),SER:new THREE.Color(13369344),THR:new THREE.Color(13369344),ASN:new THREE.Color(13369344),GLN:new THREE.Color(13369344),TYR:new THREE.Color(13369344),GLY:new THREE.Color(52428),PRO:new THREE.Color(52428),ALA:new THREE.Color(52428),VAL:new THREE.Color(52428),LEU:new THREE.Color(52428),ILE:new THREE.Color(52428),MET:new THREE.Color(52428),PHE:new THREE.Color(52428),CYS:new THREE.Color(52428),TRP:new THREE.Color(52428)},ssColors:{helix:new THREE.Color(16711808),sheet:new THREE.Color(16762880),coil:new THREE.Color(6324479)},defaultBondColor:new THREE.Color(2200790),surfaces:{1:void 0,2:void 0,3:void 0,4:void 0},hasCovalentBond:function(e,i){var t=this.covalentRadii[e.elem]+this.covalentRadii[i.elem];return e.coord.distanceToSquared(i.coord)<1.3*t*t},init:function(){this.structures={},this.chains={},this.residues={},this.secondarys={},this.alignChains={},this.chainsSeq={},this.chainsColor={},this.chainsAnno={},this.chainsAnnoTitle={},this.alignChainsSeq={},this.alignChainsAnno={},this.alignChainsAnnoTitle={},this.displayAtoms={},this.highlightAtoms={},this.prevHighlightObjects=[],this.definedNames2Residues={},this.definedNames2Atoms={},this.definedNames2Descr={},this.definedNames2Command={},this.residueId2Name={},this.moleculeTitle="",this.atoms={},this.displayAtoms={},this.highlightAtoms={},this.proteins={},this.nucleotides={},this.nucleotidesP={},this.ligands={},this.ions={},this.water={},this.calphas={},this.hbondpoints=[],this.atomPrevColors={},this.style2atoms={},this.labels=[],this.lines=[],this.inputid={idtype:void 0,id:void 0},this.biomtMatrices=[],this.bAssembly=!1},loadPDB:function(e){var i=[],t=[],n=e.split("\n"),o={},r={};this.init();var s,a,c=[],l=[],d=[],h=[],u=[],p=[],m=0,g=1,v="",f="",b="",E={};for(var y in n){var w=n[y],_=w.substr(0,6);if("HEADER"===_){var C=w.substr(10,40),S=w.substr(62,4);this.moleculeTitle=C.trim()+" ("+S+")"}else if("HELIX "===_){for(var T,R=w.substr(19,1),k=parseInt(w.substr(21,4)),H=parseInt(w.substr(33,4)),x=k;H>=x;++x)T=R+"_"+x,h.push(T),x===k&&u.push(T),x===H&&p.push(T);i.push({chain:R,initialResidue:k,initialInscode:w.substr(25,1),terminalResidue:H,terminalInscode:w.substr(37,1)})}else if("SHEET "===_){for(var R=w.substr(21,1),k=parseInt(w.substr(22,4)),H=parseInt(w.substr(33,4)),x=k;H>=x;++x){var T=R+"_"+x;c.push(T),x===k&&l.push(T),x===H&&d.push(T)}t.push({chain:R,initialResidue:k,initialInscode:w.substr(26,1),terminalResidue:H,terminalInscode:w.substr(37,1)})}else if("HBOND "===_){bCalculateHbond=!1;var A=(w.substr(6,1),w.substr(8,4).replace(/ /g,""),w.substr(14,4).replace(/ /g,""),w.substr(18,1),w.substr(20,4).replace(/ /g,""),w.substr(25,4).replace(/ /g,""),parseFloat(w.substr(30,8))),O=parseFloat(w.substr(38,8)),M=parseFloat(w.substr(46,8)),L=parseFloat(w.substr(54,8)),I=parseFloat(w.substr(62,8)),D=parseFloat(w.substr(70,8));w.substr(78,8).replace(/ /g,"");this.hbondpoints.push(new THREE.Vector3(A,O,M)),this.hbondpoints.push(new THREE.Vector3(L,I,D))}else if("REMARK"===_){var z=parseInt(w.substr(7,3));if(350==z&&"BIOMT"==w.substr(13,5)){var N=parseInt(w[18])-1,j=parseInt(w.substr(21,2));void 0==this.biomtMatrices[j]&&(this.biomtMatrices[j]=(new THREE.Matrix4).identity()),this.biomtMatrices[j].elements[N]=parseFloat(w.substr(24,9)),this.biomtMatrices[j].elements[N+4]=parseFloat(w.substr(34,9)),this.biomtMatrices[j].elements[N+8]=parseFloat(w.substr(44,9)),this.biomtMatrices[j].elements[N+12]=parseFloat(w.substr(54,10))}}else if("ENDMDL"===_)++g;else if("JRNL  "===_)"PMID"===w.substr(12,4)&&(this.pmid=w.substr(19).trim());else if("ATOM  "===_||"HETATM"===_){var q=w.substr(16,1);++m;var B=parseInt(w.substr(6,5));E[B]=m;var P=w.substr(76,2).replace(/ /g,"");""===P&&(P=w.substr(12,2).replace(/ /g,""));var V=w.substr(21,1);""===V&&(V=1);var F=parseInt(w.substr(22,4)),G=w.substr(12,4).replace(/ /g,""),T=V+"_"+F,U=parseFloat(w.substr(30,8)),Y=parseFloat(w.substr(38,8)),W=parseFloat(w.substr(46,8)),X=w.substr(17,3),Z=new THREE.Vector3(U,Y,W),Q={het:"H"===_[0],serial:m,name:G,alt:q,resn:X,structure:g,chain:V,resi:F,coord:Z,b:parseFloat(w.substr(60,8)),elem:P,bonds:[],ss:"coil",ssbegin:!1,ssend:!1};this.atoms[m]=Q,this.displayAtoms[m]=1,this.highlightAtoms[m]=1,-1!==$.inArray(T,h)?(this.atoms[m].ss="helix",-1!==$.inArray(T,u)&&(this.atoms[m].ssbegin=!0),-1!==$.inArray(T,p)&&(this.atoms[m].ssend=!0)):-1!==$.inArray(T,c)&&(this.atoms[m].ss="sheet",-1!==$.inArray(T,l)&&(this.atoms[m].ssbegin=!0),-1!==$.inArray(T,d)&&(this.atoms[m].ssend=!0)),s=g+"_"+V,a=s+"_"+F;var K="-";if("helix"===this.atoms[m].ss?K="H":"sheet"===this.atoms[m].ss?K="E":this.atoms[m].het||(K="C"),this.secondarys[a]=K,a!==f){var J=this.residueName2Abbr(X);if(this.residueId2Name[a]=J,1!==m&&(this.residues[f]=r),r={},s!==v){1!==m&&(this.chains[v]=this.unionHash2Atoms(this.chains[v],o)),o={},void 0===this.structures[g.toString()]&&(this.structures[g.toString()]=[]),this.structures[g.toString()].push(s),void 0===this.chainsSeq[s]&&(this.chainsSeq[s]=[]),void 0===this.chainsAnno[s]&&(this.chainsAnno[s]=[]),void 0===this.chainsAnno[s][0]&&(this.chainsAnno[s][0]=[]),void 0===this.chainsAnno[s][1]&&(this.chainsAnno[s][1]=[]),void 0===this.chainsAnnoTitle[s]&&(this.chainsAnnoTitle[s]=[]),void 0===this.chainsAnnoTitle[s][0]&&(this.chainsAnnoTitle[s][0]=[]),void 0===this.chainsAnnoTitle[s][1]&&(this.chainsAnnoTitle[s][1]=[]);var ee={};ee.resi=F,ee.name=J,this.chainsSeq[s].push(ee);var ie="";F%10===0&&(ie=F.toString()),this.chainsAnno[s][0].push(ie),this.chainsAnno[s][1].push(K),this.chainsAnnoTitle[s][0].push(""),this.chainsAnnoTitle[s][1].push("SS")}else{var ee={};ee.resi=F,ee.name=J,this.chainsSeq[s].push(ee);var ie="";F%10===0&&(ie=F.toString()),this.chainsAnno[s][0].push(ie),this.chainsAnno[s][1].push(K)}}o[m]=1,r[m]=1,b=_,v=s,f=a}else if("CONECT"===_)for(var te=parseInt(w.substr(6,5)),x=0;4>x;++x){var ne=parseInt(w.substr([11,16,21,26][x],5));isNaN(ne)||void 0!==this.atoms[E[te]]&&this.atoms[E[te]].bonds.push(E[ne])}else"TER   "===_&&++m}n=null;var J=this.residueName2Abbr(X);this.chains[s]=o,this.residues[a]=r;var oe,re,se=[],ae=this,ce=function(e){for(var i=se.length,t=0;i>t;++t){for(var n=se[t],o=t+1;i>o;++o){var r=se[o];n.alt===r.alt&&ae.hasCovalentBond(n,r)&&(n.bonds.push(r.serial),r.bonds.push(n.serial))}e&&e(n)}},le=new THREE.Vector3(9999,9999,9999),de=new THREE.Vector3(-9999,-9999,-9999),he=new THREE.Vector3,ue=0;for(var y in this.atoms){var G=this.atoms[y],Z=G.coord;he.add(Z),le.min(Z),de.max(Z),++ue,G.het?G.het&&("HOH"===G.resn||"WAT"===G.resn?this.water[G.serial]=1:-1!==$.inArray(G.resn,this.ionsArray)?this.ions[G.serial]=1:this.ligands[G.serial]=1):-1!==$.inArray(G.resn,this.nucleotidesArray)?(this.nucleotides[G.serial]=1,"P"===G.name&&(this.nucleotidesP[G.serial]=1)):(this.proteins[G.serial]=1,"CA"===G.name&&(this.calphas[G.serial]=1)),(oe!==G.chain||re!==G.resi)&&(ce(function(e){("C"===e.name&&"N"===G.name||"O3'"===e.name&&"P"===G.name)&&ae.hasCovalentBond(e,G)&&(e.bonds.push(G.serial),G.bonds.push(e.serial))}),oe=G.chain,re=G.resi,se.length=0),se.push(G)}ce(),this.pmin=le,this.pmax=de,this.cnt=ue,this.maxD=this.pmax.distanceTo(this.pmin),this.center=he.multiplyScalar(1/this.cnt),this.maxD<25&&(this.maxD=25)},cloneHash:function(e,i){for(var t in e)i[t]=e[t]},residueName2Abbr:function(e){switch(void 0!==e&&" "!==e.charAt(0)&&" "===e.charAt(1)&&(e=e.charAt(0)),e){case"  A":return"A";case"  C":return"C";case"  G":return"G";case"  T":return"T";case"  U":return"U";case"  I":return"I";case"ALA":return"A";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"CYS":return"C";case"GLU":return"E";case"GLN":return"Q";case"GLY":return"G";case"HIS":return"H";case"ILE":return"I";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"THR":return"T";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"SEC":return"U";case"PYL":return"O";default:return e}},calculateLigandHbonds:function(e,i,t){if(0!==Object.keys(e).length&&0!==Object.keys(i).length){var n,o={},r=t*t;for(var s in e){var a=e[s];("N"===a.elem||"O"===a.elem||"F"===a.elem)&&(n=a.structure+"_"+a.chain+"_"+a.resi+"_"+a.name,o[n]=a)}this.highlightAtoms={};for(var s in i){var a=i[s];if("N"===a.elem||"O"===a.elem||"F"===a.elem){n=a.structure+"_"+a.chain+"_"+a.resi+"_"+a.name;for(var c in o){var l=Math.abs(a.coord.x-o[c].coord.x);if(!(l>t)){var d=Math.abs(a.coord.y-o[c].coord.y);if(!(d>t)){var h=Math.abs(a.coord.z-o[c].coord.z);if(!(h>t)){var u=l*l+d*d+h*h;if(!(u>r)){var p=c.indexOf("_"),m=c.lastIndexOf("_"),g=c.substr(0,p),v=c.substr(p+1,m-p-1);m=v.lastIndexOf("_");var f=v.substr(0,m),b=v.substr(m+1);this.hbondpoints.push(a.coord),this.hbondpoints.push(o[c].coord),this.highlightAtoms=this.unionHash(this.highlightAtoms,this.residues[g+"_"+f+"_"+b])}}}}}}}}},createSphere:function(e,i,t,n,o){var r;if(void 0===i&&(i=.8),void 0===t&&(t=!1),void 0===n&&(n=1),2===o){n>.9?n=1.5:.5>n&&(n=1);var s=this.highlightColor;r=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:s}))}else if(1===o)r=new THREE.Mesh(this.sphereGeometry,this.matShader);else{var s=e.color;r=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:s}))}r.scale.x=r.scale.y=r.scale.z=t?i:(this.vdwRadii[e.elem]||i)*(n?n:1),r.position.copy(e.coord),this.mdl.add(r),1===o||2===o?this.prevHighlightObjects.push(r):this.objects.push(r)},createBox:function(e,i,t,n,o,r){var s;void 0===i&&(i=.8),void 0===t&&(t=!1),void 0===n&&(n=.8),r?(void 0===o&&(o=this.highlightColor),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:o}))):(void 0===o&&(o=e.color),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:o}))),s.scale.x=s.scale.y=s.scale.z=t?i:(this.vdwRadii[e.elem]||i)*(n?n:1),s.position.copy(e.coord),this.mdl.add(s),r?this.prevHighlightObjects.push(s):this.objects.push(s)},createCylinder:function(e,i,t,n,o){var r;2===o?(r=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:n})),t*=1.5):r=1===o?new THREE.Mesh(this.cylinderGeometryOutline,this.matShader):new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:n})),r.position.copy(e).add(i).multiplyScalar(.5),r.matrixAutoUpdate=!1,r.lookAt(e),r.updateMatrix(),r.matrix.multiply((new THREE.Matrix4).makeScale(t,t,e.distanceTo(i))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),this.mdl.add(r),1===o||2===o?this.prevHighlightObjects.push(r):this.objects.push(r)},createRepresentationSub:function(e,i,t){new THREE.Geometry;for(var n in e){var o=e[n];i&&i(o);for(var r in o.bonds){var s=this.atoms[o.bonds[r]];void 0===s||s.serial<o.serial||t&&t(o,s)}}},createSphereRepresentation:function(e,i,t,n,o){var r=this;this.createRepresentationSub(e,function(e){r.createSphere(e,i,t,n,o)})},createBoxRepresentation_P_CA:function(e,i,t){var n=this;this.createRepresentationSub(e,function(e){("CA"===e.name||"P"===e.name)&&n.createBox(e,void 0,void 0,i,void 0,t)})},createStickRepresentation:function(e,i,t,n,o){var r=this;2!==o?this.createRepresentationSub(e,function(e){r.createSphere(e,i,!n,n,o)},function(e,i){if(e.color===i.color)r.createCylinder(e.coord,i.coord,t,e.color,o);else{var n=e.coord.clone().add(i.coord).multiplyScalar(.5);r.createCylinder(e.coord,n,t,e.color,o),r.createCylinder(i.coord,n,t,i.color,o)}}):2===o&&this.createBoxRepresentation_P_CA(e,1.2,o)},createLineRepresentation:function(e,i){var t=new THREE.Geometry;if(this.createRepresentationSub(e,void 0,function(e,i){if(e.color===i.color)t.vertices.push(e.coord),t.vertices.push(i.coord),t.colors.push(e.color),t.colors.push(i.color);else{var n=e.coord.clone().add(i.coord).multiplyScalar(.5);t.vertices.push(e.coord),t.vertices.push(n),t.vertices.push(i.coord),t.vertices.push(n),t.colors.push(e.color),t.colors.push(e.color),t.colors.push(i.color),t.colors.push(i.color)}}),2!==i){var n;1===i||(n=new THREE.Line(t,new THREE.LineBasicMaterial({linewidth:this.linewidth,vertexColors:!0}),THREE.LinePieces)),this.mdl.add(n),1===i?this.prevHighlightObjects.push(n):this.objects.push(n)}else 2===i&&this.createBoxRepresentation_P_CA(e,.8,i)},subdivide:function(e,i,t,n){var o=[],r=[],s=new Array;s.push(e[0]);for(var a=1,c=e.length-1;c>a;++a){var l=e[a],d=e[a+1];s.push(l.smoothen?l.clone().add(d).multiplyScalar(.5):l)}s.push(e[e.length-1]);
for(var h=[],u=[],a=-1,p=s.length,m=1/i;p-3>=a;++a){var l=s[-1===a?0:a],d=s[a+1],g=s[a+2],v=s[a===p-3?p-1:a+3],f=g.clone().sub(l).multiplyScalar(.5),b=v.clone().sub(d).multiplyScalar(.5);a>-1&&void 0!==t&&t[a+1]&&(o=o.concat(h),r=r.concat(u)),h=[],u=[];for(var E=0;i>E;++E){var y=m*E,w=d.x+y*f.x+y*y*(-3*d.x+3*g.x-2*f.x-b.x)+y*y*y*(2*d.x-2*g.x+f.x+b.x),_=d.y+y*f.y+y*y*(-3*d.y+3*g.y-2*f.y-b.y)+y*y*y*(2*d.y-2*g.y+f.y+b.y),C=d.z+y*f.z+y*y*(-3*d.z+3*g.z-2*f.z-b.z)+y*y*y*(2*d.z-2*g.z+f.z+b.z);t?(t[a+1]&&E<=parseInt(i/2)&&(o.push(new THREE.Vector3(w,_,C)),r.push(t[a+1])),t[a+2]&&E>parseInt(i/2)&&(h.push(new THREE.Vector3(w,_,C)),u.push(t[a+2]))):(o.push(new THREE.Vector3(w,_,C)),r.push(a+1))}}return(!t||t[a+1])&&(o=o.concat(h),r=r.concat(u),o.push(s[s.length-1]),r.push(s.length-1)),points_positions=[],points_positions.push(o),points_positions.push(r),points_positions},createCurveSubArrow:function(e,i,t,n,o,r,s,a,c,l,d){var h=[],u=[];h.push(e),u.push(a),this.prepareStrand(h,u,i,t,n,void 0,o,r,s,c,l,!1,d)},createCurveSub:function(e,i,t,n,o,r,s,a,c){if(0!==e.length){n=n||5;var l;if(l=s?e:this.subdivide(e,n,a,o)[0],0!==l.length){var d=new THREE.Geometry;if(2===o&&r)for(var h=0,u=1/n;h<l.length;++h)l[h].addScalar(.6),d.vertices.push(l[h]),d.colors.push(new THREE.Color(t[0===h?0:Math.round((h-1)*u)]));else if(1===o){var p=this.coilWidth/2,m=32,g=!1;if(l.length>1)if(void 0!==c)for(var v,f,b=[],h=0,E=l.length;E>h;++h){if(v=c[h],v!==f&&v!==f+1&&void 0!==f||h===E-1){var y=new THREE.TubeGeometry(new THREE.SplineCurve3(b),b.length,p,m,g);mesh=new THREE.Mesh(y,this.matShader),this.mdl.add(mesh),this.prevHighlightObjects.push(mesh),b=[]}b.push(l[h]),f=v}else{var y=new THREE.TubeGeometry(new THREE.SplineCurve3(l),l.length,p,m,g);mesh=new THREE.Mesh(y,this.matShader),this.mdl.add(mesh),this.prevHighlightObjects.push(mesh)}}else for(var h=0,u=1/n;h<l.length;++h)d.vertices.push(l[h]),d.colors.push(new THREE.Color(t[0===h?0:Math.round((h-1)*u)]));var w=new THREE.Line(d,new THREE.LineBasicMaterial({linewidth:i,vertexColors:!0}),THREE.LineStrip);this.mdl.add(w),2===o?this.prevHighlightObjects.push(w):this.objects.push(w)}}},createLines:function(e){if(void 0!==e)for(var i in e){var t,n=e[i],o=n.position1,r=n.position2;if(n.color){var s=/^\#([0-9a-f]{6})$/i.exec(n.color);t=parseInt(s[1],16)}else t=16776960;var a=n.dashed?n.dashed:!1,c=.3;this.mdl.add(this.createSingleLine(o,r,t,a,c))}},createCylinderCurve:function(e,i,t,n,o){var r,s,a,c=null;for(a in e){var l=e[a];if(!l.het&&l.name===i){if(null!==c&&r===l.chain&&s+1===l.resi){var d=c.coord.clone().add(l.coord).multiplyScalar(.5);if(o)1===o&&(this.createCylinder(c.coord,d,t,c.color,o),this.createCylinder(d,l.coord,t,l.color,o),this.createSphere(l,t,!0,1,o));else if(n){var h=this.createSingleLine(c.coord,d,c.color,!1);this.mdl.add(h),this.objects.push(h),h=this.createSingleLine(d,l.coord,l.color,!1),this.mdl.add(h),this.objects.push(h)}else this.createCylinder(c.coord,d,t,c.color),this.createCylinder(d,l.coord,t,l.color),this.createSphere(l,t,!0,1)}c=l,r=l.chain,s=l.resi,2===o&&this.createBox(l,void 0,void 0,void 0,void 0,o)}}if(null!==c&&r===l.chain&&s+1===l.resi){var d=c.coord.add(l.coord).multiplyScalar(.5);if(o)1===o&&(this.createCylinder(c.coord,d,t,c.color,o),this.createCylinder(d,l.coord,t,l.color,o),this.createSphere(l,t,!0,1,o));else if(n){var h=this.createSingleLine(c.coord,d,c.color,!1);this.mdl.add(h),this.objects.push(h),h=this.createSingleLine(d,l.coord,l.color,!1),this.mdl.add(h),this.objects.push(h)}else this.createCylinder(c.coord,d,t,c.color),this.createCylinder(d,l.coord,t,l.color)}},prepareStrand:function(e,i,t,n,o,r,s,a,c,l,d,h,u){if(1!==l.length){o=o||this.axisDIV;for(var p,m,g,v,f=2/(c-1),b={},E=[],y=0,w=i.length;w>y;++y)b[y]=[];var _=this.subdivide(l,o)[0];if(1!==_.length){for(var y=0,w=l.length-2;w>y;++y){for(var C=0,S=i.length;S>C;++C)b[C].push(e[C][y]);E.push(n[y])}E.push(n[y]);for(var y=0,w=i.length;w>y;++y)p=-1+f*i[y],m=_.length-1-o,g=l.length-2,v=new THREE.Vector3(_[m].x+d[g].x*p,_[m].y+d[g].y*p,_[m].z+d[g].z*p),b[y].push(v);for(var T=[],y=0,w=i.length;w>y;++y){var R=this.subdivide(b[y],o,u,s);b[y]=R[0],0===y&&(T=R[1])}h?this.createStrip(b[0],b[1],E,o,r,s,!0,void 0,T):this.createCurveSub(b[0],t,E,o,s,a,!0,void 0,T);for(var y=0,w=i.length;w>y;++y)b[y]=[];E=[],T=[];for(var C=0,S=i.length;S>C;++C){b[C]=[];for(var y=o*(l.length-2),w=o*(l.length-1);u[parseInt(y/o)]&&w>y;y+=o)for(var k=parseInt(y/o),H=0;o>H;++H){var p=-1+f*i[C],x=1.8;p=p*x*(o-H)/o;var A=parseInt(y/o),v=new THREE.Vector3(_[y+H].x+d[A].x*p,_[y+H].y+d[A].y*p,_[y+H].z+d[A].z*p);v.smoothen=!0,b[C].push(v),0===C&&T.push(k)}var p=0,m=_.length-1,g=l.length-1,v=new THREE.Vector3(_[m].x+d[g].x*p,_[m].y+d[g].y*p,_[m].z+d[g].z*p);v.smoothen=!0,b[C].push(v),0===C&&T.push(m)}E.push(n[n.length-2]),E.push(n[n.length-1]),h?this.createStrip(b[0],b[1],E,o,r,s,!0,void 0,T):this.createCurveSub(b[0],t,E,o,s,a,!0,void 0,T)}}},createStripArrow:function(e,i,t,n,o,r,s,a,c,l,d,h){var u=[],p=[];u.push(e),u.push(i),p.push(a),p.push(c),this.prepareStrand(u,p,void 0,t,n,o,r,void 0,s,l,d,!0,h)},createStrip:function(e,i,t,n,o,r,s,a,c){if(!(e.length<2||(n=n||this.axisDIV,s||(e=this.subdivide(e,n,a,r)[0],i=this.subdivide(i,n,a,r)[0]),e.length<2))){for(var l,d,h,u,p,m=new THREE.Geometry,g=m.vertices,v=m.faces,f=0,b=e.length;b>f;++f)g.push(d=e[f]),g.push(d),g.push(h=i[f]),g.push(h),b-1>f&&(l=i[f].clone().sub(e[f]).cross(e[f+1].clone().sub(e[f])).normalize().multiplyScalar(o)),g.push(u=e[f].clone().add(l)),g.push(u),g.push(p=i[f].clone().add(l)),g.push(p);for(var E=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]],f=1,b=e.length,y=1/n;b>f;++f)for(var w=8*f,_=new THREE.Color(t[Math.round((f-1)*y)]),C=0;4>C;++C)v.push(new THREE.Face3(w+E[C][0],w+E[C][1],w+E[C][2],void 0,_)),v.push(new THREE.Face3(w+E[C][3],w+E[C][0],w+E[C][2],void 0,_));for(var S=g.length-8,f=0;4>f;++f)g.push(g[2*f]),g.push(g[S+2*f]);S+=8,v.push(new THREE.Face3(S,S+2,S+6,void 0,v[0].color)),v.push(new THREE.Face3(S+4,S,S+6,void 0,v[0].color)),v.push(new THREE.Face3(S+1,S+5,S+7,void 0,v[v.length-3].color)),v.push(new THREE.Face3(S+3,S+1,S+7,void 0,v[v.length-3].color)),m.computeFaceNormals(),m.computeVertexNormals(!1);var T;if(2===r)T=new THREE.Mesh(m,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(T),this.prevHighlightObjects.push(T);else if(1===r){var R=this.coilWidth/2,k=32,H=!1;if(void 0!==c)for(var x,A,$=[],O=[],f=0,M=e.length;M>f;++f){if(x=c[f],x!==A&&x!==A+1&&void 0!==A||f===M-1){var L=new THREE.TubeGeometry(new THREE.SplineCurve3($),$.length,R,k,H);T=new THREE.Mesh(L,this.matShader),this.mdl.add(T),this.prevHighlightObjects.push(T);var I=new THREE.TubeGeometry(new THREE.SplineCurve3(O),O.length,R,k,H);T=new THREE.Mesh(I,this.matShader),this.mdl.add(T),this.prevHighlightObjects.push(T),$=[],O=[]}$.push(e[f]),O.push(i[f]),A=x}else{var L=new THREE.TubeGeometry(new THREE.SplineCurve3(e),e.length,R,k,H);T=new THREE.Mesh(L,this.matShader),this.mdl.add(T),this.prevHighlightObjects.push(T);var I=new THREE.TubeGeometry(new THREE.SplineCurve3(i),i.length,R,k,H);T=new THREE.Mesh(I,this.matShader),this.mdl.add(T),this.prevHighlightObjects.push(T)}}else T=new THREE.Mesh(m,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(T),this.objects.push(T)}},createBrick:function(e,i){for(var t=new THREE.Geometry,n=0,o=e.length;o>n;++n)t.vertices.push(new THREE.Vector3(e[n][0],e[n][1],e[n][2]));t.faces=[new THREE.Face3(1,5,7,void 0,i),new THREE.Face3(1,7,3,void 0,i),new THREE.Face3(0,2,6,void 0,i),new THREE.Face3(0,6,4,void 0,i),new THREE.Face3(2,3,7,void 0,i),new THREE.Face3(2,7,6,void 0,i),new THREE.Face3(0,4,5,void 0,i),new THREE.Face3(0,5,1,void 0,i),new THREE.Face3(4,6,7,void 0,i),new THREE.Face3(4,7,5,void 0,i),new THREE.Face3(0,1,3,void 0,i),new THREE.Face3(0,3,2,void 0,i)],t.computeFaceNormals(),t.computeVertexNormals(!1);var r;r=new THREE.Mesh(t,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(r),this.objects.push(r)},getFirstAtomObj:function(e){var i=Object.keys(e),t=i[0];return this.atoms[t]},getLastAtomObj:function(e){var i=Object.keys(e),t=i[i.length-1];return this.atoms[t]},createStrand:function(e,i,t,n,o,r,s,a,c){var l=n?!0:!1,d={};if(1===c||2===c){var h,u,p,m,g,v,f,b,E=0,y=Object.keys(e).length;this.cloneHash(e,d);for(var w in e){if(h=e[w].structure+"_"+e[w].chain,u=parseInt(e[w].resi),p=e[w],void 0===m&&(f=e[w]),h!==m&&void 0!==m||u!==g&&u!==g+1&&void 0!==g||E===y-1){h!==m&&void 0!==m||u!==g&&u!==g+1&&void 0!==g?b=v:E===y-1&&(b=p);var _=f.resi;if("coil"!==f.ss&&!f.ssbegin){for(var C=f.resi-1;C>0;--C){var S=f.structure+"_"+f.chain+"_"+C;if(!this.residues.hasOwnProperty(S))break;var T=this.getFirstAtomObj(this.residues[S]);if(T.ss===f.ss&&T.ssbegin){_=T.resi;break}}for(var C=_;C<f.resi;++C){var S=f.structure+"_"+f.chain+"_"+C;d=this.unionHash(d,this.hash2Atoms(this.residues[S]))}}var R=b.resi;if("coil"!==b.ss&&!b.ssend&&!b.notshow){for(var k=this.getLastAtomObj(this.chains[b.structure+"_"+b.chain]).resi,C=b.resi+1;k>=C;++C){var S=b.structure+"_"+b.chain+"_"+C;if(!this.residues.hasOwnProperty(S))break;var T=this.getFirstAtomObj(this.residues[S]);if(T.ss===b.ss&&T.ssend){R=T.resi;break}}for(var C=b.resi+1;R>=C;++C){var S=b.structure+"_"+b.chain+"_"+C;d=this.unionHash(d,this.hash2Atoms(this.residues[S]))}}b.notshow&&(b.notshow=void 0),f=p}m=h,g=u,v=p,++E}}else d=e;2===c&&(n?(n=!1,i=null,t=null,o=null,r=null,a=void 0):(n=!0,i=2,t=void 0,o=void 0,r=void 0,a=this.thickness)),i=i||this.strandDIV,t=t||this.axisDIV,o=o||this.coilWidth,s=s||!1,r=r||this.helixSheetWidth;for(var H={},x=0;i>x;++x)H[x]=[];var A,$,O,T,M=[],L=[],I=[],D=[],z=null,N=null,j=null,q=null,B=null,P=null,V=null,F=null,G=!1,U=null,Y=null,g=null,W=!1,X=!1,Z={};this.bCalphaOnly=!1;var E=0,Q=30,K=!1;for(var C in d){if(!(Q>E))break;if("CA"!==d[C].name){K=!0;break}++E}K||(this.bCalphaOnly=!0);var J=this.hash2Atoms(d),ee={};for(var C in J){var T=J[C];S=T.structure+"_"+T.chain+"_"+T.resi,ee[S]=1}var ie=Object.keys(ee).length,te=0,ne=0;for(var C in d){T=d[C];if(("O"===T.name||"CA"===T.name)&&!T.het&&("CA"===T.name&&(e.hasOwnProperty(C)&&("coil"===T.ss||T.ssend||T.ssbegin)&&(Z[C]=T),z=T.coord.clone(),j=T.color),"O"===T.name||this.bCalphaOnly&&"CA"===T.name)){"O"===T.name&&(N=T.coord.clone());var oe=!0;if((A!==T.chain||$+1!==T.resi)&&(oe=!1),T.ssend&&"sheet"===T.ss?W=!0:T.ssend&&"helix"===T.ss&&(X=!0),B){1===c||2===c?D.push(this.highlightColor):D.push(P),O="coil"!==F&&"coil"===T.ss?o:G&&T.ssbegin?o:"coil"===F?o:r;var re;"O"===T.name?(re=B.clone(),re.sub(q)):this.bCalphaOnly&&"CA"===T.name&&(re=new THREE.Vector3(Math.random(),Math.random(),Math.random())),re.normalize(),re.multiplyScalar(O),null!==V&&re.dot(V)<0&&re.negate(),V=re;for(var se=0,ae=2/(i-1);i>se;++se){var ce=-1+ae*se,le=new THREE.Vector3(q.x+V.x*ce,q.y+V.y*ce,q.z+V.z*ce);s||"coil"===F||(le.smoothen=!0),H[se].push(le)}M.push(q),L.push(V),e.hasOwnProperty(Y)?(I.push(g),++ne):I.push(0),++te}if((T.ssbegin||T.ssend||te===ie-1)&&H[0].length>0&&oe){1===c||2===c?D.push(this.highlightColor):D.push(T.color),O=T.ssend&&"sheet"===T.ss?0:"coil"===F&&T.ssbegin?o:G&&T.ssbegin?o:"coil"===T.ss?o:r;var re;"O"===T.name?(re=N.clone(),re.sub(z)):this.bCalphaOnly&&"CA"===T.name&&(re=new THREE.Vector3(Math.random(),Math.random(),Math.random())),re.normalize(),re.multiplyScalar(O),null!==V&&re.dot(V)<0&&re.negate(),V=re;for(var se=0,ae=2/(i-1);i>se;++se){var ce=-1+ae*se,le=new THREE.Vector3(z.x+V.x*ce,z.y+V.y*ce,z.z+V.z*ce);s||"coil"===F||(le.smoothen=!0),H[se].push(le)}U=T.serial,M.push(z),L.push(V),e.hasOwnProperty(U)?I.push(T.resi):I.push(0);for(var se=0;!n&&i>se;++se)W?this.createCurveSubArrow(H[se],1,D,t,c,l,i,se,M,L,I):this.createCurveSub(H[se],1,D,t,c,l,!1,I);if(n)if(W){var de=0,he=i-1;this.createStripArrow(H[0],H[i-1],D,t,a,c,i,de,he,M,L,I)}else X?this.createStrip(H[0],H[i-1],D,t,a,c,!1,I):2===c&&this.createStrip(H[0],H[i-1],D,t,a,c,!1,I);for(var x=0;i>x;++x)H[x]=[];D=[],M=[],L=[],I=[],W=!1,X=!1}if((A!==T.chain||$+1!==T.resi)&&H[0].length>0){for(var se=0;!n&&i>se;++se)W?this.createCurveSubArrow(H[se],1,D,t,c,l,i,se,M,L,I):X&&this.createCurveSub(H[se],1,D,t,c,l,!1,I);if(n)if(W){var de=0,he=i-1;this.createStripArrow(H[0],H[i-1],D,t,a,c,i,de,he,M,L,I)}else X&&this.createStrip(H[0],H[i-1],D,t,a,c,!1,I);for(var x=0;i>x;++x)H[x]=[];D=[],M=[],L=[],I=[],W=!1,X=!1}A=T.chain,$=T.resi,F=T.ss,G=T.ssend,Y=T.serial,g=T.resi,q=z,B=T.coord,P=j}}this.createTube(Z,"CA",.3,c)},createStrandBrick:function(e,i,t){for(var n=this.strandDIV,o=this.axisDIV,r=!1,s=this.helixSheetWidth,a={},c=0;n>c;++c)a[c]=[];for(var l=[],d=null,h=0;2>h;++h){var u=e.coords[h];l.push(new THREE.Color(i));var p=new THREE.Vector3(e.coords[2].x,e.coords[2].y,e.coords[2].z);p.normalize(),p.multiplyScalar(s),null!==d&&p.dot(d)<0&&p.negate(),d=p;for(var m=0,g=2/(n-1);n>m;++m){var v=-1+g*m,f=new THREE.Vector3(u.x+d.x*v,u.y+d.y*v,u.z+d.z*v);r||(f.smoothen=!0),a[m].push(f)}}this.createStrip(a[0],a[n-1],l,o,t)},createTubeSub:function(e,i,t,n){if(!(e.length<2)){for(var o,r=this.tubeDIV,s=this.axisDIV,a=1/r,c=1/s,l=new THREE.Geometry,d=this.subdivide(e,s)[0],h=new THREE.Vector3,u=0,p=d.length;p>u;++u){var m,g=(u-1)*c;if(0===u)m=t[0];else if(g%1===0)m=t[g];else{var v=Math.floor(g),f=g-v;m=t[v]*f+t[v+1]*(1-f)}var b,E,y;p-1>u?(b=d[u].clone().sub(d[u+1]),E=new THREE.Vector3(0,-b.z,b.y).normalize().multiplyScalar(m),y=b.clone().cross(E).normalize().multiplyScalar(m),h.dot(E)<0&&(E.negate(),y.negate()),h=E,o=y):(E=h,y=o);for(var w=0;r>w;++w){var _=2*Math.PI*a*w;l.vertices.push(d[u].clone().add(E.clone().multiplyScalar(Math.cos(_))).add(y.clone().multiplyScalar(Math.sin(_))))}}for(var C=0,u=0,p=d.length-1;p>u;++u){var S=new THREE.Color(i[Math.round((u-1)*c)]),T=0,R=l.vertices[C].clone().sub(l.vertices[C+r]).lengthSq(),k=l.vertices[C].clone().sub(l.vertices[C+r+1]).lengthSq();R>k&&(R=k,T=1);for(var w=0;r>w;++w)l.faces.push(new THREE.Face3(C+w,C+(w+T)%r+r,C+(w+1)%r,void 0,S)),l.faces.push(new THREE.Face3(C+(w+1)%r,C+(w+T)%r+r,C+(w+T+1)%r+r,void 0,S));C+=r}l.computeFaceNormals(),l.computeVertexNormals(!1);var H;H=2===n?new THREE.Mesh(l,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})):1===n?new THREE.Mesh(l,this.matShader):new THREE.Mesh(l,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(H),1===n||2===n?this.prevHighlightObjects.push(H):this.objects.push(H)}},createTube:function(e,i,t,n){var o,r,s=[],a=[],c=[];for(var l in e){var d=e[l];if(d.name===i&&!d.het){(o!==d.chain||r+1!==d.resi)&&(2!==n&&this.createTubeSub(s,a,c,n),s=[],a=[],c=[]),s.push(d.coord),c.push(t||(d.b>0?.01*d.b:.3)),a.push(d.color),o=d.chain,r=d.resi;var h=1.2;2!==n||d.ssbegin||this.createBox(d,void 0,void 0,h,void 0,n)}}2!==n&&this.createTubeSub(s,a,c,n)},createCylinderHelix:function(e,i,t){var n,o,r,s=null,a={},c={};for(r in e){var l=e[r];l.het||(("helix"!==l.ss&&"sheet"!==l.ss||l.ssend||l.ssbegin)&&(a[l.serial]=l),"sheet"===l.ss&&(c[l.serial]=l),"CA"===l.name&&("helix"===l.ss&&l.ssend&&(null!==s&&n===l.chain&&o<l.resi&&(1===t||2===t?this.createCylinder(s.coord,l.coord,i,this.highlightColor,t):this.createCylinder(s.coord,l.coord,i,l.color)),s=null),null===s&&"helix"===l.ss&&l.ssbegin&&(s=l,n=l.chain,o=l.resi)))}1===t||2===t?(Object.keys(a).length>0&&this.createTube(a,"CA",.3,t),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.thickness,t)):(Object.keys(a).length>0&&this.createTube(a,"CA",.3),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.thickness))},createSurfaceRepresentation:function(e,i,t,n){var o,r=ProteinSurface({min:this.pmin,max:this.pmax,atoms:e,type:i}),s=r.verts,a=r.faces;o=new THREE.Geometry,o.vertices=s.map(function(e){var i=new THREE.Vector3(e.x,e.y,e.z);return i.atomid=e.atomid,i}),o.faces=a.map(function(e){return new THREE.Face3(e.a,e.b,e.c)}),r=null,o.computeFaceNormals(),o.computeVertexNormals(!1),o.colorsNeedUpdate=!0,o.faces.forEach(function(i){i.vertexColors=["a","b","c"].map(function(t){return e[o.vertices[i[t]].atomid].color})});var c=new THREE.Mesh(o,new THREE.MeshLambertMaterial({overdraw:this.overdraw,vertexColors:THREE.VertexColors,wireframe:t,opacity:n,transparent:!0}));this.mdl.add(c),o=null},drawNucleicAcidStick:function(e,i){var t,n,o,r=null,s=null;for(o in e){var a=e[o];void 0===a||a.het||((a.resi!==n||a.chain!==t)&&(null!==r&&null!==s&&this.createCylinder(new THREE.Vector3(r.coord.x,r.coord.y,r.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),.3,r.color,i),r=null,s=null),"O3'"===a.name&&(r=a),"  A"===a.resn||"  G"===a.resn||" DA"===a.resn||" DG"===a.resn?"N1"===a.name&&(s=a):"N3"===a.name&&(s=a),n=a.resi,t=a.chain)}null!==r&&null!==s&&this.createCylinder(new THREE.Vector3(r.coord.x,r.coord.y,r.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),.3,r.color,i)},drawCartoonNucleicAcid:function(e,i,t,n){this.drawStrandNucleicAcid(e,2,i,!0,void 0,t,n)},drawStrandNucleicAcid:function(e,i,t,n,o,r,s){2===s&&(i=void 0,r=void 0),o=o||this.nucleicAcidWidth,t=t||this.axisDIV,i=i||this.nucleicAcidStrandDIV;var a,c,l,d=[];for(l=0;i>l;l++)d[l]=[];var h,u,p,m=[],g=null;for(a in e){var v=e[a];if(void 0!==v&&("O3'"===v.name||"OP2"===v.name)&&!v.het)if("O3'"===v.name){if(h!==v.chain||u+1!==v.resi){if(p&&g)for(c=0;i>c;c++){var f=-1+2/(i-1)*c;d[c].push(new THREE.Vector3(p.x+g.x*f,p.y+g.y*f,p.z+g.z*f))}for(n&&this.createStrip(d[0],d[1],m,t,r,s),c=0;!r&&i>c;c++)this.createCurveSub(d[c],1,m,t,s);var d=[];for(l=0;i>l;l++)d[l]=[];m=[],g=null}p=new THREE.Vector3(v.coord.x,v.coord.y,v.coord.z),h=v.chain,u=v.resi,1===s||2===s?m.push(this.highlightColor):m.push(v.color)}else{if(!p){g=null;continue}var b=new THREE.Vector3(v.coord.x,v.coord.y,v.coord.z);for(b.sub(p),b.normalize().multiplyScalar(o),null!==g&&b.dot(g)<0&&b.negate(),g=b,c=0;i>c;c++){var f=-1+2/(i-1)*c;d[c].push(new THREE.Vector3(p.x+g.x*f,p.y+g.y*f,p.z+g.z*f))}p=null}}if(p&&g)for(c=0;i>c;c++){var f=-1+2/(i-1)*c;d[c].push(new THREE.Vector3(p.x+g.x*f,p.y+g.y*f,p.z+g.z*f))}for(n&&this.createStrip(d[0],d[1],m,t,r,s),c=0;!r&&i>c;c++)this.createCurveSub(d[c],1,m,t,s)},drawSymmetryMates2:function(){if(void 0!==this.biomtMatrices){for(var e=1,i=this.center.clone(),t=0;t<this.biomtMatrices.length;t++){var n=this.biomtMatrices[t];if(void 0!==n){var o=n.toArray(),r=1;for(var s in o)0==s||5==s||10==s?1e3!=parseInt(1e3*o[s])&&(r=0):0!=s&&5!=s&&10!=s&&15!=s&&0!=parseInt(1e3*o[s])&&(r=0);if(!r){var a=this.mdl.clone();a.applyMatrix(n);var c=this.center.clone();c.applyMatrix4(n),i.add(c),this.mdl.add(a),++e}}}this.maxD*=Math.sqrt(e),this.mdl.position.add(this.center).sub(i.multiplyScalar(1/e)),this.setCamera()}},makeTextSprite:function(e,i){void 0===i&&(i={});var t=i.hasOwnProperty("fontface")?i.fontface:"Arial",n=i.hasOwnProperty("fontsize")?i.fontsize:18,o=i.hasOwnProperty("borderThickness")?i.borderThickness:4,r=1,s=i.hasOwnProperty("borderColor")?this.hexToRgb(i.borderColor,r):{r:0,g:0,b:0,a:1},a=i.hasOwnProperty("backgroundColor")?this.hexToRgb(i.backgroundColor,r):{r:0,g:0,b:0,a:.5};r=1;var c=i.hasOwnProperty("textColor")?this.hexToRgb(i.textColor,r):{r:255,g:255,b:0,a:1},l=document.createElement("canvas"),d=l.getContext("2d");d.font="Bold "+n+"px "+t;var h=d.measureText(e),u=h.width,p=d.measureText("M").width;d.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",d.strokeStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",d.lineWidth=o,this.roundRect(d,o/2,o/2,1.1*(u+o),1.4*n+o,.3*p),d.fillStyle="rgba("+c.r+", "+c.g+", "+c.b+", 1.0)",d.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", 1.0)",d.fillText(e,o+.1*n,n+o);var m=new THREE.Texture(l);m.needsUpdate=!0;var g=!0,v=new THREE.SpriteMaterial({map:m,useScreenCoordinates:!1,depthTest:!g,depthWrite:!g}),f=new THREE.Sprite(v),b=this.maxD/100;return f.scale.set(16*b,8*b,1),f},hexToRgb:function(e,i){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16),a:i}:null},roundRect:function(e,i,t,n,o,r){e.beginPath(),e.moveTo(i+r,t),e.lineTo(i+n-r,t),e.quadraticCurveTo(i+n,t,i+n,t+r),e.lineTo(i+n,t+o-r),e.quadraticCurveTo(i+n,t+o,i+n-r,t+o),e.lineTo(i+r,t+o),e.quadraticCurveTo(i,t+o,i,t+o-r),e.lineTo(i,t+r),e.quadraticCurveTo(i,t,i+r,t),e.closePath(),e.fill(),e.stroke()},createLabelRepresentation:function(e){for(var i in e){var t=e[i],n=t.size?t.size:this.LABELSIZE,o=t.color?t.color:"#ffff00",r=t.background?t.background:"#cccccc",s=this.makeTextSprite(t.text,{fontsize:parseInt(n),textColor:o,borderColor:r,backgroundColor:r});s.position.set(t.position.x,t.position.y,t.position.z),this.mdl.add(s)}},getAtomsWithinAtom:function(e,i,t){var n=this.getExtent(i),o=(n[2][0]-n[0][0])*(n[2][0]-n[0][0])+(n[2][1]-n[0][1])*(n[2][1]-n[0][1])+(n[2][2]-n[0][2])*(n[2][2]-n[0][2]),r=(n[2][0]-n[1][0])*(n[2][0]-n[1][0])+(n[2][1]-n[1][1])*(n[2][1]-n[1][1])+(n[2][2]-n[1][2])*(n[2][2]-n[1][2]),s=o>r?o:r,a=Math.sqrt(s),c=(a+t)*(a+t),l={};for(var d in e){var h=e[d];if(!(h.serial in i||h.coord.x<n[0][0]-t||h.coord.x>n[1][0]+t||h.coord.y<n[0][1]-t||h.coord.y>n[1][1]+t||h.coord.z<n[0][2]-t||h.coord.z>n[1][2]+t)){var u=(h.coord.x-n[2][0])*(h.coord.x-n[2][0])+(h.coord.y-n[2][1])*(h.coord.y-n[2][1])+(h.coord.z-n[2][2])*(h.coord.z-n[2][2]);c>u&&(l[h.serial]=h)}}var p={};for(var d in i){var m=i[d],g=this.vdwRadii[m.elem]||this.defaultRadius;for(var v in l){var h=l[v],u=(h.coord.x-m.coord.x)*(h.coord.x-m.coord.x)+(h.coord.y-m.coord.y)*(h.coord.y-m.coord.y)+(h.coord.z-m.coord.z)*(h.coord.z-m.coord.z);c=(g+t)*(g+t),c>u&&(p[h.serial]=h)}}return p},getExtent:function(e){var i,t=ymin=zmin=9999,n=ymax=zmax=-9999,o=ysum=zsum=cnt=0;for(i in e){var r=e[i];cnt++,o+=r.coord.x,ysum+=r.coord.y,zsum+=r.coord.z,t=t<r.coord.x?t:r.coord.x,ymin=ymin<r.coord.y?ymin:r.coord.y,zmin=zmin<r.coord.z?zmin:r.coord.z,n=n>r.coord.x?n:r.coord.x,ymax=ymax>r.coord.y?ymax:r.coord.y,zmax=zmax>r.coord.z?zmax:r.coord.z}return[[t,ymin,zmin],[n,ymax,zmax],[o/cnt,ysum/cnt,zsum/cnt]]},getAtomsFromPosition:function(e,i){var t,n;(void 0===i||null===i)&&(i=1);for(t in this.atoms){var n=this.atoms[t];if(!(n.coord.x<e.x-i||n.coord.x>e.x+i||n.coord.y<e.y-i||n.coord.y>e.y+i||n.coord.z<e.z-i||n.coord.z>e.z+i))return n}return null},buildAxes:function(e){var i=new THREE.Object3D;i.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0+e,0,0),16711680,!1,.5)),i.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0-e,0,0),8388608,!0,.5)),i.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0+e,0),65280,!1,.5)),i.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0-e,0),32768,!0,.5)),i.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0+e),255,!1,.5)),i.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0-e),128,!0,.5)),this.scene.add(i)},createSingleLine:function(e,i,t,n,o){var r,s=new THREE.Geometry;r=n?new THREE.LineDashedMaterial({linewidth:1,color:t,dashSize:o,gapSize:o}):new THREE.LineBasicMaterial({linewidth:1,color:t}),s.vertices.push(e),s.vertices.push(i),n&&s.computeLineDistances();var a=new THREE.Line(s,r,THREE.LinePieces);return a},intersectHash:function(e,i){var t={};if(Object.keys(e).length<Object.keys(i).length)for(var n in e)void 0!==i&&i[n]&&(t[n]=e[n]);else for(var n in i)void 0!==e&&e[n]&&(t[n]=i[n]);return t},excludeHash:function(e,i){var t={};for(var n in e)n in i||(t[n]=e[n]);return t},unionHash:function(e,i){return jQuery.extend({},e,i)},intersectHash2Atoms:function(e,i){return this.hash2Atoms(this.intersectHash(e,i))},excludeHash2Atoms:function(e,i){return this.hash2Atoms(this.excludeHash(e,i))},unionHash2Atoms:function(e,i){return this.hash2Atoms(this.unionHash(e,i))},hash2Atoms:function(e){var i={};for(var t in e)i[t]=this.atoms[t];return i},centerAtoms:function(e){var i=new THREE.Vector3(9999,9999,9999),t=new THREE.Vector3(-9999,-9999,-9999),n=new THREE.Vector3,o=0;for(var r in e){var s=this.atoms[r],a=s.coord;n.add(a),i.min(a),t.max(a),++o}var c=t.distanceTo(i);return{center:n.multiplyScalar(1/o),maxD:c}},exportCanvas:function(){this.render(),window.open(this.renderer.domElement.toDataURL("image/png"))},applyPrevColor:function(){for(var e in this.atoms){var i=this.atoms[e];i.color=this.atomPrevColors[e]}},setColorByOptions:function(e,i,t){if(void 0!==t&&t)for(var n in i){var o=this.atoms[n];this.atomPrevColors[n]=o.color}else if(0===e.color.indexOf("#"))for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setStyle(e.color.toLowerCase()),this.atomPrevColors[n]=o.color}else switch(e.color.toLowerCase()){case"spectrum":var r=0,a=1/this.cnt;for(var n in i){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:(new THREE.Color).setHSL(2/3*(1-r++*a),1,.45),this.atomPrevColors[n]=o.color}break;case"chain":var c=-1,l="",d=this.stdChainColors.length;for(var n in i){var o=this.atoms[n];o.chain!=l&&(++c,c%=d),o.color=this.stdChainColors[c],Object.keys(this.chainsColor).length>0&&this.updateChainsColor(o),this.atomPrevColors[n]=o.color,l=o.chain}break;case"secondary structure":for(var n in i){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:this.ssColors[o.ss],this.atomPrevColors[n]=o.color}break;case"B factor":var h=this.getFirstAtomObj(this.atoms);if(!this.middB&&void 0!==h.b){var u=1e3,p=-1e3;for(var n in i){var o=this.atoms[n];u>parseFloat(o.b)&&(u=parseFloat(o.b)),p<parseFloat(o.b)&&(p=parseFloat(o.b))}this.middB=.5*(p+u),this.spanB=.5*(p-u),this.spanBinv=1/this.spanB}for(var n in i){var o=this.atoms[n];void 0!==o.b&&void 0!==this.middB&&(o.color=o.b<this.middB?(new THREE.Color).setRGB(1-(s=(this.middB-o.b)*this.spanBinv),1-s,1):(new THREE.Color).setRGB(1,1-(s=(o.b-this.middB)*this.spanBinv),1-s)),this.atomPrevColors[n]=o.color}break;case"residue":for(var n in i){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:this.residueColors[o.resn]||this.defaultResidueColor,this.atomPrevColors[n]=o.color}break;case"polarity":for(var n in i){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:this.polarityColors[o.resn]||this.defaultResidueColor,this.atomPrevColors[n]=o.color}break;case"atom":for(var n in i){var o=this.atoms[n];o.color=this.atomColors[o.elem]||this.defaultAtomColor,this.atomPrevColors[n]=o.color}break;case"white":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(16777215),this.atomPrevColors[n]=o.color}break;case"grey":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(8947848),this.atomPrevColors[n]=o.color}break;case"red":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(16711680),this.atomPrevColors[n]=o.color}break;case"green":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(65280),this.atomPrevColors[n]=o.color}break;case"blue":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(255),this.atomPrevColors[n]=o.color}break;case"magenta":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(16711935),this.atomPrevColors[n]=o.color}break;case"yellow":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(16776960),this.atomPrevColors[n]=o.color}break;case"cyan":for(var n in i){var o=this.atoms[n];o.color=(new THREE.Color).setHex(65535),this.atomPrevColors[n]=o.color}break;case"custom":}},updateChainsColor:function(e){var i=e.structure+"_"+e.chain;void 0!==this.chainsColor[i]&&(this.chainsColor[i]=e.color)},drawHelixBrick:function(e,i){for(var t in e)for(var n=0,o=e[t].length;o>n;++n)if("helix"===e[t][n].type){var r=1.6,s=new THREE.Color(i[t]),a=new THREE.Vector3(e[t][n].coords[0].x,e[t][n].coords[0].y,e[t][n].coords[0].z),c=new THREE.Vector3(e[t][n].coords[1].x,e[t][n].coords[1].y,e[t][n].coords[1].z);this.createCylinder(a,c,r,s)}else if("brick"===e[t][n].type){var l=e[t][n],s=i[t];this.createStrandBrick(l,s,this.thickness)}else if("coil"===e[t][n].type){var a=new THREE.Vector3(e[t][n].coords[0].x,e[t][n].coords[0].y,e[t][n].coords[0].z),c=new THREE.Vector3(e[t][n].coords[1].x,e[t][n].coords[1].y,e[t][n].coords[1].z),s=new THREE.Color(i[t]),d=this.createSingleLine(a,c,s,!1);this.mdl.add(d),this.objects.push(d)}},applyOptions:function(e){if(void 0===e&&(e=this.options),this.applyDisplayOptions(e,this.displayAtoms),"yes"===e.labels.toLowerCase()&&this.createLabelRepresentation(this.labels),"yes"===e.lines.toLowerCase()&&this.createLines(this.lines),"yes"===e.hbonds.toLowerCase()){var i="#FFFFFF";"black"!==e.background.toLowerCase()&&(i="#000000");for(var t=0,n=Math.floor(this.hbondpoints.length/2);n>t;t++){var o=(this.hbondpoints[2*t],this.hbondpoints[2*t+1],{});o.position1=this.hbondpoints[2*t],o.position2=this.hbondpoints[2*t+1],o.color=i,o.dashed=!0,this.lines.push(o)}this.createLines(this.lines)}switch(e.rotationcenter.toLowerCase()){case"molecule center":void 0!==this.center&&this.mdl.position.sub(this.center);break;case"pick center":void 0!==this.pickedatom&&this.mdl.position.sub(this.pickedatom.coord);break;case"display center":var r=this.centerAtoms(this.displayAtoms).center;this.mdl.position.sub(r);break;case"highlight center":var r=this.centerAtoms(this.highlightAtoms).center;this.mdl.position.sub(r)}switch(e.axis.toLowerCase()){case"yes":this.axis=!0,this.buildAxes(this.maxD/2);break;case"no":this.axis=!1}switch(e.picking.toLowerCase()){case"atom":this.picking=1;break;case"no":this.picking=0;break;case"residue":this.picking=2}switch(e.wireframe){case"yes":e.wireframe=!0;break;case"no":e.wireframe=!1}if(e.opacity=parseFloat(e.opacity),"yes"===e.showsurface.toLowerCase()){var s={};switch(s=this.hash2Atoms(this.highlightAtoms),e.surface.toLowerCase()){case"van der waals surface":this.createSurfaceRepresentation(s,1,e.wireframe,e.opacity);break;case"solvent excluded surface":this.createSurfaceRepresentation(s,2,e.wireframe,e.opacity);break;case"solvent accessible surface":this.createSurfaceRepresentation(s,3,e.wireframe,e.opacity);break;case"molecular surface":this.createSurfaceRepresentation(s,4,e.wireframe,e.opacity)}}},applyDisplayOptions:function(e,i,t){void 0===e&&(e=this.options);var n,o={},r={},s={};if(1===t){s=this.hash2Atoms(i);for(var a in s){var c=s[a];n=c.structure+"_"+c.chain+"_"+c.resi,o[n]=1}for(var a in o){var l=a.lastIndexOf("_"),d=a.substr(0,l+1),h=parseInt(a.substr(l+1)),u=d+(h-1).toString(),p=d+(h+1).toString();o.hasOwnProperty(u)||o.hasOwnProperty(u)||(r[a]=1)}if(1===Object.keys(s).length&&Object.keys(this.residues[n]).length>1&&"sphere"!==s[Object.keys(s)[0]].style&&"dot"!==s[Object.keys(s)[0]].style){if(void 0===this.bCid||!this.bCid)for(var a in s){var c=s[a],m=1;this.createBox(c,void 0,void 0,m,void 0,t)}}else for(var n in r){var c=this.getFirstAtomObj(this.residues[n]),u=c.structure+"_"+c.chain+"_"+parseInt(c.resi-1),p=c.structure+"_"+c.chain+"_"+parseInt(c.resi+1);if("cylinder & plate"===c.style&&"helix"===c.ss)for(var a in this.residues[n]){var c=this.atoms[a],m=1;this.createBox(c,void 0,void 0,m,void 0,t)}else if("ribbon"===c.style&&"coil"===c.ss||"strand"===c.style&&"coil"===c.ss||"phosphorus trace"===c.style||"C alpha trace"===c.style||"B factor tube"===c.style||"cylinder & plate"===c.style&&"helix"!==c.ss){var g=!1;if(!g&&this.residues.hasOwnProperty(p)){var v=Object.keys(this.residues[p])[0],f=this.hash2Atoms(this.residues[p])[v];if(c.style===f.style&&!f.ssbegin||f.ssbegin){var b=this.residues[p];if(i=this.unionHash(i,b),g=!0,f.ssbegin)for(var a in b)this.atoms[a].notshow=!0}}if(!g&&this.residues.hasOwnProperty(u)){var v=Object.keys(this.residues[u])[0],f=this.hash2Atoms(this.residues[u])[v];
c.style===f.style&&(i=this.unionHash(i,this.residues[u]),g=!0)}}else if("ribbon"===c.style&&"coil"!==c.ss&&c.ssend||"strand"===c.style&&"coil"!==c.ss&&c.ssend){var g=!1;if(!g&&this.residues.hasOwnProperty(p)){var v=Object.keys(this.residues[p])[0],f=this.hash2Atoms(this.residues[p])[v];i=this.unionHash(i,this.residues[p]),g=!0}}}}this.setStyle2Atoms(i);for(var E in this.style2atoms)atomHash=this.style2atoms[E],"ribbon"===E?this.createStrand(this.hash2Atoms(atomHash),2,void 0,!0,void 0,void 0,!1,this.thickness,t):"strand"===E?this.createStrand(this.hash2Atoms(atomHash),null,null,null,null,null,!1,void 0,t):"cylinder & plate"===E?this.createCylinderHelix(this.hash2Atoms(atomHash),1.6,t):"nucleotide cartoon"===E?(this.drawCartoonNucleicAcid(this.hash2Atoms(atomHash),null,this.thickness,t),2!==t&&this.drawNucleicAcidStick(this.hash2Atoms(atomHash),t)):"phosphorus trace"===E?this.createCylinderCurve(this.hash2Atoms(atomHash),"P",.2,!1,t):"phosphorus lines"===E?this.createCylinderCurve(this.hash2Atoms(atomHash),"P",.2,!0,t):"C alpha trace"===E?this.createCylinderCurve(this.hash2Atoms(atomHash),"CA",.2,!1,t):"B factor tube"===E?this.createTube(this.hash2Atoms(atomHash),"CA",null,t):"lines"===E?1===t?this.createStickRepresentation(this.hash2Atoms(atomHash),.1,.1,void 0,t):this.createLineRepresentation(this.hash2Atoms(atomHash),t):"stick"===E?this.createStickRepresentation(this.hash2Atoms(atomHash),this.cylinderRadius,this.cylinderRadius,void 0,t):"ball & stick"===E?this.createStickRepresentation(this.hash2Atoms(atomHash),this.cylinderRadius,.5*this.cylinderRadius,.3,t):"sphere"===E?this.createSphereRepresentation(this.hash2Atoms(atomHash),this.sphereRadius,void 0,void 0,t):"dot"===E&&this.createSphereRepresentation(this.hash2Atoms(atomHash),this.sphereRadius,!1,.3,t)},setStyle2Atoms:function(e){this.style2atoms={};for(var i in e)void 0===this.style2atoms[this.atoms[i].style]&&(this.style2atoms[this.atoms[i].style]={}),this.style2atoms[this.atoms[i].style][i]=1},setAtomStyleByOptions:function(e){if(void 0!==e.sidechains)for(var i in this.proteins)this.atoms[i].style=e.sidechains.toLowerCase();if(void 0!==e.secondary)for(var i in this.proteins)this.atoms[i].style=e.secondary.toLowerCase();if(void 0!==e.ligands)for(var i in this.ligands)this.atoms[i].style=e.ligands.toLowerCase();if(void 0!==e.ions)for(var i in this.ions)this.atoms[i].style=e.ions.toLowerCase();if(void 0!==e.water)for(var i in this.water)this.atoms[i].style=e.water.toLowerCase();if(void 0!==e.nucleotides)for(var i in this.nucleotides)this.atoms[i].style=e.nucleotides.toLowerCase()},rebuildScene:function(e){if(jQuery.extend(this.options,e),void 0!==this.scene)for(var i=this.scene.children.length-1;i>=0;i--){var t=this.scene.children[i];this.scene.remove(t)}else this.scene=new THREE.Scene;this.directionalLight=new THREE.DirectionalLight(16777215,1.2),this.camera_z>0?this.directionalLight.position.set(0,0,1):this.directionalLight.position.set(0,0,-1);var n=new THREE.AmbientLight(2105376);if(this.scene.add(this.directionalLight),this.scene.add(n),void 0!==this.mdl){for(var i=this.mdl.children.length-1;i>=0;i--){var t=this.mdl.children[i];this.mdl.remove(t)}this.options.rotationcenter="nochange"}else this.mdl=new THREE.Object3D;this.scene.add(this.mdl),this.objects=[],this.raycaster=new THREE.Raycaster,this.projector=new THREE.Projector,this.mouse=new THREE.Vector2;var o=this.backgroundColors[this.options.background.toLowerCase()];this.renderer.setClearColor(o),this.perspectiveCamera=new THREE.PerspectiveCamera(20,this.container.whratio,.1,1e4),this.perspectiveCamera.position.set(0,0,this.camera_z),this.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0)),this.orthographicCamera=new THREE.OrthographicCamera,this.orthographicCamera.position.set(0,0,this.camera_z),this.orthographicCamera.lookAt(new THREE.Vector3(0,0,0)),this.cameras={perspective:this.perspectiveCamera,orthographic:this.orthographicCamera},this.setCamera(),this.applyOptions(this.options)},setCamera:function(){this.camera=this.cameras[this.options.camera.toLowerCase()],this.camera===this.perspectiveCamera?(this.camera_z>0?this.camera.position.z=2*this.maxD:this.camera.position.z=2*-this.maxD,this.controls=new THREE.TrackballControls(this.camera,document.getElementById(this.id),this)):this.camera===this.orthographicCamera&&(this.camera.right=this.maxD/2*2.5,this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.container.whratio,this.camera.bottom=-this.camera.right/this.container.whratio,this.camera_z>0?(this.camera.near=1e4,this.camera.far=-1e4):(this.camera.near=-1e4,this.camera.far=1e4),this.controls=new THREE.OrthographicTrackballControls(this.camera,document.getElementById(this.id),this)),this.camera.updateProjectionMatrix()},applyTransformation:function(e,i,t){var n={};n.update=!1,n._zoomFactor=e,n.mouseChange=new THREE.Vector2,n.mouseChange.copy(i),n.quaternion=new THREE.Quaternion,n.quaternion.copy(t),this.controls.update(n)},render:function(){this.directionalLight.position.copy(this.camera.position),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.render(this.scene,this.camera)},setRotationCenter:function(e){this.mdl.position.sub(e)},draw:function(e,i){this.rebuildScene(e),(void 0===i||i)&&this.applyPrevColor(),this.bSSOnly&&this.drawHelixBrick(this.molid2ss,this.molid2color),this.bAssembly&&this.drawSymmetryMates2(),void 0!==this.highlightAtoms&&Object.keys(this.highlightAtoms).length>0&&Object.keys(this.highlightAtoms).length<Object.keys(this.displayAtoms).length&&(this.removeHighlightObjects(),this.addHighlightObjects(void 0,void 0)),this.bRender===!0&&(this.applyTransformation(this._zoomFactor,this.mouseChange,this.quaternion),this.render())},zoomIn:function(e){var i={};i._zoomFactor=1-e,i.update=!0,this.controls.update(i),this.render()},zoomOut:function(e){var i={};i._zoomFactor=1+e,i.update=!0,this.controls.update(i),this.render()},rotateLeft:function(e){var i=new THREE.Vector3(0,1,0),t=-e/180*Math.PI;i.applyQuaternion(this.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-t);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},rotateRight:function(e){var i=new THREE.Vector3(0,1,0),t=e/180*Math.PI;i.applyQuaternion(this.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-t);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},rotateUp:function(e){var i=new THREE.Vector3(1,0,0),t=-e/180*Math.PI;i.applyQuaternion(this.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-t);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},rotateDown:function(e){var i=new THREE.Vector3(1,0,0),t=e/180*Math.PI;i.applyQuaternion(this.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-t);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},translateLeft:function(e){var i=new THREE.Vector2(0,0);i.x-=e/100;var t={};t.mouseChange=i,t.update=!0,this.controls.update(t),this.render()},translateRight:function(e){var i=new THREE.Vector2(0,0);i.x+=e/100;var t={};t.mouseChange=i,t.update=!0,this.controls.update(t),this.render()},translateUp:function(e){var i=new THREE.Vector2(0,0);i.y-=e/100;var t={};t.mouseChange=i,t.update=!0,this.controls.update(t),this.render()},translateDown:function(e){var i=new THREE.Vector2(0,0);i.y+=e/100;var t={};t.mouseChange=i,t.update=!0,this.controls.update(t),this.render()},showPicking:function(e){if(this.removeHighlightObjects(),this.highlightAtoms={},1===this.picking)this.highlightAtoms[e.serial]=1;else if(2===this.picking){var i=e.structure+"_"+e.chain+"_"+e.resi;this.highlightAtoms=this.residues[i]}this.addHighlightObjects();var t="."+e.chain+":"+e.resi,n=t+"@"+e.name,o=[],r={};r.position=e.coord,1===this.picking?r.text=n:2===this.picking&&(r.text=t),o.push(r),this.createLabelRepresentation(o)},removeHighlightObjects:function(){for(var e in this.prevHighlightObjects)this.mdl.remove(this.prevHighlightObjects[e]);this.prevHighlightObjects=[],this.render()},addHighlightObjects:function(e){void 0===e&&(e=this.highlightColor),this.applyDisplayOptions(this.options,this.intersectHash(this.highlightAtoms,this.displayAtoms),this.bHighlight),this.render()},zoominSelection:function(){if(Object.keys(this.highlightAtoms).length>1){var e=this.centerAtoms(this.hash2Atoms(this.highlightAtoms));this.maxD=e.maxD,this.maxD<25&&(this.maxD=25),this.mdl.position.add(this.center).sub(e.center),this.center=e.center,this.setCamera()}this.render()}},"undefined"==typeof jQuery)throw new Error("iCn3DUI requires jQuery");if("undefined"==typeof iCn3D)throw new Error("iCn3DUI requires iCn3D");$.ui.dialog.prototype._makeDraggableBase||($.ui.dialog.prototype._makeDraggableBase=$.ui.dialog.prototype._makeDraggable,$.ui.dialog.prototype._makeDraggable=function(){this._makeDraggableBase(),this.uiDialog.draggable("option","containment",!1)});var iCn3DUI=function(e){var i=this;i.cfg=e,i.divid=i.cfg.divid,i.pre=i.divid+"_",i.inputid="",i.RESIDUE_WIDTH=10,i.MENU_HEIGHT=40,i.MENU_WIDTH=690,i.LESSWIDTH=20,i.LESSHEIGHT=20,i.ROTATION_DIRECTION="right",i.HIDE_SELECTION=!0,i.ALTERNATE_STRUCTURE=-1,i.EXTRAHEIGHT=2*i.MENU_HEIGHT,void 0!=i.cfg.showmenu&&0==i.cfg.showmenu&&(i.EXTRAHEIGHT=0),i.SELECT_RESIDUE=!1,i.selectedResidues={},i.CRASHED=!1,i.prevCommands="",i.options={},i.options.camera="perspective",i.options.background="black",i.options.color="spectrum",i.options.sidechains="nothing",i.options.secondary="ribbon",i.options.surface="Van der Waals surface",i.options.opacity="0.8",i.options.wireframe="no",i.options.ligands="stick",i.options.water="nothing",i.options.ions="sphere",i.options.hbonds="no",i.options.labels="no",i.options.lines="no",i.options.rotationcenter="molecule center",i.options.axis="no",i.options.picking="residue",i.options.nucleotides="phosphorus trace",i.options.surfaceregion="nothing",void 0!==i.cfg.cid&&(i.options.picking="atom"),i.modifyIcn3d()};iCn3DUI.prototype={constructor:iCn3DUI,modifyIcn3d:function(){var e=this;e.modifyIcn3dShowPicking()},modifyIcn3dShowPicking:function(){var e=this;iCn3D.prototype.showPicking=function(i){if(this.removeHighlightObjects(),this.highlightAtoms={},1===this.picking)this.highlightAtoms[i.serial]=1;else if(2===this.picking){var t=i.structure+"_"+i.chain+"_"+i.resi;this.highlightAtoms=this.residues[t]}if(this.addHighlightObjects(),2===this.picking){var n=this.id.split("_");e.pre=n[0]+"_";var o=i.structure+"_"+i.chain+"_"+i.resi;e.clearSelection(),e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),0!==$("#"+e.pre+o).length&&$("#"+e.pre+o).addClass("highlightSeq")}else 1===this.picking&&(e.removeSeqChainBkgd(),e.removeSeqResidueBkgd());var r={};r.factor=this._zoomFactor,r.mouseChange=this.mouseChange,r.quaternion=this.quaternion,this.commands.push("pickatom "+i.serial+"|||"+JSON.stringify(r)),this.logs.push("pickatom "+i.serial+" (chain: "+i.structure+"_"+i.chain+", residue: "+i.resn+", number: "+i.resi+", atom: "+i.name+")"),$("#"+e.pre+"logtext").length&&$("#"+e.pre+"logtext").val("> "+this.logs.join("\n> ")+"\n> ").scrollTop($("#"+e.pre+"logtext")[0].scrollHeight)}},show3DStructure:function(){var e=this;return e.deferred=$.Deferred(function(){e.isSessionStorageSupported()&&e.getCommandsBeforeCrash();var i=window.innerWidth,t=window.innerHeight;i=-1!==e.cfg.width.toString().indexOf("%")?i*e.cfg.width.substr(0,e.cfg.width.toString().indexOf("%"))/100-e.LESSWIDTH:e.cfg.width,t=-1!==e.cfg.height.toString().indexOf("%")?t*e.cfg.height.substr(0,e.cfg.height.toString().indexOf("%"))/100-e.EXTRAHEIGHT-e.LESSHEIGHT:e.cfg.height,e.setTopMenusHtml(e.divid),e.allEventFunctions(),e.allCustomEvents(),void 0!=e.cfg.showmenu&&0==e.cfg.showmenu?(e.EXTRAHEIGHT=0,e.hideMenu(i,t)):(e.EXTRAHEIGHT=2*e.MENU_HEIGHT,e.showMenu(i,t)),e.icn3d=new iCn3D(e.pre+"canvas"),$("#"+e.pre+"canvas").width(i).height(t);var n=parseInt(t)+e.EXTRAHEIGHT;if($("#"+e.pre+"viewer").width(i).height(n),e.icn3d.setWidthHeight(i,t),void 0!==e.cfg.bCalphaOnly&&(e.icn3d.bCalphaOnly=e.cfg.bCalphaOnly),e.icn3d.cloneHash(e.options,e.icn3d.options),e.STATENUMBER=e.icn3d.commands.length,e.isSessionStorageSupported()&&e.CRASHED){e.CRASHED=!1;var o=e.commandsBeforeCrash.split("|||")[0],r=o.substr(o.lastIndexOf(" ")+1);if(r===e.cfg.pdbid||r===e.cfg.mmdbid||r===e.cfg.gi||r===e.cfg.cid||r===e.cfg.mmcif||r===e.cfg.align)return void e.loadScript(e.commandsBeforeCrash)}if(void 0!==e.cfg.pdbid)e.inputid=e.cfg.pdbid,e.icn3d.moleculeTitle="PDB ID "+e.cfg.pdbid,e.setLogCommand("load pdb "+e.cfg.pdbid,!0),e.downloadPdb(e.cfg.pdbid);else if(void 0!==e.cfg.mmdbid)e.inputid=e.cfg.mmdbid,e.icn3d.moleculeTitle="MMDB ID "+e.cfg.mmdbid,e.setLogCommand("load mmdb "+e.cfg.mmdbid,!0),e.downloadMmdb(e.cfg.mmdbid);else if(void 0!==e.cfg.gi)e.inputid=e.cfg.gi,e.icn3d.moleculeTitle="Protein gi "+e.cfg.mmdbid,e.setLogCommand("load gi "+e.cfg.gi,!0),e.downloadGi(e.cfg.gi);else if(void 0!==e.cfg.cid)e.inputid=e.cfg.cid,e.icn3d.moleculeTitle="PubChem CID "+e.cfg.cid,e.setLogCommand("load cid "+e.cfg.cid,!0),e.downloadCid(e.cfg.cid);else if(void 0!==e.cfg.mmcif)e.inputid=e.cfg.mmcif,e.icn3d.moleculeTitle="mmCIF "+e.cfg.mmcif,e.setLogCommand("load mmcif "+e.cfg.mmcif,!0),e.downloadMmcif(e.cfg.mmcif);else if(void 0!==e.cfg.align){var s=e.cfg.align.split(",");e.inputid=s[0]+"_"+s[3],e.icn3d.moleculeTitle="Structure Alignment of MMDB ID "+s[0]+" (BioUnit "+s[1]+", Molecule "+s[2]+") and MMDB ID "+s[3]+" (BioUnit "+s[4]+", Molecule "+s[5]+")",e.setLogCommand("load alignment "+e.cfg.align,!0),e.downloadAlignment(e.cfg.align)}else alert("Please input a gi, MMDB ID, PDB ID, CID, or mmCIF...")}),e.deferred},clearSelection:function(){var e=this;$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"alignChainid").val(""),$("#"+e.pre+"customResidues").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val(""),$("#"+e.pre+"alignChainid2").val(""),$("#"+e.pre+"customResidues2").val(""),$("#"+e.pre+"customAtoms").val("")},removeSeqChainBkgd:function(e){$(".seqTitle").each(function(i){void 0===e?$(this).removeClass("highlightSeq"):$(this).attr("chain")!==e&&$(this).removeClass("highlightSeq")})},removeSeqResidueBkgd:function(){$(".residue").each(function(e){$(this).removeClass("highlightSeq")})},hideMenu:function(e,i){var t=this;void 0!==$("#"+t.pre+"menulist")[0]&&($("#"+t.pre+"menulist")[0].style.display="none"),void 0!==$("#"+t.pre+"menuLogSection")[0]&&($("#"+t.pre+"menuLogSection")[0].style.display="none"),void 0!==$("#"+t.pre+"commandlog")[0]&&($("#"+t.pre+"commandlog")[0].style.display="none"),void 0!==$("#"+t.pre+"selection")[0]&&($("#"+t.pre+"selection")[0].style.display="none"),$("#"+t.pre+"viewer").width(e).height(i),$("#"+t.pre+"canvas").width(e).height(i)},showMenu:function(e,i){var t=this;void 0!==$("#"+t.pre+"menulist")[0]&&($("#"+t.pre+"menulist")[0].style.display="block"),void 0!==$("#"+t.pre+"menuLogSection")[0]&&($("#"+t.pre+"menuLogSection")[0].style.display="block"),void 0!==$("#"+t.pre+"commandlog")[0]&&($("#"+t.pre+"commandlog")[0].style.display="block"),void 0!==$("#"+t.pre+"selection")[0]&&($("#"+t.pre+"selection")[0].style.display="block");var n=parseInt(i)+t.EXTRAHEIGHT;$("#"+t.pre+"viewer").width(e).height(n),$("#"+t.pre+"canvas").width(e).height(i)},resizeCanvas:function(e,i){var t=this;if(void 0!==t.cfg.resize&&t.cfg.resize&&!t.isMobile()){var n=parseInt(i)-t.EXTRAHEIGHT;$("#"+t.pre+"canvas").width(e).height(n),$("#"+t.pre+"viewer").width(e).height(i),t.icn3d.setWidthHeight(e,n),t.icn3d.draw()}},setOption:function(e,i){var t=this,n={};n[e]=i,"color"===e&&t.icn3d.setColorByOptions(n,t.icn3d.highlightAtoms),t.icn3d.draw(n)},setStyle:function(e,i){var t=this,n={};switch(e){case"protein":n=t.icn3d.intersectHash(t.icn3d.highlightAtoms,t.icn3d.proteins);break;case"nucleotides":n=t.icn3d.intersectHash(t.icn3d.highlightAtoms,t.icn3d.nucleotides);break;case"ligands":n=t.icn3d.intersectHash(t.icn3d.highlightAtoms,t.icn3d.ligands);break;case"ions":n=t.icn3d.intersectHash(t.icn3d.highlightAtoms,t.icn3d.ions);break;case"water":n=t.icn3d.intersectHash(t.icn3d.highlightAtoms,t.icn3d.water)}for(var o in n)t.icn3d.atoms[o].style=i;t.icn3d.draw()},setLogCommand:function(e,i){var t=this,n={};n.factor=t.icn3d._zoomFactor,n.mouseChange=t.icn3d.mouseChange,n.quaternion=t.icn3d.quaternion,i&&(t.icn3d.commands.push(e+"|||"+JSON.stringify(n)),t.isSessionStorageSupported()&&t.saveCommandsToSession(),t.STATENUMBER=t.icn3d.commands.length),t.icn3d.logs.push(e),$("#"+t.pre+"logtext").val("> "+t.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+t.pre+"logtext")[0].scrollHeight)},openDialog:function(e,i){var t=this,n=400,o=150,r=t.isMac()&&!t.isMobile();if(e===t.pre+"dl_selectresidues"||e===t.pre+"dl_alignment")if($(window).width()>$(window).height()){t.resizeCanvas(.5*$(window).width(),$(window).height()-t.LESSHEIGHT),o=r?"auto":$(window).height()-t.LESSHEIGHT-2*t.MENU_HEIGHT,n=r?"auto":.5*$(window).width()-t.LESSWIDTH;var s={my:"left top",at:"right top",of:"#"+t.pre+"canvas",collision:"none"};t.cfg.resize=!1,window.dialog=$("#"+e).dialog({autoOpen:!0,title:i,height:o,width:n,modal:!1,position:s,close:function(e){t.cfg.resize=!0,t.resizeCanvas($(window).width()-t.LESSWIDTH,$(window).height()-t.LESSHEIGHT)}})}else{t.isMobile()&&t.resizeCanvas($(window).width()-t.LESSWIDTH,$(window).height()-t.LESSHEIGHT-30),o=r?"auto":250,n=r?"auto":$(window).width()-t.LESSWIDTH;var s={my:"left top",at:"left bottom-30",of:"#"+t.pre+"canvas",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:i,height:o,width:n,modal:!1,position:s})}else{o="auto",n="auto";var s={my:"left top",at:"left bottom-30",of:"#"+t.pre+"canvas",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:i,height:o,width:n,modal:!1,position:s})}$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")},renderStructure:function(e){var i=this,t=i.setStructureMenu(e),n=i.setChainMenu(e),o=i.getAlignChainSelections(),r=i.setResidueMenu(),s=i.setAtomMenu();$("#"+i.pre+"structureid")&&$("#"+i.pre+"structureid").html(t),$("#"+i.pre+"chainid")&&$("#"+i.pre+"chainid").html(n),$("#"+i.pre+"alignChainid")&&$("#"+i.pre+"alignChainid").html(o),$("#"+i.pre+"customResidues")&&$("#"+i.pre+"customResidues").html(r),$("#"+i.pre+"structureid2")&&$("#"+i.pre+"structureid2").html(t),$("#"+i.pre+"chainid2")&&$("#"+i.pre+"chainid2").html(n),$("#"+i.pre+"alignChainid2")&&$("#"+i.pre+"alignChainid2").html(o),$("#"+i.pre+"customResidues2")&&$("#"+i.pre+"customResidues2").html(r),$("#"+i.pre+"customAtoms")&&$("#"+i.pre+"customAtoms").html(s);var a=i.getSequencesAnnotations(Object.keys(i.icn3d.chains));$("#"+i.pre+"dl_sequence")&&($("#"+i.pre+"dl_sequence").html(a.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*a.maxSeqCnt+200)),a=i.getAlignSequencesAnnotations(Object.keys(i.icn3d.alignChains)),$("#"+i.pre+"dl_sequence2")&&($("#"+i.pre+"dl_sequence2").html(a.sequencesHtml),$("#"+i.pre+"dl_sequence2").width(i.RESIDUE_WIDTH*a.maxSeqCnt+200)),e?i.icn3d.draw(i.options):i.icn3d.draw(),void 0!==i.cfg.command&&i.loadScript(i.cfg.command)},downloadPdb:function(e){var i=this,t="https:"!==document.location.protocol?"http://www.rcsb.org/pdb/files/"+e+".pdb":"https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi?pdbid="+e;i.icn3d.bCid=void 0,$.ajax({url:t,dataType:"text",cache:!0,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").show()},success:function(t){i.loadPdbData(t,e)}})},loadPdbData:function(e,i){var t=this;t.icn3d.loadPDB(e),t.pmid=t.icn3d.pmid,void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),t.icn3d.inputid.idtype="pdbid",t.icn3d.inputid.id=i,t.icn3d.setAtomStyleByOptions(t.options),t.icn3d.setColorByOptions(t.options,t.icn3d.atoms),t.renderStructure(!0),void 0!==t.cfg.rotate&&t.rotateStructure(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()},rotateStructure:function(e,i){var t=this;if(t.icn3d.bStopRotate)return!1;if(void 0!==i&&i)if("left"===e)t.ROTATION_DIRECTION="left";else if("right"===e)t.ROTATION_DIRECTION="right";else if("up"===e)t.ROTATION_DIRECTION="up";else{if("down"!==e)return!1;t.ROTATION_DIRECTION="down"}if("left"===e&&"left"===t.ROTATION_DIRECTION)t.icn3d.rotateLeft(5);else if("right"===e&&"right"===t.ROTATION_DIRECTION)t.icn3d.rotateRight(5);else if("up"===e&&"up"===t.ROTATION_DIRECTION)t.icn3d.rotateUp(5);else{if("down"!==e||"down"!==t.ROTATION_DIRECTION)return!1;t.icn3d.rotateDown(5)}setTimeout(function(){t.rotateStructure(e)},1e3)},downloadMmcif:function(e){var i=this,t="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi?mmcif="+e;i.icn3d.bCid=void 0,$.ajax({url:t,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").show()},success:function(e){i.loadMmcifData(e)}})},loadMmcifData:function(e){var i=this;if(void 0===e.atoms)return alert("invalid atoms data."),!1;i.loadAtomDataIn(e,e.mmcif,"mmcif"),void 0===i.cfg.align&&1==Object.keys(i.icn3d.structures).length&&$("#"+i.pre+"alternateWrapper").hide();for(var t=e.assembly,n=0,o=t.length;o>n;++n){void 0==i.icn3d.biomtMatrices[n]&&(i.icn3d.biomtMatrices[n]=(new THREE.Matrix4).identity());for(var r=0,s=t[n].length;s>r;++r)i.icn3d.biomtMatrices[n].elements[r]=t[n][r]}i.icn3d.inputid.idtype="mmcif",i.icn3d.inputid.id=mmcif,i.icn3d.setAtomStyleByOptions(i.options),i.icn3d.setColorByOptions(i.options,i.icn3d.atoms),i.renderStructure(!0),void 0!==i.cfg.rotate&&i.rotateStructure(i.cfg.rotate,!0),void 0!==i.deferred&&i.deferred.resolve(),void 0!==i.deferred2&&i.deferred2.resolve()},downloadAlignment:function(e){var i=this,t="https://www.ncbi.nlm.nih.gov/Structure/vastpp/vastpp.cgi?cmd=c&w3d&ids="+e,n="https://www.ncbi.nlm.nih.gov/Structure/vastpp/vastpp.cgi?cmd=c1&d&ids="+e;void 0!==i.cfg.inpara&&(t+=i.cfg.inpara,n+=i.cfg.inpara),i.icn3d.bCid=void 0,i.icn3d.pdbid_chain2title={};var o=$.ajax({url:n,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").show()}}),r={},s=o.then(function(e){r=e.seqalign;var n=0;for(var o in e){if(2>n){var s=e[o].pdbid,a=e[o].molecule;for(var c in a){var l=a[c].chain;i.icn3d.pdbid_chain2title[s+"_"+l]=a[c].name}}++n}return $.ajax({url:t,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").show()}})});s.done(function(t){return void 0===t.atoms?(alert("invalid atoms data."),!1):(i.loadAtomDataIn(t,void 0,"align",r),void 0===i.cfg.align&&1==Object.keys(i.icn3d.structures).length&&$("#"+i.pre+"alternateWrapper").hide(),i.icn3d.inputid.idtype="alignment",i.icn3d.inputid.id=e,i.icn3d.setAtomStyleByOptions(i.options),i.icn3d.setColorByOptions(i.options,i.icn3d.atoms,!0),i.renderStructure(!0),void 0!==i.cfg.rotate&&i.rotateStructure(i.cfg.rotate,!0),void 0!==i.cfg.bShowSeqByDefault&&i.cfg.bShowSeqByDefault&&i.openDialog(i.pre+"dl_alignment","Select residues in aligned sequences"),void 0!==i.deferred&&i.deferred.resolve(),void 0!==i.deferred2&&i.deferred2.resolve(),void 0)})},downloadCid:function(e){var i=this,t="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/record/SDF/?record_type=3d&response_type=display";i.icn3d.bCid=!0,$.ajax({url:t,dataType:"text",cache:!0,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").show()},success:function(t){var n=i.loadCidAtomData(t);void 0===i.cfg.align&&1==Object.keys(i.icn3d.structures).length&&$("#"+i.pre+"alternateWrapper").hide(),n?(i.icn3d.inputid.idtype="cid",i.icn3d.inputid.id=e,i.icn3d.setAtomStyleByOptions(i.options),i.icn3d.setColorByOptions(i.options,i.icn3d.atoms),i.renderStructure(!0),void 0!==i.cfg.rotate&&i.rotateStructure(i.cfg.rotate,!0),void 0!==i.deferred&&i.deferred.resolve(),void 0!==i.deferred2&&i.deferred2.resolve()):alert("The SDF of CID "+e+" has the wrong format...")}}).fail(function(){alert("This CID may not have 3D structure...")})},loadCidAtomData:function(e){var i=this,t=e.split("\n");if(t.length<4)return!1;i.icn3d.init();var n="1",o="A",r=1,s="LIG",a=n,c=n+"_"+o,l=c+"_"+r,d=parseInt(t[3].substr(0,3));if(isNaN(d)||0>=d)return!1;var h=parseInt(t[3].substr(3,3)),u=4;if(t.length<u+d+h)return!1;var p,m,g=0,v=d,f={};for(p=g;v>p;p++){m=t[u],u++;var b=p,E=parseFloat(m.substr(0,10)),y=parseFloat(m.substr(10,10)),w=parseFloat(m.substr(20,10)),_=new THREE.Vector3(E,y,w),C=m.substr(31,3).replace(/ /g,""),S={het:!0,serial:b,name:C,resn:s,structure:n,chain:o,resi:r,coord:_,b:0,elem:C,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};i.icn3d.atoms[b]=S,f[b]=1}i.icn3d.displayAtoms=f,i.icn3d.highlightAtoms=f,i.icn3d.structures[a]=[c],i.icn3d.chains[c]=f,i.icn3d.residues[l]=f,i.icn3d.residueId2Name[l]=s,void 0===i.icn3d.chainsSeq[c]&&(i.icn3d.chainsSeq[c]=[]),void 0===i.icn3d.chainsAnno[c]&&(i.icn3d.chainsAnno[c]=[]),void 0===i.icn3d.chainsAnno[c][0]&&(i.icn3d.chainsAnno[c][0]=[]),void 0===i.icn3d.chainsAnnoTitle[c]&&(i.icn3d.chainsAnnoTitle[c]=[]),void 0===i.icn3d.chainsAnnoTitle[c][0]&&(i.icn3d.chainsAnnoTitle[c][0]=[]);var T={};for(T.resi=r,T.name=s,i.icn3d.chainsSeq[c].push(T),i.icn3d.chainsAnno[c][0].push(r),i.icn3d.chainsAnnoTitle[c][0].push(""),p=0;h>p;p++){m=t[u],u++;var R=parseInt(m.substr(0,3))-1+g,k=parseInt(m.substr(3,3))-1+g,H=parseInt(m.substr(6,3));i.icn3d.atoms[R].bonds.push(k),i.icn3d.atoms[R].bondOrder.push(H),i.icn3d.atoms[k].bonds.push(R),i.icn3d.atoms[k].bondOrder.push(H)}var x=new THREE.Vector3(9999,9999,9999),A=new THREE.Vector3(-9999,-9999,-9999),O=new THREE.Vector3,M=0;for(var p in i.icn3d.atoms){var L=i.icn3d.atoms[p],_=L.coord;O.add(_),x.min(_),A.max(_),++M,L.het&&(-1!==$.inArray(L.elem,i.icn3d.ionsArray)?i.icn3d.ions[L.serial]=1:i.icn3d.ligands[L.serial]=1)}return i.icn3d.pmin=x,i.icn3d.pmax=A,i.icn3d.cnt=M,i.icn3d.maxD=i.icn3d.pmax.distanceTo(i.icn3d.pmin),i.icn3d.center=O.multiplyScalar(1/i.icn3d.cnt),i.icn3d.maxD<25&&(i.icn3d.maxD=25),!0},downloadMmdb:function(e){var i=this,t="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?program=w3d&uid="+e;i.icn3d.bCid=void 0,void 0!==i.cfg.inpara&&(t+=i.cfg.inpara),$.ajax({url:t,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"log")&&$("#"+i.pre+"log").show()},success:function(e){if(void 0!==i.cfg.inpara&&-1!=i.cfg.inpara.indexOf("mols=")||e.atomcount<=e.threshold&&void 0!==e.atoms){var t=void 0!==e.pdbId?e.pdbId:e.mmdbId;i.loadAtomDataIn(e,t,"mmdbid"),void 0===i.cfg.align&&1==Object.keys(i.icn3d.structures).length&&null!==$("#"+i.pre+"alternateWrapper")&&$("#"+i.pre+"alternateWrapper").hide(),i.icn3d.inputid.idtype="mmdbid",i.icn3d.inputid.id=t,i.icn3d.setAtomStyleByOptions(i.options),i.icn3d.setColorByOptions(i.options,i.icn3d.atoms,!0),i.renderStructure(!0),void 0!==i.cfg.rotate&&i.rotateStructure(i.cfg.rotate,!0)}if(void 0!==i.cfg.inpara&&-1==i.cfg.inpara.indexOf("mols=")&&e.atomcount>e.threshold&&void 0!==e.molid2rescount){var n=40;i.icn3d.bSSOnly=!0;var t=void 0!==e.pdbId?e.pdbId:e.mmdbId;i.loadAtomDataIn(e,t,"mmdbid"),i.icn3d.inputid.idtype="mmdbid",i.icn3d.inputid.id=t,i.options.nucleotides="phosphorus lines",i.icn3d.setAtomStyleByOptions(i.options),i.icn3d.setColorByOptions(i.options,i.icn3d.atoms,!0);var o=e.molid2rescount,r={},s={},a={},c="<table width='100%'><tr><td></td><th>#</th><th align='center'>Chain</th><th align='center'>Residue Count</th></tr>",l=1;for(var d in o){var h="#"+("000000"+o[d].color.toString(16)).slice(-6);c+="<tr style='color:"+h+"'><td><input type='checkbox' name='"+i.pre+"filter_ckbx' value='"+d+"'/></td><td align='center'>"+l+"</td><td align='center'>"+o[d].chain+"</td><td align='center'>"+o[d].resCount+"</td></tr>",r[d]=h;var u=t+"_"+o[d].chain;s[u]=d,a[d]=u,++l}Object.keys(i.icn3d.ligands).length>0&&(c+="<tr><td><input type='checkbox' name='"+i.pre+"filter_ckbx' value='ligands'/></td><td align='center'>"+l+"</td><td align='center'>Ligands</td><td align='center'>"+Object.keys(i.icn3d.ligands).length+" atoms</td></tr>"),c+="</table>";var p={};for(var d in i.icn3d.chains){var m={},g=i.icn3d.centerAtoms(i.icn3d.hash2Atoms(i.icn3d.chains[d])).center;m.position=g;var u=d.substr(d.indexOf("_")+1);m.text=u,m.size=n,m.color=r[s[d]],m.background="#FFFFFF",p[s[d]]=m}molid2ss={};for(var d in e.helix)for(var v=0,f=e.helix[d].length;f>v;++v){var b=e.helix[d][v],E={};E.type="helix",E.startResi=b.from,E.endResi=b.to,E.coords=[],E.coords.push(b.end),E.coords.push(b.start),void 0===molid2ss[d]&&(molid2ss[d]=[]),molid2ss[d].push(E)}for(var d in e.brick)for(var v=0,f=e.brick[d].length;f>v;++v){var y=e.brick[d][v],E={};E.type="brick",E.startResi=y.from,E.endResi=y.to,E.coords=[];var w={},_={},C={};w.x=.25*(y["000"][0]+y["010"][0]+y["011"][0]+y["001"][0]),w.y=.25*(y["000"][1]+y["010"][1]+y["011"][1]+y["001"][1]),w.z=.25*(y["000"][2]+y["010"][2]+y["011"][2]+y["001"][2]),_.x=.25*(y[100][0]+y[110][0]+y[111][0]+y[101][0]),_.y=.25*(y[100][1]+y[110][1]+y[111][1]+y[101][1]),_.z=.25*(y[100][2]+y[110][2]+y[111][2]+y[101][2]),C.x=y["010"][0]-y["000"][0],C.y=y["010"][1]-y["000"][1],C.z=y["010"][2]-y["000"][2],E.coords.push(w),E.coords.push(_),E.coords.push(C),void 0===molid2ss[d]&&(molid2ss[d]=[]),molid2ss[d].push(E)}for(var d in molid2ss)molid2ss[d].sort(function(e,i){return parseFloat(e.startResi)-parseFloat(i.startResi)});if(0!==i.icn3d.cnt)var S=i.icn3d.pmin,T=i.icn3d.pmax,R=i.icn3d.center.multiplyScalar(i.icn3d.cnt),k=i.icn3d.cnt;else var S=new THREE.Vector3(9999,9999,9999),T=new THREE.Vector3(-9999,-9999,-9999),R=new THREE.Vector3,k=0;for(var d in molid2ss){for(var H=new THREE.Vector3(9999,9999,9999),x=new THREE.Vector3(-9999,-9999,-9999),A=new THREE.Vector3,O=0,v=0,f=molid2ss[d].length;f>v;++v){var M=molid2ss[d][v].coords[0];S.min(M),T.max(M),R.add(M),H.min(M),x.max(M),A.add(M),++k,++O,M=molid2ss[d][v].coords[1],S.min(M),T.max(M),R.add(M),H.min(M),x.max(M),A.add(M),++k,++O}var L=A.multiplyScalar(1/O),m={},g=new THREE.Vector3;g.x=L.x,g.y=L.y,g.z=L.z,m.position=g;var u=a[d];m.text=u.substr(u.indexOf("_")+1),m.size=n,m.color=r[d],m.background="#FFFFFF",p[d]=m}i.icn3d.maxD=T.distanceTo(S),i.icn3d.center=R.multiplyScalar(1/k);for(var d in molid2ss)for(var v=1,f=molid2ss[d].length;f>v;++v){var E={};E.type="coil",E.startResi=molid2ss[d][v-1].endResi,E.endResi=molid2ss[d][v].startResi,E.coords=[],E.coords.push(molid2ss[d][v-1].coords[1]),E.coords.push(molid2ss[d][v].coords[0]),molid2ss[d].push(E)}i.icn3d.savedLabels=p,i.icn3d.molid2ss=molid2ss,i.icn3d.molid2color=r,
i.renderStructure(!0),void 0!==i.cfg.rotate&&i.rotateStructure(i.cfg.rotate,!0),$("#"+i.pre+"dl_filter_table").html(c);var I="Select chains to display",D=250,z=i.isMobile()?"auto":200,g={my:"left top",at:"left+10 top+93",of:"#"+i.pre+"canvas",collision:"none"};window.dialog=$("#"+i.pre+"dl_filter").dialog({autoOpen:!0,title:I,height:z,width:D,modal:!1,position:g}),$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")}return void 0!==i.deferred&&i.deferred.resolve(),void 0!==i.deferred2&&i.deferred2.resolve(),void 0===e.atoms&&void 0===e.molid2rescount?(alert("invalid MMDB data."),!1):void 0}})},downloadGi:function(e){var i=this,t="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?dbfrom=protein&db=structure&linkname=protein_structure&id="+e;i.icn3d.bCid=void 0,i.setLogCommand("load gi "+e,!1),$.ajax({url:t,dataType:"text",success:function(t){if(-1===t.indexOf("<Link>"))alert("There are no MMDB IDs available for the gi "+e);else{var n=t.substr(t.indexOf("<Link>")),o=n.indexOf("<Id>"),r=n.indexOf("</Id>"),s=n.substr(o+4,r-o-4);i.downloadMmdb(s)}}})},loadAtomDataIn:function(e,i,t,n){var o=this;o.icn3d.init();var r=new THREE.Vector3(9999,9999,9999),s=new THREE.Vector3(-9999,-9999,-9999),a=new THREE.Vector3,c=e.atoms,l=0,d=0,h={},u={};if(o.pmid=e.pubmedid,"align"===t)for(var p=0,m=e.aligned_structures.length;m>p;++p){var g=e.aligned_structures[p];1===p&&(o.icn3d.secondId=g.pdbid);for(var v=g.range[0];v<=g.range[1];++v){var f=g.pdbid,b=g.mmdbid;h[v]=f.toString(),u[b]=f}}var E={},y={};if("mmdbid"===t||"align"===t)if("mmdbid"===t){if(void 0!==e.molid2chain)for(var w in e.molid2chain)E[w]=e.molid2chain[w].chain}else if("align"===t&&void 0!==e.molid2chain)for(var _ in e.molid2chain)for(var w in e.molid2chain[_])y[u[_]+"_"+w]=e.molid2chain[_][w].chain;var C={},S="",T="",R="",k="",H="",x="";for(var p in c){++l,C[p]=l;var A=c[p];A.serial=l;var O;if("mmdbid"===t||"mmcif"===t?O=i:"align"===t&&(O=h[l]),void 0!==A.chain||"mmdbid"!==t&&"align"!==t)A.chain=""===A.chain?"Misc":A.chain;else if("mmdbid"===t){var w=A.ids.m;A.chain=void 0===E[w]?"Misc":E[w]}else if("align"===t){var w=A.ids.m;A.chain=void 0===y[O+"_"+w]?"Misc":y[O+"_"+w]}A.resi=parseInt(A.resi),void 0!==A.color&&(A.color=new THREE.Color(A.color)),A.coord=new THREE.Vector3(A.coord.x,A.coord.y,A.coord.z),("mmdbid"===t||"align"===t)&&(A.structure=O);var M="-";"helix"===A.ss?M="H":"sheet"===A.ss?M="E":A.het||(M="C"),o.icn3d.secondarys[A.structure+"_"+A.chain+"_"+A.resi]=M,r.min(A.coord),s.max(A.coord),a.add(A.coord),"p"===A.mt||"n"===A.mt?("p"===A.mt?(o.icn3d.proteins[l]=1,"CA"===A.name&&(o.icn3d.calphas[l]=1)):"n"===A.mt&&(o.icn3d.nucleotides[l]=1,"P"==A.name&&(o.icn3d.nucleotidesP[l]=1)),o.icn3d.het=!1):"s"===A.mt?(o.icn3d.water[l]=1,o.icn3d.het=!0):"l"===A.mt&&(o.icn3d.ligands[l]=1,0===A.bonds.length&&(o.icn3d.ions[l]=1),o.icn3d.het=!0),"HOH"==A.resn&&(o.icn3d.water[l]=1),o.icn3d.atoms[l]=A,o.icn3d.displayAtoms[l]=1,o.icn3d.highlightAtoms[l]=1;var L=A.structure+"_"+A.chain;void 0===o.icn3d.chains[L]&&(o.icn3d.chains[L]={}),o.icn3d.chains[L][l]=1;var I=A.structure+"_"+A.chain+"_"+A.resi;void 0===o.icn3d.residues[I]&&(o.icn3d.residues[I]={}),o.icn3d.residues[I][l]=1,k=A.structure,H=k+"_"+A.chain,x=H+"_"+A.resi,x!==R&&H!==T&&1!==l&&(void 0===o.icn3d.structures[S]&&(o.icn3d.structures[S]=[]),o.icn3d.structures[S].push(T));var D=o.icn3d.residueName2Abbr(A.resn.substr(0,3));if(o.icn3d.residueId2Name[I]=D,A.resi!=d){void 0===o.icn3d.chainsSeq[L]&&(o.icn3d.chainsSeq[L]=[]),void 0===o.icn3d.chainsAnno[L]&&(o.icn3d.chainsAnno[L]=[]),void 0===o.icn3d.chainsAnno[L][0]&&(o.icn3d.chainsAnno[L][0]=[]),void 0===o.icn3d.chainsAnno[L][1]&&(o.icn3d.chainsAnno[L][1]=[]),void 0===o.icn3d.chainsAnnoTitle[L]&&(o.icn3d.chainsAnnoTitle[L]=[]),void 0===o.icn3d.chainsAnnoTitle[L][0]&&(o.icn3d.chainsAnnoTitle[L][0]=[]),void 0===o.icn3d.chainsAnnoTitle[L][1]&&(o.icn3d.chainsAnnoTitle[L][1]=[]);var z={};z.resi=A.resi,z.name=D;var N="";A.resi%10===0&&(N=A.resi.toString()),o.icn3d.chainsSeq[L].push(z),o.icn3d.chainsAnno[L][0].push(N),o.icn3d.chainsAnno[L][1].push(M),o.icn3d.chainsAnnoTitle[L][0].push(""),o.icn3d.chainsAnnoTitle[L][1].push("SS"),("mmdbid"===t||"align"===t)&&(o.icn3d.chainsColor[L]=A.color)}d=A.resi,S=k,T=H,R=x}if(e.atoms={},void 0===o.icn3d.structures[k]&&(o.icn3d.structures[k]=[]),o.icn3d.structures[k].push(H),"mmcif"!==t)for(var p in o.icn3d.atoms)for(var j=void 0===o.icn3d.atoms[p].bonds?0:o.icn3d.atoms[p].bonds.length,v=0;j>v;++v)o.icn3d.atoms[p].bonds[v]=C[o.icn3d.atoms[p].bonds[v]];if(o.icn3d.cnt=l,o.icn3d.pmin=r,o.icn3d.pmax=s,o.icn3d.maxD=s.distanceTo(r),o.icn3d.center=a.multiplyScalar(1/o.icn3d.cnt),o.icn3d.maxD<25&&(o.icn3d.maxD=25),"align"===t&&void 0!==n){for(var p=0,m=n.length;m>p;++p){for(var q=n[p][0],B=e.aligned_structures[0].pdbid,P=q.mid,V=y[B+"_"+P],F=B+"_"+V,G={},U=q.mseq.length,Y=-1,v=0,W=q.mseq.length;W>v;++v){var X=q.mseq[v][1],Z="~"===q.mseq[v][2]?"-":q.mseq[v][2],Q=q.mseq[v][3];1==Q&&(U>v&&(U=v),v>Y&&(Y=v)),G[v]={resi:X,resn:Z,aligned:Q}}q=n[p][1];var K=e.aligned_structures[1].pdbid,J=q.sid,ee=y[K+"_"+J],ie=K+"_"+ee;void 0===o.icn3d.alignChainsAnnoTitle[F]&&(o.icn3d.alignChainsAnnoTitle[F]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][0]&&(o.icn3d.alignChainsAnnoTitle[F][0]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][1]&&(o.icn3d.alignChainsAnnoTitle[F][1]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][2]&&(o.icn3d.alignChainsAnnoTitle[F][2]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][3]&&(o.icn3d.alignChainsAnnoTitle[F][3]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][4]&&(o.icn3d.alignChainsAnnoTitle[F][4]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][5]&&(o.icn3d.alignChainsAnnoTitle[F][5]=[]),void 0===o.icn3d.alignChainsAnnoTitle[F][6]&&(o.icn3d.alignChainsAnnoTitle[F][6]=[]),o.icn3d.alignChainsAnnoTitle[F][0].push("SS"),o.icn3d.alignChainsAnnoTitle[F][1].push(""),o.icn3d.alignChainsAnnoTitle[F][2].push(""),o.icn3d.alignChainsAnnoTitle[F][3].push(""),o.icn3d.alignChainsAnnoTitle[F][4].push(ie),o.icn3d.alignChainsAnnoTitle[F][5].push(F),o.icn3d.alignChainsAnnoTitle[F][6].push("");for(var te=1,v=U;Y>=v;++v){var ne,X=q.sseq[v][1],Z="~"===q.sseq[v][2]?"-":q.sseq[v][2],Q=G[v].aligned+q.sseq[v][3];ne=2===Q?G[v].resn===Z?"#F00":"#00F":"#CCC",void 0===o.icn3d.alignChainsSeq[F]&&(o.icn3d.alignChainsSeq[F]=[]);var z={};z.mmdbid=B,z.chain=V,z.resi=G[v].resi,z.resn=G[v].resn,z.aligned=Q,z.color=ne,o.icn3d.alignChainsSeq[F].push(z),isNaN(G[v].resi)||(void 0===o.icn3d.alignChains[F]&&(o.icn3d.alignChains[F]={}),$.extend(o.icn3d.alignChains[F],o.icn3d.residues[F+"_"+G[v].resi])),void 0===o.icn3d.alignChainsSeq[ie]&&(o.icn3d.alignChainsSeq[ie]=[]),z={},z.mmdbid=K,z.chain=ee,z.resi=X,z.resn=Z,z.aligned=Q,z.color=ne,o.icn3d.alignChainsSeq[ie].push(z),isNaN(X)||(void 0===o.icn3d.alignChains[ie]&&(o.icn3d.alignChains[ie]={}),$.extend(o.icn3d.alignChains[ie],o.icn3d.residues[ie+"_"+X])),void 0===o.icn3d.alignChainsAnno[F]&&(o.icn3d.alignChainsAnno[F]=[]),void 0===o.icn3d.alignChainsAnno[F][0]&&(o.icn3d.alignChainsAnno[F][0]=[]),void 0===o.icn3d.alignChainsAnno[F][1]&&(o.icn3d.alignChainsAnno[F][1]=[]),void 0===o.icn3d.alignChainsAnno[F][2]&&(o.icn3d.alignChainsAnno[F][2]=[]),v===U&&(void 0===o.icn3d.alignChainsAnno[F][3]&&(o.icn3d.alignChainsAnno[F][3]=[]),void 0===o.icn3d.alignChainsAnno[F][4]&&(o.icn3d.alignChainsAnno[F][4]=[]),void 0===o.icn3d.alignChainsAnno[F][5]&&(o.icn3d.alignChainsAnno[F][5]=[]),void 0===o.icn3d.alignChainsAnno[F][6]&&(o.icn3d.alignChainsAnno[F][6]=[]),o.icn3d.alignChainsAnno[F][3].push(""),o.icn3d.alignChainsAnno[F][4].push(o.icn3d.pdbid_chain2title[ie]),o.icn3d.alignChainsAnno[F][5].push(o.icn3d.pdbid_chain2title[F]),o.icn3d.alignChainsAnno[F][6].push(""));var I=F+"_"+G[v].resi,oe=o.icn3d.secondarys[I];o.icn3d.alignChainsAnno[F][0].push(oe);var re=".";te%5===0&&(re="*"),te%10===0&&(re="|"),o.icn3d.alignChainsAnno[F][1].push(re);var N="";te%10===0&&(N=te.toString()),o.icn3d.alignChainsAnno[F][2].push(N),++te}}n={}}e={}},setStructureMenu:function(e,i){var t=this,n="",o=e?" selected":"",r=Object.keys(t.icn3d.structures).sort();for(var s in r){var a=r[s];void 0!==i&&(o=-1!==i.indexOf(a)?" selected":"");var c=void 0!==t.icn3d.secondId&&0===a.indexOf(t.icn3d.secondId)?"&nbsp;&nbsp;&nbsp;":"";if(n+="<option value='"+a+"'"+o+">"+c+r[s]+"</option>"," selected"===o)for(var l in t.icn3d.structures[a]){var d=t.icn3d.structures[a][l];t.icn3d.highlightAtoms=t.icn3d.unionHash(t.icn3d.highlightAtoms,t.icn3d.chains[d])}}return n},setChainMenu:function(e,i){var t=this,n="",o=e?" selected":"";if(void 0===i)for(var r in t.icn3d.chains){var s=void 0!==t.icn3d.secondId&&0===r.indexOf(t.icn3d.secondId)?"&nbsp;&nbsp;&nbsp;":"";n+="<option value='"+r+"' "+o+">"+s+r+"</option>",t.icn3d.highlightAtoms=t.icn3d.unionHash(t.icn3d.highlightAtoms,t.icn3d.chains[r])}else for(var r in t.icn3d.chains){var a=r.indexOf("_"),c=r.substr(0,a),s=void 0!==t.icn3d.secondId&&0===r.indexOf(t.icn3d.secondId)?"&nbsp;&nbsp;&nbsp;":"";null!==i&&-1!==i.toString().toLowerCase().indexOf(c.toLowerCase())?(n+="<option value='"+r+"' selected>"+s+r+"</option>",t.icn3d.highlightAtoms=t.icn3d.unionHash(t.icn3d.highlightAtoms,t.icn3d.chains[r])):n+="<option value='"+r+"'>"+s+r+"</option>"}return n},getAlignChainSelections:function(){var e=this,i="";for(var t in e.icn3d.alignChains){var n=void 0!==e.icn3d.secondId&&0===t.indexOf(e.icn3d.secondId)?"&nbsp;&nbsp;&nbsp;":"";i+="<option value='"+t+"'>"+n+t+"</option>",e.icn3d.highlightAtoms=e.icn3d.unionHash(e.icn3d.highlightAtoms,e.icn3d.alignChains[t])}return i},setResidueMenu:function(e){var i=this,t="",n=!1;for(var o in i.icn3d.definedNames2Residues)o===e?(t+="<option value='"+o+"' selected='selected'>"+o+"</option>",n=!0):t+="<option value='"+o+"'>"+o+"</option>";return n&&($("#"+i.pre+"chainid").val(""),$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"structureid2").val("")),t},setAtomMenu:function(e){var i=this,t="",n=!1;for(var o in i.icn3d.definedNames2Atoms)o===e?(t+="<option value='"+o+"' selected='selected'>"+o+"</option>",n=!0):t+="<option value='"+o+"'>"+o+"</option>";return n&&($("#"+i.pre+"chainid").val(""),$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"structureid2").val("")),t},getSequencesAnnotations:function(e,i,t){var n=this,o=""===n.icn3d.moleculeTitle?"<b>Sequences with coordinates:</b>":"<b>Sequences of "+n.icn3d.moleculeTitle+" with coordinates: </b>";o+=" (click to select, click again to deselect, click \"Stop Selection\" to stop the current selection)<br/><button style='white-space:nowrap;' class='"+n.pre+"stopselection'>Stop Selection</button> <button style='white-space:nowrap;' class='"+n.pre+"outputselection'>Output Selection</button><br/>";var r=0;for(var s in e){s=e[s],(void 0===i||i)&&(n.icn3d.highlightAtoms=n.icn3d.unionHash(n.icn3d.highlightAtoms,n.icn3d.chains[s]));var a=[],c="",l=void 0!==n.icn3d.chainsSeq[s]?n.icn3d.chainsSeq[s].length:0;l>r&&(r=l);var d=s.indexOf("_"),h=s.substr(0,d),u=s.substr(d+1);c+="<span class='residueNum' title='starting residue number'>"+n.icn3d.chainsSeq[s][0].resi+"</span>";for(var p=parseInt(n.icn3d.chainsSeq[s][0].resi),m=0,g=l;g>m;++m){var v=h+"_"+u+"_"+n.icn3d.chainsSeq[s][m].resi,f="class='residue'";void 0!==t&&-1!==t.indexOf(v)&&(f="class='residue highlightSeq'");var b=1===n.icn3d.chainsSeq[s][m].name.length?n.icn3d.chainsSeq[s][m].name:n.icn3d.chainsSeq[s][m].name.trim().substr(0,1).toLowerCase();c+="<span id='"+n.pre+h+"_"+u+"_"+n.icn3d.chainsSeq[s][m].resi+"' "+f+">"+b+"</span>",p<parseInt(n.icn3d.chainsSeq[s][m].resi)&&(p=parseInt(n.icn3d.chainsSeq[s][m].resi))}c+="<span class='residueNum' title='ending residue number'>"+p+"</span>";for(var E=void 0!==n.icn3d.chainsAnno[s]?n.icn3d.chainsAnno[s].length:0,y=0,w=E;w>y;++y){a[y]="",a[y]+="<span class='residueNum'></span>";for(var m=0,g=n.icn3d.chainsAnno[s][y].length;g>m;++m){var _=n.icn3d.chainsAnno[s][y][m];a[y]+="<span>"+_+"</span>"}a[y]+="<span class='residueNum'></span>"}for(var y=0,w=E;w>y;++y)o+="<div class='residueLine' style='white-space:nowrap;'><div class='annoTitle' chain='"+s+"' anno='"+y+"'>"+n.icn3d.chainsAnnoTitle[s][y][0]+" </div>"+a[y]+"<br/></div>";var C=void 0!==n.icn3d.chainsColor[s]?"#"+n.icn3d.chainsColor[s].getHexString():"#000000",S=s;title=void 0!==n.icn3d.pdbid_chain2title?n.icn3d.pdbid_chain2title[s]:"",o+='<div class="seqTitle" chain="'+s+'" anno="sequence" style="color:'+C+'" title="'+title+'">'+S+' </div><span class="seqLine" style="color:'+C+'">'+c+"</span><br/>"}return{sequencesHtml:o,maxSeqCnt:r}},getAlignSequencesAnnotations:function(e,i,t){var n=this,o="<b>Aligned Sequences:</b>";o+=" (click to select, click again to deselect, click \"Stop Selection\" to stop the current selection)<br/><button style='white-space:nowrap;' class='"+n.pre+"stopselection'>Stop Selection</button> <button style='white-space:nowrap;' class='"+n.pre+"outputselection'>Output Selection</button><br/>";var r=0;for(var s in e){s=e[s],(void 0===i||i)&&(n.icn3d.highlightAtoms=n.icn3d.unionHash(n.icn3d.highlightAtoms,n.icn3d.alignChains[s]));var a=[],c="",l=void 0!==n.icn3d.alignChainsSeq[s]?n.icn3d.alignChainsSeq[s].length:0;l>r&&(r=l);var d=s.indexOf("_"),h=s.substr(0,d),u=s.substr(d+1);c+="<span class='residueNum' title='starting residue number'>"+n.icn3d.alignChainsSeq[s][0].resi+"</span>";for(var p=0,m=l;m>p;++p){var g="N/A",v="",f="#000";isNaN(n.icn3d.alignChainsSeq[s][p].resi)||(g=n.icn3d.alignChainsSeq[s][p].resi,v=h+"_"+u+"_"+g,f=n.icn3d.alignChainsSeq[s][p].color);var b="class='residue'";2===n.icn3d.alignChainsSeq[s][p].aligned&&void 0!==t&&""!==v&&-1!==t.indexOf(v)&&(b="class='residue highlightSeq'"),c+="<span id='"+n.pre+v+"' "+b+" style='color:"+f+"'>"+n.icn3d.alignChainsSeq[s][p].resn+"</span>"}c+="<span class='residueNum' title='ending residue number'>"+n.icn3d.alignChainsSeq[s][l-1].resi+"</span>";for(var E=void 0!==n.icn3d.alignChainsAnno[s]?n.icn3d.alignChainsAnno[s].length:0,y=0,w=E;w>y;++y){a[y]="",a[y]+="<span class='residueNum'></span>";for(var p=0,m=n.icn3d.alignChainsAnno[s][y].length;m>p;++p)a[y]+="<span>"+n.icn3d.alignChainsAnno[s][y][p]+"</span>";a[y]+="<span class='residueNum'></span>"}for(var f=void 0!==n.icn3d.chainsColor[s]?"#"+n.icn3d.chainsColor[s].getHexString():"#000000",_=s,C=void 0!==n.icn3d.pdbid_chain2title?n.icn3d.pdbid_chain2title[s]:"",y=E-1;y>=0;--y)o+="<div class='residueLine' style='white-space:nowrap;'><div class='seqTitle' chain='"+s+"' anno='"+y+"'>"+n.icn3d.alignChainsAnnoTitle[s][y][0]+"</div>"+a[y]+"<br/></div>";o+='<div class="seqTitle" chain="'+s+'" anno="sequence" style="color:'+f+'" title="'+C+'">'+_+' </div><span class="seqLine" style="color:'+f+'">'+c+"</span><br/>"}return{sequencesHtml:o,maxSeqCnt:r}},addCustomSelection:function(e,i,t,n,o,r){var s=this;if(t in s.icn3d.definedNames2Residues){r&&(s.icn3d.definedNames2Residues[t]=s.icn3d.definedNames2Residues[t].concat(e)),s.icn3d.definedNames2Atoms[t]=s.icn3d.definedNames2Atoms[t].concat(i),s.icn3d.definedNames2Descr[t]=n,s.icn3d.definedNames2Command[t]=o;var a=s.setResidueMenu(t),c=s.setAtomMenu(t);$("#"+s.pre+"customResidues").html(a),$("#"+s.pre+"customResidues2").html(a),$("#"+s.pre+"customAtoms").html(c)}else{r&&(s.icn3d.definedNames2Residues[t]=e),s.icn3d.definedNames2Atoms[t]=i,s.icn3d.definedNames2Descr[t]=n,s.icn3d.definedNames2Command[t]=o;var a=s.setResidueMenu(t),c=s.setAtomMenu(t);$("#"+s.pre+"customResidues").html(a),$("#"+s.pre+"customResidues2").html(a),$("#"+s.pre+"customAtoms").html(c)}},changeStructureid:function(e){var i=this;i.icn3d.removeHighlightObjects(),i.icn3d.highlightAtoms={},i.ALTERNATE_STRUCTURE=Object.keys(i.icn3d.structures).indexOf(e[0]),$("#"+i.pre+"chainid").val(""),$("#"+i.pre+"alignChainid").val(""),$("#"+i.pre+"customResidues").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"alignChainid2").val(""),$("#"+i.pre+"customResidues2").val(""),$("#"+i.pre+"customAtoms").val(""),null!==e&&i.setLogCommand("select structure "+e.toString(),!0);var t=i.setChainMenu(!1,e);$("#"+i.pre+"chainid").html(t),$("#"+i.pre+"chainid2").html(t);var n=[];for(var o in i.icn3d.residues){var r=o.indexOf("_"),s=o.substr(0,r);-1!==e.toString().toLowerCase().indexOf(s.toLowerCase())&&(n.push(o),i.icn3d.highlightAtoms=i.icn3d.unionHash(i.icn3d.highlightAtoms,i.icn3d.residues[o]))}var a=i.getSequencesAnnotations(Object.keys(i.icn3d.chains),!1,n);$("#"+i.pre+"dl_sequence").html(a.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*a.maxSeqCnt+200),i.icn3d.addHighlightObjects()},changeChainid:function(e){var i=this;i.icn3d.removeHighlightObjects(),i.icn3d.highlightAtoms={},$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"alignChainid").val(""),$("#"+i.pre+"customResidues").val(""),$("#"+i.pre+"structureid2").val(""),$("#"+i.pre+"alignChainid2").val(""),$("#"+i.pre+"customResidues2").val(""),$("#"+i.pre+"customAtoms").val(""),null!==e&&i.setLogCommand("select chain "+e.toString(),!0);var t=[];for(var n in i.icn3d.residues){var o=n.lastIndexOf("_"),r=n.substr(0,o);-1!==e.toString().toLowerCase().indexOf(r.toLowerCase())&&(t.push(n),i.icn3d.highlightAtoms=i.icn3d.unionHash(i.icn3d.highlightAtoms,i.icn3d.residues[n]))}var s=i.getSequencesAnnotations(Object.keys(i.icn3d.chains),!1,t);$("#"+i.pre+"dl_sequence").html(s.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*s.maxSeqCnt+200),i.icn3d.addHighlightObjects()},changeAlignChainid:function(e){var i=this;i.icn3d.removeHighlightObjects(),i.icn3d.highlightAtoms={},$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"chainid").val(""),$("#"+i.pre+"customResidues").val(""),$("#"+i.pre+"structureid2").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"customResidues2").val(""),$("#"+i.pre+"customAtoms").val(""),null!==e&&i.setLogCommand("select alignChain "+e.toString(),!0);var t=[];for(var n in i.icn3d.residues){var o=n.lastIndexOf("_"),r=n.substr(0,o);-1!==e.toString().toLowerCase().indexOf(r.toLowerCase())&&(t.push(n),i.icn3d.highlightAtoms=i.icn3d.unionHash(i.icn3d.highlightAtoms,i.icn3d.residues[n]))}var s=i.getAlignSequencesAnnotations(Object.keys(i.icn3d.alignChains),!1,t);$("#"+i.pre+"dl_sequence2").html(s.sequencesHtml),$("#"+i.pre+"dl_sequence2").width(i.RESIDUE_WIDTH*s.maxSeqCnt+200),i.icn3d.addHighlightObjects()},changeResidueid:function(e){var i=this;i.icn3d.removeHighlightObjects(),i.icn3d.highlightAtoms={},$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"chainid").val(""),$("#"+i.pre+"alignChainid").val(""),$("#"+i.pre+"customResidues").val(""),$("#"+i.pre+"structureid2").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"alignChainid2").val(""),$("#"+i.pre+"customResidues2").val(""),$("#"+i.pre+"customAtoms").val(""),null!==e&&i.setLogCommand("select residue "+e.toString(),!0);for(var t="",n=0,o=e.length;o>n;++n)i.icn3d.highlightAtoms=i.icn3d.unionHash(i.icn3d.highlightAtoms,i.icn3d.residues[e[n]]);t+="<b>Annotation(s):</b> Previously selected residues<br/>";var r=[];for(var s in i.icn3d.chains)r.push(s);var a=i.getSequencesAnnotations(r,!1,e);$("#"+i.pre+"dl_sequence").html(t+a.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*a.maxSeqCnt+200),i.icn3d.addHighlightObjects()},changeCustomResidues:function(e){var i=this;i.icn3d.removeHighlightObjects(),i.icn3d.highlightAtoms={},$("#"+i.pre+"chainid").val(""),$("#"+i.pre+"alignChainid").val(""),$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"alignChainid2").val(""),$("#"+i.pre+"structureid2").val(""),$("#"+i.pre+"customAtoms").val(""),t+=" (click to select, click again to deselect, click \"Stop Selection\" to stop the current selection)<br/><button style='white-space:nowrap;' class='"+i.pre+"stopselection'>Stop Selection</button> <button style='white-space:nowrap;' class='"+i.pre+"outputselection'>Output Selection</button><br/>";for(var t="",n="",o={},r=0;r<e.length;++r){var s=i.icn3d.definedNames2Residues[e[r]];if(void 0!==s){var a=i.icn3d.definedNames2Descr[e[r]];n+="<b>"+e[r]+":</b> "+a+"; ";for(var c=0,l=s.length;l>c;++c)o[s[c]]=1,i.icn3d.highlightAtoms=i.icn3d.unionHash(i.icn3d.highlightAtoms,i.icn3d.residues[s[c]])}}t+="<b>Annotation(s):</b> "+n+"<br/>";var d=[];for(var h in i.icn3d.chains)d.push(h);var u=i.getSequencesAnnotations(d,!1,Object.keys(o));$("#"+i.pre+"dl_sequence").html(t+u.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*u.maxSeqCnt+200),i.icn3d.addHighlightObjects()},changeCustomAtoms:function(e){var i=this;i.icn3d.removeHighlightObjects(),i.icn3d.highlightAtoms={},$("#"+i.pre+"chainid").val(""),$("#"+i.pre+"alignChainid").val(""),$("#"+i.pre+"structureid").val(""),$("#"+i.pre+"customResidues").val(""),$("#"+i.pre+"chainid2").val(""),$("#"+i.pre+"alignChainid2").val(""),$("#"+i.pre+"structureid2").val(""),$("#"+i.pre+"customResidues2").val(""),$("#"+i.pre+"command").val(""),$("#"+i.pre+"command_name").val(""),$("#"+i.pre+"command_desc").val(""),t+=" (click to select, click again to deselect, click \"Stop Selection\" to stop the current selection)<br/><button style='white-space:nowrap;' class='"+i.pre+"stopselection'>Stop Selection</button> <button style='white-space:nowrap;' class='"+i.pre+"outputselection'>Output Selection</button><br/>";for(var t="",n="",o={},r=0;r<e.length;++r){for(var s=i.icn3d.definedNames2Atoms[e[r]],a={},c=0,l=s.length;l>c;++c){var d=i.icn3d.atoms[s[c]],h=d.structure+"_"+d.chain+"_"+d.resi;a[h]=1}var u=Object.keys(a);if(void 0!==u){var p=i.icn3d.definedNames2Descr[e[r]];n+="<b>"+e[r]+":</b> "+p+"; ";for(var c=0,l=u.length;l>c;++c)o[u[c]]=1}}t+="<b>Annotation(s):</b> "+n+"<br/>";var m=[];for(var g in i.icn3d.chains)m.push(g);var v=i.getSequencesAnnotations(m,!1,Object.keys(o));$("#"+i.pre+"dl_sequence").html(t+v.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*v.maxSeqCnt+200),i.icn3d.highlightAtoms={};for(var r=0;r<e.length;++r){var s=i.icn3d.definedNames2Atoms[e[r]],f=i.icn3d.definedNames2Descr[e[r]],b=i.icn3d.definedNames2Command[e[r]];if(0===r)$("#"+i.pre+"command").val(b),$("#"+i.pre+"command_name").val(e[r]),$("#"+i.pre+"command_desc").val(f);else{var E=$("#command").val();$("#"+i.pre+"command").val(E+"; "+b);var E=$("#command_name").val();$("#"+i.pre+"command_name").val(E+"; "+e[r]);var E=$("#command_desc").val();$("#"+i.pre+"command_desc").val(E+"; "+f)}for(var c=0,l=s.length;l>c;++c)i.icn3d.highlightAtoms[s[c]]=1}i.icn3d.addHighlightObjects()},showSelection:function(e){var i=this;i.icn3d.displayAtoms={},i.icn3d.cloneHash(i.icn3d.highlightAtoms,i.icn3d.displayAtoms);var t={};t.rotationcenter="display center",i.icn3d.draw(t)},selectByCommand:function(e,i,t){for(var n=this,o=e.replace(/\s/g,"").split(";"),r=[],s=[],a=!0,c=0,l=o.length;l>c;++c){var d,h,u,p,m=o[c].indexOf("#"),g=o[c].indexOf("."),v=o[c].indexOf(":"),f=o[c].indexOf("@"),b=o[c];-1===f?p="*":(p=b.substr(f+1),b=b.substr(0,f)),-1===v?u="*":(u=b.substr(v+1),b=b.substr(0,v)),-1===g?h="*":(h=b.substr(g+1),b=b.substr(0,g)),-1===m?d="*":(d=b.substr(m+1),b=b.substr(0,m)),"*"!==p&&(a=!1);var E,y,w,_,C=[],S=[];if(C="*"===d?Object.keys(n.icn3d.structures):d.split(","),"*"===h){var T=Object.keys(n.icn3d.chains);for(var R in T)y=T[R],E=y.substr(0,y.indexOf("_")),-1!==C.toString().toLowerCase().indexOf(E.toLowerCase())&&S.push(y)}else for(var R in C){E=C[R];var k=h.split(",");for(var H in k)S.push(E+"_"+k[H])}var x=u.split(",");for(var R in x){var A,$=!1,O=x[R].indexOf("-"),M=!1;if(-1!==O)w=x[R].substr(0,O),_=x[R].substr(O+1),$=!0;else if(isNaN(x[R])){if("*"===x[R])M=!0;else if("proteins"!==x[R]&&"nucleotides"!==x[R]&&"ligands"!==x[R]&&"ions"!==x[R]&&"water"!==x[R]){var L=x[R].toUpperCase();A=1===x[R].length?L:n.icn3d.residueName2Abbr(L)}}else w=x[R],_=w,$=!0;var I={};for(var D in S)if(y=S[D],$)for(var H=parseInt(w);H<=parseInt(_);++H){var z=y+"_"+H;r.push(z);for(var N in n.icn3d.residues[z])("*"===p||p===n.icn3d.atoms[N].name)&&s.push(N)}else if(y in n.icn3d.chains){var j=n.icn3d.chains[y];for(var N in j){var L=n.icn3d.atoms[N].resn.substr(0,3).toUpperCase();(M||n.icn3d.residueName2Abbr(L)===A||"proteins"===x[R]&&N in n.icn3d.proteins||"nucleotides"===x[R]&&N in n.icn3d.nucleotides||"ligands"===x[R]&&N in n.icn3d.ligands||"ions"===x[R]&&N in n.icn3d.ions||"water"===x[R]&&N in n.icn3d.water)&&(I[y+"_"+n.icn3d.atoms[N].resi]=1,("*"===p||p===n.icn3d.atoms[N].name)&&s.push(N))}}for(var q in I)r.push(q)}}if(""!==i){n.addCustomSelection(r,s,i,t,e,a);var B=[i];n.changeCustomResidues(B)}},pickCustomSphere:function(e){var i=this;i.clearSelection();var t="select zone cutoff "+e,n={};for(var o in i.icn3d.highlightAtoms)n[o]=i.icn3d.atoms[o];var r=i.icn3d.getAtomsWithinAtom(i.icn3d.hash2Atoms(i.icn3d.displayAtoms),n,parseFloat(e)),s={},a=[];for(var o in r){var c=r[o],l=c.structure+"_"+c.chain+"_"+c.resi;s[l]=1,a.push(o)}var d=Object.keys(s);i.icn3d.highlightAtoms={};for(var h in d){var l=d[h];for(var o in i.icn3d.residues[l])i.icn3d.highlightAtoms[o]=1}var u,p,m=i.icn3d.getFirstAtomObj(n);u="sphere."+m.chain+":"+i.icn3d.residueName2Abbr(m.resn.substr(0,3))+m.resi+"-"+$("#"+i.pre+"radius_aroundsphere").val()+"A",p="select a sphere around currently selected "+Object.keys(i.icn3d.highlightAtoms).length+" atoms with a radius of "+e+" angstrom",i.addCustomSelection(d,a,u,p,t,!0);var g=[u];i.changeCustomResidues(g)},showHbonds:function(e){var i=this,t={};t.hbonds="yes";var n="hbonds "+e,o={};for(var r in i.icn3d.atoms)!i.icn3d.highlightAtoms.hasOwnProperty(r)&&i.icn3d.displayAtoms.hasOwnProperty(r)&&(o[r]=i.icn3d.atoms[r]);var s=i.icn3d.getFirstAtomObj(i.icn3d.highlightAtoms);if(Object.keys(o).length>0&&Object.keys(i.icn3d.highlightAtoms).length>0){i.icn3d.calculateLigandHbonds(o,i.icn3d.intersectHash2Atoms(i.icn3d.displayAtoms,i.icn3d.highlightAtoms),parseFloat(e)),i.clearSelection();var a={},c=[];for(var r in i.icn3d.highlightAtoms){var l=i.icn3d.atoms[r].structure+"_"+i.icn3d.atoms[r].chain+"_"+i.icn3d.atoms[r].resi;a[l]=1,c.push(r)}var d="hbonds_"+s.serial,h="all atoms that are hydrogen-bonded with the selected atoms";i.addCustomSelection(Object.keys(a),c,d,h,n,!0);var u=[d];i.changeCustomResidues(u),i.icn3d.draw(t)}},addLabel:function(e,i,t,n,o,r,s){var a=this,c={},l=new THREE.Vector3;l.x=i,l.y=t,l.z=n,c.position=l,c.text=e,c.size=o,c.color=r,c.background=s,a.icn3d.labels.push(c),a.icn3d.removeHighlightObjects()},addLine:function(e,i,t,n,o,r,s,a){var c=this,l={};l.position1=new THREE.Vector3(e,i,t),l.position2=new THREE.Vector3(n,o,r),l.color=s,l.dashed=a,c.icn3d.lines.push(l),c.icn3d.removeHighlightObjects()},selectAChain:function(e,i){var t=this,i=i.replace(/\s/g,""),n="select chain "+e,o=[],r=[];t.icn3d.removeHighlightObjects(),t.icn3d.highlightAtoms={};for(var s in t.icn3d.chainsSeq[e]){var a=t.icn3d.chainsSeq[e][s],c=e+"_"+a.resi,l=a.name;if(""!==l&&"-"!==l){o.push(c);for(var d in t.icn3d.residues[c])r.push(d),t.icn3d.highlightAtoms[d]=1}}t.addCustomSelection(o,r,i,i,n,!0),t.icn3d.addHighlightObjects()},selectAAlignChain:function(e,i){var t=this,n=i.replace(/\s/g,""),o="Selection from chain annotation in 'Select Residue' dialog",r=[],s=[];t.icn3d.removeHighlightObjects(),t.icn3d.highlightAtoms={};for(var a in t.icn3d.alignChainsSeq[e]){var c=t.icn3d.alignChainsSeq[e][a],l=e+"_"+c.resi,d=c.name;if(""!==d&&"-"!==d){r.push(l);for(var h in t.icn3d.residues[l])s.push(h),t.icn3d.highlightAtoms[h]=1}}t.addCustomSelection(r,s,n,i,o,!0),t.icn3d.addHighlightObjects()},selectAResidue:function(e,i){var t=this,i=i.replace(/\s/g,""),n="select residue "+e,o=[],r=[];o.push(e);for(var s in t.icn3d.residues[e])r.push(s),t.icn3d.highlightAtoms[s]=1;t.addCustomSelection(o,r,i,i,n,!0)},back:function(){var e=this;e.STATENUMBER--,e.STATENUMBER<1?e.STATENUMBER=1:e.execCommands(e.STATENUMBER),e.adjustIcon()},forward:function(){var e=this;e.STATENUMBER++,e.STATENUMBER>e.icn3d.commands.length?e.STATENUMBER=e.icn3d.commands.length:e.execCommands(e.STATENUMBER),e.adjustIcon()},toggleSelection:function(){var e=this;if(e.HIDE_SELECTION){for(var i in e.icn3d.displayAtoms)e.icn3d.highlightAtoms.hasOwnProperty(i)&&delete e.icn3d.displayAtoms[i];e.HIDE_SELECTION=!1}else e.icn3d.displayAtoms=e.icn3d.unionHash(e.icn3d.displayAtoms,e.icn3d.highlightAtoms),e.HIDE_SELECTION=!0;e.icn3d.draw()},alternateStructures:function(){var e=this;e.icn3d.displayAtoms={};for(var i=Object.keys(e.icn3d.structures),t=0,n=i.length;n>t;++t){var o=i[t];if(t>e.ALTERNATE_STRUCTURE||e.ALTERNATE_STRUCTURE===n-1&&0===t){for(var r in e.icn3d.structures[o]){var s=e.icn3d.structures[o][r];e.icn3d.displayAtoms=e.icn3d.unionHash(e.icn3d.displayAtoms,e.icn3d.chains[s])}var i=[];i.push(o),e.changeStructureid(i);var a=e.setStructureMenu(!1,i);$("#"+e.pre+"structureid").html(a),$("#"+e.pre+"structureid2").html(a),e.ALTERNATE_STRUCTURE=t;break}}e.icn3d.draw()},adjustIcon:function(){var e=this;1===e.STATENUMBER?$("#"+e.pre+"back").hasClass("middleIcon")&&($("#"+e.pre+"back").toggleClass("middleIcon"),$("#"+e.pre+"back").toggleClass("endIcon")):$("#"+e.pre+"back").hasClass("endIcon")&&($("#"+e.pre+"back").toggleClass("middleIcon"),$("#"+e.pre+"back").toggleClass("endIcon")),e.STATENUMBER===e.icn3d.commands.length?$("#"+e.pre+"forward").hasClass("middleIcon")&&($("#"+e.pre+"forward").toggleClass("middleIcon"),$("#"+e.pre+"forward").toggleClass("endIcon")):$("#"+e.pre+"forward").hasClass("endIcon")&&($("#"+e.pre+"forward").toggleClass("middleIcon"),$("#"+e.pre+"forward").toggleClass("endIcon"))},toggle:function(e,i,t,n){$("#"+e).toggleClass("ui-icon-plus"),$("#"+e).toggleClass("ui-icon-minus"),$("#"+i).toggleClass("ui-icon-plus"),$("#"+i).toggleClass("ui-icon-minus"),$("#"+e).toggleClass("shown"),$("#"+e).toggleClass("hidden"),$("#"+i).toggleClass("shown"),$("#"+i).toggleClass("hidden"),$("#"+t).toggleClass("shown"),$("#"+t).toggleClass("hidden"),$("#"+n).toggleClass("shown"),$("#"+n).toggleClass("hidden")},isIE:function(){var e=window.navigator.userAgent,i=e.indexOf("MSIE ");return i>0||navigator.userAgent.match(/Trident.*rv\:11\./)?!0:!1},saveFile:function(e,i,t){var n=this;if(n.isIE()){if(window.navigator.msSaveBlob)if("text"===i){var o=n.icn3d.commands.join("\n"),r=decodeURIComponent(o),s=new Blob([r],{type:"text/html;charset=utf-8;"});navigator.msSaveBlob(s,e)}else if("png"===i){n.icn3d.render();var s=n.icn3d.renderer.domElement.msToBlob();navigator.msSaveBlob(s,e)}else if("residue"===i){var o=t,r=decodeURIComponent(o),s=new Blob([r],{type:"text/html;charset=utf-8;"});navigator.msSaveBlob(s,e)}}else{var r;if("text"===i){var o=n.icn3d.commands.join("\n");r="data:text;charset=utf-8,"+encodeURIComponent(o)}else if("png"===i){n.icn3d.render();var o=n.icn3d.renderer.domElement.toDataURL("image/png");r=o}else if("residue"===i){var o=t;r="data:text;charset=utf-8,"+encodeURIComponent(o)}window.open(r,"_blank")}},loadScript:function(e,i){var t=this;t.icn3d.bRender=!1,e=e.replace(/;/g,"\n"),t.icn3d.commands=e.split("\n"),t.STATENUMBER=t.icn3d.commands.length,t.execCommands(t.STATENUMBER,i)},execCommandsBase:function(e,i,t,n){for(var o=this,r=e;i>=r;++r){if(-1!==o.icn3d.commands[r].indexOf("load"))return void $.when(o.applyCommandLoad(o.icn3d.commands[r],t)).then(function(){o.execCommandsBase(r+1,i,t,n)});if(o.applyCommand(o.icn3d.commands[r],t),r===n-1){o.icn3d.bRender=!0;var s=o.icn3d.commands[n-1].split("|||");if(2==s.length){var a=JSON.parse(s[1]);o.icn3d._zoomFactor=a.factor,o.icn3d.mouseChange.x=a.mouseChange.x,o.icn3d.mouseChange.y=a.mouseChange.y,o.icn3d.quaternion._x=a.quaternion._x,o.icn3d.quaternion._y=a.quaternion._y,o.icn3d.quaternion._z=a.quaternion._z,o.icn3d.quaternion._w=a.quaternion._w}o.icn3d.draw()}}},execCommands:function(e,i){var t=this;t.icn3d.bRender=!1,t.execCommandsBase(0,e-1,i,e)},applyCommandLoad:function(e,i){var t=this;return void 0!==i&&i&&t.setLogCommand(e,!0),t.deferred2=$.Deferred(function(){var i=e.split("|||"),n=i[0].replace(/\s\s/g," ").trim(),o=n.toLowerCase();if(-1!==o.indexOf("load")){var r=o.substr(o.lastIndexOf(" ")+1);-1!==o.indexOf("pdb")?t.downloadPdb(r):-1!==o.indexOf("mmcif")?t.downloadMmcif(r):-1!==o.indexOf("mmdb")?t.downloadMmdb(r):-1!==o.indexOf("gi")?t.downloadGi(r):-1!==o.indexOf("cid")?t.downloadCid(r):-1!==o.indexOf("align")&&t.downloadAlignment(r);
}}),t.deferred2},applyCommand:function(e,i){var t=this;void 0!==i&&i&&t.setLogCommand(e,!0);var n=e.split("|||"),o=n[0].replace(/\s\s/g," ").trim(),r=o.toLowerCase();if(-1!==r.indexOf("export state file"));else if(-1!==o.indexOf("select structure")){var s=o.substr(o.lastIndexOf(" ")+1).split(",");null!==s&&t.changeStructureid(s)}else if(-1!==o.indexOf("select chain")){var s=o.substr(o.lastIndexOf(" ")+1).split(",");null!==s&&t.changeChainid(s)}else if(-1!==o.indexOf("select alignChain")){var s=o.substr(o.lastIndexOf(" ")+1).split(",");null!==s&&t.changeAlignChainid(s)}else if(-1!==o.indexOf("select residue")){var s=o.substr(o.lastIndexOf(" ")+1).split(",");null!==s&&t.changeResidueid(s)}else if(-1!==o.indexOf("select saved selection")){var s=o.substr(o.lastIndexOf(" ")+1).split(",");null!==s&&t.changeCustomResidues(s)}else if(-1!==o.indexOf("select saved atoms")){var s=o.substr(o.lastIndexOf(" ")+1).split(",");null!==s&&t.changeCustomAtoms(s)}else if(-1!==r.indexOf("show selection"))t.showSelection();else if(-1!==r.indexOf("select")&&-1!==r.indexOf("name")&&-1!==r.indexOf("description")){var a=o.split(" | "),c=a[0].substr(a[0].lastIndexOf(" ")+1),l=a[1].substr(a[1].lastIndexOf(" ")+1),d=a[2].substr(a[2].lastIndexOf(" ")+1);t.selectByCommand(c,l,d)}else if(-1!==r.indexOf("set picking atom"))t.icn3d.picking=1,t.icn3d.options.picking="atom";else if(-1!==r.indexOf("set picking off"))t.icn3d.picking=0,t.icn3d.options.picking="no",t.icn3d.draw(void 0,void 0),t.icn3d.removeHighlightObjects();else if(-1!==r.indexOf("set picking residue"))t.icn3d.picking=2,t.icn3d.options.picking="residue";else if(-1!==r.indexOf("pickatom")){var h=parseInt(r.substr(r.lastIndexOf(" ")+1));t.icn3d.pickedatom=t.icn3d.atoms[h];var u=t.icn3d.pickedatom.structure+"_"+t.icn3d.pickedatom.chain+"_"+t.icn3d.pickedatom.resi;0!==$("#"+t.pre+u).length&&$("#"+t.pre+u).toggleClass("highlightSeq")}else if(-1!==r.indexOf("select zone cutoff")){var p=r.substr(r.lastIndexOf(" ")+1);t.pickCustomSphere(p)}else if(-1!==r.indexOf("style")){var m=r.substr(r.indexOf(" ")+1),g=m.substr(0,m.indexOf(" ")),v=m.substr(m.indexOf(" ")+1);t.setStyle(g,v)}else if(-1!==r.indexOf("color")){var f=r.substr(r.indexOf(" ")+1),b={};b.color=f,t.icn3d.setColorByOptions(b,t.icn3d.highlightAtoms)}else if(-1!==r.indexOf("set surface wireframe on"))t.options.wireframe="yes";else if(-1!==r.indexOf("set surface wireframe off"))t.options.wireframe="no";else if(-1!==r.indexOf("set surface opacity")){var E=r.substr(r.lastIndexOf(" ")+1);t.options.opacity=E}else if(-1!==r.indexOf("set surface")){var E=r.substr(12);t.options.surface=E}else if(-1!==r.indexOf("set camera")){var E=r.substr(r.lastIndexOf(" ")+1);t.options.camera=E}else if(-1!==r.indexOf("set background")){var E=r.substr(r.lastIndexOf(" ")+1);t.options.background=E}else if(-1!==r.indexOf("set axis on"))t.options.axis="yes";else if(-1!==r.indexOf("set axis off"))t.options.axis="no";else if(-1!==r.indexOf("reset"))location.reload();else if(-1!==r.indexOf("toggle highlight"))t.icn3d.prevHighlightObjects.length>0?t.icn3d.removeHighlightObjects():t.icn3d.addHighlightObjects();else if(-1!==r.indexOf("set assembly on"))t.icn3d.bAssembly=!0;else if(-1!==r.indexOf("set assembly off"))t.icn3d.bAssembly=!1;else if(-1!==r.indexOf("add label")){var a=r.split(" | "),y=a[0].substr(a[0].lastIndexOf(" ")+1);t.addLabel(y,size,f,background),t.icn3d.draw()}else if(-1!==r.indexOf("add line")){var a=r.split(" | "),w=a[1].split(" "),_=a[2].split(" "),f=a[3].substr(a[3].lastIndexOf(" ")+1),C="true"===a[4].substr(a[4].lastIndexOf(" ")+1)?!0:!1;t.addLine(w[0],w[1],w[2],_[0],_[1],_[2],f,C)}else if(-1!==r.indexOf("zoom selection"))t.icn3d.zoominSelection();else if(-1!==r.indexOf("rotate left"))t.icn3d.bStopRotate=!1,t.ROTATION_DIRECTION="left",t.rotateStructure("left");else if(-1!==r.indexOf("rotate right"))t.icn3d.bStopRotate=!1,t.ROTATION_DIRECTION="right",t.rotateStructure("right");else if(-1!==r.indexOf("rotate up"))t.icn3d.bStopRotate=!1,t.ROTATION_DIRECTION="up",t.rotateStructure("up");else if(-1!==r.indexOf("rotate down"))t.icn3d.bStopRotate=!1,t.ROTATION_DIRECTION="down",t.rotateStructure("down");else if(-1!==r.indexOf("hbonds")){var S=r.substr(r.lastIndexOf(" ")+1);t.showHbonds(S)}else if(-1!==r.indexOf("set hbonds off"))t.options.hbonds="no",t.icn3d.draw(t.options);else if(-1!==r.indexOf("set lines off"))t.options.lines="no",t.icn3d.draw(t.options);else if(-1!==r.indexOf("set labels off"))t.options.labels="no",t.icn3d.draw(t.options);else if(-1!==r.indexOf("back"))t.back();else if(-1!==r.indexOf("forward"))t.forward();else if(-1!==r.indexOf("toggle selection"))t.toggleSelection();else if(-1!==r.indexOf("select all"))t.selectAll();else if(-1!==r.indexOf("select complement"))t.selectComplement();else if(-1!==r.indexOf("set highlight color")){var f=r.substr(20);"yellow"===f?(t.icn3d.highlightColor=new THREE.Color(16776960),t.icn3d.matShader=t.icn3d.setOutlineColor("yellow")):"green"===f?(t.icn3d.highlightColor=new THREE.Color(65280),t.icn3d.matShader=t.icn3d.setOutlineColor("green")):"red"===f&&(t.icn3d.highlightColor=new THREE.Color(16711680),t.icn3d.matShader=t.icn3d.setOutlineColor("red")),t.icn3d.draw()}else if(-1!==r.indexOf("set highlight style")){var v=r.substr(20);"outline"===v?t.icn3d.bHighlight=1:"3d"===v&&(t.icn3d.bHighlight=2),t.icn3d.draw()}else if(-1!==r.indexOf("output selection"))t.outputSelection();else if(-1!==r.indexOf("select")){var c=o,l="unspecified"+parseInt(100*Math.random()),d="description not available";t.selectByCommand(c,l,d)}},setTopMenusHtml:function(e){var i=this,t="";t+="<div style='position:relative;'>",t+="  <!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar-->",t+="  <div id='"+i.pre+"menulist' style='position:absolute; z-index:999; float:left; display:table-row; margin: 3px 0px 0px 3px;'>",t+="    <table border='0' cellpadding='0' cellspacing='0' width='100'><tr>",t+="    <td valign='top'>",t+="    <div style='float:left; margin:10px 5px 0px 5px;'>",t+="          <span id='"+i.pre+"back' class='ui-icon ui-icon-arrowthick-1-w middleIcon link' title='Step backward'></span>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left; margin:10px 5px 0px 5px;'>",t+="          <span id='"+i.pre+"forward' class='ui-icon ui-icon-arrowthick-1-e middleIcon link' title='Step forward'></span>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left;'>",t+="          <accordion id='"+i.pre+"accordion1'>",t+="              <h3>File</h3>",t+="              <div>",t+="              <ul class='menu'>",t+="                <li>Retrieve by ID",t+="                  <ul>",t+="                    <li><span id='"+i.pre+"menu1_pdbid' class='link'>PDB ID</span></li>",t+="                    <li><span id='"+i.pre+"menu1_mmcifid' class='link'>mmCIF ID</span></li>",t+="                    <li><span id='"+i.pre+"menu1_mmdbid' class='link'>MMDB ID</span></li>",t+="                    <li><span id='"+i.pre+"menu1_gi' class='link'>gi</span></li>",t+="                    <li><span id='"+i.pre+"menu1_cid' class='link'>PubChem CID</span></li>",t+="                  </ul>",t+="                </li>",t+="                <li><span id='"+i.pre+"menu1_pdbfile' class='link'>Open PDB File</span></li>",t+="                <li><span id='"+i.pre+"menu1_state' class='link'>Open State/Script</span></li>",t+="                <li><span id='"+i.pre+"menu1_exportState' class='link'>Export State<br/></span></li>",t+="                <li><span id='"+i.pre+"menu1_exportCanvas' class='link'>Export Image</span></li>",t+="                <li>Links",t+="                  <ul>",t+="                    <li><span id='"+i.pre+"menu1_link_structure' class='link'>Search Structure</span></li>",t+="                    <li><span id='"+i.pre+"menu1_link_vast' class='link'>Find Similar Structures</span></li>",t+="                    <li><span id='"+i.pre+"menu1_link_pubmed' class='link'>Literature</span></li>",t+="                  </ul>",t+="                </li>",t+="              </ul>",t+="              </div>",t+="          </accordion>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left;'>",t+="          <accordion id='"+i.pre+"accordion2'>",t+="              <h3>Select</h3>",t+="              <div>",t+="              <ul class='menu'>",t+="                <li>Select",t+="                  <ul>",void 0===i.cfg.cid&&(t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_select_chain'><label for='"+i.pre+"menu2_select_chain'>Structure/Chain</label></li>"),t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_selectall'><label for='"+i.pre+"menu2_selectall'>All</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_selectcomplement'><label for='"+i.pre+"menu2_selectcomplement'>Complement</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_aroundsphere'><label for='"+i.pre+"menu2_aroundsphere'>Custom Sphere</label></li>",void 0===i.cfg.cid&&(t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_selectresidues'><label for='"+i.pre+"menu2_selectresidues'>Sequences</label></li>"),void 0!==i.cfg.align&&(t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_alignment'><label for='"+i.pre+"menu2_alignment'>Aligned Seq.</label></li>"),t+="                      <li><input type='radio' name='"+i.pre+"menu2_select' id='"+i.pre+"menu2_command'><label for='"+i.pre+"menu2_command'>by Command</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Picking",t+="                  <ul>",void 0===i.cfg.cid?(t+="                      <li><input type='radio' name='"+i.pre+"menu2_picking' id='"+i.pre+"menu2_pickingResidue' checked><label for='"+i.pre+"menu2_pickingResidue'>Residue</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu2_picking' id='"+i.pre+"menu2_pickingYes'><label for='"+i.pre+"menu2_pickingYes'>Atom</label></li>"):(t+="                      <li><input type='radio' name='"+i.pre+"menu2_picking' id='"+i.pre+"menu2_pickingResidue'><label for='"+i.pre+"menu2_pickingResidue'>Residue</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu2_picking' id='"+i.pre+"menu2_pickingYes' checked><label for='"+i.pre+"menu2_pickingYes'>Atom</label></li>"),t+="                      <li><input type='radio' name='"+i.pre+"menu2_picking' id='"+i.pre+"menu2_pickingNo'><label for='"+i.pre+"menu2_pickingNo'>Off</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Display",t+="                  <ul>",void 0!==i.cfg.align&&(t+="                      <li><input type='radio' name='"+i.pre+"menu2_display' id='"+i.pre+"menu2_alternate'><label for='"+i.pre+"menu2_alternate'>Alternate Structures</label></li>"),t+="                      <li><input type='radio' name='"+i.pre+"menu2_display' id='"+i.pre+"menu2_toggle'><label for='"+i.pre+"menu2_toggle'>Toggle Selection</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu2_display' id='"+i.pre+"menu2_show_selected'><label for='"+i.pre+"menu2_show_selected'>Display Selection</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu2_display' id='"+i.pre+"toggleHighlight2'><label for='"+i.pre+"toggleHighlight2'>Toggle Highlight</label></li>",t+="                  </ul>",t+="                </li>",t+="                    <li>Highlight Color",t+="                      <ul>",t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_color' id='"+i.pre+"menu2_hl_colorYellow' checked><label for='"+i.pre+"menu2_hl_colorYellow'>Yellow</label></li>",t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_color' id='"+i.pre+"menu2_hl_colorGreen'><label for='"+i.pre+"menu2_hl_colorGreen'>Green</label></li>",t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_color' id='"+i.pre+"menu2_hl_colorRed'><label for='"+i.pre+"menu2_hl_colorRed'>Red</label></li>",t+="                      </ul>",t+="                    </li>",t+="                    <li>Highlight Style",t+="                      <ul>",Detector.webgl?(t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_style' id='"+i.pre+"menu2_hl_styleOutline' checked><label for='"+i.pre+"menu2_hl_styleOutline'>Outline</label></li>",t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_style' id='"+i.pre+"menu2_hl_styleObject'><label for='"+i.pre+"menu2_hl_styleObject'>3D Objects</label></li>"):(t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_style' id='"+i.pre+"menu2_hl_styleOutline'><label for='"+i.pre+"menu2_hl_styleOutline'>Outline</label></li>",t+="                        <li><input type='radio' name='"+i.pre+"menu2_hl_style' id='"+i.pre+"menu2_hl_styleObject' checked><label for='"+i.pre+"menu2_hl_styleObject'>3D Objects</label></li>"),t+="                      </ul>",t+="                    </li>",t+="              </ul>",t+="              </div>",t+="          </accordion>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left;'>",t+="          <accordion id='"+i.pre+"accordion3'>",t+="              <h3>Style</h3>",t+="              <div>",t+="              <ul class='menu'>",void 0===i.cfg.cid&&(t+="                <li>Protein",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinRibbon' checked><label for='"+i.pre+"menu3_proteinRibbon'>Ribbon</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinStrand'><label for='"+i.pre+"menu3_proteinStrand'>Strand</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinCylinder'><label for='"+i.pre+"menu3_proteinCylinder'>Cylinder and Plate</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinCalpha'><label for='"+i.pre+"menu3_proteinCalpha'>C alpha Trace</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinBfactor'><label for='"+i.pre+"menu3_proteinBfactor'>B Factor Tube</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinLines'><label for='"+i.pre+"menu3_proteinLines'>Lines</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinStick'><label for='"+i.pre+"menu3_proteinStick'>Stick</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinBallstick'><label for='"+i.pre+"menu3_proteinBallstick'>Ball and Stick</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinSphere'><label for='"+i.pre+"menu3_proteinSphere'>Sphere</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_protein' id='"+i.pre+"menu3_proteinNothing'><label for='"+i.pre+"menu3_proteinNothing'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Nucleotides",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclCartoon'><label for='"+i.pre+"menu3_nuclCartoon'>Cartoon</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclPhos' checked><label for='"+i.pre+"menu3_nuclPhos'>Phosphorus Trace</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclLines'><label for='"+i.pre+"menu3_nuclLines'>Lines</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclStick'><label for='"+i.pre+"menu3_nuclStick'>Stick</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclBallstick'><label for='"+i.pre+"menu3_nuclBallstick'>Ball and Stick</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclSphere'><label for='"+i.pre+"menu3_nuclSphere'>Sphere</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_nucl' id='"+i.pre+"menu3_nuclNothing'><label for='"+i.pre+"menu3_nuclNothing'>Hide</label></li>",t+="                  </ul>",t+="                </li>"),t+="                <li>Ligands",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ligands' id='"+i.pre+"menu3_ligandsLines'><label for='"+i.pre+"menu3_ligandsLines'>Lines</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ligands' id='"+i.pre+"menu3_ligandsStick' checked><label for='"+i.pre+"menu3_ligandsStick'>Stick</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ligands' id='"+i.pre+"menu3_ligandsBallstick'><label for='"+i.pre+"menu3_ligandsBallstick'>Ball and Stick</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ligands' id='"+i.pre+"menu3_ligandsSphere'><label for='"+i.pre+"menu3_ligandsSphere'>Sphere</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ligands' id='"+i.pre+"menu3_ligandsNothing'><label for='"+i.pre+"menu3_ligandsNothing'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Ions",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ions' id='"+i.pre+"menu3_ionsSphere' checked><label for='"+i.pre+"menu3_ionsSphere'>Sphere</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ions' id='"+i.pre+"menu3_ionsDot'><label for='"+i.pre+"menu3_ionsDot'>Dot</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_ions' id='"+i.pre+"menu3_ionsNothing'><label for='"+i.pre+"menu3_ionsNothing'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Water",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_water' id='"+i.pre+"menu3_waterSphere'><label for='"+i.pre+"menu3_waterSphere'>Sphere</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_water' id='"+i.pre+"menu3_waterDot'><label for='"+i.pre+"menu3_waterDot'>Dot</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu3_water' id='"+i.pre+"menu3_waterNothing' checked><label for='"+i.pre+"menu3_waterNothing'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="              </ul>",t+="              </div>",t+="          </accordion>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left;'>",t+="          <accordion id='"+i.pre+"accordion4'>",t+="              <h3>Color</h3>",t+="              <div>",t+="              <ul class='menu'>",void 0===i.cfg.cid?(t+=void 0!==i.cfg.mmdbid?"                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorSpectrum'><label for='"+i.pre+"menu4_colorSpectrum'>Spectrum</label></li>":"                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorSpectrum' checked><label for='"+i.pre+"menu4_colorSpectrum'>Spectrum</label></li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorChain'><label for='"+i.pre+"menu4_colorChain'>Chain</label></li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorSS'><label for='"+i.pre+"menu4_colorSS'>Secondary</label></li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorBfactor'><label for='"+i.pre+"menu4_colorBfactor'>B Factor</label></li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorResidue'><label for='"+i.pre+"menu4_colorResidue'>Residue</label></li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorPolarity'><label for='"+i.pre+"menu4_colorPolarity'>Polarity</label></li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorAtom'><label for='"+i.pre+"menu4_colorAtom'>Atom</label></li>"):t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorAtom' checked><label for='"+i.pre+"menu4_colorAtom'>Atom</label></li>",t+="                <li>-</li>",t+="                <li>Unicolor",t+="                  <ul>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorRed'><label for='"+i.pre+"menu4_colorRed'>Red</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorGreen'><label for='"+i.pre+"menu4_colorGreen'>Green</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorBlue'><label for='"+i.pre+"menu4_colorBlue'>Blue</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorMagenta'><label for='"+i.pre+"menu4_colorMagenta'>Magenta</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorYellow'><label for='"+i.pre+"menu4_colorYellow'>Yellow</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorCyan'><label for='"+i.pre+"menu4_colorCyan'>Cyan</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorWhite'><label for='"+i.pre+"menu4_colorWhite'>White</label></li>",t+="                    <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorGrey'><label for='"+i.pre+"menu4_colorGrey'>Grey</label></li>",t+="                  </ul>",t+="                <li>-</li>",t+="                <li><input type='radio' name='"+i.pre+"menu4_color' id='"+i.pre+"menu4_colorCustom'><label for='"+i.pre+"menu4_colorCustom'>Custom</label></li>",t+="              </ul>",t+="              </div>",t+="          </accordion>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left;'>",t+="          <accordion id='"+i.pre+"accordion5'>",t+="              <h3>Surface</h3>",t+="              <div>",t+="              <ul class='menu'>",t+="                <li>Show Surface",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_showsurface' id='"+i.pre+"menu5_showsurfaceYes'><label for='"+i.pre+"menu5_showsurfaceYes'>Yes</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_showsurface' id='"+i.pre+"menu5_showsurfaceNo' checked><label for='"+i.pre+"menu5_showsurfaceNo'>No</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Type",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_surface' id='"+i.pre+"menu5_surfaceVDW' checked><label for='"+i.pre+"menu5_surfaceVDW'>Van der Waals</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_surface' id='"+i.pre+"menu5_surfaceSES'><label for='"+i.pre+"menu5_surfaceSES'>Solvent Excluded</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_surface' id='"+i.pre+"menu5_surfaceSAS'><label for='"+i.pre+"menu5_surfaceSAS'>Solvent Accessible</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_surface' id='"+i.pre+"menu5_surfaceMolecular'><label for='"+i.pre+"menu5_surfaceMolecular'>Molecular Surface</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_surface' id='"+i.pre+"menu5_surfaceNothing'><label for='"+i.pre+"menu5_surfaceNothing'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Opacity",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_opacity' id='"+i.pre+"menu5_opacity10'><label for='"+i.pre+"menu5_opacity10'>1.0</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_opacity' id='"+i.pre+"menu5_opacity09'><label for='"+i.pre+"menu5_opacity09'>0.9</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_opacity' id='"+i.pre+"menu5_opacity08' checked><label for='"+i.pre+"menu5_opacity08'>0.8</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_opacity' id='"+i.pre+"menu5_opacity07'><label for='"+i.pre+"menu5_opacity07'>0.7</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_opacity' id='"+i.pre+"menu5_opacity06'><label for='"+i.pre+"menu5_opacity06'>0.6</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_opacity' id='"+i.pre+"menu5_opacity05'><label for='"+i.pre+"menu5_opacity05'>0.5</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Wireframe",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_wireframe' id='"+i.pre+"menu5_wireframeYes'><label for='"+i.pre+"menu5_wireframeYes'>Yes</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu5_wireframe' id='"+i.pre+"menu5_wireframeNo' checked><label for='"+i.pre+"menu5_wireframeNo'>No</label></li>",t+="                  </ul>",t+="                </li>",t+="              </ul>",t+="              </div>",t+="          </accordion>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left;'>",t+="          <accordion id='"+i.pre+"accordion6'>",t+="              <h3>Other</h3>",t+="              <div>",t+="              <ul class='menu'>",t+="                <li><span id='"+i.pre+"reset' class='link'>Reset</span></li>",t+="                <li><span id='"+i.pre+"menu6_selectedcenter' class='link'>Zoom in Selection</span></li>",t+="                <li><span id='"+i.pre+"menu6_back' class='link'>Back</span></li>",t+="                <li><span id='"+i.pre+"menu6_forward' class='link'>Forward</span></li>",void 0===i.cfg.cid&&(t+="                <li>Assembly",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_assembly' id='"+i.pre+"menu6_assemblyYes'><label for='"+i.pre+"menu6_assemblyYes'>Yes</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_assembly' id='"+i.pre+"menu6_assemblyNo' checked><label for='"+i.pre+"menu6_assemblyNo'>No</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>H-bonds to selection",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_hbonds' id='"+i.pre+"menu6_hbondsYes'><label for='"+i.pre+"menu6_hbondsYes'>Show</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_hbonds' id='"+i.pre+"menu6_hbondsNo' checked><label for='"+i.pre+"menu6_hbondsNo'>Hide</label></li>",t+="                  </ul>",t+="                </li>"),t+="                <li>Custom Labels",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_addlabel' id='"+i.pre+"menu6_addlabelYes'><label for='"+i.pre+"menu6_addlabelYes'>Show</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_addlabel' id='"+i.pre+"menu6_addlabelNo' checked><label for='"+i.pre+"menu6_addlabelNo'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Distance",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_distance' id='"+i.pre+"menu6_distanceYes'><label for='"+i.pre+"menu6_distanceYes'>Show</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_distance' id='"+i.pre+"menu6_distanceNo' checked><label for='"+i.pre+"menu6_distanceNo'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Auto Rotation",t+="                  <ul>",t+="                      <li><span id='"+i.pre+"menu6_rotateleft' class='link'>Rotate Left</span></li>",t+="                      <li><span id='"+i.pre+"menu6_rotateright' class='link'>Rotate Right</span></li>",t+="                      <li><span id='"+i.pre+"menu6_rotateup' class='link'>Rotate Up</span></li>",t+="                      <li><span id='"+i.pre+"menu6_rotatedown' class='link'>Rotate Down</span></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Camera",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_camera' id='"+i.pre+"menu6_cameraPers' checked><label for='"+i.pre+"menu6_cameraPers'>Perspective</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_camera' id='"+i.pre+"menu6_cameraOrth'><label for='"+i.pre+"menu6_cameraOrth'>Orthographic</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Background",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_bkgd' id='"+i.pre+"menu6_bkgdBlack' checked><label for='"+i.pre+"menu6_bkgdBlack'>Black</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_bkgd' id='"+i.pre+"menu6_bkgdGrey'><label for='"+i.pre+"menu6_bkgdGrey'>Grey</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_bkgd' id='"+i.pre+"menu6_bkgdWhite'><label for='"+i.pre+"menu6_bkgdWhite'>White</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>XYZ-axes",t+="                  <ul>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_showaxis' id='"+i.pre+"menu6_showaxisYes'><label for='"+i.pre+"menu6_showaxisYes'>Show</label></li>",t+="                      <li><input type='radio' name='"+i.pre+"menu6_showaxis' id='"+i.pre+"menu6_showaxisNo' checked><label for='"+i.pre+"menu6_showaxisNo'>Hide</label></li>",t+="                  </ul>",t+="                </li>",t+="                <li>Transform Hint",t+="                  <ul>",t+="                    <li>Rotate",t+="                        <ul>",t+="                            <li>Left Mouse</li>",t+="                            <li>Key L: Left</li>",t+="                            <li>Key J: Right</li>",t+="                            <li>Key I: Up</li>",t+="                            <li>Key M: Down</li>",t+="                        </ul>",t+="                    </li>",t+="                    <li>Zoom",t+="                        <ul>",t+="                            <li>Middle Mouse</li>",t+="                            <li>Left Mouse + Shift</li>",t+="                            <li>Key Z: Zoom in</li>",t+="                            <li>Key X: Zoom out</li>",t+="                        </ul>",t+="                    </li>",t+="                    <li>Translate",t+="                        <ul>",t+="                            <li>Right Mouse</li>",t+="                            <li>Left Mouse + Ctrl</li>",t+="                            <li>Arrow Left: Left</li>",t+="                            <li>Arrow Right: Right</li>",t+="                            <li>Arrow Up: Up</li>",t+="                            <li>Arrow Down: Down</li>",
t+="                        </ul>",t+="                    </li>",t+="                  </ul>",t+="                </li>",t+="                <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html' target='_blank'>Help</a></li>",t+="              </ul>",t+="              </div>",t+="          </accordion>",t+="    </div>",t+="    </td>",t+="    <td valign='top'>",t+="    <div style='float:left; margin:10px 5px 0px 5px;'>",t+="    <a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html' target='_blank'><span class='ui-icon ui-icon-help middleIcon link' title='click to see the help page'></span></a>",t+="    </div>",t+="    </td>",t+="  </tr>",t+="  </table>",t+="  </div>",t+="  <div id='"+i.pre+"commandlog' style='position:absolute; z-index:555; float:left; display:table-row; margin: 3px 0px 0px "+i.MENU_WIDTH+"px;'>",t+="    <div style='float:left' class='commandTitle'>Script/Log (<a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#commands' target='_blank'><span title='click to see all commands'>Hint</span></a>)</div><br/>",t+="    <textarea id='"+i.pre+"logtext' rows='3' cols='40'></textarea>",t+="  </div>",t+=i.setTools(),t+="  <div id='"+i.pre+"viewer' style='width:100%; height:100%; background-color: #ddd;'>",t+="   <div id='"+i.pre+"menuLogSection'>",t+="    <div style='height: "+i.MENU_HEIGHT+"px;'></div>",t+="    <div style='height: "+i.MENU_HEIGHT+"px;'></div>",t+="   </div>",t+="    <div id='"+i.pre+"wait' style='width:100%; height: 100%; background-color: rgba(221,221,221, 0.8);'><div style='padding-top:25%; text-align: center; font-size: 2em; color: #777777;'>Loading the structure...</div></div>",t+="    <canvas id='"+i.pre+"canvas' style='width:100%; height: 100%; background-color: #000;'>Your browser does not support WebGL.</canvas>",t+="  </div>",t+="</div>",t+="<!-- dialog will not be part of the form -->",t+="<div id='"+i.pre+"allselections' class='hidden'>",t+="<div id='"+i.pre+"dl_filter' style='overflow:auto; position:relative;'>",t+="  <div style='text-align:center; margin-bottom:10px;'><button id='"+i.pre+"filter'><span style='white-space:nowrap'><b>Show Structure</b></span></button>",t+="<button id='"+i.pre+"label_3d_diagram' style='margin-left:10px;'><span style='white-space:nowrap'><b>Show Labels</b></span></button></div>",t+="  <div id='"+i.pre+"dl_filter_table' class='box'>",t+="  </div>",t+="</div>",t+="<div id='"+i.pre+"dl_selectresidues'>",t+="  <div id='"+i.pre+"dl_sequence' class='dl_sequence'>",t+="  </div>",t+="</div>",void 0!==i.cfg.align&&(t+="<div id='"+i.pre+"dl_alignment'>",t+="  <div id='"+i.pre+"dl_sequence2' class='dl_sequence'>",t+="  </div>",t+="</div>"),t+="<div id='"+i.pre+"dl_command'>",t+="  <table><tr><td valign='top'><table>",t+="<tr><td align='right'><b>Select (<a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#selectb' target='_blank'><span title='click to see how to select'>Hint</span></a>):</b></td><td><input type='text' id='"+i.pre+"command' placeholder='#[structures].[chains]:[residues]@[atoms]' size='30'></td></tr>",t+="<tr><td align='right'><b>Name:</b></td><td><input type='text' id='"+i.pre+"command_name' placeholder='my_selection' size='30'></td></tr>",t+="<tr><td align='right'><b>Description:</b></td><td><input type='text' id='"+i.pre+"command_desc' placeholder='description about my selection' size='30'></td></tr>",t+="<tr><td colspan='2' align='center'><button id='"+i.pre+"command_apply'><b>Apply</b></button></td></tr>",t+="  </table></td>",t+="  <td valign='top'><div>",t+="    <b>Atom Selection(s):</b> <br/>",t+="    <select id='"+i.pre+"customAtoms' multiple size='3' style='min-width:100px;'>",t+="    </select>",t+="  </td>",t+="  <td valign='top'><div>",t+="    <button id='"+i.pre+"show_selected_atom'><span style='white-space:nowrap'><b>Display Selection</b></span></button>",t+="  </div></td></tr>",t+="  <tr><td colspan='3'>(Script format: select [select] | name [name] | description [description])</td></tr></table>",t+="</div>",t+="<div id='"+i.pre+"dl_pdbid'>",t+="PDB ID: <input type='text' id='"+i.pre+"pdbid' value='2POR' size=8> ",t+="<button id='"+i.pre+"reload_pdb'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_pdbfile'>",t+="PDB File: <input type='file' id='"+i.pre+"pdbfile' value='2POR' size=8> ",t+="<button id='"+i.pre+"reload_pdbfile'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_mmcifid'>",t+="mmCIF ID: <input type='text' id='"+i.pre+"mmcifid' value='2POR' size=8> ",t+="<button id='"+i.pre+"reload_mmcif'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_mmdbid'>",t+="MMDB ID: <input type='text' id='"+i.pre+"mmdbid' value='2POR' size=8> ",t+="<button id='"+i.pre+"reload_mmdb'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_gi'>",t+="Protein gi: <input type='text' id='"+i.pre+"gi' value='827343227' size=8> ",t+="<button id='"+i.pre+"reload_gi'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_cid'>",t+="PubChem CID: <input type='text' id='"+i.pre+"cid' value='2244' size=8> ",t+="<button id='"+i.pre+"reload_cid'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_state'>",t+="State file: <input type='file' id='"+i.pre+"state'><br/>",t+="<button id='"+i.pre+"reload_state' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+i.pre+"dl_color'>",t+="Custom Color: <input type='text' id='"+i.pre+"color' value='#FF0000' size=8> ",t+="<button id='"+i.pre+"applycustomcolor'>Apply</button>",t+="</div>",t+="<div id='"+i.pre+"dl_hbonds'>",t+="  <span style='white-space:nowrap;'>Threshold: <select id='"+i.pre+"hbondthreshold'>",t+="  <option value='3.2'>3.2</option>",t+="  <option value='3.3'>3.3</option>",t+="  <option value='3.4'>3.4</option>",t+="  <option value='3.5' selected>3.5</option>",t+="  <option value='3.6'>3.6</option>",t+="  <option value='3.7'>3.7</option>",t+="  <option value='3.8'>3.8</option>",t+="  <option value='3.9'>3.9</option>",t+="  <option value='4.0'>4.0</option>",t+="  </select> &#197;</span><br/>",t+="  <span style='white-space:nowrap'><button id='"+i.pre+"applyhbonds'>Display</button></span>",t+="</div>",t+="<div id='"+i.pre+"dl_aroundsphere'",t+="  <span style='white-space:nowrap'>1. Sphere with a radius: <input type='text' id='"+i.pre+"radius_aroundsphere' value='5' size='2'> &#197;</span><br/>",t+="  <span style='white-space:nowrap'>2. <button id='"+i.pre+"applypick_aroundsphere'>Display</button> the sphere around currently selected atoms</span>",t+="</div>",t+="<div id='"+i.pre+"dl_select_chain'>",t+="    <table><tr valign='center'>",t+="        <td valign='top'><b>Structure:</b><br/>",t+="        <select id='"+i.pre+"structureid2' multiple size='3' style='min-width:50px;'>",t+="        </select></td>",t+="        <td valign='top'><b>Chain:</b><br/>",t+="        <select id='"+i.pre+"chainid2' multiple size='3' style='min-width:50px;'>",t+="        </select></td>",void 0!==i.cfg.align&&(t+="        <td valign='top'><b>Aligned:</b><br/>",t+="        <select id='"+i.pre+"alignChainid2' multiple size='3' style='min-width:50px;'>",t+="        </select></td>"),t+="        <td valign='top'><b>Custom:</b><br/>",t+="        <select id='"+i.pre+"customResidues2' multiple size='3' style='min-width:50px;'>",t+="        </select></td>",t+="    </tr></table>",t+="</div>",t+="<div id='"+i.pre+"dl_addlabel'>",t+="1. Text: <input type='text' id='"+i.pre+"labeltext' value='Text' size=4><br/>",t+="2. Size: <input type='text' id='"+i.pre+"labelsize' value='40' size=4><br/>",t+="3. Color: <input type='text' id='"+i.pre+"labelcolor' value='#ffff00' size=4><br/>",t+="4. Background: <input type='text' id='"+i.pre+"labelbkgd' value='#cccccc' size=4><br/>",t+="<span style='white-space:nowrap'>5. Pick TWO atoms</span><br/>",t+="<span style='white-space:nowrap'>6. <button id='"+i.pre+"applypick_labels'>Display</button></span>",t+="</div>",t+="<div id='"+i.pre+"dl_distance'>",t+="  <span style='white-space:nowrap'>1. Pick TWO atoms</span><br/>",t+="  <span style='white-space:nowrap'>2. <button id='"+i.pre+"applypick_measuredistance'>Display</button></span>",t+="</div>",t+="</div>",t+="<!--/form-->",$("#"+e).html(t),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".menu").menu({position:{my:"left top",at:"right top"}}),$(".menu").hover(function(){},function(){$("accordion").accordion("option","active","none")}),$("#"+i.pre+"accordion1").hover(function(){$("#"+i.pre+"accordion1 div").css("display","block")},function(){$("#"+i.pre+"accordion1 div").css("display","none")}),$("#"+i.pre+"accordion2").hover(function(){$("#"+i.pre+"accordion2 div").css("display","block")},function(){$("#"+i.pre+"accordion2 div").css("display","none")}),$("#"+i.pre+"accordion3").hover(function(){$("#"+i.pre+"accordion3 div").css("display","block")},function(){$("#"+i.pre+"accordion3 div").css("display","none")}),$("#"+i.pre+"accordion4").hover(function(){$("#"+i.pre+"accordion4 div").css("display","block")},function(){$("#"+i.pre+"accordion4 div").css("display","none")}),$("#"+i.pre+"accordion5").hover(function(){$("#"+i.pre+"accordion5 div").css("display","block")},function(){$("#"+i.pre+"accordion5 div").css("display","none")}),$("#"+i.pre+"accordion6").hover(function(){$("#"+i.pre+"accordion6 div").css("display","block")},function(){$("#"+i.pre+"accordion6 div").css("display","none")})},setTools:function(){var e=this,i="";i+="  <div id='"+e.pre+"selection' style='position:absolute; z-index:555; float:left; display:table-row; margin: 32px 0px 0px 3px;'>",i+="    <table style='margin-top: 3px;'><tr valign='center'>",void 0===e.cfg.cid&&(i+="        <td valign='top'><span class='commandTitle'>Structure:</span><br/>",i+="        <div style='margin-top:-3px;'><select id='"+e.pre+"structureid' multiple size='1' style='min-width:50px;'>",i+="        </select></div></td>",void 0!==e.cfg.align?(i+="        <td valign='top'><span class='commandTitle'>Aligned:</span><br/>",i+="        <div style='margin-top:-3px;'><select id='"+e.pre+"alignChainid' multiple size='1' style='min-width:50px;'>",i+="        </select></div></td>"):(i+="        <td valign='top'><span class='commandTitle'>Chain:</span><br/>",i+="        <div style='margin-top:-3px;'><select id='"+e.pre+"chainid' multiple size='1' style='min-width:50px;'>",i+="        </select></div></td>")),i+="        <td valign='top'><span class='commandTitle'>Custom:</span><br/>",i+="        <div style='margin-top:-3px;'><select id='"+e.pre+"customResidues' multiple size='1' style='min-width:50px;'>",i+="        </select></div></td>";var t=e.isMobile()?"none":"button";i+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+t+"; height:36px;' id='"+e.pre+"selectall'><span style='white-space:nowrap' class='commandTitle' title='Select all atoms'>Select<br/>All</span></button></div></td>";var n;return n=void 0!==e.cfg.align?"Aligned<br/>Seq.":"Sequ-<br/>ence",void 0===e.cfg.cid&&(i+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+t+"; height:36px;' id='"+e.pre+"show_sequences'><span style='white-space:nowrap' class='commandTitle' title='Show the sequences of the selected structure'>"+n+"</span></button></div></td>",i+="      <td valign='top'><div id='"+e.pre+"alternateWrapper' style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+t+"; height:36px;' id='"+e.pre+"alternate'><span style='white-space:nowrap' class='commandTitle' title='Alternate the structures'>Alternate<br/>Selection</span></button></div></td>"),i+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+t+"; height:36px;' id='"+e.pre+"show_selected'><span style='white-space:nowrap' class='commandTitle' title='Display the selected atoms ONLY'>Display<br/>Selection</span></button></div></td>",i+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+t+"; height:36px;' id='"+e.pre+"zoomin_selection'><span style='white-space:nowrap' class='commandTitle' title='Center on the selected atoms and zoom in'>Zoom in<br/>Selection</span></button></div></td>",void 0===e.cfg.align&&(i+="      <td valign='top'><div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+t+"; height:36px;' id='"+e.pre+"toggleHighlight'><span style='white-space:nowrap' class='commandTitle' title='Turn on and off the 3D highlight in the viewer'>Toggle<br/>Highlight</span></button></div></td>"),i+="    </tr></table>",i+="    </div>"},selectAll:function(){var e=this;e.icn3d.highlightAtoms={};for(var i in e.icn3d.chains)e.icn3d.highlightAtoms=e.icn3d.unionHash(e.icn3d.highlightAtoms,e.icn3d.chains[i]);e.icn3d.removeHighlightObjects();var t=e.getSequencesAnnotations(Object.keys(e.icn3d.chains));$("#"+e.pre+"dl_sequence").html(t.sequencesHtml),$("#"+e.pre+"dl_sequence").width(e.RESIDUE_WIDTH*t.maxSeqCnt+200),e.icn3d.addHighlightObjects()},selectComplement:function(){var e,i=this,t={},n={};for(var o in i.icn3d.atoms)i.icn3d.highlightAtoms.hasOwnProperty(o)||(t[o]=1,e=i.icn3d.atoms[o].structure+"_"+i.icn3d.atoms[o].chain+"_"+i.icn3d.atoms[o].resi,n[e]=1);i.icn3d.highlightAtoms={},i.icn3d.cloneHash(t,i.icn3d.highlightAtoms),i.icn3d.removeHighlightObjects();var r="<b>Annotation(s):</b> Complement of the current selection<br/>",s=[];for(var a in i.icn3d.chains)s.push(a);var c=i.getSequencesAnnotations(s,!1,Object.keys(n));$("#"+i.pre+"dl_sequence").html(r+c.sequencesHtml),$("#"+i.pre+"dl_sequence").width(i.RESIDUE_WIDTH*c.maxSeqCnt+200),i.icn3d.addHighlightObjects()},outputSelection:function(){var e=this,i={};for(var t in e.icn3d.highlightAtoms){var n=e.icn3d.atoms[t].structure+"_"+e.icn3d.atoms[t].chain+"_"+e.icn3d.atoms[t].resi;i[n]=1}for(var o=Object.keys(i).sort(),r="Structure	Chain	Residue Number\n",t=0,s=o.length;s>t;++t){var a=o[t].indexOf("_"),c=o[t].lastIndexOf("_"),l=o[t].substr(0,a),d=o[t].substr(a+1,c-a-1),h=o[t].substr(c+1);r+=l+"	"+d+"	"+h+"\n"}e.saveFile(e.inputid+"_residues.txt","residue",r)},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isMac:function(){return/Mac/i.test(navigator.userAgent)},isSessionStorageSupported:function(){var e="test";try{return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(i){return!1}},saveCommandsToSession:function(){var e=this,i=e.icn3d.commands.join("\n"),t=decodeURIComponent(i);sessionStorage.setItem("commands",t)},clickBack:function(){var e=this;$("#"+e.pre+"back").add("#"+e.pre+"menu6_back").click(function(i){i.preventDefault(),e.setLogCommand("back",!1),e.back()})},clickForward:function(){var e=this;$("#"+e.pre+"forward").add("#"+e.pre+"menu6_forward").click(function(i){i.preventDefault(),e.setLogCommand("forward",!1),e.forward()})},clickToggle:function(){var e=this;$("#"+e.pre+"toggle").add("#"+e.pre+"menu2_toggle").click(function(i){e.setLogCommand("toggle selection",!0),e.toggleSelection()})},clickHlColorYellow:function(){var e=this;$("#"+e.pre+"menu2_hl_colorYellow").click(function(i){e.setLogCommand("set highlight color yellow",!0),e.icn3d.highlightColor=new THREE.Color(16776960),e.icn3d.matShader=e.icn3d.setOutlineColor("yellow"),e.icn3d.draw()})},clickHlColorGreen:function(){var e=this;$("#"+e.pre+"menu2_hl_colorGreen").click(function(i){e.setLogCommand("set highlight color green",!0),e.icn3d.highlightColor=new THREE.Color(65280),e.icn3d.matShader=e.icn3d.setOutlineColor("green"),e.icn3d.draw()})},clickHlColorRed:function(){var e=this;$("#"+e.pre+"menu2_hl_colorRed").click(function(i){e.setLogCommand("set highlight color red",!0),e.icn3d.highlightColor=new THREE.Color(16711680),e.icn3d.matShader=e.icn3d.setOutlineColor("red"),e.icn3d.draw()})},clickHlStyleOutline:function(){var e=this;$("#"+e.pre+"menu2_hl_styleOutline").click(function(i){e.setLogCommand("set highlight style outline",!0),e.icn3d.bHighlight=1,e.icn3d.draw()})},clickHlStyleObject:function(){var e=this;$("#"+e.pre+"menu2_hl_styleObject").click(function(i){e.setLogCommand("set highlight style 3d",!0),e.icn3d.bHighlight=2,e.icn3d.draw()})},clickAlternate:function(){var e=this;$("#"+e.pre+"alternate").add("#"+e.pre+"menu2_alternate").click(function(i){e.setLogCommand("alternate structures",!1),e.alternateStructures()})},clickMenu1_pdbid:function(){var e=this;$("#"+e.pre+"menu1_pdbid").click(function(i){e.openDialog(e.pre+"dl_pdbid","Please input PDB ID")})},clickMenu1_pdbfile:function(){var e=this;$("#"+e.pre+"menu1_pdbfile").click(function(i){e.openDialog(e.pre+"dl_pdbfile","Please input PDB File")})},clickMenu1_mmcifid:function(){var e=this;$("#"+e.pre+"menu1_mmcifid").click(function(i){e.openDialog(e.pre+"dl_mmcifid","Please input mmCIF ID")})},clickMenu1_mmdbid:function(){var e=this;$("#"+e.pre+"menu1_mmdbid").click(function(i){e.openDialog(e.pre+"dl_mmdbid","Please input MMDB ID")})},clickMenu1_gi:function(){var e=this;$("#"+e.pre+"menu1_gi").click(function(i){e.openDialog(e.pre+"dl_gi","Please input protein gi")})},clickMenu1_cid:function(){var e=this;$("#"+e.pre+"menu1_cid").click(function(i){e.openDialog(e.pre+"dl_cid","Please input PubChem CID")})},clickMenu1_state:function(){var e=this;$("#"+e.pre+"menu1_state").click(function(i){e.openDialog(e.pre+"dl_state","Please input the state file")})},clickMenu1_exportState:function(){var e=this;$("#"+e.pre+"menu1_exportState").click(function(i){e.setLogCommand("export state file",!1),e.saveFile(e.inputid+"_statefile.txt","text")})},clickMenu1_exportCanvas:function(){var e=this;$("#"+e.pre+"menu1_exportCanvas").click(function(i){e.setLogCommand("export canvas",!1),e.saveFile(e.inputid+"_image.png","png")})},clickMenu1_link_structure:function(){var e=this;$("#"+e.pre+"menu1_link_structure").click(function(i){var t="https://www.ncbi.nlm.nih.gov/structure/?term="+e.inputid;e.setLogCommand("link to search structure "+e.inputid+": "+t,!1),window.open(t,"_blank")})},clickMenu1_link_vast:function(){var e=this;$("#"+e.pre+"menu1_link_vast").click(function(i){var t="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+e.inputid;e.setLogCommand("link to structures similar to "+e.inputid+": "+t,!1),window.open(t,"_blank")})},clickMenu1_link_pubmed:function(){var e=this;$("#"+e.pre+"menu1_link_pubmed").click(function(i){var t;t=void 0!==e.pmid?"https://www.ncbi.nlm.nih.gov/pubmed/"+e.pmid:"https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.inputid,e.setLogCommand("link to literature about "+e.inputid+": "+t,!1),window.open(t,"_blank")})},clickMenu2_selectresidues:function(){var e=this;$("#"+e.pre+"menu2_selectresidues").click(function(i){e.openDialog(e.pre+"dl_selectresidues","Select residues in sequences with coordinates")})},clickMenu2_selectall:function(){var e=this;$("#"+e.pre+"menu2_selectall").add("#"+e.pre+"selectall").click(function(i){e.setLogCommand("select all",!0),e.selectAll()})},clickMenu2_selectcomplement:function(){var e=this;$("#"+e.pre+"menu2_selectcomplement").click(function(i){Object.keys(e.icn3d.highlightAtoms).length<Object.keys(e.icn3d.atoms).length&&(e.setLogCommand("select complement",!0),e.selectComplement())})},clickMenu2_alignment:function(){var e=this;$("#"+e.pre+"menu2_alignment").click(function(i){e.openDialog(e.pre+"dl_alignment","Select residues in aligned sequences")})},clickMenu2_command:function(){var e=this;$("#"+e.pre+"menu2_command").click(function(i){e.openDialog(e.pre+"dl_command","Use command to define selections")})},clickMenu2_pickingYes:function(){var e=this;$("#"+e.pre+"menu2_pickingYes").click(function(i){e.icn3d.picking=1,e.icn3d.options.picking="atom",e.setLogCommand("set picking atom",!0)})},clickMenu2_pickingNo:function(){var e=this;$("#"+e.pre+"menu2_pickingNo").click(function(i){e.icn3d.picking=0,e.icn3d.options.picking="no",e.setLogCommand("set picking off",!0),e.icn3d.draw(void 0,void 0),e.icn3d.removeHighlightObjects()})},clickMenu2_pickingResidue:function(){var e=this;$("#"+e.pre+"menu2_pickingResidue").click(function(i){e.icn3d.picking=2,e.icn3d.options.picking="atom",e.setLogCommand("set picking residue",!0)})},clickMenu2_aroundsphere:function(){var e=this;$("#"+e.pre+"menu2_aroundsphere").click(function(i){e.openDialog(e.pre+"dl_aroundsphere","Select a sphere around current selection")})},clickMenu2_select_chain:function(){var e=this;$("#"+e.pre+"menu2_select_chain").click(function(i){e.openDialog(e.pre+"dl_select_chain","Select Structure/Chain/Custom Selection")})},clickMenu3_proteinRibbon:function(){var e=this;$("#"+e.pre+"menu3_proteinRibbon").click(function(i){e.setStyle("protein","ribbon"),e.setLogCommand("style protein ribbon",!0)})},clickMenu3_proteinStrand:function(){var e=this;$("#"+e.pre+"menu3_proteinStrand").click(function(i){e.setStyle("protein","strand"),e.setLogCommand("style protein strand",!0)})},clickMenu3_proteinCylinder:function(){var e=this;$("#"+e.pre+"menu3_proteinCylinder").click(function(i){e.setStyle("protein","cylinder & plate"),e.setLogCommand("style protein cylinder & plate",!0)})},clickMenu3_proteinCalpha:function(){var e=this;$("#"+e.pre+"menu3_proteinCalpha").click(function(i){e.setStyle("protein","C alpha trace"),e.setLogCommand("style protein C alpha trace",!0)})},clickMenu3_proteinBfactor:function(){var e=this;$("#"+e.pre+"menu3_proteinBfactor").click(function(i){e.setStyle("protein","B factor tube"),e.setLogCommand("style protein B factor tube",!0)})},clickMenu3_proteinLines:function(){var e=this;$("#"+e.pre+"menu3_proteinLines").click(function(i){e.setStyle("protein","lines"),e.setLogCommand("style protein lines",!0)})},clickMenu3_proteinStick:function(){var e=this;$("#"+e.pre+"menu3_proteinStick").click(function(i){e.setStyle("protein","stick"),e.setLogCommand("style protein stick",!0)})},clickMenu3_proteinBallstick:function(){var e=this;$("#"+e.pre+"menu3_proteinBallstick").click(function(i){e.setStyle("protein","ball & stick"),e.setLogCommand("style protein ball & stick",!0)})},clickMenu3_proteinSphere:function(){var e=this;$("#"+e.pre+"menu3_proteinSphere").click(function(i){e.setStyle("protein","sphere"),e.setLogCommand("style protein sphere",!0)})},clickMenu3_proteinNothing:function(){var e=this;$("#"+e.pre+"menu3_proteinNothing").click(function(i){e.setStyle("protein","nothing"),e.setLogCommand("style protein nothing",!0)})},clickmenu3_nuclCartoon:function(){var e=this;$("#"+e.pre+"menu3_nuclCartoon").click(function(i){e.setStyle("nucleotides","nucleotide cartoon"),e.setLogCommand("style nucleotides nucleotide cartoon",!0)})},clickmenu3_nuclPhos:function(){var e=this;$("#"+e.pre+"menu3_nuclPhos").click(function(i){e.setStyle("nucleotides","phosphorus trace"),e.setLogCommand("style nucleotides phosphorus trace",!0)})},clickmenu3_nuclLines:function(){var e=this;$("#"+e.pre+"menu3_nuclLines").click(function(i){e.setStyle("nucleotides","lines"),e.setLogCommand("style nucleotides lines",!0)})},clickmenu3_nuclStick:function(){var e=this;$("#"+e.pre+"menu3_nuclStick").click(function(i){e.setStyle("nucleotides","stick"),e.setLogCommand("style nucleotides stick",!0)})},clickmenu3_nuclBallstick:function(){var e=this;$("#"+e.pre+"menu3_nuclBallstick").click(function(i){e.setStyle("nucleotides","ball & stick"),e.setLogCommand("style nucleotides ball & stick",!0)})},clickmenu3_nuclSphere:function(){var e=this;$("#"+e.pre+"menu3_nuclSphere").click(function(i){e.setStyle("nucleotides","sphere"),e.setLogCommand("style nucleotides sphere",!0)})},clickmenu3_nuclNothing:function(){var e=this;$("#"+e.pre+"menu3_nuclNothing").click(function(i){e.setStyle("nucleotides","nothing"),e.setLogCommand("style nucleotides nothing",!0)})},clickMenu3_ligandsLines:function(){var e=this;$("#"+e.pre+"menu3_ligandsLines").click(function(i){e.setStyle("ligands","lines"),e.setLogCommand("style ligands lines",!0)})},clickMenu3_ligandsStick:function(){var e=this;$("#"+e.pre+"menu3_ligandsStick").click(function(i){e.setStyle("ligands","stick"),e.setLogCommand("style ligands stick",!0)})},clickMenu3_ligandsBallstick:function(){var e=this;$("#"+e.pre+"menu3_ligandsBallstick").click(function(i){e.setStyle("ligands","ball & stick"),e.setLogCommand("style ligands ball & stick",!0)})},clickMenu3_ligandsSphere:function(){var e=this;$("#"+e.pre+"menu3_ligandsSphere").click(function(i){e.setStyle("ligands","sphere"),e.setLogCommand("style ligands sphere",!0)})},clickMenu3_ligandsNothing:function(){var e=this;$("#"+e.pre+"menu3_ligandsNothing").click(function(i){e.setStyle("ligands","nothing"),e.setLogCommand("style ligands nothing",!0)})},clickMenu3_ionsSphere:function(){var e=this;$("#"+e.pre+"menu3_ionsSphere").click(function(i){e.setStyle("ions","sphere"),e.setLogCommand("style ions sphere",!0)})},clickMenu3_ionsDot:function(){var e=this;$("#"+e.pre+"menu3_ionsDot").click(function(i){e.setStyle("ions","dot"),e.setLogCommand("style ions dot",!0)})},clickMenu3_ionsNothing:function(){var e=this;$("#"+e.pre+"menu3_ionsNothing").click(function(i){e.setStyle("ions","nothing"),e.setLogCommand("style ions nothing",!0)})},clickMenu3_waterSphere:function(){var e=this;$("#"+e.pre+"menu3_waterSphere").click(function(i){e.setStyle("water","sphere"),e.setLogCommand("style water sphere",!0)})},clickMenu3_waterDot:function(){var e=this;$("#"+e.pre+"menu3_waterDot").click(function(i){e.setStyle("water","dot"),e.setLogCommand("style water dot",!0)})},clickMenu3_waterNothing:function(){var e=this;$("#"+e.pre+"menu3_waterNothing").click(function(i){e.setStyle("water","nothing"),e.setLogCommand("style water nothing",!0)})},clickMenu4_colorSpectrum:function(){var e=this;$("#"+e.pre+"menu4_colorSpectrum").click(function(i){e.setOption("color","spectrum"),e.setLogCommand("color spectrum",!0)})},clickMenu4_colorChain:function(){var e=this;$("#"+e.pre+"menu4_colorChain").click(function(i){e.setOption("color","chain"),e.setLogCommand("color chain",!0)})},clickMenu4_colorSS:function(){var e=this;$("#"+e.pre+"menu4_colorSS").click(function(i){e.setOption("color","secondary structure"),e.setLogCommand("color secondary structure",!0)})},clickMenu4_colorBfactor:function(){var e=this;$("#"+e.pre+"menu4_colorBfactor").click(function(i){e.setOption("color","B factor"),e.setLogCommand("color B factor",!0)})},clickMenu4_colorResidue:function(){var e=this;$("#"+e.pre+"menu4_colorResidue").click(function(i){e.setOption("color","residue"),e.setLogCommand("color residue",!0)})},clickMenu4_colorPolarity:function(){var e=this;$("#"+e.pre+"menu4_colorPolarity").click(function(i){e.setOption("color","polarity"),e.setLogCommand("color polarity",!0)})},clickMenu4_colorAtom:function(){var e=this;$("#"+e.pre+"menu4_colorAtom").click(function(i){e.setOption("color","atom"),e.setLogCommand("color atom",!0)})},clickMenu4_colorRed:function(){var e=this;$("#"+e.pre+"menu4_colorRed").click(function(i){e.setOption("color","red"),e.setLogCommand("color red",!0)})},clickMenu4_colorGreen:function(){var e=this;$("#"+e.pre+"menu4_colorGreen").click(function(i){e.setOption("color","green"),e.setLogCommand("color green",!0)})},clickMenu4_colorBlue:function(){var e=this;$("#"+e.pre+"menu4_colorBlue").click(function(i){e.setOption("color","blue"),e.setLogCommand("color blue",!0)})},clickMenu4_colorMagenta:function(){var e=this;$("#"+e.pre+"menu4_colorMagenta").click(function(i){e.setOption("color","magenta"),e.setLogCommand("color magenta",!0)})},clickMenu4_colorYellow:function(){var e=this;$("#"+e.pre+"menu4_colorYellow").click(function(i){e.setOption("color","yellow"),e.setLogCommand("color yellow",!0)})},clickMenu4_colorCyan:function(){var e=this;$("#"+e.pre+"menu4_colorCyan").click(function(i){e.setOption("color","cyan"),e.setLogCommand("color cyan",!0)})},clickMenu4_colorWhite:function(){var e=this;$("#"+e.pre+"menu4_colorWhite").click(function(i){e.setOption("color","white"),e.setLogCommand("color white",!0)})},clickMenu4_colorGrey:function(){var e=this;$("#"+e.pre+"menu4_colorGrey").click(function(i){e.setOption("color","grey"),e.setLogCommand("color grey",!0)})},clickMenu4_colorCustom:function(){var e=this;$("#"+e.pre+"menu4_colorCustom").click(function(i){e.openDialog(e.pre+"dl_color","Choose custom color")})},clickMenu5_showsurfaceYes:function(){var e=this;$("#"+e.pre+"menu5_showsurfaceYes").click(function(i){e.setOption("showsurface","yes"),e.setLogCommand("set surface on",!0)})},clickMenu5_showsurfaceNo:function(){var e=this;$("#"+e.pre+"menu5_showsurfaceNo").click(function(i){e.setOption("showsurface","no"),e.setLogCommand("set surface off",!0)})},clickMenu5_surfaceVDW:function(){var e=this;$("#"+e.pre+"menu5_surfaceVDW").click(function(i){e.setOption("surface","Van der Waals surface"),e.setLogCommand("set surface Van der Waals surface",!0)})},clickMenu5_surfaceSES:function(){var e=this;$("#"+e.pre+"menu5_surfaceSES").click(function(i){e.setOption("surface","solvent excluded surface"),e.setLogCommand("set surface solvent excluded surface",!0)})},clickMenu5_surfaceSAS:function(){var e=this;$("#"+e.pre+"menu5_surfaceSAS").click(function(i){e.setOption("surface","solvent accessible surface"),e.setLogCommand("set surface solvent accessible surface",!0)})},clickMenu5_surfaceMolecular:function(){var e=this;$("#"+e.pre+"menu5_surfaceMolecular").click(function(i){e.setOption("surface","molecular surface"),e.setLogCommand("set surface molecular surface",!0)})},clickMenu5_surfaceNothing:function(){var e=this;$("#"+e.pre+"menu5_surfaceNothing").click(function(i){e.setOption("surface","nothing"),e.setLogCommand("set surface nothing",!0)})},clickMenu5_opacity10:function(){var e=this;$("#"+e.pre+"menu5_opacity10").click(function(i){e.setOption("opacity","1.0"),e.setLogCommand("set surface opacity 1.0",!0)})},clickMenu5_opacity09:function(){var e=this;$("#"+e.pre+"menu5_opacity09").click(function(i){e.setOption("opacity","0.9"),e.setLogCommand("set surface opacity 0.9",!0)})},clickMenu5_opacity08:function(){var e=this;$("#"+e.pre+"menu5_opacity08").click(function(i){e.setOption("opacity","0.8"),e.setLogCommand("set surface opacity 0.8",!0)})},clickMenu5_opacity07:function(){var e=this;$("#"+e.pre+"menu5_opacity07").click(function(i){e.setOption("opacity","0.7"),e.setLogCommand("set surface opacity 0.7",!0)})},clickMenu5_opacity06:function(){var e=this;$("#"+e.pre+"menu5_opacity06").click(function(i){e.setOption("opacity","0.6"),e.setLogCommand("set surface opacity 0.6",!0)})},clickMenu5_opacity05:function(){var e=this;$("#"+e.pre+"menu5_opacity05").click(function(i){e.setOption("opacity","0.5"),e.setLogCommand("set surface opacity 0.5",!0)})},clickMenu5_wireframeYes:function(){var e=this;$("#"+e.pre+"menu5_wireframeYes").click(function(i){e.setOption("wireframe","yes"),e.setLogCommand("set surface wireframe on",!0)})},clickMenu5_wireframeNo:function(){var e=this;$("#"+e.pre+"menu5_wireframeNo").click(function(i){e.setOption("wireframe","no"),e.setLogCommand("set surface wireframe off",!0)})},clickMenu6_assemblyYes:function(){var e=this;$("#"+e.pre+"menu6_assemblyYes").click(function(i){e.icn3d.bAssembly=!0,e.setLogCommand("set assembly on",!0),e.icn3d.draw()})},clickMenu6_assemblyNo:function(){var e=this;$("#"+e.pre+"menu6_assemblyNo").click(function(i){e.icn3d.bAssembly=!1,e.setLogCommand("set assembly off",!0),e.icn3d.draw()})},clickMenu6_addlabelYes:function(){var e=this;$("#"+e.pre+"menu6_addlabelYes").click(function(i){e.openDialog(e.pre+"dl_addlabel","Add custom labels"),e.icn3d.picking=1,e.icn3d.pickpair=!0,e.icn3d.pickedatomNum=0})},clickMenu6_addlabelNo:function(){var e=this;$("#"+e.pre+"menu6_addlabelNo").click(function(i){e.icn3d.pickpair=!1;var t="set labels off";e.setLogCommand(t,!0),e.options.labels="no",e.icn3d.draw(e.options)})},clickMenu6_distanceYes:function(){var e=this;$("#"+e.pre+"menu6_distanceYes").click(function(i){e.openDialog(e.pre+"dl_distance","Measure the distance of atoms"),e.icn3d.picking=1,e.icn3d.pickpair=!0,e.icn3d.pickedatomNum=0})},clickMenu6_distanceNo:function(){var e=this;$("#"+e.pre+"menu6_distanceNo").click(function(i){e.icn3d.pickpair=!1;var t="set lines off";e.setLogCommand(t,!0),e.options.lines="no",
e.icn3d.draw(e.options)})},clickMenu6_selectedcenter:function(){var e=this;$("#"+e.pre+"menu6_selectedcenter").add("#"+e.pre+"zoomin_selection").click(function(i){e.setLogCommand("zoom selection",!0),e.icn3d.zoominSelection()})},clickMenu6_rotateleft:function(){var e=this;$("#"+e.pre+"menu6_rotateleft").click(function(i){e.setLogCommand("rotate left",!0),e.icn3d.bStopRotate=!1,e.ROTATION_DIRECTION="left",e.rotateStructure("left")})},clickMenu6_rotateright:function(){var e=this;$("#"+e.pre+"menu6_rotateright").click(function(i){e.setLogCommand("rotate right",!0),e.icn3d.bStopRotate=!1,e.ROTATION_DIRECTION="right",e.rotateStructure("right")})},clickMenu6_rotateup:function(){var e=this;$("#"+e.pre+"menu6_rotateup").click(function(i){e.setLogCommand("rotate up",!0),e.icn3d.bStopRotate=!1,e.ROTATION_DIRECTION="up",e.rotateStructure("up")})},clickMenu6_rotatedown:function(){var e=this;$("#"+e.pre+"menu6_rotatedown").click(function(i){e.setLogCommand("rotate down",!0),e.icn3d.bStopRotate=!1,e.ROTATION_DIRECTION="down",e.rotateStructure("down")})},clickMenu6_cameraPers:function(){var e=this;$("#"+e.pre+"menu6_cameraPers").click(function(i){e.setOption("camera","perspective"),e.setLogCommand("set camera perspective",!0)})},clickMenu6_cameraOrth:function(){var e=this;$("#"+e.pre+"menu6_cameraOrth").click(function(i){e.setOption("camera","orthographic"),e.setLogCommand("set camera orthographic",!0)})},clickMenu6_bkgdBlack:function(){var e=this;$("#"+e.pre+"menu6_bkgdBlack").click(function(i){e.setOption("background","black"),e.setLogCommand("set background black",!0)})},clickMenu6_bkgdGrey:function(){var e=this;$("#"+e.pre+"menu6_bkgdGrey").click(function(i){e.setOption("background","grey"),e.setLogCommand("set background grey",!0)})},clickMenu6_bkgdWhite:function(){var e=this;$("#"+e.pre+"menu6_bkgdWhite").click(function(i){e.setOption("background","white"),e.setLogCommand("set background white",!0)})},clickMenu6_showaxisYes:function(){var e=this;$("#"+e.pre+"menu6_showaxisYes").click(function(i){e.setOption("axis","yes"),e.setLogCommand("set axis on",!0)})},clickMenu6_showaxisNo:function(){var e=this;$("#"+e.pre+"menu6_showaxisNo").click(function(i){e.setOption("axis","no"),e.setLogCommand("set axis off",!0)})},clickMenu6_hbondsYes:function(){var e=this;$("#"+e.pre+"menu6_hbondsYes").click(function(i){e.openDialog(e.pre+"dl_hbonds","Hydrogen Bonds")})},clickMenu6_hbondsNo:function(){var e=this;$("#"+e.pre+"menu6_hbondsNo").click(function(i){var t="set hbonds off";e.setLogCommand(t,!0),e.options.hbonds="no",e.options.lines="no",e.icn3d.draw(e.options)})},selectSequenceNonMobile:function(){var e=this;$("#"+e.pre+"dl_sequence").selectable({stop:function(){$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val(""),$(".ui-selected",this).each(function(){var i=$(this).attr("id");if(void 0!==i&&""!==i){e.SELECT_RESIDUE===!1&&(e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},e.SELECT_RESIDUE=!0,e.selectedResidues={},e.icn3d.highlightAtoms={},e.commandname="seq_"+i.substr(i.indexOf("_")+1)),$(this).toggleClass("highlightSeq");var t=i.substr(i.indexOf("_")+1);$(this).hasClass("highlightSeq")&&(e.selectAResidue(t,e.commandname),e.selectedResidues[t]=1);for(var n in e.icn3d.residues[t]){e.icn3d.atoms[n];$(this).hasClass("highlightSeq")||(delete e.icn3d.highlightAtoms[n],e.selectedResidues[t]=void 0)}}});e.icn3d.addHighlightObjects(),$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val(""),$(".ui-selected",this).each(function(){var i=$(this).attr("chain");if($(this).hasClass("seqTitle")){e.SELECT_RESIDUE=!1,e.setLogCommand("select residue "+Object.keys(e.selectedResidues),!0),e.removeSeqChainBkgd(i),e.removeSeqResidueBkgd(),$(this).toggleClass("highlightSeq");var t=$(this).attr("chain"),n="seq_"+$(this).text().trim();if($(this).hasClass("highlightSeq")){var o="select chain "+t;e.selectAChain(t,n),e.setLogCommand(o,!0)}else e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},$("#"+e.pre+"customResidues").val(""),$("#"+e.pre+"customResidues2").val(""),$("#"+e.pre+"customAtoms").val("")}})}}),$("#"+e.pre+"dl_sequence2").selectable({stop:function(){$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val(""),$(".ui-selected",this).each(function(){var i=$(this).attr("id");if(void 0!==i&&""!==i){e.SELECT_RESIDUE===!1&&(e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},e.SELECT_RESIDUE=!0,e.selectedResidues={},e.icn3d.highlightAtoms={},e.commandname="alignSeq_"+i.substr(i.indexOf("_")+1)),$(this).toggleClass("highlightSeq");var t=i.substr(i.indexOf("_")+1);$(this).hasClass("highlightSeq")&&(e.selectAResidue(t,e.commandname),e.selectedResidues[t]=1);for(var n in e.icn3d.residues[t]){e.icn3d.atoms[n];$(this).hasClass("highlightSeq")||(delete e.icn3d.highlightAtoms[n],e.selectedResidues[t]=void 0)}}});e.icn3d.addHighlightObjects(),$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val(""),$(".ui-selected",this).each(function(){var i=$(this).attr("chain");if($(this).hasClass("seqTitle")){e.SELECT_RESIDUE=!1,e.setLogCommand("select residue "+Object.keys(e.selectedResidues),!0),e.removeSeqChainBkgd(i),e.removeSeqResidueBkgd(),$(this).toggleClass("highlightSeq");var t=$(this).attr("chain"),n="alignSeq_"+$(this).text().trim();$(this).hasClass("highlightSeq")?(e.selectAAlignChain(t,n),e.setLogCommand("select alignChain "+t,!0)):(e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},$("#"+e.pre+"customResidues").val(""),$("#"+e.pre+"customResidues2").val(""),$("#"+e.pre+"customAtoms").val(""))}})}})},selectSequenceMobile:function(){var e=this;$("#"+e.pre+"dl_sequence").add("#"+e.pre+"dl_sequence2").on("click",".residue",function(i){$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val("");var t=$(this).attr("id");if(void 0!==t&&""!==t){e.SELECT_RESIDUE===!1&&(e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},e.SELECT_RESIDUE=!0,e.selectedResidues={},e.icn3d.highlightAtoms={},e.commandname="seq_"+t.substr(t.indexOf("_")+1)),$(this).toggleClass("highlightSeq");var n=t.substr(t.indexOf("_")+1);$(this).hasClass("highlightSeq")&&(e.selectAResidue(n,e.commandname),e.selectedResidues[n]=1);for(var o in e.icn3d.residues[n]){e.icn3d.atoms[o];$(this).hasClass("highlightSeq")||(delete e.icn3d.highlightAtoms[o],e.selectedResidues[n]=void 0)}}e.icn3d.addHighlightObjects()})},selectChainMobile:function(){var e=this;$("#"+e.pre+"dl_sequence").on("click",".seqTitle",function(i){$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val("");var t=$(this).attr("chain");e.SELECT_RESIDUE=!1,e.setLogCommand("select residue "+Object.keys(e.selectedResidues),!0),e.removeSeqChainBkgd(t),e.removeSeqResidueBkgd(),$(this).toggleClass("highlightSeq");var n=$(this).attr("chain"),o="seq_"+$(this).text().trim();if($(this).hasClass("highlightSeq")){var r="select chain "+n;e.selectAChain(n,o),e.setLogCommand(r,!0)}else e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},$("#"+e.pre+"customResidues").val(""),$("#"+e.pre+"customResidues2").val(""),$("#"+e.pre+"customAtoms").val("")}),$("#"+e.pre+"dl_sequence2").on("click",".seqTitle",function(i){$("#"+e.pre+"chainid").val(""),$("#"+e.pre+"structureid").val(""),$("#"+e.pre+"chainid2").val(""),$("#"+e.pre+"structureid2").val("");var t=$(this).attr("chain");e.removeSeqChainBkgd(t),e.removeSeqResidueBkgd(),$(this).toggleClass("highlightSeq");var n=$(this).attr("chain"),o="alignSeq_"+$(this).text().trim();$(this).hasClass("highlightSeq")?(e.selectAAlignChain(n,o),e.setLogCommand("select alignChain "+n,!0)):(e.icn3d.removeHighlightObjects(),e.icn3d.highlightAtoms={},$("#"+e.pre+"customResidues").val(""),$("#"+e.pre+"customResidues2").val(""),$("#"+e.pre+"customAtoms").val(""))})},clickStructureid:function(){var e=this;$("#"+e.pre+"structureid").change(function(i){var t=$(this).val();$("#"+e.pre+"structureid2").val(""),e.changeStructureid(t)}),$("#"+e.pre+"structureid2").change(function(i){var t=$(this).val();$("#"+e.pre+"structureid").val(""),e.changeStructureid(t)}),$("#"+e.pre+"structureid").focus(function(i){e.isMobile()&&$("#"+e.pre+"structureid").val(""),$(this).attr("size",$("#"+e.pre+"structureid option").length)}),$("#"+e.pre+"structureid").blur(function(e){$(this).attr("size",1)})},clickChainid:function(){var e=this;$("#"+e.pre+"chainid").change(function(i){var t=$(this).val();$("#"+e.pre+"chainid2").val(""),e.changeChainid(t)}),$("#"+e.pre+"chainid2").change(function(i){var t=$(this).val();$("#"+e.pre+"chainid").val(""),e.changeChainid(t)}),$("#"+e.pre+"chainid").focus(function(i){e.isMobile()&&$("#"+e.pre+"chainid").val(""),$(this).attr("size",$("#"+e.pre+"chainid option").length)}),$("#"+e.pre+"chainid").blur(function(e){$(this).attr("size",1)})},clickAlignChainid:function(){var e=this;$("#"+e.pre+"alignChainid").change(function(i){var t=$(this).val();$("#"+e.pre+"alignChainid2").val(),e.changeAlignChainid(t)}),$("#"+e.pre+"alignChainid2").change(function(i){var t=$(this).val();$("#"+e.pre+"alignChainid").val(),e.changeAlignChainid(t)}),$("#"+e.pre+"alignChainid").focus(function(i){e.isMobile()&&$("#"+e.pre+"alignChainid").val(""),$(this).attr("size",$("#"+e.pre+"alignChainid option").length)}),$("#"+e.pre+"alignChainid").blur(function(e){$(this).attr("size",1)})},clickCustomResidues:function(){var e=this;$("#"+e.pre+"customResidues").change(function(i){var t=$(this).val();$("#"+e.pre+"customResidues2").val(""),null!==t&&(e.setLogCommand("select saved selection "+t.toString(),!0),e.changeCustomResidues(t))}),$("#"+e.pre+"customResidues2").change(function(i){var t=$(this).val();$("#"+e.pre+"customResidues").val(""),null!==t&&(e.setLogCommand("select saved selection "+t.toString(),!0),e.changeCustomResidues(t))}),$("#"+e.pre+"customResidues").focus(function(i){e.isMobile()&&$("#"+e.pre+"customResidues").val(""),$(this).attr("size",$("#"+e.pre+"customResidues option").length)}),$("#"+e.pre+"customResidues").blur(function(e){$(this).attr("size",1)})},clickCustomAtoms:function(){var e=this;$("#"+e.pre+"customAtoms").change(function(i){var t=$(this).val();null!==t&&(e.setLogCommand("select saved matoms "+t.toString(),!0),e.changeCustomAtoms(t))}),$("#"+e.pre+"customAtoms").focus(function(i){e.isMobile()&&$("#"+e.pre+"customAtoms").val("")})},clickShow_selected:function(){var e=this;$("#"+e.pre+"show_selected").add("#"+e.pre+"menu2_show_selected").click(function(i){e.setLogCommand("show selection",!0),e.showSelection()})},clickShow_sequences:function(){var e=this;$("#"+e.pre+"show_sequences").click(function(i){$("#"+e.pre+"alignChainid").length>0?e.openDialog(e.pre+"dl_alignment","Select residues in aligned sequences"):$("#"+e.pre+"chainid").length>0&&e.openDialog(e.pre+"dl_selectresidues","Select residues in sequences with coordinates")})},clickShow_selected_atom:function(){var e=this;$("#"+e.pre+"show_selected_atom").click(function(i){i.preventDefault(),e.setLogCommand("show election",!0),e.showSelection()})},clickCommand_apply:function(){var e=this;$("#"+e.pre+"command_apply").click(function(i){i.preventDefault();var t=$("#"+e.pre+"command").val(),n=$("#"+e.pre+"command_name").val(),o=$("#"+e.pre+"command_desc").val();e.setLogCommand("select "+t+" | name "+n+" | description "+o,!0),e.selectByCommand(t,n,o)})},clickReload_pdb:function(){var e=this;$("#"+e.pre+"reload_pdb").click(function(i){i.preventDefault(),dialog.dialog("close"),e.setLogCommand("load pdb "+$("#"+e.pre+"pdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?pdbid="+$("#"+e.pre+"pdbid").val(),"_blank")})},clickReload_mmcif:function(){var e=this;$("#"+e.pre+"reload_mmcif").click(function(i){i.preventDefault(),dialog.dialog("close"),e.setLogCommand("load mmcif "+$("#"+e.pre+"mmcifid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmcif="+$("#"+e.pre+"mmcifid").val(),"_blank")})},clickReload_mmdb:function(){var e=this;$("#"+e.pre+"reload_mmdb").click(function(i){i.preventDefault(),dialog.dialog("close"),e.setLogCommand("load mmdb "+$("#"+e.pre+"mmdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmdbid="+$("#"+e.pre+"mmdbid").val(),"_blank")})},clickReload_gi:function(){var e=this;$("#"+e.pre+"reload_gi").click(function(i){i.preventDefault(),dialog.dialog("close"),e.setLogCommand("load gi "+$("#"+e.pre+"gi").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?gi="+$("#"+e.pre+"gi").val(),"_blank")})},clickReload_cid:function(){var e=this;$("#"+e.pre+"reload_cid").click(function(i){i.preventDefault(),dialog.dialog("close"),e.setLogCommand("load cid "+$("#"+e.pre+"cid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?cid="+$("#"+e.pre+"cid").val(),"_blank")})},clickReload_state:function(){var e=this;$("#"+e.pre+"reload_state").click(function(i){i.preventDefault(),dialog.dialog("close");var t=$("#"+e.pre+"state")[0].files[0];if(t){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(i){var n=i.target.result;e.setLogCommand("load state file "+t,!1);var o=!0;e.loadScript(n,o)},n.readAsText(t)}else alert("Please select a file before clicking 'Load'")})},clickReload_pdbfile:function(){var e=this;$("#"+e.pre+"reload_pdbfile").click(function(i){i.preventDefault(),dialog.dialog("close");var t=$("#"+e.pre+"pdbfile")[0].files[0];if(t){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(i){var t=i.target.result;e.setLogCommand("load pdb file "+$("#"+e.pre+"pdbfile").val(),!1),e.loadPdbData(t)},n.readAsText(t)}else alert("Please select a file before clicking 'Load'")})},clickApplycustomcolor:function(){var e=this;$("#"+e.pre+"applycustomcolor").click(function(i){i.preventDefault(),dialog.dialog("close"),e.setOption("color",$("#"+e.pre+"color").val()),e.setLogCommand("color "+$("#"+e.pre+"color").val(),!0)})},clickApplypick_aroundsphere:function(){var e=this;$("#"+e.pre+"applypick_aroundsphere").click(function(i){i.preventDefault(),dialog.dialog("close");var t=$("#"+e.pre+"radius_aroundsphere").val(),n="select zone cutoff "+t;e.setLogCommand(n,!0),e.pickCustomSphere(t)})},clickApplyhbonds:function(){var e=this;$("#"+e.pre+"applyhbonds").click(function(i){i.preventDefault(),dialog.dialog("close");var t=$("#"+e.pre+"hbondthreshold").val(),n="hbonds "+t;e.setLogCommand(n,!0),e.showHbonds(t)})},clickApplypick_labels:function(){var e=this;$("#"+e.pre+"applypick_labels").click(function(i){i.preventDefault(),dialog.dialog("close");var t=$("#"+e.pre+"labeltext").val(),n=$("#"+e.pre+"labelsize").val(),o=$("#"+e.pre+"labelcolor").val(),r=$("#"+e.pre+"labelbkgd").val();if(void 0===e.icn3d.pickedatom||void 0===e.icn3d.pickedatom2)alert("Please pick another atom");else{var s=(e.icn3d.pickedatom.coord.x+e.icn3d.pickedatom2.coord.x)/2,a=(e.icn3d.pickedatom.coord.y+e.icn3d.pickedatom2.coord.y)/2,c=(e.icn3d.pickedatom.coord.z+e.icn3d.pickedatom2.coord.z)/2;e.setLogCommand("add label "+t+" | x "+s+" y "+a+" z "+c+" | size "+n+" | color "+o+" | background "+r,!0),e.addLabel(t,s,a,c,n,o,r),e.icn3d.pickpair=!1;var l={};l.labels="yes",e.icn3d.draw(l)}})},clickApplypick_measuredistance:function(){var e=this;$("#"+e.pre+"applypick_measuredistance").click(function(i){if(i.preventDefault(),dialog.dialog("close"),void 0===e.icn3d.pickedatom||void 0===e.icn3d.pickedatom2)alert("Please pick another atom");else{var t,n,o,r=parseInt(10*e.icn3d.pickedatom.coord.distanceTo(e.icn3d.pickedatom2.coord))/10,s=r.toString()+" A",a=(e.icn3d.pickedatom.coord.x+e.icn3d.pickedatom2.coord.x)/2,c=(e.icn3d.pickedatom.coord.y+e.icn3d.pickedatom2.coord.y)/2,l=(e.icn3d.pickedatom.coord.z+e.icn3d.pickedatom2.coord.z)/2;e.setLogCommand("add label "+s+" | x "+a+" y "+c+" z "+l+" | size "+t+" | color "+n+" | background "+o,!0),e.addLabel(s,a,c,l,t,n,o);var n="#FFFF00",d=!0;e.setLogCommand("add line | x1 "+e.icn3d.pickedatom.coord.x+" y1 "+e.icn3d.pickedatom.coord.y+" z1 "+e.icn3d.pickedatom.coord.z+" | x2 "+e.icn3d.pickedatom2.coord.x+" y2 "+e.icn3d.pickedatom2.coord.y+" z2 "+e.icn3d.pickedatom2.coord.z+" | color "+n+" | dashed "+d,!0),e.addLine(e.icn3d.pickedatom.coord.x,e.icn3d.pickedatom.coord.y,e.icn3d.pickedatom.coord.z,e.icn3d.pickedatom2.coord.x,e.icn3d.pickedatom2.coord.y,e.icn3d.pickedatom2.coord.z,n,d),e.icn3d.pickpair=!1;var h={};h.labels="yes",h.lines="yes",e.icn3d.draw(h)}})},clickReset:function(){var e=this;$("#"+e.pre+"reset").click(function(i){e.setLogCommand("reset",!0),location.reload()})},clickToggleHighlight:function(){var e=this;$("#"+e.pre+"toggleHighlight").add("#"+e.pre+"toggleHighlight2").click(function(i){e.setLogCommand("toggle highlight",!0),e.icn3d.prevHighlightObjects.length>0?e.icn3d.removeHighlightObjects():e.icn3d.addHighlightObjects()})},pressCommandtext:function(){var e=this;$("#"+e.pre+"logtext").keypress(function(i){var t=i.keyCode?i.keyCode:i.which;if(13==t){i.preventDefault();var n=$(this).val();e.icn3d.bRender=!0;var o=n.split("\n"),r=o[o.length-1].substr(2);if(e.icn3d.logs.push(r),$("#"+e.pre+"logtext").val("> "+e.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+e.pre+"logtext")[0].scrollHeight),""!==r){var s={};s.factor=e.icn3d._zoomFactor,s.mouseChange=e.icn3d.mouseChange,s.quaternion=e.icn3d.quaternion,e.icn3d.commands.push(r+"|||"+JSON.stringify(s)),e.applyCommand(r+"|||"+JSON.stringify(s)),e.icn3d.draw()}}})},clickFilter_ckbx_all:function(){var e=this;$("#"+e.pre+"filter_ckbx_all").click(function(i){var t=document.getElementsByName(e.pre+"filter_ckbx");if(1==$(this)[0].checked)for(var n=0,o=t.length;o>n;++n)t[n].checked=!0;else for(var n=0,o=t.length;o>n;++n)t[n].checked=!1})},clickFilter:function(){var e=this;$("#"+e.pre+"filter").click(function(i){for(var t=document.getElementsByName(e.pre+"filter_ckbx"),n="",o="&het=0",r=0,s=t.length;s>r;++r)t[r].checked&&("ligands"==t[r].value?o="&het=2":n+=t[r].value+",");""==n&&(n=t[0].value);var a=document.URL+"&mols="+n+"&complexity=2"+o;window.open(a,"_self")})},clickLabel_3d_diagram:function(){var e=this;$("#"+e.pre+"label_3d_diagram").click(function(i){for(var t=document.getElementsByName(e.pre+"filter_ckbx"),n=[],o=0,r=t.length;r>o;++o)t[o].checked&&"ligands"!=t[o].value&&n.push(e.icn3d.savedLabels[t[o].value]);e.icn3d.labels=n,e.icn3d.createLabelRepresentation(e.icn3d.labels),e.icn3d.render()})},clickStopSelection:function(){var e=this;$(document).on("click","."+e.pre+"stopselection",function(i){e.SELECT_RESIDUE=!1,e.setLogCommand("select residue "+Object.keys(e.selectedResidues),!0)})},clickOutputSelection:function(){var e=this;$(document).on("click","."+e.pre+"outputselection",function(i){e.SELECT_RESIDUE=!1,e.setLogCommand("output selection",!0),e.outputSelection()})},bindMouseup:function(){var e=this;$("accordion").bind("mouseup touchend",function(i){e.icn3d.controls&&(e.icn3d.controls.noRotate=!1,e.icn3d.controls.noZoom=!1,e.icn3d.controls.noPan=!1)})},bindMousedown:function(){var e=this;$("accordion").bind("mousedown touchstart",function(i){e.icn3d.controls&&(e.icn3d.controls.noRotate=!0,e.icn3d.controls.noZoom=!0,e.icn3d.controls.noPan=!0)})},windowResize:function(){var e=this;void 0!==e.cfg.resize&&e.cfg.resize&&!e.isMobile()&&$(window).resize(function(){var i=$(window).width()-e.LESSWIDTH,t=$(window).height()-e.LESSHEIGHT;e.resizeCanvas(i,t)})},getCommandsBeforeCrash:function(){var e=this;window.addEventListener("load",function(){sessionStorage.setItem("good_exit","pending")}),window.addEventListener("beforeunload",function(){sessionStorage.setItem("good_exit","true")}),sessionStorage.getItem("good_exit")&&"pending"===sessionStorage.getItem("good_exit")&&(e.isMac()||(e.CRASHED=!0),e.commandsBeforeCrash=sessionStorage.getItem("commands"))},allEventFunctions:function(){var e=this;e.isMobile()?(e.selectSequenceMobile(),e.selectChainMobile()):e.selectSequenceNonMobile(),e.clickBack(),e.clickForward(),e.clickToggle(),e.clickHlColorYellow(),e.clickHlColorGreen(),e.clickHlColorRed(),e.clickHlStyleOutline(),e.clickHlStyleObject(),e.clickAlternate(),e.clickMenu1_pdbid(),e.clickMenu1_pdbfile(),e.clickMenu1_mmcifid(),e.clickMenu1_mmdbid(),e.clickMenu1_gi(),e.clickMenu1_cid(),e.clickMenu1_state(),e.clickMenu1_exportState(),e.clickMenu1_exportCanvas(),e.clickMenu1_link_structure(),e.clickMenu1_link_vast(),e.clickMenu1_link_pubmed(),e.clickMenu2_selectresidues(),e.clickMenu2_selectcomplement(),e.clickMenu2_selectall(),e.clickMenu2_alignment(),e.clickMenu2_command(),e.clickMenu2_pickingYes(),e.clickMenu2_pickingNo(),e.clickMenu2_pickingResidue(),e.clickMenu2_aroundsphere(),e.clickMenu2_select_chain(),e.clickMenu3_proteinRibbon(),e.clickMenu3_proteinStrand(),e.clickMenu3_proteinCylinder(),e.clickMenu3_proteinCalpha(),e.clickMenu3_proteinBfactor(),e.clickMenu3_proteinLines(),e.clickMenu3_proteinStick(),e.clickMenu3_proteinBallstick(),e.clickMenu3_proteinSphere(),e.clickMenu3_proteinNothing(),e.clickmenu3_nuclCartoon(),e.clickmenu3_nuclPhos(),e.clickmenu3_nuclLines(),e.clickmenu3_nuclStick(),e.clickmenu3_nuclBallstick(),e.clickmenu3_nuclSphere(),e.clickmenu3_nuclNothing(),e.clickMenu3_ligandsLines(),e.clickMenu3_ligandsStick(),e.clickMenu3_ligandsBallstick(),e.clickMenu3_ligandsSphere(),e.clickMenu3_ligandsNothing(),e.clickMenu3_ionsSphere(),e.clickMenu3_ionsDot(),e.clickMenu3_ionsNothing(),e.clickMenu3_waterSphere(),e.clickMenu3_waterDot(),e.clickMenu3_waterNothing(),e.clickMenu4_colorSpectrum(),e.clickMenu4_colorChain(),e.clickMenu4_colorSS(),e.clickMenu4_colorBfactor(),e.clickMenu4_colorResidue(),e.clickMenu4_colorPolarity(),e.clickMenu4_colorAtom(),e.clickMenu4_colorRed(),e.clickMenu4_colorGreen(),e.clickMenu4_colorBlue(),e.clickMenu4_colorMagenta(),e.clickMenu4_colorYellow(),e.clickMenu4_colorCyan(),e.clickMenu4_colorWhite(),e.clickMenu4_colorGrey(),e.clickMenu4_colorCustom(),e.clickMenu5_showsurfaceYes(),e.clickMenu5_showsurfaceNo(),e.clickMenu5_surfaceVDW(),e.clickMenu5_surfaceSES(),e.clickMenu5_surfaceSAS(),e.clickMenu5_surfaceSAS(),e.clickMenu5_surfaceNothing(),e.clickMenu5_opacity10(),e.clickMenu5_opacity09(),e.clickMenu5_opacity08(),e.clickMenu5_opacity07(),e.clickMenu5_opacity06(),e.clickMenu5_opacity05(),e.clickMenu5_wireframeYes(),e.clickMenu5_wireframeNo(),e.clickMenu6_assemblyYes(),e.clickMenu6_assemblyNo(),e.clickMenu6_addlabelYes(),e.clickMenu6_addlabelNo(),e.clickMenu6_distanceYes(),e.clickMenu6_distanceNo(),e.clickMenu6_selectedcenter(),e.clickMenu6_rotateleft(),e.clickMenu6_rotateright(),e.clickMenu6_rotateup(),e.clickMenu6_rotatedown(),e.clickMenu6_cameraPers(),e.clickMenu6_cameraOrth(),e.clickMenu6_bkgdBlack(),e.clickMenu6_bkgdGrey(),e.clickMenu6_bkgdWhite(),e.clickMenu6_showaxisYes(),e.clickMenu6_showaxisNo(),e.clickMenu6_hbondsYes(),e.clickMenu6_hbondsNo(),e.clickStructureid(),e.clickChainid(),e.clickAlignChainid(),e.clickCustomResidues(),e.clickCustomAtoms(),e.clickShow_selected(),e.clickShow_sequences(),e.clickShow_selected_atom(),e.clickCommand_apply(),e.clickReload_pdb(),e.clickReload_pdbfile(),e.clickReload_mmcif(),e.clickReload_mmdb(),e.clickReload_gi(),e.clickReload_cid(),e.clickReload_state(),e.clickApplycustomcolor(),e.clickApplypick_aroundsphere(),e.clickApplyhbonds(),e.clickApplypick_labels(),e.clickApplypick_measuredistance(),e.clickReset(),e.clickToggleHighlight(),e.pressCommandtext(),e.clickFilter_ckbx_all(),e.clickFilter(),e.clickLabel_3d_diagram(),e.clickStopSelection(),e.clickOutputSelection(),e.bindMouseup(),e.bindMousedown(),e.windowResize()},allCustomEvents:function(){}};