var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,o,i;e=e||{},t=void 0!==e.parent?e.parent:document.body,o=void 0!==e.id?e.id:"oldie",i=Detector.getWebGLErrorMessage(),i.id=o,t.appendChild(i)}};if("object"==typeof module&&(module.exports=Detector),THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){ge.setRGB(0,0,0),ye.setRGB(0,0,0),we.setRGB(0,0,0);for(var e=0,t=R.length;t>e;e++){var o=R[e],i=o.color;o instanceof THREE.AmbientLight?ge.add(i):o instanceof THREE.DirectionalLight?ye.add(i):o instanceof THREE.PointLight&&we.add(i)}}function o(e,t,o){for(var i=0,r=R.length;r>i;i++){var n=R[i];if(pe.copy(n.color),n instanceof THREE.DirectionalLight){var s=be.setFromMatrixPosition(n.matrixWorld).normalize(),a=t.dot(s);if(0>=a)continue;a*=n.intensity,o.add(pe.multiplyScalar(a))}else if(n instanceof THREE.PointLight){var s=be.setFromMatrixPosition(n.matrixWorld),a=t.dot(be.subVectors(s,e).normalize());if(0>=a)continue;if(a*=0==n.distance?1:1-Math.min(e.distanceTo(s)/n.distance,1),0==a)continue;a*=n.intensity,o.add(pe.multiplyScalar(a))}}}function i(e,t,o){u(o.opacity),p(o.blending);var i=t.scale.x*W,r=t.scale.y*Y,n=.5*Math.sqrt(i*i+r*r);if(fe.min.set(e.x-n,e.y-n),fe.max.set(e.x+n,e.y+n),o instanceof THREE.SpriteMaterial){var s=o.map;if(null!==s){var a=ve[s.id];if((void 0===a||a.version!==s.version)&&(a=h(s),ve[s.id]=a),void 0!==a.canvas){g(a.canvas);var c=s.image,l=c.width*s.offset.x,d=c.height*s.offset.y,v=c.width*s.repeat.x,m=c.height*s.repeat.y,E=i/v,y=r/m;J.save(),J.translate(e.x,e.y),0!==o.rotation&&J.rotate(o.rotation),J.translate(-i/2,-r/2),J.scale(E,y),J.translate(-l,-d),J.fillRect(l,d,v,m),J.restore()}}else g(o.color.getStyle()),J.save(),J.translate(e.x,e.y),0!==o.rotation&&J.rotate(o.rotation),J.scale(i,-r),J.fillRect(-.5,-.5,1,1),J.restore()}else o instanceof THREE.SpriteCanvasMaterial&&(f(o.color.getStyle()),g(o.color.getStyle()),J.save(),J.translate(e.x,e.y),0!==o.rotation&&J.rotate(o.rotation),J.scale(i,r),o.program(J),J.restore())}function r(e,t,o,i){if(u(i.opacity),p(i.blending),J.beginPath(),J.moveTo(e.positionScreen.x,e.positionScreen.y),J.lineTo(t.positionScreen.x,t.positionScreen.y),i instanceof THREE.LineBasicMaterial){if(v(i.linewidth),m(i.linecap),E(i.linejoin),i.vertexColors!==THREE.VertexColors)f(i.color.getStyle());else{var r=o.vertexColors[0].getStyle(),n=o.vertexColors[1].getStyle();if(r===n)f(r);else{try{var s=J.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);s.addColorStop(0,r),s.addColorStop(1,n)}catch(a){s=r}f(s)}}J.stroke(),fe.expandByScalar(2*i.linewidth)}else i instanceof THREE.LineDashedMaterial&&(v(i.linewidth),m(i.linecap),E(i.linejoin),f(i.color.getStyle()),y([i.dashSize,i.gapSize]),J.stroke(),fe.expandByScalar(2*i.linewidth),y([]))}function n(e,t,i,r,n,h,d,v){if(N.info.render.vertices+=3,N.info.render.faces++,u(v.opacity),p(v.blending),A=e.positionScreen.x,z=e.positionScreen.y,_=t.positionScreen.x,M=t.positionScreen.y,k=i.positionScreen.x,O=i.positionScreen.y,s(A,z,_,M,k,O),(v instanceof THREE.MeshLambertMaterial||v instanceof THREE.MeshPhongMaterial)&&null===v.map)de.copy(v.color),ue.copy(v.emissive),v.vertexColors===THREE.FaceColors&&de.multiply(d.color),le.copy(ge),Te.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),o(Te,d.normalModel,le),le.multiply(de).add(ue),v.wireframe===!0?a(le,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):c(le);else if(v instanceof THREE.MeshBasicMaterial||v instanceof THREE.MeshLambertMaterial||v instanceof THREE.MeshPhongMaterial)if(null!==v.map){var m=v.map.mapping;m===THREE.UVMapping&&(L=d.uvs,l(A,z,_,M,k,O,L[r].x,L[r].y,L[n].x,L[n].y,L[h].x,L[h].y,v.map))}else null!==v.envMap?v.envMap.mapping===THREE.SphericalReflectionMapping&&(Re.copy(d.vertexNormalsModel[r]).applyMatrix3(Ce),j=.5*Re.x+.5,V=.5*Re.y+.5,Re.copy(d.vertexNormalsModel[n]).applyMatrix3(Ce),P=.5*Re.x+.5,D=.5*Re.y+.5,Re.copy(d.vertexNormalsModel[h]).applyMatrix3(Ce),F=.5*Re.x+.5,I=.5*Re.y+.5,l(A,z,_,M,k,O,j,V,P,D,F,I,v.envMap)):(le.copy(v.color),v.vertexColors===THREE.FaceColors&&le.multiply(d.color),v.wireframe===!0?a(le,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):c(le));else v instanceof THREE.MeshDepthMaterial?(le.r=le.g=le.b=1-w(e.positionScreen.z*e.positionScreen.w,C.near,C.far),v.wireframe===!0?a(le,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):c(le)):v instanceof THREE.MeshNormalMaterial?(Re.copy(d.normalModel).applyMatrix3(Ce),le.setRGB(Re.x,Re.y,Re.z).multiplyScalar(.5).addScalar(.5),v.wireframe===!0?a(le,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):c(le)):(le.setRGB(1,1,1),v.wireframe===!0?a(le,v.wireframeLinewidth,v.wireframeLinecap,v.wireframeLinejoin):c(le))}function s(e,t,o,i,r,n){J.beginPath(),J.moveTo(e,t),J.lineTo(o,i),J.lineTo(r,n),J.closePath()}function a(e,t,o,i){v(t),m(o),E(i),f(e.getStyle()),J.stroke(),fe.expandByScalar(2*t)}function c(e){g(e.getStyle()),J.fill()}function h(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image,o=document.createElement("canvas");o.width=t.width,o.height=t.height;var i=o.getContext("2d");i.setTransform(1,0,0,-1,0,t.height),i.drawImage(t,0,0);var r=e.wrapS===THREE.RepeatWrapping,n=e.wrapT===THREE.RepeatWrapping,s="no-repeat";return r===!0&&n===!0?s="repeat":r===!0?s="repeat-x":n===!0&&(s="repeat-y"),{canvas:J.createPattern(o,s),version:e.version}}function l(e,t,o,i,r,n,s,a,c,l,d,u,p){var v=ve[p.id];if((void 0===v||v.version!==p.version)&&(v=h(p),ve[p.id]=v),void 0===v.canvas)return g("rgba( 0, 0, 0, 1)"),void J.fill();g(v.canvas);var m,E,f,y,w,b,T,R,C=p.offset.x/p.repeat.x,H=p.offset.y/p.repeat.y,x=p.image.width*p.repeat.x,S=p.image.height*p.repeat.y;s=(s+C)*x,a=(a+H)*S,c=(c+C)*x,l=(l+H)*S,d=(d+C)*x,u=(u+H)*S,o-=e,i-=t,r-=e,n-=t,c-=s,l-=a,d-=s,u-=a,T=c*u-d*l,0!==T&&(R=1/T,m=(u*o-l*r)*R,E=(u*i-l*n)*R,f=(c*r-d*o)*R,y=(c*n-d*i)*R,w=e-m*s-f*a,b=t-E*s-y*a,J.save(),J.transform(m,E,f,y,w,b),J.fill(),J.restore())}function d(e,t,o){var i,r=t.x-e.x,n=t.y-e.y,s=r*r+n*n;0!==s&&(i=o/Math.sqrt(s),r*=i,n*=i,t.x+=r,t.y+=n,e.x-=r,e.y-=n)}function u(e){oe!==e&&(J.globalAlpha=e,oe=e)}function p(e){ie!==e&&(e===THREE.NormalBlending?J.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?J.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(J.globalCompositeOperation="darker"),ie=e)}function v(e){se!==e&&(J.lineWidth=e,se=e)}function m(e){ae!==e&&(J.lineCap=e,ae=e)}function E(e){ce!==e&&(J.lineJoin=e,ce=e)}function f(e){re!==e&&(J.strokeStyle=e,re=e)}function g(e){ne!==e&&(J.fillStyle=e,ne=e)}function y(e){he.length!==e.length&&(J.setLineDash(e),he=e)}console.log("THREE.CanvasRenderer",THREE.REVISION);var w=THREE.Math.smoothstep;e=e||{};var b,T,R,C,H,x,S,A,z,_,M,k,O,L,j,V,P,D,F,I,N=this,B=new THREE.Projector,G=void 0!==e.canvas?e.canvas:document.createElement("canvas"),$=G.width,q=G.height,W=Math.floor($/2),Y=Math.floor(q/2),U=0,X=0,Z=$,Q=q,K=1,J=G.getContext("2d",{alpha:e.alpha===!0}),ee=new THREE.Color(0),te=e.alpha===!0?0:1,oe=1,ie=0,re=null,ne=null,se=null,ae=null,ce=null,he=[],le=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),de=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),ue=new THREE.Color,pe=new THREE.Color,ve={},me=new THREE.Box2,Ee=new THREE.Box2,fe=new THREE.Box2,ge=new THREE.Color,ye=new THREE.Color,we=new THREE.Color,be=new THREE.Vector3,Te=new THREE.Vector3,Re=new THREE.Vector3,Ce=new THREE.Matrix3;void 0===J.setLineDash&&(J.setLineDash=function(){}),this.domElement=G,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return J},this.getContextAttributes=function(){return J.getContextAttributes()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(e){void 0!==e&&(K=e)},this.setSize=function(e,t,o){$=e*K,q=t*K,G.width=$,G.height=q,W=Math.floor($/2),Y=Math.floor(q/2),o!==!1&&(G.style.width=e+"px",G.style.height=t+"px"),me.min.set(-W,-Y),me.max.set(W,Y),Ee.min.set(-W,-Y),Ee.max.set(W,Y),oe=1,ie=0,re=null,ne=null,se=null,ae=null,ce=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,o,i){U=e*K,X=t*K,Z=o*K,Q=i*K},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){ee.set(e),te=void 0!==t?t:1,Ee.min.set(-W,-Y),Ee.max.set(W,Y)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return ee},this.getClearAlpha=function(){return te},this.getMaxAnisotropy=function(){return 0},this.clear=function(){Ee.empty()===!1&&(Ee.intersect(me),Ee.expandByScalar(2),Ee.min.x=Ee.min.x+W,Ee.min.y=-Ee.min.y+Y,Ee.max.x=Ee.max.x+W,Ee.max.y=-Ee.max.y+Y,1>te&&J.clearRect(0|Ee.min.x,0|Ee.max.y,Ee.max.x-Ee.min.x|0,Ee.min.y-Ee.max.y|0),te>0&&(p(THREE.NormalBlending),u(1),g("rgba("+Math.floor(255*ee.r)+","+Math.floor(255*ee.g)+","+Math.floor(255*ee.b)+","+te+")"),J.fillRect(0|Ee.min.x,0|Ee.max.y,Ee.max.x-Ee.min.x|0,Ee.min.y-Ee.max.y|0)),Ee.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,o){if(o instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),N.info.render.vertices=0,N.info.render.faces=0,J.setTransform(Z/$,0,0,-Q/q,U,q-X),J.translate(W,Y),b=B.projectScene(e,o,this.sortObjects,this.sortElements),T=b.elements,R=b.lights,C=o,Ce.getNormalMatrix(o.matrixWorldInverse),t();for(var s=0,a=T.length;a>s;s++){var c=T[s],h=c.material;if(void 0!==h&&0!==h.opacity){if(fe.makeEmpty(),c instanceof THREE.RenderableSprite)H=c,H.x*=W,H.y*=Y,i(H,c,h);else if(c instanceof THREE.RenderableLine)H=c.v1,x=c.v2,H.positionScreen.x*=W,H.positionScreen.y*=Y,x.positionScreen.x*=W,x.positionScreen.y*=Y,fe.setFromPoints([H.positionScreen,x.positionScreen]),me.isIntersectionBox(fe)===!0&&r(H,x,c,h);else if(c instanceof THREE.RenderableFace){if(H=c.v1,x=c.v2,S=c.v3,H.positionScreen.z<-1||H.positionScreen.z>1)continue;if(x.positionScreen.z<-1||x.positionScreen.z>1)continue;if(S.positionScreen.z<-1||S.positionScreen.z>1)continue;H.positionScreen.x*=W,H.positionScreen.y*=Y,x.positionScreen.x*=W,x.positionScreen.y*=Y,S.positionScreen.x*=W,S.positionScreen.y*=Y,h.overdraw>0&&(d(H.positionScreen,x.positionScreen,h.overdraw),d(x.positionScreen,S.positionScreen,h.overdraw),d(S.positionScreen,H.positionScreen,h.overdraw)),fe.setFromPoints([H.positionScreen,x.positionScreen,S.positionScreen]),me.isIntersectionBox(fe)===!0&&n(H,x,S,0,1,2,c,h)}Ee.union(fe)}}J.setTransform(1,0,0,1,0,0)}},THREE.TrackballControls=function(e,t,o){function i(e){u.enabled!==!1&&(window.removeEventListener("keydown",i),m=u._state,u._state===u.STATE.NONE&&(e.keyCode!==u.keys[u.STATE.ROTATE]||u.noRotate?e.keyCode!==u.keys[u.STATE.ZOOM]&&!e.shiftKey||u.noZoom?e.keyCode!==u.keys[u.STATE.PAN]&&!e.ctrlKey||u.noPan||(u._state=u.STATE.PAN):u._state=u.STATE.ZOOM:u._state=u.STATE.ROTATE))}function r(e){u.enabled!==!1&&(u._state=m,window.addEventListener("keydown",i,!1))}function n(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state===u.STATE.NONE&&(u._state=e.button),u._state!==u.STATE.ROTATE||u.noRotate?u._state!==u.STATE.ZOOM||u.noZoom?u._state!==u.STATE.PAN||u.noPan||(u._panStart.copy(T(e.pageX,e.pageY)),u._panEnd.copy(u._panStart)):(u._zoomStart.copy(T(e.pageX,e.pageY)),u._zoomEnd.copy(u._zoomStart)):(u._rotateStart.copy(R(e.pageX,e.pageY)),u._rotateEnd.copy(u._rotateStart)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),u.dispatchEvent(w))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state!==u.STATE.ROTATE||u.noRotate?u._state!==u.STATE.ZOOM||u.noZoom?u._state!==u.STATE.PAN||u.noPan||u._panEnd.copy(T(e.pageX,e.pageY)):u._zoomEnd.copy(T(e.pageX,e.pageY)):u._rotateEnd.copy(R(e.pageX,e.pageY)))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state=u.STATE.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),u.dispatchEvent(b))}function c(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),u._zoomStart.y=.01*t,u.dispatchEvent(w),u.dispatchEvent(b)}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._state=u.STATE.TOUCH_ROTATE,u._rotateStart.copy(R(e.touches[0].pageX,e.touches[0].pageY)),u._rotateEnd.copy(u._rotateStart);break;case 2:u._state=u.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=f=Math.sqrt(t*t+o*o);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panStart.copy(T(i,r)),u._panEnd.copy(u._panStart);break;default:u._state=u.STATE.NONE}u.dispatchEvent(w)}}function l(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u._rotateEnd.copy(R(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+o*o);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(T(i,r));break;default:u._state=u.STATE.NONE}}function d(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._rotateEnd.copy(R(e.touches[0].pageX,e.touches[0].pageY)),u._rotateStart.copy(u._rotateEnd);break;case 2:f=g=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(T(t,o)),u._panStart.copy(u._panEnd)}u._state=u.STATE.NONE,u.dispatchEvent(b)}}var u=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=1e-6,v=new THREE.Vector3;this._state=this.STATE.NONE;var m=this.STATE.NONE,E=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var f=0,g=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},w={type:"start"},b={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var T=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-u.screen.left)/u.screen.width,(o-u.screen.top)/u.screen.height),e}}(),R=function(){var e=new THREE.Vector3,t=new THREE.Vector3,o=new THREE.Vector3;return function(i,r){o.set((i-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(.5*u.screen.height+u.screen.top-r)/(.5*u.screen.height),0);var n=o.length();return u.noRoll?n<Math.SQRT1_2?o.z=Math.sqrt(1-n*n):o.z=.5/n:n>1?o.normalize():o.z=Math.sqrt(1-n*n),E.copy(u.object.position).sub(u.target),e.copy(u.object.up).setLength(o.y),e.add(t.copy(u.object.up).cross(E).setLength(o.x)),e.add(E.setLength(o.z)),e}}();this.rotateCamera=function(e,t){var i=new THREE.Vector3,r=new THREE.Quaternion;return function(e,t){var n;void 0===e&&(n=Math.acos(u._rotateStart.dot(u._rotateEnd)/u._rotateStart.length()/u._rotateEnd.length())),(n||void 0!==e)&&(void 0===e?(i.crossVectors(u._rotateStart,u._rotateEnd).normalize(),n*=u.rotateSpeed,r.setFromAxisAngle(i,-n)):r.copy(e),(void 0===t||t===!0)&&o.quaternion.multiplyQuaternions(r,o.quaternion),E.applyQuaternion(r),u.object.up.applyQuaternion(r),u._rotateEnd.applyQuaternion(r),u.staticMoving?u._rotateStart.copy(u._rotateEnd):(r.setFromAxisAngle(i,n*(u.dynamicDampingFactor-1)),u._rotateStart.applyQuaternion(r)))}}(),this.zoomCamera=function(e,t){if(u._state===u.STATE.TOUCH_ZOOM_PAN){var i;void 0!==e?i=e:(i=f/g,f=g),E.multiplyScalar(i),(void 0===t||t===!0)&&(o._zoomFactor*=i)}else{var i;i=void 0!==e?e:1+(u._zoomEnd.y-u._zoomStart.y)*u.zoomSpeed,(void 0===t||t===!0)&&(o._zoomFactor*=i),1!==i&&(E.multiplyScalar(i),u.staticMoving?u._zoomStart.copy(u._zoomEnd):u._zoomStart.y+=(u._zoomEnd.y-u._zoomStart.y)*this.dynamicDampingFactor)}},this.panCamera=function(e,t){var i=new THREE.Vector2,r=new THREE.Vector3,n=new THREE.Vector3;return function(e,t){void 0!==e?(i=e,(void 0===t||t===!0)&&o.mouseChange.add(e)):(i.copy(u._panEnd).sub(u._panStart),(void 0===t||t===!0)&&o.mouseChange.add(u._panEnd).sub(u._panStart)),i.lengthSq()&&(i.multiplyScalar(E.length()*u.panSpeed),n.copy(E).cross(u.object.up).setLength(i.x),n.add(r.copy(u.object.up).setLength(i.y)),u.object.position.add(n),u.target.add(n),u.staticMoving?u._panStart.copy(u._panEnd):u._panStart.add(i.subVectors(u._panEnd,u._panStart).multiplyScalar(u.dynamicDampingFactor)))}}(),this.checkDistances=function(){u.noZoom&&u.noPan||(E.lengthSq()>u.maxDistance*u.maxDistance&&u.object.position.addVectors(u.target,E.setLength(u.maxDistance)),E.lengthSq()<u.minDistance*u.minDistance&&u.object.position.addVectors(u.target,E.setLength(u.minDistance)))},this.update=function(e){E.subVectors(u.object.position,u.target),u.noRotate||(void 0!==e&&void 0!==e.quaternion?u.rotateCamera(e.quaternion,e.update):u.rotateCamera()),u.noZoom||(void 0!==e&&void 0!==e._zoomFactor?u.zoomCamera(e._zoomFactor,e.update):u.zoomCamera()),u.noPan||(void 0!==e&&void 0!==e.mouseChange?u.panCamera(e.mouseChange,e.update):u.panCamera()),u.object.position.addVectors(u.target,E),u.checkDistances(),u.object.lookAt(u.target),v.distanceToSquared(u.object.position)>p&&(u.dispatchEvent(y),v.copy(u.object.position))},this.reset=function(){u._state=u.STATE.NONE,m=u.STATE.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),E.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(y),v.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",r,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.OrthographicTrackballControls=function(e,t,o){function i(e){u.enabled!==!1&&(window.removeEventListener("keydown",i),f=u._state,u._state===p.NONE&&(e.keyCode!==u.keys[p.ROTATE]||u.noRotate?e.keyCode!==u.keys[p.ZOOM]&&!e.shiftKey||u.noZoom?e.keyCode!==u.keys[p.PAN]&&!e.ctrlKey||u.noPan||(u._state=p.PAN):u._state=p.ZOOM:u._state=p.ROTATE))}function r(e){u.enabled!==!1&&(u._state=f,window.addEventListener("keydown",i,!1))}function n(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state===p.NONE&&(u._state=e.button),u._state!==p.ROTATE||u.noRotate?u._state!==p.ZOOM||u.noZoom?u._state!==p.PAN||u.noPan||(u._panStart.copy(H(e.pageX,e.pageY)),u._panEnd.copy(u._panStart)):(u._zoomStart.copy(H(e.pageX,e.pageY)),u._zoomEnd.copy(u._zoomStart)):(u._rotateStart.copy(x(e.pageX,e.pageY)),u._rotateEnd.copy(u._rotateStart)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),u.dispatchEvent(R))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state!==p.ROTATE||u.noRotate?u._state!==p.ZOOM||u.noZoom?u._state!==p.PAN||u.noPan||u._panEnd.copy(H(e.pageX,e.pageY)):u._zoomEnd.copy(H(e.pageX,e.pageY)):u._rotateEnd.copy(x(e.pageX,e.pageY)))}function a(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),u._state=p.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),u.dispatchEvent(C))}function c(e){if(u.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),u._zoomStart.y=.01*t,u.dispatchEvent(R),u.dispatchEvent(C)}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._state=p.TOUCH_ROTATE,u._rotateStart.copy(x(e.touches[0].pageX,e.touches[0].pageY)),u._rotateEnd.copy(u._rotateStart);break;case 2:u._state=p.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;b=w=Math.sqrt(t*t+o*o);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panStart.copy(H(i,r)),u._panEnd.copy(u._panStart);break;default:u._state=p.NONE}u.dispatchEvent(R)}}function l(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u._rotateEnd.copy(x(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;b=Math.sqrt(t*t+o*o);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,r=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(H(i,r));break;default:u._state=p.NONE}}function d(e){if(u.enabled!==!1){switch(e.touches.length){case 1:u._rotateEnd.copy(x(e.touches[0].pageX,e.touches[0].pageY)),u._rotateStart.copy(u._rotateEnd);break;case 2:w=b=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;u._panEnd.copy(H(t,o)),u._panStart.copy(u._panEnd)}u._state=p.NONE,u.dispatchEvent(C)}}var u=this,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=.5,this.zoomSpeed=1.2;var v=.01;this.zoomSpeed*=v,this.panSpeed=.03,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var m=1e-6,E=new THREE.Vector3;this._state=p.NONE;var f=p.NONE,g=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var y=1,w=0,b=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var T={type:"change"},R={type:"start"},C={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var H=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-u.screen.left)/u.screen.width,(o-u.screen.top)/u.screen.height),e}}(),x=function(){var e=new THREE.Vector3,t=new THREE.Vector3,o=new THREE.Vector3;return function(i,r){o.set((i-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(.5*u.screen.height+u.screen.top-r)/(.5*u.screen.height),0);var n=o.length();return u.noRoll?n<Math.SQRT1_2?o.z=Math.sqrt(1-n*n):o.z=.5/n:n>1?o.normalize():o.z=Math.sqrt(1-n*n),g.copy(u.object.position).sub(u.target),e.copy(u.object.up).setLength(o.y),e.add(t.copy(u.object.up).cross(g).setLength(o.x)),e.add(g.setLength(o.z)),e}}();this.rotateCamera=function(e,t){var i=new THREE.Vector3,r=new THREE.Quaternion;return function(e,t){var n;void 0===e&&(n=Math.acos(u._rotateStart.dot(u._rotateEnd)/u._rotateStart.length()/u._rotateEnd.length())),(n||void 0!==e)&&(void 0===e?(i.crossVectors(u._rotateStart,u._rotateEnd).normalize(),n*=u.rotateSpeed,r.setFromAxisAngle(i,-n)):r.copy(e),(void 0===t||t===!0)&&o.quaternion.multiplyQuaternions(r,o.quaternion),g.applyQuaternion(r),u.object.up.applyQuaternion(r),u._rotateEnd.applyQuaternion(r),u.staticMoving?u._rotateStart.copy(u._rotateEnd):(r.setFromAxisAngle(i,n*(u.dynamicDampingFactor-1)),u._rotateStart.applyQuaternion(r)))}}(),this.zoomCamera=function(e,t){var i;u._state===p.TOUCH_ZOOM_PAN?void 0!==e?i=e:(i=w/b,w=b):i=void 0!==e?e:1+(u._zoomEnd.y-u._zoomStart.y)*u.zoomSpeed/v,(void 0===t||t===!0)&&(o._zoomFactor*=i),1!==i&&(y=i,u.object.left=y*u.left0+(1-y)*u.center0.x,u.object.right=y*u.right0+(1-y)*u.center0.x,u.object.top=y*u.top0+(1-y)*u.center0.y,u.object.bottom=y*u.bottom0+(1-y)*u.center0.y,u.staticMoving?u._zoomStart.copy(u._zoomEnd):u._zoomStart.y+=(u._zoomEnd.y-u._zoomStart.y)*this.dynamicDampingFactor)},this.panCamera=function(e,t){var i=new THREE.Vector2,r=new THREE.Vector3,n=new THREE.Vector3;return function(e,t){void 0!==e?(i=e,(void 0===t||t===!0)&&o.mouseChange.add(e)):(i.copy(u._panEnd).sub(u._panStart),(void 0===t||t===!0)&&o.mouseChange.add(u._panEnd).sub(u._panStart)),i.lengthSq()&&(i.multiplyScalar(g.length()*u.panSpeed),n.copy(g).cross(u.object.up).setLength(i.x),n.add(r.copy(u.object.up).setLength(i.y)),u.object.position.add(n),u.target.add(n),u.staticMoving?u._panStart.copy(u._panEnd):u._panStart.add(i.subVectors(u._panEnd,u._panStart).multiplyScalar(u.dynamicDampingFactor)))}}(),this.update=function(e){g.subVectors(u.object.position,u.target),u.noRotate||(void 0!==e&&void 0!==e.quaternion?u.rotateCamera(e.quaternion,e.update):u.rotateCamera()),u.noZoom||(void 0!==e&&void 0!==e._zoomFactor?u.zoomCamera(e._zoomFactor,e.update):u.zoomCamera(),u.object.updateProjectionMatrix()),u.noPan||(void 0!==e&&void 0!==e.mouseChange?u.panCamera(e.mouseChange,e.update):u.panCamera()),u.object.position.addVectors(u.target,g),u.object.lookAt(u.target),E.distanceToSquared(u.object.position)>m&&(u.dispatchEvent(T),E.copy(u.object.position))},this.reset=function(){u._state=p.NONE,f=p.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),g.subVectors(u.object.position,u.target),u.object.left=u.left0,u.object.right=u.right0,u.object.top=u.top0,u.object.bottom=u.bottom0,u.object.lookAt(u.target),u.dispatchEvent(T),E.copy(u.object.position)},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",h,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",i,!1),window.addEventListener("keyup",r,!1),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls,THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){function e(){if(c===y){var e=new THREE.RenderableObject;return g.push(e),y++,c++,e}return g[c++]}function t(){if(l===b){var e=new THREE.RenderableVertex;return w.push(e),b++,l++,e}return w[l++]}function o(){if(u===R){var e=new THREE.RenderableFace;return T.push(e),R++,u++,e}return T[u++]}function i(){if(v===H){var e=new THREE.RenderableLine;return C.push(e),H++,v++,e}return C[v++]}function r(){if(E===S){var e=new THREE.RenderableSprite;return x.push(e),S++,E++,e}return x[E++]}function n(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function s(e,t){var o=0,i=1,r=e.z+e.w,n=t.z+t.w,s=-e.z+e.w,a=-t.z+t.w;return r>=0&&n>=0&&s>=0&&a>=0?!0:0>r&&0>n||0>s&&0>a?!1:(0>r?o=Math.max(o,r/(r-n)):0>n&&(i=Math.min(i,r/(r-n))),0>s?o=Math.max(o,s/(s-a)):0>a&&(i=Math.min(i,s/(s-a))),o>i?!1:(e.lerp(t,o),t.lerp(e,1-i),!0))}var a,c,h,l,d,u,p,v,m,E,f,g=[],y=0,w=[],b=0,T=[],R=0,C=[],H=0,x=[],S=0,A={objects:[],lights:[],elements:[]},z=new THREE.Vector3,_=new THREE.Vector3,M=new THREE.Vector3,k=new THREE.Vector3,O=new THREE.Vector4,L=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),j=new THREE.Box3,V=new Array(3),P=(new Array(4),
new THREE.Matrix4),D=new THREE.Matrix4,F=new THREE.Matrix4,I=new THREE.Matrix3,N=new THREE.Frustum,B=new THREE.Vector4,G=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var $=function(){var e=[],r=[],n=null,s=null,a=new THREE.Matrix3,c=function(t){n=t,s=n.material,a.getNormalMatrix(n.matrixWorld),e.length=0,r.length=0},l=function(e){var t=e.position,o=e.positionWorld,i=e.positionScreen;o.copy(t).applyMatrix4(f),i.copy(o).applyMatrix4(D);var r=1/i.w;i.x*=r,i.y*=r,i.z*=r,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1},u=function(e,o,i){h=t(),h.position.set(e,o,i),l(h)},v=function(t,o,i){e.push(t,o,i)},m=function(e,t){r.push(e,t)},E=function(e,t,o){return e.visible===!0||t.visible===!0||o.visible===!0?!0:(V[0]=e.positionScreen,V[1]=t.positionScreen,V[2]=o.positionScreen,L.isIntersectionBox(j.setFromPoints(V)))},g=function(e,t,o){return(o.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(o.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},y=function(e,t){var o=w[e],r=w[t];p=i(),p.id=n.id,p.v1.copy(o),p.v2.copy(r),p.z=(o.positionScreen.z+r.positionScreen.z)/2,p.material=n.material,A.elements.push(p)},b=function(t,i,c){var h=w[t],l=w[i],u=w[c];if(E(h,l,u)!==!1&&(s.side===THREE.DoubleSide||g(h,l,u)===!0)){d=o(),d.id=n.id,d.v1.copy(h),d.v2.copy(l),d.v3.copy(u),d.z=(h.positionScreen.z+l.positionScreen.z+u.positionScreen.z)/3;for(var p=0;3>p;p++){var v=3*arguments[p],m=d.vertexNormalsModel[p];m.set(e[v],e[v+1],e[v+2]),m.applyMatrix3(a).normalize();var f=2*arguments[p],y=d.uvs[p];y.set(r[f],r[f+1])}d.vertexNormalsLength=3,d.material=n.material,A.elements.push(d)}};return{setObject:c,projectVertex:l,checkTriangleVisibility:E,checkBackfaceCulling:g,pushVertex:u,pushNormal:v,pushUv:m,pushLine:y,pushTriangle:b}},q=new $;this.projectScene=function(h,g,y,b){u=0,v=0,E=0,A.elements.length=0,h.autoUpdate===!0&&h.updateMatrixWorld(),void 0===g.parent&&g.updateMatrixWorld(),P.copy(g.matrixWorldInverse.getInverse(g.matrixWorld)),D.multiplyMatrices(g.projectionMatrix,P),N.setFromMatrix(D),c=0,A.objects.length=0,A.lights.length=0,h.traverseVisible(function(t){if(t instanceof THREE.Light)A.lights.push(t);else if(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite){if(t.material.visible===!1)return;(t.frustumCulled===!1||N.intersectsObject(t)===!0)&&(a=e(),a.id=t.id,a.object=t,k.setFromMatrixPosition(t.matrixWorld),k.applyProjection(D),a.z=k.z,A.objects.push(a))}}),y===!0&&A.objects.sort(n);for(var T=0,R=A.objects.length;R>T;T++){var C=A.objects[T].object,H=C.geometry;if(q.setObject(C),f=C.matrixWorld,l=0,C instanceof THREE.Mesh){if(H instanceof THREE.BufferGeometry){var x=H.attributes,S=H.offsets;if(void 0===x.position)continue;for(var L=x.position.array,j=0,V=L.length;V>j;j+=3)q.pushVertex(L[j],L[j+1],L[j+2]);if(void 0!==x.normal)for(var $=x.normal.array,j=0,V=$.length;V>j;j+=3)q.pushNormal($[j],$[j+1],$[j+2]);if(void 0!==x.uv)for(var W=x.uv.array,j=0,V=W.length;V>j;j+=2)q.pushUv(W[j],W[j+1]);if(void 0!==x.index){var Y=x.index.array;if(S.length>0)for(var T=0;T<S.length;T++)for(var U=S[T],X=U.index,j=U.start,V=U.start+U.count;V>j;j+=3)q.pushTriangle(Y[j]+X,Y[j+1]+X,Y[j+2]+X);else for(var j=0,V=Y.length;V>j;j+=3)q.pushTriangle(Y[j],Y[j+1],Y[j+2])}else for(var j=0,V=L.length/3;V>j;j+=3)q.pushTriangle(j,j+1,j+2)}else if(H instanceof THREE.Geometry){var Z=H.vertices,Q=H.faces,K=H.faceVertexUvs[0];I.getNormalMatrix(f);for(var J=C.material instanceof THREE.MeshFaceMaterial,ee=J===!0?C.material:null,te=0,oe=Z.length;oe>te;te++){var ie=Z[te];q.pushVertex(ie.x,ie.y,ie.z)}for(var re=0,ne=Q.length;ne>re;re++){var se=Q[re],ae=J===!0?ee.materials[se.materialIndex]:C.material;if(void 0!==ae){var ce=ae.side,he=w[se.a],le=w[se.b],de=w[se.c];if(ae.morphTargets===!0){var ue=H.morphTargets,pe=C.morphTargetInfluences,ve=he.position,me=le.position,Ee=de.position;z.set(0,0,0),_.set(0,0,0),M.set(0,0,0);for(var fe=0,ge=ue.length;ge>fe;fe++){var ye=pe[fe];if(0!==ye){var we=ue[fe].vertices;z.x+=(we[se.a].x-ve.x)*ye,z.y+=(we[se.a].y-ve.y)*ye,z.z+=(we[se.a].z-ve.z)*ye,_.x+=(we[se.b].x-me.x)*ye,_.y+=(we[se.b].y-me.y)*ye,_.z+=(we[se.b].z-me.z)*ye,M.x+=(we[se.c].x-Ee.x)*ye,M.y+=(we[se.c].y-Ee.y)*ye,M.z+=(we[se.c].z-Ee.z)*ye}}he.position.add(z),le.position.add(_),de.position.add(M),q.projectVertex(he),q.projectVertex(le),q.projectVertex(de)}if(q.checkTriangleVisibility(he,le,de)!==!1){var be=q.checkBackfaceCulling(he,le,de);if(ce!==THREE.DoubleSide){if(ce===THREE.FrontSide&&be===!1)continue;if(ce===THREE.BackSide&&be===!0)continue}d=o(),d.id=C.id,d.v1.copy(he),d.v2.copy(le),d.v3.copy(de),d.normalModel.copy(se.normal),be!==!1||ce!==THREE.BackSide&&ce!==THREE.DoubleSide||d.normalModel.negate(),d.normalModel.applyMatrix3(I).normalize();for(var Te=se.vertexNormals,Re=0,Ce=Math.min(Te.length,3);Ce>Re;Re++){var He=d.vertexNormalsModel[Re];He.copy(Te[Re]),be!==!1||ce!==THREE.BackSide&&ce!==THREE.DoubleSide||He.negate(),He.applyMatrix3(I).normalize()}d.vertexNormalsLength=Te.length;var xe=K[re];if(void 0!==xe)for(var Se=0;3>Se;Se++)d.uvs[Se].copy(xe[Se]);d.color=se.color,d.material=ae,d.z=(he.positionScreen.z+le.positionScreen.z+de.positionScreen.z)/3,A.elements.push(d)}}}}}else if(C instanceof THREE.Line){if(H instanceof THREE.BufferGeometry){var x=H.attributes;if(void 0!==x.position){for(var L=x.position.array,j=0,V=L.length;V>j;j+=3)q.pushVertex(L[j],L[j+1],L[j+2]);if(void 0!==x.index)for(var Y=x.index.array,j=0,V=Y.length;V>j;j+=2)q.pushLine(Y[j],Y[j+1]);else for(var Ae=C.mode===THREE.LinePieces?2:1,j=0,V=L.length/3-1;V>j;j+=Ae)q.pushLine(j,j+1)}}else if(H instanceof THREE.Geometry){F.multiplyMatrices(D,f);var Z=C.geometry.vertices;if(0===Z.length)continue;he=t(),he.positionScreen.copy(Z[0]).applyMatrix4(F);for(var Ae=C.mode===THREE.LinePieces?2:1,te=1,oe=Z.length;oe>te;te++)he=t(),he.positionScreen.copy(Z[te]).applyMatrix4(F),(te+1)%Ae>0||(le=w[l-2],B.copy(he.positionScreen),G.copy(le.positionScreen),s(B,G)===!0&&(B.multiplyScalar(1/B.w),G.multiplyScalar(1/G.w),p=i(),p.id=C.id,p.v1.positionScreen.copy(B),p.v2.positionScreen.copy(G),p.z=Math.max(B.z,G.z),p.material=C.material,C.material.vertexColors===THREE.VertexColors&&(p.vertexColors[0].copy(C.geometry.colors[te]),p.vertexColors[1].copy(C.geometry.colors[te-1])),A.elements.push(p)))}}else if(C instanceof THREE.Sprite){O.set(f.elements[12],f.elements[13],f.elements[14],1),O.applyMatrix4(D);var ze=1/O.w;O.z*=ze,O.z>=-1&&O.z<=1&&(m=r(),m.id=C.id,m.x=O.x*ze,m.y=O.y*ze,m.z=O.z,m.object=C,m.rotation=C.rotation,m.scale.x=C.scale.x*Math.abs(m.x-(O.x+g.projectionMatrix.elements[0])/(O.w+g.projectionMatrix.elements[12])),m.scale.y=C.scale.y*Math.abs(m.y-(O.y+g.projectionMatrix.elements[5])/(O.w+g.projectionMatrix.elements[13])),m.material=C.material,A.elements.push(m))}}return b===!0&&A.elements.sort(n),A}},$3Dmol={},$3Dmol.MarchingCubeInitializer=function(){var e=2,t={};t.march=function(t,s,a,c){var h=!!c.fulltable,l=c.hasOwnProperty("origin")&&c.origin.hasOwnProperty("x")?c.origin:{x:0,y:0,z:0},d=!!c.voxel,u=c.nX||0,p=c.nY||0,v=c.nZ||0,m=c.scale||1,E=null;E=c.unitCube?c.unitCube:{x:m,y:m,z:m};var f,g,y=new Int32Array(u*p*v);for(f=0,g=y.length;g>f;++f)y[f]=-1;var w=function(e,t,o,i,r,n){var a={x:l.x,y:l.y,z:l.z},c=!!(i&1<<r),h=!!(i&1<<n),u=r;!c&&h&&(u=n),1&u&&o++,2&u&&t++,4&u&&e++,a.x+=E.x*e,a.y+=E.y*t,a.z+=E.z*o;var m=(p*e+t)*v+o;return d?(s.push(a),s.length-1):(y[m]<0&&(y[m]=s.length,s.push(a)),y[m])},b=new Int32Array(12),T=h?r:o,R=h?n:i;for(f=0;u-1>f;++f)for(var C=0;p-1>C;++C)for(var H=0;v-1>H;++H){for(var x=0,S=0;8>S;++S){var A=(p*(f+((4&S)>>2))+C+((2&S)>>1))*v+H+(1&S),z=!!(t[A]&e);x|=z<<S}if(0!==x&&255!==x){var _=T[x];if(0!==_){var M=R[x];1&_&&(b[0]=w(f,C,H,x,0,1)),2&_&&(b[1]=w(f,C,H,x,1,3)),4&_&&(b[2]=w(f,C,H,x,3,2)),8&_&&(b[3]=w(f,C,H,x,2,0)),16&_&&(b[4]=w(f,C,H,x,4,5)),32&_&&(b[5]=w(f,C,H,x,5,7)),64&_&&(b[6]=w(f,C,H,x,7,6)),128&_&&(b[7]=w(f,C,H,x,6,4)),256&_&&(b[8]=w(f,C,H,x,0,4)),512&_&&(b[9]=w(f,C,H,x,1,5)),1024&_&&(b[10]=w(f,C,H,x,3,7)),2048&_&&(b[11]=w(f,C,H,x,2,6));for(var k=0;k<M.length;k+=3){var O=b[M[k]],L=b[M[k+1]],j=b[M[k+2]];d&&k>=3&&(s.push(s[O]),O=s.length-1,s.push(s[L]),L=s.length-1,s.push(s[j]),j=s.length-1),a.push(O),a.push(L),a.push(j)}}}}y=null},t.laplacianSmooth=function(e,t,o){var i,r,n,s,a,c=new Array(t.length);for(i=0,r=t.length;r>i;i++)c[i]={x:0,y:0,z:0};var h,l=new Array(20);for(i=0;20>i;i++)l[i]=new Array(t.length);for(i=0,r=t.length;r>i;i++)l[0][i]=0;for(i=0,r=o.length/3;r>i;i++){var d=3*i,u=3*i+1,p=3*i+2;for(h=!0,n=0,s=l[0][o[d]];s>n;n++)if(o[u]==l[n+1][o[d]]){h=!1;break}for(h&&(l[0][o[d]]++,l[l[0][o[d]]][o[d]]=o[u]),h=!0,n=0,s=l[0][o[d]];s>n;n++)if(o[p]==l[n+1][o[d]]){h=!1;break}for(h&&(l[0][o[d]]++,l[l[0][o[d]]][o[d]]=o[p]),h=!0,n=0,s=l[0][o[u]];s>n;n++)if(o[d]==l[n+1][o[u]]){h=!1;break}for(h&&(l[0][o[u]]++,l[l[0][o[u]]][o[u]]=o[d]),h=!0,n=0,s=l[0][o[u]];s>n;n++)if(o[p]==l[n+1][o[u]]){h=!1;break}for(h&&(l[0][o[u]]++,l[l[0][o[u]]][o[u]]=o[p]),h=!0,n=0;n<l[0][o[p]];n++)if(o[d]==l[n+1][o[p]]){h=!1;break}for(h&&(l[0][o[p]]++,l[l[0][o[p]]][o[p]]=o[d]),h=!0,n=0,s=l[0][o[p]];s>n;n++)if(o[u]==l[n+1][o[p]]){h=!1;break}h&&(l[0][o[p]]++,l[l[0][o[p]]][o[p]]=o[u])}var v=1,m=.5;for(a=0;e>a;a++){for(i=0,r=t.length;r>i;i++)if(l[0][i]<3)c[i].x=t[i].x,c[i].y=t[i].y,c[i].z=t[i].z;else if(3==l[0][i]||4==l[0][i]){for(c[i].x=0,c[i].y=0,c[i].z=0,n=0,s=l[0][i];s>n;n++)c[i].x+=t[l[n+1][i]].x,c[i].y+=t[l[n+1][i]].y,c[i].z+=t[l[n+1][i]].z;c[i].x+=m*t[i].x,c[i].y+=m*t[i].y,c[i].z+=m*t[i].z,c[i].x/=m+l[0][i],c[i].y/=m+l[0][i],c[i].z/=m+l[0][i]}else{for(c[i].x=0,c[i].y=0,c[i].z=0,n=0,s=l[0][i];s>n;n++)c[i].x+=t[l[n+1][i]].x,c[i].y+=t[l[n+1][i]].y,c[i].z+=t[l[n+1][i]].z;c[i].x+=v*t[i].x,c[i].y+=v*t[i].y,c[i].z+=v*t[i].z,c[i].x/=v+l[0][i],c[i].y/=v+l[0][i],c[i].z/=v+l[0][i]}for(i=0,r=t.length;r>i;i++)t[i].x=c[i].x,t[i].y=c[i].y,t[i].z=c[i].z}l=null,c=null},t.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0];var o=new Uint32Array(t.edgeTable),i=t.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],r=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],n=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];return t},$3Dmol.MarchingCube=$3Dmol.MarchingCubeInitializer(),"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ProteinSurface=function(){var e,t,o,r=1,n=2,s=4,a=0,c=0,h=0,l=1.4,d=2,u=d,p=0,v=0,m=0,E=0,f=null,g=null,y=null,w=0,b=0,T=0,R=0,C=0,H=0,x={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},S=function(e){return e.elem&&"undefined"!=typeof x[e.elem]?e.elem:"X"},A={},z={},_=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(o){var i,r,n={};for(i=0,r=o.length;r>i;i++)n[o[i]]=!0;var s=t;for(i=0,r=s.length;r>i;i++)s[i].x=s[i].x/u-a,s[i].y=s[i].y/u-c,s[i].z=s[i].z/u-h;var l=[];for(i=0,r=e.length;r>i;i+=3){var d=e[i],p=e[i+1],v=e[i+2],m=s[d].atomid,E=s[p].atomid,w=s[v].atomid,b=m;if(b>E&&(b=E),b>w&&(b=w),n[b]){s[e[i]],s[e[i+1]],s[e[i+2]];d!==p&&p!==v&&d!==v&&l.push({a:d,b:p,c:v})}}return f=null,g=null,y=null,{vertices:s,faces:l}},this.initparm=function(e,t,i){var r=1/u*5.5;o=e,w=e[0][0],R=e[1][0],b=e[0][1],C=e[1][1],T=e[0][2],H=e[1][2],t?(w-=l+r,b-=l+r,T-=l+r,R+=l+r,C+=l+r,H+=l+r):(w-=r,b-=r,T-=r,R+=r,C+=r,H+=r),w=Math.floor(w*u)/u,b=Math.floor(b*u)/u,T=Math.floor(T*u)/u,R=Math.ceil(R*u)/u,C=Math.ceil(C*u)/u,H=Math.ceil(H*u)/u,a=-w,c=-b,h=-T;var n=128;u=R-w,C-b>u&&(u=C-b),H-T>u&&(u=H-T),u=(n-1)/u,n=Math.floor(n*d/u),u=d;var s=180;if(n>s){var x=s/n;n=Math.floor(s),u*=x}m=Math.ceil(u*(R-w))+1,v=Math.ceil(u*(C-b))+1,p=Math.ceil(u*(H-T))+1,this.boundingatom(t),E=l*u,f=new Uint8Array(m*v*p),g=new Float64Array(m*v*p),y=new Int32Array(m*v*p)},this.boundingatom=function(e){var t,o,i,r=[];flagradius=e;for(var n in x)if(x.hasOwnProperty(n)){var s=x[n];for(e?r[n]=(s+l)*u+.5:r[n]=s*u+.5,i=r[n]*r[n],z[n]=Math.floor(r[n])+1,A[n]=new Int32Array(z[n]*z[n]),indx=0,j=0;j<z[n];j++)for(k=0;k<z[n];k++)t=j*j+k*k,t>i?A[n][indx]=-1:(o=Math.sqrt(i-t),A[n][indx]=Math.floor(o)),indx++}},this.fillvoxels=function(e,t){var o,i;for(o=0,i=f.length;i>o;o++)f[o]=0,g[o]=-1,y[o]=-1;for(o in t){var s=e[t[o]];void 0!==s&&this.fillAtom(s,e)}for(o=0,i=f.length;i>o;o++)f[o]&r&&(f[o]|=n)},this.fillAtom=function(e,t){var o,i,n,s,l,d,E,g,w,b,T,R,C,H,x,_,M,k,O;o=Math.floor(.5+u*(e.coord.x+a)),i=Math.floor(.5+u*(e.coord.y+c)),n=Math.floor(.5+u*(e.coord.z+h));var L=S(e),j=0,V=v*p;for(b=0,O=z[L];O>b;b++)for(T=0;O>T;T++){if(-1!=A[L][j])for(_=-1;2>_;_++)for(M=-1;2>M;M++)for(k=-1;2>k;k++)if(0!==_&&0!==M&&0!==k)for(E=_*b,w=k*T,R=0;R<=A[L][j];R++)if(g=R*M,C=o+E,H=i+g,x=n+w,!(0>C||0>H||0>x||C>=m||H>=v||x>=p)){var P=C*V+H*p+x;if(f[P]&r){var D=t[y[P]];D.serial!=e.serial&&(s=o+E-Math.floor(.5+u*(D.x+a)),l=i+g-Math.floor(.5+u*(D.y+c)),d=n+w-Math.floor(.5+u*(D.z+h)),s*s+l*l+d*d>E*E+g*g+w*w&&(y[P]=e.serial))}else f[P]|=r,y[P]=e.serial}j++}},this.fillvoxelswaals=function(e,t){var o,i;for(o=0,i=f.length;i>o;o++)f[o]&=~n;for(o in t){var r=e[t[o]];void 0!==r&&this.fillAtomWaals(r,e)}},this.fillAtomWaals=function(e,t){var o,i,r,s,l,d,E,g,w,b,T,R,C,H,x,_,M,k,O,L=0;o=Math.floor(.5+u*(e.coord.x+a)),i=Math.floor(.5+u*(e.coord.y+c)),r=Math.floor(.5+u*(e.coord.z+h));var j=S(e),V=v*p;for(C=0,O=z[j];O>C;C++)for(H=0;O>H;H++){if(-1!=A[j][L])for(_=-1;2>_;_++)for(M=-1;2>M;M++)for(k=-1;2>k;k++)if(0!==_&&0!==M&&0!==k)for(E=_*C,w=k*H,x=0;x<=A[j][L];x++)if(g=x*M,b=o+E,T=i+g,R=r+w,!(0>b||0>T||0>R||b>=m||T>=v||R>=p)){var P=b*V+T*p+R;if(f[P]&n){var D=t[y[P]];D.serial!=e.serial&&(s=o+E-Math.floor(.5+u*(D.x+a)),l=i+g-Math.floor(.5+u*(D.y+c)),d=r+w-Math.floor(.5+u*(D.z+h)),s*s+l*l+d*d>E*E+g*g+w*w&&(y[P]=e.serial))}else f[P]|=n,y[P]=e.serial}L++}},this.buildboundary=function(){var e=v*p;for(i=0;i<m;i++)for(j=0;j<p;j++)for(k=0;k<v;k++){var t=i*e+k*p+j;if(f[t]&r)for(var o=0;26>o;){var n=i+_[o][0],a=j+_[o][2],c=k+_[o][1];if(n>-1&&m>n&&c>-1&&v>c&&a>-1&&p>a&&!(f[n*e+c*p+a]&r)){f[t]|=s;break}o++}}};var M=function(e,t,o){var i=new Int32Array(e*t*o*3);this.set=function(e,r,n,s){var a=3*((e*t+r)*o+n);i[a]=s.ix,i[a+1]=s.iy,i[a+2]=s.iz},this.get=function(e,r,n){var s=3*((e*t+r)*o+n);return{ix:i[s],iy:i[s+1],iz:i[s+2]}}};this.fastdistancemap=function(){var e,t,o,i,a,c=new M(m,v,p),h=v*p,l=E*E,d=[],y=[];for(e=0;m>e;e++)for(t=0;v>t;t++)for(o=0;p>o;o++)if(a=e*h+t*p+o,f[a]&=~n,f[a]&r&&f[a]&s){var w={ix:e,iy:t,iz:o};c.set(e,t,o,w),d.push(w),g[a]=0,f[a]|=n,f[a]&=~s}do for(y=this.fastoneshell(d,c),d=[],e=0,i=y.length;i>e;e++)a=h*y[e].ix+p*y[e].iy+y[e].iz,f[a]&=~s,g[a]<=1.0404*l&&d.push({ix:y[e].ix,iy:y[e].iy,iz:y[e].iz});while(0!==d.length);d=[],y=[],c=null;var b=u-.5;0>b&&(b=0);var T=l-.5/(.1+b);for(e=0;m>e;e++)for(t=0;v>t;t++)for(o=0;p>o;o++)a=e*h+t*p+o,f[a]&=~s,f[a]&r&&(!(f[a]&n)||f[a]&n&&g[a]>=T)&&(f[a]|=s)},this.fastoneshell=function(e,t){var o,i,a,c,h,l,d,u,E,y,w,b,T=[];if(0===e.length)return T;tnv={ix:-1,iy:-1,iz:-1};var R=v*p;for(d=0,E=e.length;E>d;d++)for(o=e[d].ix,i=e[d].iy,a=e[d].iz,w=t.get(o,i,a),u=0;6>u;u++)tnv.ix=o+_[u][0],tnv.iy=i+_[u][1],tnv.iz=a+_[u][2],tnv.ix<m&&tnv.ix>-1&&tnv.iy<v&&tnv.iy>-1&&tnv.iz<p&&tnv.iz>-1&&(b=tnv.ix*R+p*tnv.iy+tnv.iz,f[b]&r&&!(f[b]&n)?(t.set(tnv.ix,tnv.iy,a+_[u][2],w),c=tnv.ix-w.ix,h=tnv.iy-w.iy,l=tnv.iz-w.iz,y=c*c+h*h+l*l,g[b]=y,f[b]|=n,f[b]|=s,T.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):f[b]&r&&f[b]&n&&(c=tnv.ix-w.ix,h=tnv.iy-w.iy,l=tnv.iz-w.iz,y=c*c+h*h+l*l,y<g[b]&&(t.set(tnv.ix,tnv.iy,tnv.iz,w),g[b]=y,f[b]&s||(f[b]|=s,T.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(d=0,E=e.length;E>d;d++)for(o=e[d].ix,i=e[d].iy,a=e[d].iz,w=t.get(o,i,a),u=6;18>u;u++)tnv.ix=o+_[u][0],tnv.iy=i+_[u][1],tnv.iz=a+_[u][2],tnv.ix<m&&tnv.ix>-1&&tnv.iy<v&&tnv.iy>-1&&tnv.iz<p&&tnv.iz>-1&&(b=tnv.ix*R+p*tnv.iy+tnv.iz,f[b]&r&&!(f[b]&n)?(t.set(tnv.ix,tnv.iy,a+_[u][2],w),c=tnv.ix-w.ix,h=tnv.iy-w.iy,l=tnv.iz-w.iz,y=c*c+h*h+l*l,g[b]=y,f[b]|=n,f[b]|=s,T.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):f[b]&r&&f[b]&n&&(c=tnv.ix-w.ix,h=tnv.iy-w.iy,l=tnv.iz-w.iz,y=c*c+h*h+l*l,y<g[b]&&(t.set(tnv.ix,tnv.iy,tnv.iz,w),g[b]=y,f[b]&s||(f[b]|=s,T.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(d=0,E=e.length;E>d;d++)for(o=e[d].ix,i=e[d].iy,a=e[d].iz,w=t.get(o,i,a),u=18;26>u;u++)tnv.ix=o+_[u][0],tnv.iy=i+_[u][1],tnv.iz=a+_[u][2],tnv.ix<m&&tnv.ix>-1&&tnv.iy<v&&tnv.iy>-1&&tnv.iz<p&&tnv.iz>-1&&(b=tnv.ix*R+p*tnv.iy+tnv.iz,f[b]&r&&!(f[b]&n)?(t.set(tnv.ix,tnv.iy,a+_[u][2],w),c=tnv.ix-w.ix,h=tnv.iy-w.iy,l=tnv.iz-w.iz,y=c*c+h*h+l*l,g[b]=y,f[b]|=n,f[b]|=s,T.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):f[b]&r&&f[b]&n&&(c=tnv.ix-w.ix,h=tnv.iy-w.iy,l=tnv.iz-w.iz,y=c*c+h*h+l*l,y<g[b]&&(t.set(tnv.ix,tnv.iy,tnv.iz,w),g[b]=y,f[b]&s||(f[b]|=s,T.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));return T},this.marchingcubeinit=function(e){for(var t=0,o=f.length;o>t;t++)1==e?f[t]&=~s:4==e?(f[t]&=~n,f[t]&s&&(f[t]|=n),f[t]&=~s):2==e?f[t]&s&&f[t]&n?f[t]&=~s:f[t]&s&&!(f[t]&n)&&(f[t]|=n):3==e&&(f[t]&=~s)};this.marchingcube=function(o){this.marchingcubeinit(o),t=[],e=[],$3Dmol.MarchingCube.march(f,t,e,{smooth:1,nX:m,nY:v,nZ:p});for(var i=v*p,r=0,n=t.length;n>r;r++)t[r].atomid=y[t[r].x*i+p*t[r].y+t[r].z];$3Dmol.MarchingCube.laplacianSmooth(1,t,e)}},$3Dmol.SetupSurface=function(e){var t=void 0,o=new $3Dmol.ProteinSurface;return o.initparm(e.extent,1===e.type?!1:!0,t),o.fillvoxels(e.allatoms,e.extendedAtoms),o.buildboundary(),2===e.type&&(o.fastdistancemap(),o.boundingatom(!1),o.fillvoxelswaals(e.allatoms,e.extendedAtoms)),o.marchingcube(e.type),o.vpBits=null,o.vpDistance=null,o.vpAtomID=null,o.faces=null,o.verts=null,o.getFacesAndVertices(e.atomsToShow)},"undefined"==typeof jQuery)throw new Error("iCn3D requires jQuery");var iCn3D=function(e){this.REVISION="1",this.id=e,this.container=$("#"+e),this.overdraw=0,this.bHighlight=1,Detector.webgl?(this.renderer=new THREE.WebGLRenderer({canvas:this.container.get(0),antialias:!0,preserveDrawingBuffer:!0}),this.overdraw=0):(alert("Currently your web browser has a problem on WebGL, and CanvasRenderer instead of WebGLRenderer is used. If you are using Chrome, open a new tab for the same URL and WebGL may work again."),this.renderer=new THREE.CanvasRenderer({canvas:this.container.get(0)}),this.overdraw=.5,this.bHighlight=2),this.matShader=this.setOutlineColor("yellow"),this.fractionOfColor=new THREE.Color(.1,.1,.1),this.WIDTH=this.container.width(),this.HEIGHT=this.container.height(),this.setWidthHeight(this.WIDTH,this.HEIGHT),this.axis=!1,this.picking=1,this.pickpair=!1,this.pickedatomNum=0,this.pickedatom=void 0,this.pickedatom2=void 0,this.bStopRotate=!1,this.bCalphaOnly=!1,this.bSSOnly=!1,this.bConsiderNeighbors=!1,this.effects={none:this.renderer},this.maxD=500,this.camera_z=2*-this.maxD,this.commands=[],this.logs=[],this.bRender=!0,this.highlightColor=new THREE.Color(16776960),this.sphereGeometry=new THREE.SphereGeometry(1,32,32),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1),this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,!0),this.sphereRadius=1.5,this.cylinderRadius=.4,this.linewidth=1,this.curveWidth=3,this.helixSheetWidth=1.3,this.coilWidth=.3,this.thickness=.4,this.axisDIV=5,this.strandDIV=6,this.tubeDIV=8,this.LABELSIZE=40,this.nucleicAcidStrandDIV=6,this.nucleicAcidWidth=.8,this.options={camera:"perspective",background:"black",color:"spectrum",sidechains:"nothing",secondary:"cylinder & plate",surface:"nothing",wireframe:"no",opacity:"0.8",ligands:"stick",water:"nothing",ions:"sphere",hbonds:"no",labels:"no",lines:"no",rotationcenter:"molecule center",axis:"no",picking:"no",nucleotides:"nucleotide cartoon"},this._zoomFactor=1,this.mouseChange=new THREE.Vector2(0,0),this.quaternion=new THREE.Quaternion(0,0,0,1);var t=this;this.container.bind("contextmenu",function(e){e.preventDefault()}),t.typetext=!1,$(document).bind("keydown",function(e){if(t.controls&&(t.bStopRotate=!0,$("input, textarea").focus(function(){t.typetext=!0}),$("input, textarea").blur(function(){t.typetext=!1}),!t.typetext)){if(90===e.keyCode){var o={};t.camera===t.perspectiveCamera?o._zoomFactor=.9:t.camera===t.orthographicCamera&&(t._zoomFactor<.1?t._zoomFactor=.1:t._zoomFactor>1&&(t._zoomFactor=1),o._zoomFactor=.9*t._zoomFactor,o._zoomFactor<.1&&(o._zoomFactor=.1)),o.update=!0,t.controls.update(o)}else if(88===e.keyCode){var o={};t.camera===t.perspectiveCamera?o._zoomFactor=1.1:t.camera===t.orthographicCamera&&(t._zoomFactor>20?t._zoomFactor=20:t._zoomFactor<1&&(t._zoomFactor=1),o._zoomFactor=1.03*t._zoomFactor,o._zoomFactor>20&&(o._zoomFactor=20)),o.update=!0,t.controls.update(o)}else if(76===e.keyCode){var i=new THREE.Vector3(0,1,0),r=-5/180*Math.PI;i.applyQuaternion(t.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-r);var o={};o.quaternion=n,o.update=!0,t.controls.update(o)}else if(74===e.keyCode){var i=new THREE.Vector3(0,1,0),r=5/180*Math.PI;i.applyQuaternion(t.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-r);var o={};o.quaternion=n,o.update=!0,t.controls.update(o)}else if(73===e.keyCode){
var i=new THREE.Vector3(1,0,0),r=-5/180*Math.PI;i.applyQuaternion(t.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-r);var o={};o.quaternion=n,o.update=!0,t.controls.update(o)}else if(77===e.keyCode){var i=new THREE.Vector3(1,0,0),r=5/180*Math.PI;i.applyQuaternion(t.camera.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(i,-r);var o={};o.quaternion=n,o.update=!0,t.controls.update(o)}else if(37===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.x-=.01;var o={};o.mouseChange=s,o.update=!0,t.controls.update(o)}else if(39===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.x+=.01;var o={};o.mouseChange=s,o.update=!0,t.controls.update(o)}else if(38===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.y-=.01;var o={};o.mouseChange=s,o.update=!0,t.controls.update(o)}else if(40===e.keyCode){e.preventDefault();var s=new THREE.Vector2(0,0);s.y+=.01;var o={};o.mouseChange=s,o.update=!0,t.controls.update(o)}t.render()}}),this.container.bind("mouseup touchend",function(e){t.isDragging=!1}),this.container.bind("mousedown touchstart",function(e){if(e.preventDefault(),t.scene){t.bStopRotate=!0;var o=e.pageX,i=e.pageY;if(e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]&&(o=e.originalEvent.targetTouches[0].pageX,i=e.originalEvent.targetTouches[0].pageY),t.isDragging=!0,t.picking){t.mouse.x=(o-t.container.offset().left)/t.container.width()*2-1,t.mouse.y=2*-((i-t.container.offset().top)/t.container.height())+1;var r=new THREE.Vector3;r.x=t.mouse.x,r.y=t.mouse.y,this.camera_z>0?r.z=-1:r.z=1,t.camera===t.perspectiveCamera?(this.camera_z>0?r.z=-1:r.z=1,r.unproject(t.camera),t.raycaster.set(t.camera.position,r.sub(t.camera.position).normalize())):t.camera===t.orthographicCamera&&(this.camera_z>0?r.z=1:r.z=-1,r.unproject(t.camera),t.raycaster.set(r,new THREE.Vector3(0,0,-1).transformDirection(t.camera.matrixWorld)));var n=t.raycaster.intersectObjects(t.objects);if(n.length>0){n[0].point.sub(t.mdl.position);for(var s=1,a=t.getAtomsFromPosition(n[0].point,s);!a&&10>s;)++s,a=t.getAtomsFromPosition(n[0].point,s);a?(t.pickpair?(t.pickedatomNum%2===0?t.pickedatom=a:t.pickedatom2=a,++t.pickedatomNum):t.pickedatom=a,t.showPicking(a)):console.log("No atoms were found in 10 andstrom range")}}t.controls.handleResize(),t.controls.update(),t.render()}}),this.container.bind("mousemove touchmove",function(e){e.preventDefault(),t.scene&&t.isDragging&&(t.controls.handleResize(),t.controls.update(),t.render())}),this.container.bind("mousewheel",function(e){e.preventDefault(),t.scene&&(t.bStopRotate=!0,t.controls.handleResize(),t.controls.update(),t.render())}),this.container.bind("DOMMouseScroll",function(e){e.preventDefault(),t.scene&&(t.bStopRotate=!0,t.controls.handleResize(),t.controls.update(),t.render())})};iCn3D.prototype={constructor:iCn3D,setOutlineColor:function(e){var t={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};"yellow"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"green"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"red"===e&&(t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n"));var o={offset:{type:"f",value:.5}},i=t.outline,r=new THREE.ShaderMaterial({uniforms:o,vertexShader:i.vertex_shader,fragmentShader:i.fragment_shader,depthTest:!1,depthWrite:!1,needsUpdate:!0});return r},setWidthHeight:function(e,t){this.renderer.setSize(e,t),this.container.widthInv=1/e,this.container.heightInv=1/t,this.container.whratio=e/t},nucleotidesArray:["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU"],ionsArray:[" NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I"],vdwRadii:{H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56},covalentRadii:{H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69},atomColors:{H:new THREE.Color(16777215),He:new THREE.Color(16761035),HE:new THREE.Color(16761035),Li:new THREE.Color(11674146),LI:new THREE.Color(11674146),B:new THREE.Color(65280),C:new THREE.Color(13158600),N:new THREE.Color(9408511),O:new THREE.Color(15728640),F:new THREE.Color(14329120),Na:new THREE.Color(255),NA:new THREE.Color(255),Mg:new THREE.Color(2263842),MG:new THREE.Color(2263842),Al:new THREE.Color(8421520),AL:new THREE.Color(8421520),Si:new THREE.Color(14329120),SI:new THREE.Color(14329120),P:new THREE.Color(16753920),S:new THREE.Color(16762930),Cl:new THREE.Color(65280),CL:new THREE.Color(65280),Ca:new THREE.Color(8421520),CA:new THREE.Color(8421520),Ti:new THREE.Color(8421520),TI:new THREE.Color(8421520),Cr:new THREE.Color(8421520),CR:new THREE.Color(8421520),Mn:new THREE.Color(8421520),MN:new THREE.Color(8421520),Fe:new THREE.Color(16753920),FE:new THREE.Color(16753920),Ni:new THREE.Color(10824234),NI:new THREE.Color(10824234),Cu:new THREE.Color(10824234),CU:new THREE.Color(10824234),Zn:new THREE.Color(10824234),ZN:new THREE.Color(10824234),Br:new THREE.Color(10824234),BR:new THREE.Color(10824234),Ag:new THREE.Color(8421520),AG:new THREE.Color(8421520),I:new THREE.Color(10494192),Ba:new THREE.Color(16753920),BA:new THREE.Color(16753920),Au:new THREE.Color(14329120),AU:new THREE.Color(14329120)},defaultAtomColor:new THREE.Color(13421772),stdChainColors:[new THREE.Color(3329330),new THREE.Color(2003199),new THREE.Color(16416882),new THREE.Color(16753920),new THREE.Color(52945),new THREE.Color(16738740),new THREE.Color(65280),new THREE.Color(255),new THREE.Color(16711680),new THREE.Color(16776960),new THREE.Color(65535),new THREE.Color(16711935),new THREE.Color(3978097),new THREE.Color(4620980),new THREE.Color(13458524),new THREE.Color(16770229),new THREE.Color(11529966),new THREE.Color(15631086),new THREE.Color(25600),new THREE.Color(139),new THREE.Color(9109504),new THREE.Color(13468991),new THREE.Color(35723),new THREE.Color(9699539)],backgroundColors:{black:new THREE.Color(0),grey:new THREE.Color(13421772),white:new THREE.Color(16777215)},residueColors:{ALA:new THREE.Color(13158600),ARG:new THREE.Color(1334015),ASN:new THREE.Color(56540),ASP:new THREE.Color(15075850),CYS:new THREE.Color(15132160),GLN:new THREE.Color(56540),GLU:new THREE.Color(15075850),GLY:new THREE.Color(15461355),HIS:new THREE.Color(8553170),ILE:new THREE.Color(1016335),LEU:new THREE.Color(1016335),LYS:new THREE.Color(1334015),MET:new THREE.Color(15132160),PHE:new THREE.Color(3289770),PRO:new THREE.Color(14456450),SER:new THREE.Color(16422400),THR:new THREE.Color(16422400),TRP:new THREE.Color(11819700),TYR:new THREE.Color(3289770),VAL:new THREE.Color(1016335),ASX:new THREE.Color(16738740),GLX:new THREE.Color(16738740)},defaultResidueColor:new THREE.Color(12492910),chargeColors:{"  G":new THREE.Color(16711680),"  A":new THREE.Color(16711680),"  T":new THREE.Color(16711680),"  C":new THREE.Color(16711680),"  U":new THREE.Color(16711680)," DG":new THREE.Color(16711680)," DA":new THREE.Color(16711680)," DT":new THREE.Color(16711680)," DC":new THREE.Color(16711680)," DU":new THREE.Color(16711680),G:new THREE.Color(16711680),A:new THREE.Color(16711680),T:new THREE.Color(16711680),C:new THREE.Color(16711680),U:new THREE.Color(16711680),DG:new THREE.Color(16711680),DA:new THREE.Color(16711680),DT:new THREE.Color(16711680),DC:new THREE.Color(16711680),DU:new THREE.Color(16711680),ARG:new THREE.Color(255),LYS:new THREE.Color(255),ASP:new THREE.Color(16711680),GLU:new THREE.Color(16711680),HIS:new THREE.Color(8947848),SER:new THREE.Color(8947848),THR:new THREE.Color(8947848),ASN:new THREE.Color(8947848),GLN:new THREE.Color(8947848),TYR:new THREE.Color(8947848),GLY:new THREE.Color(8947848),PRO:new THREE.Color(8947848),ALA:new THREE.Color(8947848),VAL:new THREE.Color(8947848),LEU:new THREE.Color(8947848),ILE:new THREE.Color(8947848),MET:new THREE.Color(8947848),PHE:new THREE.Color(8947848),CYS:new THREE.Color(8947848),TRP:new THREE.Color(8947848)},ssColors:{helix:new THREE.Color(16711808),sheet:new THREE.Color(16762880),coil:new THREE.Color(6324479)},defaultBondColor:new THREE.Color(2200790),surfaces:{1:void 0,2:void 0,3:void 0,4:void 0},hasCovalentBond:function(e,t){var o=this.covalentRadii[e.elem]+this.covalentRadii[t.elem];return e.coord.distanceToSquared(t.coord)<1.3*o*o},init:function(){this.structures={},this.chains={},this.residues={},this.secondarys={},this.alignChains={},this.chainsSeq={},this.chainsColor={},this.chainsAnno={},this.chainsAnnoTitle={},this.alignChainsSeq={},this.alignChainsAnno={},this.alignChainsAnnoTitle={},this.displayAtoms={},this.highlightAtoms={},this.prevHighlightObjects=[],this.prevSurfaces=[],this.definedNames2Residues={},this.definedNames2Atoms={},this.definedNames2Descr={},this.definedNames2Command={},this.residueId2Name={},this.moleculeTitle="",this.atoms={},this.displayAtoms={},this.highlightAtoms={},this.proteins={},this.nucleotides={},this.nucleotidesP={},this.ligands={},this.ions={},this.water={},this.calphas={},this.hbondpoints=[],this.doublebonds={},this.triplebonds={},this.atomPrevColors={},this.style2atoms={},this.labels=[],this.lines=[],this.inputid={idtype:void 0,id:void 0},this.biomtMatrices=[],this.bAssembly=!1},loadPDB:function(e){var t=[],o=[],i=e.split("\n"),r={},n={};this.init();var s,a,c=[],h=[],l=[],d=[],u=[],p=[],v=0,m=1,E="",f="",g="",y={};for(var w in i){var b=i[w],T=b.substr(0,6);if("HEADER"===T){var R=b.substr(10,40),C=b.substr(62,4);this.moleculeTitle=R.trim()+" ("+C+")"}else if("HELIX "===T){for(var H,x=b.substr(19,1),S=parseInt(b.substr(21,4)),A=parseInt(b.substr(33,4)),z=S;A>=z;++z)H=x+"_"+z,d.push(H),z===S&&u.push(H),z===A&&p.push(H);t.push({chain:x,initialResidue:S,initialInscode:b.substr(25,1),terminalResidue:A,terminalInscode:b.substr(37,1)})}else if("SHEET "===T){for(var x=b.substr(21,1),S=parseInt(b.substr(22,4)),A=parseInt(b.substr(33,4)),z=S;A>=z;++z){var H=x+"_"+z;c.push(H),z===S&&h.push(H),z===A&&l.push(H)}o.push({chain:x,initialResidue:S,initialInscode:b.substr(26,1),terminalResidue:A,terminalInscode:b.substr(37,1)})}else if("HBOND "===T){bCalculateHbond=!1;var _=(b.substr(6,1),b.substr(8,4).replace(/ /g,""),b.substr(14,4).replace(/ /g,""),b.substr(18,1),b.substr(20,4).replace(/ /g,""),b.substr(25,4).replace(/ /g,""),parseFloat(b.substr(30,8))),M=parseFloat(b.substr(38,8)),k=parseFloat(b.substr(46,8)),O=parseFloat(b.substr(54,8)),L=parseFloat(b.substr(62,8)),j=parseFloat(b.substr(70,8));b.substr(78,8).replace(/ /g,"");this.hbondpoints.push(new THREE.Vector3(_,M,k)),this.hbondpoints.push(new THREE.Vector3(O,L,j))}else if("REMARK"===T){var V=parseInt(b.substr(7,3));if(350==V&&"BIOMT"==b.substr(13,5)){var P=parseInt(b[18])-1,D=parseInt(b.substr(21,2));void 0==this.biomtMatrices[D]&&(this.biomtMatrices[D]=(new THREE.Matrix4).identity()),this.biomtMatrices[D].elements[P]=parseFloat(b.substr(24,9)),this.biomtMatrices[D].elements[P+4]=parseFloat(b.substr(34,9)),this.biomtMatrices[D].elements[P+8]=parseFloat(b.substr(44,9)),this.biomtMatrices[D].elements[P+12]=parseFloat(b.substr(54,10))}}else if("ENDMDL"===T)++m;else if("JRNL  "===T)"PMID"===b.substr(12,4)&&(this.pmid=b.substr(19).trim());else if("ATOM  "===T||"HETATM"===T){var F=b.substr(16,1);++v;var I=parseInt(b.substr(6,5));y[I]=v;var N=b.substr(76,2).replace(/ /g,"");""===N&&(N=b.substr(12,2).replace(/ /g,""));var B=b.substr(21,1);""===B&&(B=1);var G=parseInt(b.substr(22,4)),q=b.substr(12,4).replace(/ /g,""),H=B+"_"+G,W=parseFloat(b.substr(30,8)),Y=parseFloat(b.substr(38,8)),U=parseFloat(b.substr(46,8)),X=b.substr(17,3),Z=new THREE.Vector3(W,Y,U),Q={het:"H"===T[0],serial:v,name:q,alt:F,resn:X,structure:m,chain:B,resi:G,coord:Z,b:parseFloat(b.substr(60,8)),elem:N,bonds:[],ss:"coil",ssbegin:!1,ssend:!1};this.atoms[v]=Q,this.displayAtoms[v]=1,this.highlightAtoms[v]=1,-1!==$.inArray(H,d)?(this.atoms[v].ss="helix",-1!==$.inArray(H,u)&&(this.atoms[v].ssbegin=!0),-1!==$.inArray(H,p)&&(this.atoms[v].ssend=!0)):-1!==$.inArray(H,c)&&(this.atoms[v].ss="sheet",-1!==$.inArray(H,h)&&(this.atoms[v].ssbegin=!0),-1!==$.inArray(H,l)&&(this.atoms[v].ssend=!0)),s=m+"_"+B,a=s+"_"+G;var K="-";if("helix"===this.atoms[v].ss?K="H":"sheet"===this.atoms[v].ss?K="E":this.atoms[v].het||(K="C"),this.secondarys[a]=K,a!==f){var J=this.residueName2Abbr(X);if(this.residueId2Name[a]=J,1!==v&&(this.residues[f]=n),n={},s!==E){1!==v&&(this.chains[E]=this.unionHash2Atoms(this.chains[E],r)),r={},void 0===this.structures[m.toString()]&&(this.structures[m.toString()]=[]),this.structures[m.toString()].push(s),void 0===this.chainsSeq[s]&&(this.chainsSeq[s]=[]),void 0===this.chainsAnno[s]&&(this.chainsAnno[s]=[]),void 0===this.chainsAnno[s][0]&&(this.chainsAnno[s][0]=[]),void 0===this.chainsAnno[s][1]&&(this.chainsAnno[s][1]=[]),void 0===this.chainsAnnoTitle[s]&&(this.chainsAnnoTitle[s]=[]),void 0===this.chainsAnnoTitle[s][0]&&(this.chainsAnnoTitle[s][0]=[]),void 0===this.chainsAnnoTitle[s][1]&&(this.chainsAnnoTitle[s][1]=[]);var ee={};ee.resi=G,ee.name=J,this.chainsSeq[s].push(ee);var te="";G%10===0&&(te=G.toString()),this.chainsAnno[s][0].push(te),this.chainsAnno[s][1].push(K),this.chainsAnnoTitle[s][0].push(""),this.chainsAnnoTitle[s][1].push("SS")}else{var ee={};ee.resi=G,ee.name=J,this.chainsSeq[s].push(ee);var te="";G%10===0&&(te=G.toString()),this.chainsAnno[s][0].push(te),this.chainsAnno[s][1].push(K)}}r[v]=1,n[v]=1,g=T,E=s,f=a}else if("CONECT"===T)for(var oe=parseInt(b.substr(6,5)),z=0;4>z;++z){var ie=parseInt(b.substr([11,16,21,26][z],5));isNaN(ie)||void 0!==this.atoms[y[oe]]&&this.atoms[y[oe]].bonds.push(y[ie])}else"TER   "===T&&++v}i=null,this.residues[a]=n,this.chains[s]=this.unionHash2Atoms(this.chains[s],r);var re,ne,se=[],ae=this,ce=function(e){for(var t=se.length,o=0;t>o;++o){for(var i=se[o],r=o+1;t>r;++r){var n=se[r];i.alt===n.alt&&ae.hasCovalentBond(i,n)&&(i.bonds.push(n.serial),n.bonds.push(i.serial))}e&&e(i)}},he=new THREE.Vector3(9999,9999,9999),le=new THREE.Vector3(-9999,-9999,-9999),de=new THREE.Vector3,ue=0;for(var w in this.atoms){var q=this.atoms[w],Z=q.coord;de.add(Z),he.min(Z),le.max(Z),++ue,q.het?q.het&&("HOH"===q.resn||"WAT"===q.resn?this.water[q.serial]=1:-1!==$.inArray(q.resn,this.ionsArray)?this.ions[q.serial]=1:this.ligands[q.serial]=1):-1!==$.inArray(q.resn,this.nucleotidesArray)?(this.nucleotides[q.serial]=1,"P"===q.name&&(this.nucleotidesP[q.serial]=1)):(this.proteins[q.serial]=1,"CA"===q.name&&(this.calphas[q.serial]=1)),(re!==q.chain||ne!==q.resi)&&(ce(function(e){("C"===e.name&&"N"===q.name||"O3'"===e.name&&"P"===q.name)&&ae.hasCovalentBond(e,q)&&(e.bonds.push(q.serial),q.bonds.push(e.serial))}),re=q.chain,ne=q.resi,se.length=0),se.push(q)}ce(),this.pmin=he,this.pmax=le,this.cnt=ue,this.maxD=this.pmax.distanceTo(this.pmin),this.center=de.multiplyScalar(1/this.cnt),this.maxD<25&&(this.maxD=25)},cloneHash:function(e,t){for(var o in e)t[o]=e[o]},residueName2Abbr:function(e){switch(void 0!==e&&" "!==e.charAt(0)&&" "===e.charAt(1)&&(e=e.charAt(0)),e){case"  A":return"A";case"  C":return"C";case"  G":return"G";case"  T":return"T";case"  U":return"U";case"  I":return"I";case"ALA":return"A";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"CYS":return"C";case"GLU":return"E";case"GLN":return"Q";case"GLY":return"G";case"HIS":return"H";case"ILE":return"I";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"THR":return"T";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"SEC":return"U";case"PYL":return"O";default:return e}},calculateLigandHbonds:function(e,t,o){if(0!==Object.keys(e).length&&0!==Object.keys(t).length){var i,r={},n=o*o;for(var s in e){var a=e[s];("N"===a.elem||"O"===a.elem||"F"===a.elem)&&(i=a.structure+"_"+a.chain+"_"+a.resi+"_"+a.name,r[i]=a)}this.highlightAtoms={};for(var s in t){var a=t[s];if("N"===a.elem||"O"===a.elem||"F"===a.elem){i=a.structure+"_"+a.chain+"_"+a.resi+"_"+a.name;for(var c in r){var h=Math.abs(a.coord.x-r[c].coord.x);if(!(h>o)){var l=Math.abs(a.coord.y-r[c].coord.y);if(!(l>o)){var d=Math.abs(a.coord.z-r[c].coord.z);if(!(d>o)){var u=h*h+l*l+d*d;if(!(u>n)){var p=c.indexOf("_"),v=c.lastIndexOf("_"),m=c.substr(0,p),E=c.substr(p+1,v-p-1);v=E.lastIndexOf("_");var f=E.substr(0,v),g=E.substr(v+1);this.hbondpoints.push(a.coord),this.hbondpoints.push(r[c].coord),this.highlightAtoms=this.unionHash(this.highlightAtoms,this.residues[m+"_"+f+"_"+g])}}}}}}}}},createSphere:function(e,t,o,i,r){var n;if(void 0===t&&(t=.8),void 0===o&&(o=!1),void 0===i&&(i=1),2===r){i>.9?i=1.5:.5>i&&(i=1);var s=this.highlightColor;n=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:s}))}else if(1===r)n=new THREE.Mesh(this.sphereGeometry,this.matShader);else{var s=e.color;n=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:s}))}n.scale.x=n.scale.y=n.scale.z=o?t:(this.vdwRadii[e.elem]||t)*(i?i:1),n.position.copy(e.coord),this.mdl.add(n),1===r||2===r?this.prevHighlightObjects.push(n):this.objects.push(n)},createBox:function(e,t,o,i,r,n){var s;void 0===t&&(t=.8),void 0===o&&(o=!1),void 0===i&&(i=.8),n?(void 0===r&&(r=this.highlightColor),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:r}))):(void 0===r&&(r=e.color),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:r}))),s.scale.x=s.scale.y=s.scale.z=o?t:(this.vdwRadii[e.elem]||t)*(i?i:1),s.position.copy(e.coord),this.mdl.add(s),n?this.prevHighlightObjects.push(s):this.objects.push(s)},createCylinder:function(e,t,o,i,r){var n;2===r?(n=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:i})),o*=1.5):n=1===r?new THREE.Mesh(this.cylinderGeometryOutline,this.matShader):new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,color:i})),n.position.copy(e).add(t).multiplyScalar(.5),n.matrixAutoUpdate=!1,n.lookAt(e),n.updateMatrix(),n.matrix.multiply((new THREE.Matrix4).makeScale(o,o,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),this.mdl.add(n),1===r||2===r?this.prevHighlightObjects.push(n):this.objects.push(n)},createRepresentationSub:function(e,t,o){new THREE.Geometry;for(var i in e){var r=e[i];t&&t(r);for(var n in r.bonds){var s=this.atoms[r.bonds[n]];void 0===s||s.serial<r.serial||o&&o(r,s)}}},createSphereRepresentation:function(e,t,o,i,r){var n=this;this.createRepresentationSub(e,function(e){n.createSphere(e,t,o,i,r)})},createBoxRepresentation_P_CA:function(e,t,o){var i=this;this.createRepresentationSub(e,function(e){("CA"===e.name||"P"===e.name)&&i.createBox(e,void 0,void 0,t,void 0,o)})},createStickRepresentation:function(e,t,o,i,r){var n=this;2!==r?this.createRepresentationSub(e,function(e){n.createSphere(e,t,!i,i,r)},function(e,t){var i=e.coord.clone().add(t.coord).multiplyScalar(.5),s=e.serial+"_"+t.serial;if(n.doublebonds.hasOwnProperty(s)){var a,c,h;e.bonds.length>t.bonds.length?(a=e.serial,c=e.bonds[0],h=e.bonds[1]):(a=t.serial,c=t.bonds[0],h=t.bonds[1]);var l=n.atoms[a].coord.clone();l.sub(n.atoms[c].coord);var d=n.atoms[a].coord.clone();d.sub(n.atoms[h].coord),l.cross(d);var u=t.coord.clone();u.sub(e.coord),u.cross(l).normalize().multiplyScalar(.2),e.color===t.color?(n.createCylinder(e.coord.clone().add(u),t.coord.clone().add(u),.3*n.cylinderRadius,e.color,r),n.createCylinder(e.coord.clone().sub(u),t.coord.clone().sub(u),.3*n.cylinderRadius,e.color,r)):(n.createCylinder(e.coord.clone().add(u),i.clone().add(u),.3*n.cylinderRadius,e.color,r),n.createCylinder(t.coord.clone().add(u),i.clone().add(u),.3*n.cylinderRadius,t.color,r),n.createCylinder(e.coord.clone().sub(u),i.clone().sub(u),.3*n.cylinderRadius,e.color,r),n.createCylinder(t.coord.clone().sub(u),i.clone().sub(u),.3*n.cylinderRadius,t.color,r))}else if(n.triplebonds.hasOwnProperty(s)){var p=new THREE.Vector3(Math.random(),Math.random(),Math.random()),v=t.coord.clone();v.sub(e.coord);var m=p.clone();m.cross(v).normalize().multiplyScalar(.3),e.color===t.color?(n.createCylinder(e.coord,t.coord,.2*n.cylinderRadius,e.color,r),n.createCylinder(e.coord.clone().add(m),t.coord.clone().add(m),.2*n.cylinderRadius,e.color,r),n.createCylinder(e.coord.clone().sub(m),t.coord.clone().sub(m),.2*n.cylinderRadius,e.color,r)):(n.createCylinder(e.coord,i,.2*n.cylinderRadius,e.color,r),n.createCylinder(t.coord,i,.2*n.cylinderRadius,t.color,r),n.createCylinder(e.coord.clone().add(m),i.clone().add(m),.2*n.cylinderRadius,e.color,r),n.createCylinder(t.coord.clone().add(m),i.clone().add(m),.2*n.cylinderRadius,t.color,r),n.createCylinder(e.coord.clone().sub(m),i.clone().sub(m),.2*n.cylinderRadius,e.color,r),n.createCylinder(t.coord.clone().sub(m),i.clone().sub(m),.2*n.cylinderRadius,t.color,r))}else e.color===t.color?n.createCylinder(e.coord,t.coord,o,e.color,r):(n.createCylinder(e.coord,i,o,e.color,r),n.createCylinder(t.coord,i,o,t.color,r))}):2===r&&this.createBoxRepresentation_P_CA(e,1.2,r)},createLineRepresentation:function(e,t){var o=new THREE.Geometry;if(this.createRepresentationSub(e,void 0,function(e,t){if(e.color===t.color)o.vertices.push(e.coord),o.vertices.push(t.coord),o.colors.push(e.color),o.colors.push(t.color);else{var i=e.coord.clone().add(t.coord).multiplyScalar(.5);o.vertices.push(e.coord),o.vertices.push(i),o.vertices.push(t.coord),o.vertices.push(i),o.colors.push(e.color),o.colors.push(e.color),o.colors.push(t.color),o.colors.push(t.color)}}),2!==t){var i;1===t||(i=new THREE.Line(o,new THREE.LineBasicMaterial({linewidth:this.linewidth,vertexColors:!0}),THREE.LinePieces)),this.mdl.add(i),1===t?this.prevHighlightObjects.push(i):this.objects.push(i)}else 2===t&&this.createBoxRepresentation_P_CA(e,.8,t)},subdivide:function(e,t,o,i){var r=[],n=[],s=new Array;s.push(e[0]);for(var a=1,c=e.length-1;c>a;++a){var h=e[a],l=e[a+1];s.push(h.smoothen?h.clone().add(l).multiplyScalar(.5):h)}s.push(e[e.length-1]);for(var d=[],u=[],a=-1,p=s.length,v=1/t;p-3>=a;++a){var h=s[-1===a?0:a],l=s[a+1],m=s[a+2],E=s[a===p-3?p-1:a+3],f=m.clone().sub(h).multiplyScalar(.5),g=E.clone().sub(l).multiplyScalar(.5);a>-1&&void 0!==o&&o[a+1]&&(r=r.concat(d),n=n.concat(u)),d=[],u=[];for(var y=0;t>y;++y){var w=v*y,b=l.x+w*f.x+w*w*(-3*l.x+3*m.x-2*f.x-g.x)+w*w*w*(2*l.x-2*m.x+f.x+g.x),T=l.y+w*f.y+w*w*(-3*l.y+3*m.y-2*f.y-g.y)+w*w*w*(2*l.y-2*m.y+f.y+g.y),R=l.z+w*f.z+w*w*(-3*l.z+3*m.z-2*f.z-g.z)+w*w*w*(2*l.z-2*m.z+f.z+g.z);o?(o[a+1]&&y<=parseInt(t/2)&&(r.push(new THREE.Vector3(b,T,R)),n.push(o[a+1])),o[a+2]&&y>parseInt(t/2)&&(d.push(new THREE.Vector3(b,T,R)),u.push(o[a+2]))):(r.push(new THREE.Vector3(b,T,R)),n.push(a+1))}}return(!o||o[a+1])&&(r=r.concat(d),n=n.concat(u),r.push(s[s.length-1]),n.push(s.length-1)),points_positions=[],points_positions.push(r),points_positions.push(n),points_positions},createCurveSubArrow:function(e,t,o,i,r,n,s,a,c,h,l){var d=[],u=[];d.push(e),u.push(a),this.prepareStrand(d,u,t,o,i,void 0,r,n,s,c,h,!1,l)},createCurveSub:function(e,t,o,i,r,n,s,a,c){if(0!==e.length){i=i||5;var h;if(h=s?e:this.subdivide(e,i,a,r)[0],0!==h.length){var l=new THREE.Geometry;if(2===r&&n)for(var d=0,u=1/i;d<h.length;++d)h[d].addScalar(.6),l.vertices.push(h[d]),l.colors.push(new THREE.Color(o[0===d?0:Math.round((d-1)*u)]));else if(1===r){var p=this.coilWidth/2,v=32,m=!1;if(h.length>1)if(void 0!==c)for(var E,f,g=[],d=0,y=h.length;y>d;++d){if(E=c[d],E!==f&&E!==f+1&&void 0!==f||d===y-1){var w=new THREE.TubeGeometry(new THREE.SplineCurve3(g),g.length,p,v,m);mesh=new THREE.Mesh(w,this.matShader),this.mdl.add(mesh),this.prevHighlightObjects.push(mesh),g=[]}g.push(h[d]),f=E}else{var w=new THREE.TubeGeometry(new THREE.SplineCurve3(h),h.length,p,v,m);mesh=new THREE.Mesh(w,this.matShader),this.mdl.add(mesh),this.prevHighlightObjects.push(mesh)}}else for(var d=0,u=1/i;d<h.length;++d)l.vertices.push(h[d]),l.colors.push(new THREE.Color(o[0===d?0:Math.round((d-1)*u)]));var b=new THREE.Line(l,new THREE.LineBasicMaterial({linewidth:t,vertexColors:!0}),THREE.LineStrip);this.mdl.add(b),2===r?this.prevHighlightObjects.push(b):this.objects.push(b)}}},createLines:function(e){if(void 0!==e)for(var t in e){var o,i=e[t],r=i.position1,n=i.position2;if(i.color){var s=/^\#([0-9a-f]{6})$/i.exec(i.color);o=parseInt(s[1],16)}else o=16776960;var a=i.dashed?i.dashed:!1,c=.3;this.mdl.add(this.createSingleLine(r,n,o,a,c))}},createCylinderCurve:function(e,t,o,i,r){var n,s,a,c=null;for(a in e){var h=e[a];if(!h.het&&h.name===t){if(null!==c&&n===h.chain&&s+1===h.resi){var l=c.coord.clone().add(h.coord).multiplyScalar(.5);if(r)1===r&&(this.createCylinder(c.coord,l,o,c.color,r),this.createCylinder(l,h.coord,o,h.color,r),this.createSphere(h,o,!0,1,r));else if(i){var d=this.createSingleLine(c.coord,l,c.color,!1);this.mdl.add(d),this.objects.push(d),d=this.createSingleLine(l,h.coord,h.color,!1),this.mdl.add(d),this.objects.push(d)}else this.createCylinder(c.coord,l,o,c.color),this.createCylinder(l,h.coord,o,h.color),this.createSphere(h,o,!0,1)}c=h,n=h.chain,s=h.resi,2===r&&this.createBox(h,void 0,void 0,void 0,void 0,r)}}if(null!==c&&n===h.chain&&s+1===h.resi){var l=c.coord.add(h.coord).multiplyScalar(.5);if(r)1===r&&(this.createCylinder(c.coord,l,o,c.color,r),this.createCylinder(l,h.coord,o,h.color,r),this.createSphere(h,o,!0,1,r));else if(i){var d=this.createSingleLine(c.coord,l,c.color,!1);this.mdl.add(d),this.objects.push(d),d=this.createSingleLine(l,h.coord,h.color,!1),this.mdl.add(d),this.objects.push(d)}else this.createCylinder(c.coord,l,o,c.color),this.createCylinder(l,h.coord,o,h.color)}},prepareStrand:function(e,t,o,i,r,n,s,a,c,h,l,d,u){if(1!==h.length){r=r||this.axisDIV;for(var p,v,m,E,f=2/(c-1),g={},y=[],w=0,b=t.length;b>w;++w)g[w]=[];var T=this.subdivide(h,r)[0];if(1!==T.length){for(var w=0,b=h.length-2;b>w;++w){for(var R=0,C=t.length;C>R;++R)g[R].push(e[R][w]);y.push(i[w])}y.push(i[w]);for(var w=0,b=t.length;b>w;++w)p=-1+f*t[w],v=T.length-1-r,m=h.length-2,E=new THREE.Vector3(T[v].x+l[m].x*p,T[v].y+l[m].y*p,T[v].z+l[m].z*p),g[w].push(E);for(var H=[],w=0,b=t.length;b>w;++w){var x=this.subdivide(g[w],r,u,s);g[w]=x[0],0===w&&(H=x[1])}d?this.createStrip(g[0],g[1],y,r,n,s,!0,void 0,H):this.createCurveSub(g[0],o,y,r,s,a,!0,void 0,H);for(var w=0,b=t.length;b>w;++w)g[w]=[];y=[],H=[];for(var R=0,C=t.length;C>R;++R){g[R]=[];for(var w=r*(h.length-2),b=r*(h.length-1);u[parseInt(w/r)]&&b>w;w+=r)for(var S=parseInt(w/r),A=0;r>A;++A){var p=-1+f*t[R],z=1.8;p=p*z*(r-A)/r;var _=parseInt(w/r),E=new THREE.Vector3(T[w+A].x+l[_].x*p,T[w+A].y+l[_].y*p,T[w+A].z+l[_].z*p);E.smoothen=!0,g[R].push(E),0===R&&H.push(S)}var p=0,v=T.length-1,m=h.length-1,E=new THREE.Vector3(T[v].x+l[m].x*p,T[v].y+l[m].y*p,T[v].z+l[m].z*p);E.smoothen=!0,g[R].push(E),0===R&&H.push(v)}y.push(i[i.length-2]),y.push(i[i.length-1]),d?this.createStrip(g[0],g[1],y,r,n,s,!0,void 0,H):this.createCurveSub(g[0],o,y,r,s,a,!0,void 0,H)}}},createStripArrow:function(e,t,o,i,r,n,s,a,c,h,l,d){var u=[],p=[];u.push(e),u.push(t),p.push(a),p.push(c),this.prepareStrand(u,p,void 0,o,i,r,n,void 0,s,h,l,!0,d)},createStrip:function(e,t,o,i,r,n,s,a,c){if(!(e.length<2||(i=i||this.axisDIV,s||(e=this.subdivide(e,i,a,n)[0],t=this.subdivide(t,i,a,n)[0]),e.length<2))){for(var h,l,d,u,p,v=new THREE.Geometry,m=v.vertices,E=v.faces,f=0,g=e.length;g>f;++f)m.push(l=e[f]),m.push(l),m.push(d=t[f]),m.push(d),g-1>f&&(h=t[f].clone().sub(e[f]).cross(e[f+1].clone().sub(e[f])).normalize().multiplyScalar(r)),m.push(u=e[f].clone().add(h)),m.push(u),m.push(p=t[f].clone().add(h)),m.push(p);for(var y=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]],f=1,g=e.length,w=1/i;g>f;++f)for(var b=8*f,T=new THREE.Color(o[Math.round((f-1)*w)]),R=0;4>R;++R)E.push(new THREE.Face3(b+y[R][0],b+y[R][1],b+y[R][2],void 0,T)),E.push(new THREE.Face3(b+y[R][3],b+y[R][0],b+y[R][2],void 0,T));for(var C=m.length-8,f=0;4>f;++f)m.push(m[2*f]),m.push(m[C+2*f]);C+=8,E.push(new THREE.Face3(C,C+2,C+6,void 0,E[0].color)),E.push(new THREE.Face3(C+4,C,C+6,void 0,E[0].color)),E.push(new THREE.Face3(C+1,C+5,C+7,void 0,E[E.length-3].color)),E.push(new THREE.Face3(C+3,C+1,C+7,void 0,E[E.length-3].color)),v.computeFaceNormals(),v.computeVertexNormals(!1);var H;if(2===n)H=new THREE.Mesh(v,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(H),this.prevHighlightObjects.push(H);else if(1===n){var x=this.coilWidth/2,S=32,A=!1;if(void 0!==c)for(var z,_,M=[],k=[],f=0,O=e.length;O>f;++f){if(z=c[f],z!==_&&z!==_+1&&void 0!==_||f===O-1){var L=new THREE.TubeGeometry(new THREE.SplineCurve3(M),M.length,x,S,A);H=new THREE.Mesh(L,this.matShader),this.mdl.add(H),this.prevHighlightObjects.push(H);var j=new THREE.TubeGeometry(new THREE.SplineCurve3(k),k.length,x,S,A);H=new THREE.Mesh(j,this.matShader),this.mdl.add(H),this.prevHighlightObjects.push(H),M=[],k=[]}M.push(e[f]),k.push(t[f]),_=z}else{var L=new THREE.TubeGeometry(new THREE.SplineCurve3(e),e.length,x,S,A);H=new THREE.Mesh(L,this.matShader),this.mdl.add(H),this.prevHighlightObjects.push(H);var j=new THREE.TubeGeometry(new THREE.SplineCurve3(t),t.length,x,S,A);H=new THREE.Mesh(j,this.matShader),this.mdl.add(H),this.prevHighlightObjects.push(H)}}else H=new THREE.Mesh(v,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(H),this.objects.push(H)}},createBrick:function(e,t){for(var o=new THREE.Geometry,i=0,r=e.length;r>i;++i)o.vertices.push(new THREE.Vector3(e[i][0],e[i][1],e[i][2]));o.faces=[new THREE.Face3(1,5,7,void 0,t),new THREE.Face3(1,7,3,void 0,t),new THREE.Face3(0,2,6,void 0,t),new THREE.Face3(0,6,4,void 0,t),new THREE.Face3(2,3,7,void 0,t),new THREE.Face3(2,7,6,void 0,t),new THREE.Face3(0,4,5,void 0,t),new THREE.Face3(0,5,1,void 0,t),new THREE.Face3(4,6,7,void 0,t),new THREE.Face3(4,7,5,void 0,t),new THREE.Face3(0,1,3,void 0,t),new THREE.Face3(0,3,2,void 0,t)],o.computeFaceNormals(),o.computeVertexNormals(!1);
var n;n=new THREE.Mesh(o,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(n),this.objects.push(n)},getFirstAtomObj:function(e){var t=Object.keys(e),o=t[0];return this.atoms[o]},getLastAtomObj:function(e){var t=Object.keys(e),o=t[t.length-1];return this.atoms[o]},createStrand:function(e,t,o,i,r,n,s,a,c){var h=i?!0:!1,l={};if(1===c||2===c){var d,u,p,v,m,E,f,g,y=0,w=Object.keys(e).length;this.cloneHash(e,l);for(var b in e){if(d=e[b].structure+"_"+e[b].chain,u=parseInt(e[b].resi),p=e[b],void 0===v&&(f=e[b]),d!==v&&void 0!==v||u!==m&&u!==m+1&&void 0!==m||y===w-1){d!==v&&void 0!==v||u!==m&&u!==m+1&&void 0!==m?g=E:y===w-1&&(g=p);var T=f.resi;if("coil"!==f.ss&&!f.ssbegin){for(var R=f.resi-1;R>0;--R){var C=f.structure+"_"+f.chain+"_"+R;if(!this.residues.hasOwnProperty(C))break;var H=this.getFirstAtomObj(this.residues[C]);if(H.ss===f.ss&&H.ssbegin){T=H.resi;break}}for(var R=T;R<f.resi;++R){var C=f.structure+"_"+f.chain+"_"+R;l=this.unionHash(l,this.hash2Atoms(this.residues[C]))}}if(1===c&&"coil"===f.ss){var C=f.structure+"_"+f.chain+"_"+(f.resi-1);this.residues.hasOwnProperty(C)&&(l=this.unionHash(l,this.hash2Atoms(this.residues[C])),e=this.unionHash(e,this.hash2Atoms(this.residues[C])))}var x=g.resi;if("coil"!==g.ss&&!g.ssend&&!g.notshow){for(var S=this.getLastAtomObj(this.chains[g.structure+"_"+g.chain]).resi,R=g.resi+1;S>=R;++R){var C=g.structure+"_"+g.chain+"_"+R;if(!this.residues.hasOwnProperty(C))break;var H=this.getFirstAtomObj(this.residues[C]);if(H.ss===g.ss&&H.ssend){x=H.resi;break}}for(var R=g.resi+1;x>=R;++R){var C=g.structure+"_"+g.chain+"_"+R;l=this.unionHash(l,this.hash2Atoms(this.residues[C]))}}if(1===c&&"coil"===g.ss){var C=g.structure+"_"+g.chain+"_"+(g.resi+1);this.residues.hasOwnProperty(C)&&(l=this.unionHash(l,this.hash2Atoms(this.residues[C])),e=this.unionHash(e,this.hash2Atoms(this.residues[C])))}g.notshow&&(g.notshow=void 0),f=p}v=d,m=u,E=p,++y}}else l=e;2===c&&(i?(i=!1,t=null,o=null,r=null,n=null,a=void 0):(i=!0,t=2,o=void 0,r=void 0,n=void 0,a=this.thickness)),t=t||this.strandDIV,o=o||this.axisDIV,r=r||this.coilWidth,s=s||!1,n=n||this.helixSheetWidth;for(var A={},z=0;t>z;++z)A[z]=[];var _,M,k,H,O=[],L=[],j=[],V=[],P=null,D=null,F=null,I=null,N=null,B=null,G=null,$=null,q=!1,W=null,Y=null,m=null,U=!1,X=!1,Z={};this.bCalphaOnly=!1;var y=0,Q=30,K=!1;for(var R in l){if(!(Q>y))break;if("CA"!==l[R].name){K=!0;break}++y}K||(this.bCalphaOnly=!0);var J=this.hash2Atoms(l),ee={};for(var R in J){var H=J[R];C=H.structure+"_"+H.chain+"_"+H.resi,ee[C]=1}var te=Object.keys(ee).length,oe=0,ie=0;for(var R in l){H=l[R];if(("O"===H.name||"CA"===H.name)&&!H.het&&("CA"===H.name&&(e.hasOwnProperty(R)&&("coil"===H.ss||H.ssend||H.ssbegin)&&(Z[R]=H),P=H.coord.clone(),F=H.color),"O"===H.name||this.bCalphaOnly&&"CA"===H.name)){"O"===H.name&&(D=H.coord.clone());var re=!0;if((_!==H.chain||M+1!==H.resi)&&(re=!1),H.ssend&&"sheet"===H.ss?U=!0:H.ssend&&"helix"===H.ss&&(X=!0),N){1===c||2===c?V.push(this.highlightColor):V.push(B),k="coil"!==$&&"coil"===H.ss?r:q&&H.ssbegin?r:"coil"===$?r:n;var ne;"O"===H.name?(ne=N.clone(),ne.sub(I)):this.bCalphaOnly&&"CA"===H.name&&(ne=new THREE.Vector3(Math.random(),Math.random(),Math.random())),ne.normalize(),ne.multiplyScalar(k),null!==G&&ne.dot(G)<0&&ne.negate(),G=ne;for(var se=0,ae=2/(t-1);t>se;++se){var ce=-1+ae*se,he=new THREE.Vector3(I.x+G.x*ce,I.y+G.y*ce,I.z+G.z*ce);s||"coil"===$||(he.smoothen=!0),A[se].push(he)}O.push(I),L.push(G),e.hasOwnProperty(Y)?(j.push(m),++ie):j.push(0),++oe}if((H.ssbegin||H.ssend||oe===te-1)&&A[0].length>0&&re){1===c||2===c?V.push(this.highlightColor):V.push(H.color),k=H.ssend&&"sheet"===H.ss?0:"coil"===$&&H.ssbegin?r:q&&H.ssbegin?r:"coil"===H.ss?r:n;var ne;"O"===H.name?(ne=D.clone(),ne.sub(P)):this.bCalphaOnly&&"CA"===H.name&&(ne=new THREE.Vector3(Math.random(),Math.random(),Math.random())),ne.normalize(),ne.multiplyScalar(k),null!==G&&ne.dot(G)<0&&ne.negate(),G=ne;for(var se=0,ae=2/(t-1);t>se;++se){var ce=-1+ae*se,he=new THREE.Vector3(P.x+G.x*ce,P.y+G.y*ce,P.z+G.z*ce);s||"coil"===$||(he.smoothen=!0),A[se].push(he)}W=H.serial,O.push(P),L.push(G),e.hasOwnProperty(W)?j.push(H.resi):j.push(0);for(var se=0;!i&&t>se;++se)U?this.createCurveSubArrow(A[se],1,V,o,c,h,t,se,O,L,j):this.createCurveSub(A[se],1,V,o,c,h,!1,j);if(i)if(U){var le=0,de=t-1;this.createStripArrow(A[0],A[t-1],V,o,a,c,t,le,de,O,L,j)}else X?this.createStrip(A[0],A[t-1],V,o,a,c,!1,j):2===c&&this.createStrip(A[0],A[t-1],V,o,a,c,!1,j);for(var z=0;t>z;++z)A[z]=[];V=[],O=[],L=[],j=[],U=!1,X=!1}if((_!==H.chain||M+1!==H.resi)&&A[0].length>0){for(var se=0;!i&&t>se;++se)U?this.createCurveSubArrow(A[se],1,V,o,c,h,t,se,O,L,j):X&&this.createCurveSub(A[se],1,V,o,c,h,!1,j);if(i)if(U){var le=0,de=t-1;this.createStripArrow(A[0],A[t-1],V,o,a,c,t,le,de,O,L,j)}else X&&this.createStrip(A[0],A[t-1],V,o,a,c,!1,j);for(var z=0;t>z;++z)A[z]=[];V=[],O=[],L=[],j=[],U=!1,X=!1}_=H.chain,M=H.resi,$=H.ss,q=H.ssend,Y=H.serial,m=H.resi,I=P,N=H.coord,B=F}}this.createTube(Z,"CA",.3,c)},createStrandBrick:function(e,t,o){for(var i=this.strandDIV,r=this.axisDIV,n=!1,s=this.helixSheetWidth,a={},c=0;i>c;++c)a[c]=[];for(var h=[],l=null,d=0;2>d;++d){var u=e.coords[d];h.push(new THREE.Color(t));var p=new THREE.Vector3(e.coords[2].x,e.coords[2].y,e.coords[2].z);p.normalize(),p.multiplyScalar(s),null!==l&&p.dot(l)<0&&p.negate(),l=p;for(var v=0,m=2/(i-1);i>v;++v){var E=-1+m*v,f=new THREE.Vector3(u.x+l.x*E,u.y+l.y*E,u.z+l.z*E);n||(f.smoothen=!0),a[v].push(f)}}this.createStrip(a[0],a[i-1],h,r,o)},createTubeSub:function(e,t,o,i){if(!(e.length<2)){for(var r,n=this.tubeDIV,s=this.axisDIV,a=1/n,c=1/s,h=new THREE.Geometry,l=this.subdivide(e,s)[0],d=new THREE.Vector3,u=0,p=l.length;p>u;++u){var v,m=(u-1)*c;if(0===u)v=o[0];else if(m%1===0)v=o[m];else{var E=Math.floor(m),f=m-E;v=o[E]*f+o[E+1]*(1-f)}var g,y,w;p-1>u?(g=l[u].clone().sub(l[u+1]),y=new THREE.Vector3(0,-g.z,g.y).normalize().multiplyScalar(v),w=g.clone().cross(y).normalize().multiplyScalar(v),d.dot(y)<0&&(y.negate(),w.negate()),d=y,r=w):(y=d,w=r);for(var b=0;n>b;++b){var T=2*Math.PI*a*b;h.vertices.push(l[u].clone().add(y.clone().multiplyScalar(Math.cos(T))).add(w.clone().multiplyScalar(Math.sin(T))))}}for(var R=0,u=0,p=l.length-1;p>u;++u){var C=new THREE.Color(t[Math.round((u-1)*c)]),H=0,x=h.vertices[R].clone().sub(h.vertices[R+n]).lengthSq(),S=h.vertices[R].clone().sub(h.vertices[R+n+1]).lengthSq();x>S&&(x=S,H=1);for(var b=0;n>b;++b)h.faces.push(new THREE.Face3(R+b,R+(b+H)%n+n,R+(b+1)%n,void 0,C)),h.faces.push(new THREE.Face3(R+(b+1)%n,R+(b+H)%n+n,R+(b+H+1)%n+n,void 0,C));R+=n}h.computeFaceNormals(),h.computeVertexNormals(!1);var A;A=2===i?new THREE.Mesh(h,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})):1===i?new THREE.Mesh(h,this.matShader):new THREE.Mesh(h,new THREE.MeshPhongMaterial({metal:!1,overdraw:this.overdraw,specular:this.fractionOfColor,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(A),1===i||2===i?this.prevHighlightObjects.push(A):this.objects.push(A)}},createTube:function(e,t,o,i){var r,n,s=[],a=[],c=[];for(var h in e){var l=e[h];if(l.name===t&&!l.het){(r!==l.chain||n+1!==l.resi)&&(2!==i&&this.createTubeSub(s,a,c,i),s=[],a=[],c=[]),s.push(l.coord),c.push(o||(l.b>0?.01*l.b:.3)),a.push(l.color),r=l.chain,n=l.resi;var d=1.2;2!==i||l.ssbegin||this.createBox(l,void 0,void 0,d,void 0,i)}}2!==i&&this.createTubeSub(s,a,c,i)},createCylinderHelix:function(e,t,o){var i,r,n,s=null,a={},c={};for(n in e){var h=e[n];h.het||(("helix"!==h.ss&&"sheet"!==h.ss||h.ssend||h.ssbegin)&&(a[h.serial]=h),"sheet"===h.ss&&(c[h.serial]=h),"CA"===h.name&&("helix"===h.ss&&h.ssend&&(null!==s&&i===h.chain&&r<h.resi&&(1===o||2===o?this.createCylinder(s.coord,h.coord,t,this.highlightColor,o):this.createCylinder(s.coord,h.coord,t,h.color)),s=null),null===s&&"helix"===h.ss&&h.ssbegin&&(s=h,i=h.chain,r=h.resi)))}1===o||2===o?(Object.keys(a).length>0&&this.createTube(a,"CA",.3,o),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.thickness,o)):(Object.keys(a).length>0&&this.createTube(a,"CA",.3),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.thickness))},createSurfaceRepresentation:function(e,t,o,i){var r,n=this.getExtent(e),s=5,a=[];a=this.bConsiderNeighbors?Object.keys(this.unionHash(e,this.getAtomsWithinAtom(this.atoms,e,s))):Object.keys(e);var c=$3Dmol.SetupSurface({extent:n,allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:a,type:t}),h=c.vertices,l=c.faces,d=this;r=new THREE.Geometry,r.vertices=h.map(function(e){var t=new THREE.Vector3(e.x,e.y,e.z);return t.atomid=e.atomid,t}),r.faces=l.map(function(e){return new THREE.Face3(e.a,e.b,e.c)}),c=null,h=null,l=null,r.computeFaceNormals(),r.computeVertexNormals(!1),r.colorsNeedUpdate=!0,r.faces.forEach(function(e){e.vertexColors=["a","b","c"].map(function(t){var o=r.vertices[e[t]].atomid;return d.atoms[o].color})});var u=new THREE.Mesh(r,new THREE.MeshLambertMaterial({overdraw:d.overdraw,vertexColors:THREE.VertexColors,wireframe:o,opacity:i,transparent:!0}));d.mdl.add(u),this.prevSurfaces.push(u),r=null},drawNucleicAcidStick:function(e,t){var o,i,r,n=null,s=null;for(r in e){var a=e[r];void 0===a||a.het||((a.resi!==i||a.chain!==o)&&(null!==n&&null!==s&&this.createCylinder(new THREE.Vector3(n.coord.x,n.coord.y,n.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),.3,n.color,t),n=null,s=null),"O3'"===a.name&&(n=a),"  A"===a.resn||"  G"===a.resn||" DA"===a.resn||" DG"===a.resn?"N1"===a.name&&(s=a):"N3"===a.name&&(s=a),i=a.resi,o=a.chain)}null!==n&&null!==s&&this.createCylinder(new THREE.Vector3(n.coord.x,n.coord.y,n.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),.3,n.color,t)},drawCartoonNucleicAcid:function(e,t,o,i){this.drawStrandNucleicAcid(e,2,t,!0,void 0,o,i)},drawStrandNucleicAcid:function(e,t,o,i,r,n,s){2===s&&(t=void 0,n=void 0),r=r||this.nucleicAcidWidth,o=o||this.axisDIV,t=t||this.nucleicAcidStrandDIV;var a,c,h,l=[];for(h=0;t>h;h++)l[h]=[];var d,u,p,v=[],m=null;for(a in e){var E=e[a];if(void 0!==E&&("O3'"===E.name||"OP2"===E.name)&&!E.het)if("O3'"===E.name){if(d!==E.chain||u+1!==E.resi){if(p&&m)for(c=0;t>c;c++){var f=-1+2/(t-1)*c;l[c].push(new THREE.Vector3(p.x+m.x*f,p.y+m.y*f,p.z+m.z*f))}for(i&&this.createStrip(l[0],l[1],v,o,n,s),c=0;!n&&t>c;c++)this.createCurveSub(l[c],1,v,o,s);var l=[];for(h=0;t>h;h++)l[h]=[];v=[],m=null}p=new THREE.Vector3(E.coord.x,E.coord.y,E.coord.z),d=E.chain,u=E.resi,1===s||2===s?v.push(this.highlightColor):v.push(E.color)}else{if(!p){m=null;continue}var g=new THREE.Vector3(E.coord.x,E.coord.y,E.coord.z);for(g.sub(p),g.normalize().multiplyScalar(r),null!==m&&g.dot(m)<0&&g.negate(),m=g,c=0;t>c;c++){var f=-1+2/(t-1)*c;l[c].push(new THREE.Vector3(p.x+m.x*f,p.y+m.y*f,p.z+m.z*f))}p=null}}if(p&&m)for(c=0;t>c;c++){var f=-1+2/(t-1)*c;l[c].push(new THREE.Vector3(p.x+m.x*f,p.y+m.y*f,p.z+m.z*f))}for(i&&this.createStrip(l[0],l[1],v,o,n,s),c=0;!n&&t>c;c++)this.createCurveSub(l[c],1,v,o,s)},drawSymmetryMates2:function(){if(void 0!==this.biomtMatrices){for(var e=1,t=this.center.clone(),o=0;o<this.biomtMatrices.length;o++){var i=this.biomtMatrices[o];if(void 0!==i){var r=i.toArray(),n=1;for(var s in r)0==s||5==s||10==s?1e3!=parseInt(1e3*r[s])&&(n=0):0!=s&&5!=s&&10!=s&&15!=s&&0!=parseInt(1e3*r[s])&&(n=0);if(!n){var a=this.mdl.clone();a.applyMatrix(i);var c=this.center.clone();c.applyMatrix4(i),t.add(c),this.mdl.add(a),++e}}}this.maxD*=Math.sqrt(e),this.mdl.position.add(this.center).sub(t.multiplyScalar(1/e)),this.setCamera()}},makeTextSprite:function(e,t){void 0===t&&(t={});var o=t.hasOwnProperty("fontface")?t.fontface:"Arial",i=t.hasOwnProperty("fontsize")?t.fontsize:18,r=t.hasOwnProperty("borderThickness")?t.borderThickness:4,n=1,s=t.hasOwnProperty("borderColor")?this.hexToRgb(t.borderColor,n):{r:0,g:0,b:0,a:1},a=t.hasOwnProperty("backgroundColor")?this.hexToRgb(t.backgroundColor,n):{r:0,g:0,b:0,a:.5};n=1;var c=t.hasOwnProperty("textColor")?this.hexToRgb(t.textColor,n):{r:255,g:255,b:0,a:1},h=document.createElement("canvas"),l=h.getContext("2d");l.font="Bold "+i+"px "+o;var d=l.measureText(e),u=d.width,p=l.measureText("M").width;l.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",l.strokeStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",l.lineWidth=r,this.roundRect(l,r/2,r/2,1.1*(u+r),1.4*i+r,.3*p),l.fillStyle="rgba("+c.r+", "+c.g+", "+c.b+", 1.0)",l.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", 1.0)",l.fillText(e,r+.1*i,i+r);var v=new THREE.Texture(h);v.needsUpdate=!0;var m=!0,E=new THREE.SpriteMaterial({map:v,useScreenCoordinates:!1,depthTest:!m,depthWrite:!m}),f=new THREE.Sprite(E),g=this.maxD/100;return f.scale.set(16*g,8*g,1),f},hexToRgb:function(e,t){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16),a:t}:null},roundRect:function(e,t,o,i,r,n){e.beginPath(),e.moveTo(t+n,o),e.lineTo(t+i-n,o),e.quadraticCurveTo(t+i,o,t+i,o+n),e.lineTo(t+i,o+r-n),e.quadraticCurveTo(t+i,o+r,t+i-n,o+r),e.lineTo(t+n,o+r),e.quadraticCurveTo(t,o+r,t,o+r-n),e.lineTo(t,o+n),e.quadraticCurveTo(t,o,t+n,o),e.closePath(),e.fill(),e.stroke()},createLabelRepresentation:function(e){for(var t in e){var o=e[t],i=o.size?o.size:this.LABELSIZE,r=o.color?o.color:"#ffff00",n=o.background?o.background:"#cccccc",s=this.makeTextSprite(o.text,{fontsize:parseInt(i),textColor:r,borderColor:n,backgroundColor:n});s.position.set(o.position.x,o.position.y,o.position.z),this.mdl.add(s)}},getAtomsWithinAtom:function(e,t,o){var i=this.getExtent(t),r=(i[2][0]-i[0][0])*(i[2][0]-i[0][0])+(i[2][1]-i[0][1])*(i[2][1]-i[0][1])+(i[2][2]-i[0][2])*(i[2][2]-i[0][2]),n=(i[2][0]-i[1][0])*(i[2][0]-i[1][0])+(i[2][1]-i[1][1])*(i[2][1]-i[1][1])+(i[2][2]-i[1][2])*(i[2][2]-i[1][2]),s=r>n?r:n,a=Math.sqrt(s),c=(a+o)*(a+o),h={};for(var l in e){var d=e[l];if(!(d.serial in t||d.coord.x<i[0][0]-o||d.coord.x>i[1][0]+o||d.coord.y<i[0][1]-o||d.coord.y>i[1][1]+o||d.coord.z<i[0][2]-o||d.coord.z>i[1][2]+o)){var u=(d.coord.x-i[2][0])*(d.coord.x-i[2][0])+(d.coord.y-i[2][1])*(d.coord.y-i[2][1])+(d.coord.z-i[2][2])*(d.coord.z-i[2][2]);c>u&&(h[d.serial]=d)}}var p={};for(var l in t){var v=t[l],m=this.vdwRadii[v.elem]||this.defaultRadius;for(var E in h){var d=h[E],u=(d.coord.x-v.coord.x)*(d.coord.x-v.coord.x)+(d.coord.y-v.coord.y)*(d.coord.y-v.coord.y)+(d.coord.z-v.coord.z)*(d.coord.z-v.coord.z);c=(m+o)*(m+o),c>u&&(p[d.serial]=d)}}return p},getExtent:function(e){var t,o=ymin=zmin=9999,i=ymax=zmax=-9999,r=ysum=zsum=cnt=0;for(t in e){var n=e[t];cnt++,r+=n.coord.x,ysum+=n.coord.y,zsum+=n.coord.z,o=o<n.coord.x?o:n.coord.x,ymin=ymin<n.coord.y?ymin:n.coord.y,zmin=zmin<n.coord.z?zmin:n.coord.z,i=i>n.coord.x?i:n.coord.x,ymax=ymax>n.coord.y?ymax:n.coord.y,zmax=zmax>n.coord.z?zmax:n.coord.z}return[[o,ymin,zmin],[i,ymax,zmax],[r/cnt,ysum/cnt,zsum/cnt]]},getAtomsFromPosition:function(e,t){var o,i;(void 0===t||null===t)&&(t=1);for(o in this.atoms){var i=this.atoms[o];if(!(i.coord.x<e.x-t||i.coord.x>e.x+t||i.coord.y<e.y-t||i.coord.y>e.y+t||i.coord.z<e.z-t||i.coord.z>e.z+t))return i}return null},buildAxes:function(e){var t=new THREE.Object3D;t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0+e,0,0),16711680,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0-e,0,0),8388608,!0,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0+e,0),65280,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0-e,0),32768,!0,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0+e),255,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0-e),128,!0,.5)),this.scene.add(t)},createSingleLine:function(e,t,o,i,r){var n,s=new THREE.Geometry;n=i?new THREE.LineDashedMaterial({linewidth:1,color:o,dashSize:r,gapSize:r}):new THREE.LineBasicMaterial({linewidth:1,color:o}),s.vertices.push(e),s.vertices.push(t),i&&s.computeLineDistances();var a=new THREE.Line(s,n,THREE.LinePieces);return a},intersectHash:function(e,t){var o={};if(Object.keys(e).length<Object.keys(t).length)for(var i in e)void 0!==t&&t[i]&&(o[i]=e[i]);else for(var i in t)void 0!==e&&e[i]&&(o[i]=t[i]);return o},excludeHash:function(e,t){var o={};for(var i in e)i in t||(o[i]=e[i]);return o},unionHash:function(e,t){return jQuery.extend({},e,t)},intersectHash2Atoms:function(e,t){return this.hash2Atoms(this.intersectHash(e,t))},excludeHash2Atoms:function(e,t){return this.hash2Atoms(this.excludeHash(e,t))},unionHash2Atoms:function(e,t){return this.hash2Atoms(this.unionHash(e,t))},hash2Atoms:function(e){var t={};for(var o in e)t[o]=this.atoms[o];return t},centerAtoms:function(e){var t=new THREE.Vector3(9999,9999,9999),o=new THREE.Vector3(-9999,-9999,-9999),i=new THREE.Vector3,r=0;for(var n in e){var s=this.atoms[n],a=s.coord;i.add(a),t.min(a),o.max(a),++r}var c=o.distanceTo(t);return{center:i.multiplyScalar(1/r),maxD:c}},exportCanvas:function(){this.render(),window.open(this.renderer.domElement.toDataURL("image/png"))},applyPrevColor:function(){for(var e in this.atoms){var t=this.atoms[e];t.color=this.atomPrevColors[e]}},setColorByOptions:function(e,t,o){if(void 0!==o&&o)for(var i in t){var r=this.atoms[i];this.atomPrevColors[i]=r.color}else if(0===e.color.indexOf("#"))for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setStyle(e.color.toLowerCase()),this.atomPrevColors[i]=r.color}else switch(e.color.toLowerCase()){case"spectrum":var n=0,s=1/this.cnt;for(var i in t){var r=this.atoms[i];r.color=r.het?this.atomColors[r.elem]||this.defaultAtomColor:(new THREE.Color).setHSL(2/3*(1-n++*s),1,.45),this.atomPrevColors[i]=r.color}break;case"chain":var a=-1,c="",h=this.stdChainColors.length;for(var i in t){var r=this.atoms[i];r.chain!=c&&(++a,a%=h),r.color=this.stdChainColors[a],Object.keys(this.chainsColor).length>0&&this.updateChainsColor(r),this.atomPrevColors[i]=r.color,c=r.chain}break;case"secondary structure":for(var i in t){var r=this.atoms[i];r.color=r.het?this.atomColors[r.elem]||this.defaultAtomColor:this.ssColors[r.ss],this.atomPrevColors[i]=r.color}break;case"residue":for(var i in t){var r=this.atoms[i];r.color=r.het?this.atomColors[r.elem]||this.defaultAtomColor:this.residueColors[r.resn]||this.defaultResidueColor,this.atomPrevColors[i]=r.color}break;case"charge":for(var i in t){var r=this.atoms[i];r.color=r.het?this.atomColors[r.elem]||this.defaultAtomColor:this.chargeColors[r.resn]||this.defaultResidueColor,this.atomPrevColors[i]=r.color}break;case"atom":for(var i in t){var r=this.atoms[i];r.color=this.atomColors[r.elem]||this.defaultAtomColor,this.atomPrevColors[i]=r.color}break;case"white":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(16777215),this.atomPrevColors[i]=r.color}break;case"grey":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(8947848),this.atomPrevColors[i]=r.color}break;case"red":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(16711680),this.atomPrevColors[i]=r.color}break;case"green":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(65280),this.atomPrevColors[i]=r.color}break;case"blue":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(255),this.atomPrevColors[i]=r.color}break;case"magenta":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(16711935),this.atomPrevColors[i]=r.color}break;case"yellow":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(16776960),this.atomPrevColors[i]=r.color}break;case"cyan":for(var i in t){var r=this.atoms[i];r.color=(new THREE.Color).setHex(65535),this.atomPrevColors[i]=r.color}break;case"custom":}},updateChainsColor:function(e){var t=e.structure+"_"+e.chain;void 0!==this.chainsColor[t]&&(this.chainsColor[t]=e.color)},drawHelixBrick:function(e,t){for(var o in e)for(var i=0,r=e[o].length;r>i;++i)if("helix"===e[o][i].type){var n=1.6,s=new THREE.Color(t[o]),a=new THREE.Vector3(e[o][i].coords[0].x,e[o][i].coords[0].y,e[o][i].coords[0].z),c=new THREE.Vector3(e[o][i].coords[1].x,e[o][i].coords[1].y,e[o][i].coords[1].z);this.createCylinder(a,c,n,s)}else if("brick"===e[o][i].type){var h=e[o][i],s=t[o];this.createStrandBrick(h,s,this.thickness)}else if("coil"===e[o][i].type){var a=new THREE.Vector3(e[o][i].coords[0].x,e[o][i].coords[0].y,e[o][i].coords[0].z),c=new THREE.Vector3(e[o][i].coords[1].x,e[o][i].coords[1].y,e[o][i].coords[1].z),s=new THREE.Color(t[o]),l=this.createSingleLine(a,c,s,!1);this.mdl.add(l),this.objects.push(l)}},applyOtherOptions:function(e){if(void 0===e&&(e=this.options),"yes"===e.labels.toLowerCase()&&this.createLabelRepresentation(this.labels),"yes"===e.lines.toLowerCase()&&this.createLines(this.lines),"yes"===e.hbonds.toLowerCase()){var t="#FFFFFF";"black"!==e.background.toLowerCase()&&(t="#000000");for(var o=0,i=Math.floor(this.hbondpoints.length/2);i>o;o++){var r=(this.hbondpoints[2*o],this.hbondpoints[2*o+1],{});r.position1=this.hbondpoints[2*o],r.position2=this.hbondpoints[2*o+1],r.color=t,r.dashed=!0,this.lines.push(r)}this.createLines(this.lines)}switch(e.rotationcenter.toLowerCase()){case"molecule center":void 0!==this.center&&this.mdl.position.sub(this.center);break;case"pick center":void 0!==this.pickedatom&&this.mdl.position.sub(this.pickedatom.coord);break;case"display center":var n=this.centerAtoms(this.displayAtoms).center;this.mdl.position.sub(n);break;case"highlight center":var n=this.centerAtoms(this.highlightAtoms).center;this.mdl.position.sub(n)}switch(e.axis.toLowerCase()){case"yes":this.axis=!0,this.buildAxes(this.maxD/2);break;case"no":this.axis=!1}switch(e.picking.toLowerCase()){case"atom":this.picking=1;break;case"no":this.picking=0;break;case"residue":this.picking=2;break;case"strand":this.picking=3}},applySurfaceOptions:function(e){switch(void 0===e&&(e=this.options),e.wireframe){case"yes":e.wireframe=!0;break;case"no":e.wireframe=!1}e.opacity=parseFloat(e.opacity);var t={};switch(t=this.hash2Atoms(this.highlightAtoms),e.surface.toLowerCase()){case"van der waals surface":this.createSurfaceRepresentation(t,1,e.wireframe,e.opacity);break;case"solvent excluded surface":this.createSurfaceRepresentation(t,2,e.wireframe,e.opacity);break;case"solvent accessible surface":this.createSurfaceRepresentation(t,3,e.wireframe,e.opacity);break;case"molecular surface":this.createSurfaceRepresentation(t,4,e.wireframe,e.opacity)}},applyDisplayOptions:function(e,t,o){void 0===e&&(e=this.options);var i,r={},n={},s={};if(1===o){s=this.hash2Atoms(t);for(var a in s){var c=s[a];i=c.structure+"_"+c.chain+"_"+c.resi,r[i]=1}for(var a in r){var h=a.lastIndexOf("_"),l=a.substr(0,h+1),d=parseInt(a.substr(h+1)),u=l+(d-1).toString(),p=l+(d+1).toString();r.hasOwnProperty(u)||r.hasOwnProperty(u)||(n[a]=1)}if(1===Object.keys(s).length&&Object.keys(this.residues[i]).length>1&&"sphere"!==s[Object.keys(s)[0]].style&&"dot"!==s[Object.keys(s)[0]].style){if(void 0===this.bCid||!this.bCid)for(var a in s){var c=s[a],v=1;this.createBox(c,void 0,void 0,v,void 0,o)}}else for(var i in n){var c=this.getFirstAtomObj(this.residues[i]),u=c.structure+"_"+c.chain+"_"+parseInt(c.resi-1),p=c.structure+"_"+c.chain+"_"+parseInt(c.resi+1);if("cylinder & plate"===c.style&&"helix"===c.ss)for(var a in this.residues[i]){var c=this.atoms[a],v=1;this.createBox(c,void 0,void 0,v,void 0,o)}else if("ribbon"===c.style&&"coil"===c.ss||"strand"===c.style&&"coil"===c.ss||"phosphorus trace"===c.style||"C alpha trace"===c.style||"B factor tube"===c.style||"cylinder & plate"===c.style&&"helix"!==c.ss){var m=!1;if(!m&&this.residues.hasOwnProperty(p)){var E=Object.keys(this.residues[p])[0],f=this.hash2Atoms(this.residues[p])[E];if(c.style===f.style&&!f.ssbegin||f.ssbegin){var g=this.residues[p];if(t=this.unionHash(t,g),m=!0,f.ssbegin)for(var a in g)this.atoms[a].notshow=!0}}if(!m&&this.residues.hasOwnProperty(u)){var E=Object.keys(this.residues[u])[0],f=this.hash2Atoms(this.residues[u])[E];c.style===f.style&&(t=this.unionHash(t,this.residues[u]),m=!0)}}else if("ribbon"===c.style&&"coil"!==c.ss&&c.ssend||"strand"===c.style&&"coil"!==c.ss&&c.ssend){var m=!1;if(!m&&this.residues.hasOwnProperty(p)){var E=Object.keys(this.residues[p])[0],f=this.hash2Atoms(this.residues[p])[E];t=this.unionHash(t,this.residues[p]),m=!0}}}}this.setStyle2Atoms(t);for(var y in this.style2atoms)atomHash=this.style2atoms[y],"ribbon"===y?this.createStrand(this.hash2Atoms(atomHash),2,void 0,!0,void 0,void 0,!1,this.thickness,o):"strand"===y?this.createStrand(this.hash2Atoms(atomHash),null,null,null,null,null,!1,void 0,o):"cylinder & plate"===y?this.createCylinderHelix(this.hash2Atoms(atomHash),1.6,o):"nucleotide cartoon"===y?(this.drawCartoonNucleicAcid(this.hash2Atoms(atomHash),null,this.thickness,o),2!==o&&this.drawNucleicAcidStick(this.hash2Atoms(atomHash),o)):"phosphorus trace"===y?this.createCylinderCurve(this.hash2Atoms(atomHash),"P",.2,!1,o):"phosphorus lines"===y?this.createCylinderCurve(this.hash2Atoms(atomHash),"P",.2,!0,o):"C alpha trace"===y?this.createCylinderCurve(this.hash2Atoms(atomHash),"CA",.2,!1,o):"B factor tube"===y?this.createTube(this.hash2Atoms(atomHash),"CA",null,o):"lines"===y?1===o?this.createStickRepresentation(this.hash2Atoms(atomHash),.1,.1,void 0,o):this.createLineRepresentation(this.hash2Atoms(atomHash),o):"stick"===y?this.createStickRepresentation(this.hash2Atoms(atomHash),this.cylinderRadius,this.cylinderRadius,void 0,o):"ball & stick"===y?this.createStickRepresentation(this.hash2Atoms(atomHash),this.cylinderRadius,.5*this.cylinderRadius,.3,o):"sphere"===y?this.createSphereRepresentation(this.hash2Atoms(atomHash),this.sphereRadius,void 0,void 0,o):"dot"===y&&this.createSphereRepresentation(this.hash2Atoms(atomHash),this.sphereRadius,!1,.3,o)},setStyle2Atoms:function(e){this.style2atoms={};for(var t in e)void 0===this.style2atoms[this.atoms[t].style]&&(this.style2atoms[this.atoms[t].style]={}),this.style2atoms[this.atoms[t].style][t]=1},setAtomStyleByOptions:function(e){if(void 0!==e.sidechains)for(var t in this.proteins)this.atoms[t].style=e.sidechains.toLowerCase();if(void 0!==e.secondary)for(var t in this.proteins)this.atoms[t].style=e.secondary.toLowerCase();if(void 0!==e.ligands)for(var t in this.ligands)this.atoms[t].style=e.ligands.toLowerCase();if(void 0!==e.ions)for(var t in this.ions)this.atoms[t].style=e.ions.toLowerCase();if(void 0!==e.water)for(var t in this.water)this.atoms[t].style=e.water.toLowerCase();if(void 0!==e.nucleotides)for(var t in this.nucleotides)this.atoms[t].style=e.nucleotides.toLowerCase()},rebuildScene:function(e){if(jQuery.extend(this.options,e),void 0!==this.scene)for(var t=this.scene.children.length-1;t>=0;t--){var o=this.scene.children[t];this.scene.remove(o)}else this.scene=new THREE.Scene;this.directionalLight=new THREE.DirectionalLight(16777215,1.2),this.camera_z>0?this.directionalLight.position.set(0,0,1):this.directionalLight.position.set(0,0,-1);var i=new THREE.AmbientLight(2105376);this.scene.add(this.directionalLight),this.scene.add(i),this.mdl=new THREE.Object3D,this.scene.add(this.mdl),this.objects=[],this.raycaster=new THREE.Raycaster,this.projector=new THREE.Projector,this.mouse=new THREE.Vector2;var r=this.backgroundColors[this.options.background.toLowerCase()];this.renderer.setClearColor(r),this.perspectiveCamera=new THREE.PerspectiveCamera(20,this.container.whratio,.1,1e4),this.perspectiveCamera.position.set(0,0,this.camera_z),this.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0)),this.orthographicCamera=new THREE.OrthographicCamera,this.orthographicCamera.position.set(0,0,this.camera_z),this.orthographicCamera.lookAt(new THREE.Vector3(0,0,0)),this.cameras={perspective:this.perspectiveCamera,orthographic:this.orthographicCamera},this.setCamera(),this.applyDisplayOptions(this.options,this.displayAtoms),this.applyOtherOptions()},setCamera:function(){this.camera=this.cameras[this.options.camera.toLowerCase()],this.camera===this.perspectiveCamera?(this.camera_z>0?this.camera.position.z=2*this.maxD:this.camera.position.z=2*-this.maxD,this.controls=new THREE.TrackballControls(this.camera,document.getElementById(this.id),this)):this.camera===this.orthographicCamera&&(this.camera.right=this.maxD/2*2.5,this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.container.whratio,this.camera.bottom=-this.camera.right/this.container.whratio,this.camera_z>0?(this.camera.near=1e4,this.camera.far=-1e4):(this.camera.near=-1e4,this.camera.far=1e4),this.controls=new THREE.OrthographicTrackballControls(this.camera,document.getElementById(this.id),this)),this.camera.updateProjectionMatrix()},applyTransformation:function(e,t,o){var i={};i.update=!1,i._zoomFactor=e,i.mouseChange=new THREE.Vector2,i.mouseChange.copy(t),i.quaternion=new THREE.Quaternion,i.quaternion.copy(o),this.controls.update(i)},render:function(){this.directionalLight.position.copy(this.camera.position),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.render(this.scene,this.camera)},setRotationCenter:function(e){this.mdl.position.sub(e)},draw:function(e,t){this.rebuildScene(e),(void 0===t||t)&&this.applyPrevColor(),this.bSSOnly&&this.drawHelixBrick(this.molid2ss,this.molid2color),this.bAssembly&&this.drawSymmetryMates2(),void 0!==this.highlightAtoms&&Object.keys(this.highlightAtoms).length>0&&Object.keys(this.highlightAtoms).length<Object.keys(this.displayAtoms).length&&(this.removeHighlightObjects(),this.addHighlightObjects(void 0,!1)),this.bRender===!0&&(this.applyTransformation(this._zoomFactor,this.mouseChange,this.quaternion),this.render())},zoomIn:function(e){var t={};t._zoomFactor=1-e,t.update=!0,this.controls.update(t),this.render()},zoomOut:function(e){var t={};t._zoomFactor=1+e,t.update=!0,this.controls.update(t),this.render()},rotateLeft:function(e){var t=new THREE.Vector3(0,1,0),o=-e/180*Math.PI;t.applyQuaternion(this.camera.quaternion).normalize();var i=new THREE.Quaternion;i.setFromAxisAngle(t,-o);var r={};r.quaternion=i,r.update=!0,this.controls.update(r),this.render()},rotateRight:function(e){var t=new THREE.Vector3(0,1,0),o=e/180*Math.PI;t.applyQuaternion(this.camera.quaternion).normalize();var i=new THREE.Quaternion;i.setFromAxisAngle(t,-o);var r={};r.quaternion=i,r.update=!0,this.controls.update(r),this.render()},rotateUp:function(e){var t=new THREE.Vector3(1,0,0),o=-e/180*Math.PI;t.applyQuaternion(this.camera.quaternion).normalize();var i=new THREE.Quaternion;i.setFromAxisAngle(t,-o);var r={};r.quaternion=i,r.update=!0,this.controls.update(r),this.render()},rotateDown:function(e){var t=new THREE.Vector3(1,0,0),o=e/180*Math.PI;t.applyQuaternion(this.camera.quaternion).normalize();var i=new THREE.Quaternion;i.setFromAxisAngle(t,-o);var r={};r.quaternion=i,r.update=!0,this.controls.update(r),this.render()},translateLeft:function(e){var t=new THREE.Vector2(0,0);t.x-=e/100;var o={};o.mouseChange=t,o.update=!0,this.controls.update(o),this.render()},translateRight:function(e){var t=new THREE.Vector2(0,0);t.x+=e/100;var o={};o.mouseChange=t,o.update=!0,this.controls.update(o),this.render()},translateUp:function(e){var t=new THREE.Vector2(0,0);t.y-=e/100;var o={};o.mouseChange=t,o.update=!0,this.controls.update(o),this.render()},translateDown:function(e){var t=new THREE.Vector2(0,0);t.y+=e/100;var o={};o.mouseChange=t,o.update=!0,this.controls.update(o),this.render()},selectStrandHelixFromAtom:function(e){for(var t=e,o=e,i=t.resi,r=t.resi-1;r>0;--r){var n=t.structure+"_"+t.chain+"_"+r;if(!this.residues.hasOwnProperty(n))break;var e=this.getFirstAtomObj(this.residues[n]);if(i=e.resi,"coil"!==t.ss&&e.ss===t.ss&&e.ssbegin||"coil"===t.ss&&e.ss!==t.ss){"coil"===t.ss&&e.ss!==t.ss&&(i=e.resi+1);break}}for(var r=i;r<=t.resi;++r){var n=t.structure+"_"+t.chain+"_"+r;this.highlightAtoms=this.unionHash(this.highlightAtoms,this.hash2Atoms(this.residues[n]))}for(var s=o.resi,a=this.getLastAtomObj(this.chains[o.structure+"_"+o.chain]).resi,r=o.resi+1;a>=r;++r){
var n=o.structure+"_"+o.chain+"_"+r;if(!this.residues.hasOwnProperty(n))break;var e=this.getFirstAtomObj(this.residues[n]);if(s=e.resi,"coil"!==o.ss&&e.ss===o.ss&&e.ssend||"coil"===o.ss&&e.ss!==o.ss){"coil"===o.ss&&e.ss!==o.ss&&(s=e.resi-1);break}}for(var r=o.resi+1;s>=r;++r){var n=o.structure+"_"+o.chain+"_"+r;this.highlightAtoms=this.unionHash(this.highlightAtoms,this.hash2Atoms(this.residues[n]))}},showPicking:function(e){if(this.removeHighlightObjects(),this.highlightAtoms={},1===this.picking)this.highlightAtoms[e.serial]=1;else if(2===this.picking){var t=e.structure+"_"+e.chain+"_"+e.resi;this.highlightAtoms=this.residues[t]}else 3===this.picking&&this.selectStrandHelixFromAtom(e);this.addHighlightObjects();var o="."+e.chain+":"+e.resi,i=o+"@"+e.name,r=[],n={};n.position=e.coord,1===this.picking?n.text=i:2===this.picking?n.text=o:3===this.picking&&(n.text=o),r.push(n),this.createLabelRepresentation(r)},removeHighlightObjects:function(){for(var e in this.prevHighlightObjects)this.mdl.remove(this.prevHighlightObjects[e]);this.prevHighlightObjects=[],this.removeSurfaces()},addHighlightObjects:function(e,t){void 0===e&&(e=this.highlightColor),this.applyDisplayOptions(this.options,this.intersectHash(this.highlightAtoms,this.displayAtoms),this.bHighlight),this.applySurfaceOptions(),(void 0===t||t)&&this.render()},removeSurfaces:function(){for(var e in this.prevSurfaces)this.mdl.remove(this.prevSurfaces[e]);this.prevSurfaces=[]},zoominSelection:function(){if(Object.keys(this.highlightAtoms).length>1){var e=this.centerAtoms(this.hash2Atoms(this.highlightAtoms));this.maxD=e.maxD,this.maxD<25&&(this.maxD=25),this.mdl.position.add(this.center).sub(e.center),this.center=e.center,this.setCamera()}this.render()}};var show3DStructure=function(e){function t(){if(void 0!==e.pdbid){var t=e.pdbid.toLowerCase();o(t)}else if(void 0!==e.mmdbid)c(e.mmdbid);else if(void 0!==e.gi){var i="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/elink.fcgi?dbfrom=protein&db=structure&linkname=protein_structure&id="+e.gi;$.ajax({url:i,dataType:"text",cache:!0,success:function(t){if(-1===t.indexOf("<Link>"))alert("There are no MMDB IDs available for the gi "+e.gi);else{var o=t.substr(t.indexOf("<Link>")),i=o.indexOf("<Id>"),r=o.indexOf("</Id>"),n=o.substr(i+4,r-i-4);c(n)}}})}else void 0!==e.cid?s(e.cid):void 0!==e.mmcif?r(e.mmcif):void 0!==e.align?n(e.align):alert("Please input a gi, MMDB ID, PDB ID, CID, or mmCIF...")}function o(t){var o,r;"https:"!==document.location.protocol?(o="http://www.rcsb.org/pdb/files/"+t+".pdb",r="text"):(o="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi?jsonp=t&pdbid="+t,r="jsonp"),g.bCid=void 0;$.ajax({url:o,dataType:r,cache:!0,beforeSend:function(){$("#"+v+"wait").show(),$("#"+v+"canvas").hide()},complete:function(){$("#"+v+"wait").hide(),$("#"+v+"canvas").show()},success:function(t){"https:"!==document.location.protocol?g.loadPDB(t):g.loadPDB(t.data),g.setAtomStyleByOptions(y),g.setColorByOptions(y,g.atoms),g.draw(y),void 0!==e.rotate&&e.rotate&&i("right")}})}function i(e){if(g.bStopRotate)return!1;if("left"===e)g.rotateLeft(5);else if("right"===e)g.rotateRight(5);else if("up"===e)g.rotateUp(5);else{if("down"!==e)return!1;g.rotateDown(5)}setTimeout(function(){i(e)},1e3)}function r(t){var o="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi?mmcif="+t;g.bCid=void 0,$.ajax({url:o,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+v+"wait").show(),$("#"+v+"canvas").hide(),$("#"+v+"log").hide()},complete:function(){$("#"+v+"wait").hide(),$("#"+v+"canvas").show(),$("#"+v+"log").show()},success:function(t){return void 0===t.atoms?(alert("invalid atoms data."),!1):(h(t,t.mmcif,"mmcif"),g.setAtomStyleByOptions(y),g.setColorByOptions(y,g.atoms),g.draw(y),void 0!==e.rotate&&e.rotate&&i("right"),void 0)}})}function n(t){var o="https://www.ncbi.nlm.nih.gov/Structure/vastpp/vastpp.cgi?cmd=c&w3d&ids="+t,r="https://www.ncbi.nlm.nih.gov/Structure/vastpp/vastpp.cgi?cmd=c1&d&ids="+t;void 0!==e.inpara&&(o+=e.inpara,r+=e.inpara),g.bCid=void 0,g.pdbid_chain2title={};var n,s=$.ajax({url:r,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+v+"wait").show(),$("#"+v+"canvas").hide()},complete:function(){$("#"+v+"wait").hide(),$("#"+v+"canvas").show()}}),a=s.then(function(e){n=e.seqalign;var t=0;for(var i in e){if(2>t){var r=e[i].pdbid,s=e[i].molecule;for(var a in s){var c=s[a].chain;g.pdbid_chain2title[r+"_"+c]=s[a].name}}++t}return $.ajax({url:o,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+v+"wait").show(),$("#"+v+"canvas").hide()},complete:function(){$("#"+v+"wait").hide(),$("#"+v+"canvas").show()}})});a.done(function(t){return void 0===t.atoms?(alert("invalid atoms data."),!1):(h(t,void 0,"align",n),g.setAtomStyleByOptions(y),g.setColorByOptions(y,g.atoms,!0),g.draw(y),void 0!==e.rotate&&e.rotate&&i("right"),void 0)})}function s(t){var o="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+t+"/SDF?record_type=3d";g.bCid=!0,$.ajax({url:o,dataType:"text",cache:!0,beforeSend:function(){$("#"+v+"wait").show(),$("#"+v+"canvas").hide(),$("#"+v+"log").hide()},complete:function(){$("#"+v+"wait").hide(),$("#"+v+"canvas").show(),$("#"+v+"log").show()},success:function(o){var r=a(o);r?(g.setAtomStyleByOptions(y),g.setColorByOptions(y,g.atoms),g.draw(y),void 0!==e.rotate&&e.rotate&&i("right")):alert("The SDF of CID "+t+" has the wrong format...")}}).fail(function(){alert("This CID may not have 3D structure...")})}function a(e){var t=e.split("\n");if(t.length<4)return!1;g.init();var o="1",i="1",r="1",n="LIG",s=o,a=o+"_"+i,c=a+"_"+r,h=parseInt(t[3].substr(0,3));if(isNaN(h)||0>=h)return!1;var l=parseInt(t[3].substr(3,3)),d=4;if(t.length<d+h+l)return!1;var u,p,v=0,m=h,E={};for(u=v;m>u;u++){p=t[d],d++;var f=u,y=parseFloat(p.substr(0,10)),w=parseFloat(p.substr(10,10)),b=parseFloat(p.substr(20,10)),T=new THREE.Vector3(y,w,b),R=p.substr(31,3).replace(/ /g,""),C={het:!0,serial:f,name:R,resn:n,structure:o,chain:i,resi:r,coord:T,b:0,elem:R,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};g.atoms[f]=C,E[f]=1}for(g.displayAtoms=E,g.highlightAtoms=E,g.structures[s]=E,g.chains[a]=E,g.residues[c]=E,g.residueId2Name[c]=n,void 0===g.chainsSeq[a]&&(g.chainsSeq[a]=[]),void 0===g.chainsAnno[a]&&(g.chainsAnno[a]=[]),void 0===g.chainsAnno[a][0]&&(g.chainsAnno[a][0]=[]),g.chainsSeq[a].push(n),g.chainsAnno[a][0].push(r),u=0;l>u;u++){p=t[d],d++;var H=parseInt(p.substr(0,3))-1+v,x=parseInt(p.substr(3,3))-1+v,S=parseInt(p.substr(6,3));g.atoms[H].bonds.push(x),g.atoms[H].bondOrder.push(S),g.atoms[x].bonds.push(H),g.atoms[x].bondOrder.push(S),2==S?(g.doublebonds[H+"_"+x]=1,g.doublebonds[x+"_"+H]=1):3==S&&(g.triplebonds[H+"_"+x]=1,g.triplebonds[x+"_"+H]=1)}var A=new THREE.Vector3(9999,9999,9999),z=new THREE.Vector3(-9999,-9999,-9999),_=new THREE.Vector3,M=0;for(var u in g.atoms){var k=g.atoms[u],T=k.coord;_.add(T),A.min(T),z.max(T),++M,k.het&&(-1!==$.inArray(k.elem,g.ionsArray)?g.ions[k.serial]=1:g.ligands[k.serial]=1)}return g.pmin=A,g.pmax=z,g.cnt=M,g.maxD=g.pmax.distanceTo(g.pmin),g.center=_.multiplyScalar(1/g.cnt),g.maxD<25&&(g.maxD=25),!0}function c(t){var o="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?program=w3d&uid="+t;g.bCid=void 0,void 0!==e.inpara&&(o+=e.inpara),$.ajax({url:o,dataType:"jsonp",cache:!0,beforeSend:function(){$("#"+v+"wait").show(),$("#"+v+"canvas").hide()},complete:function(){$("#"+v+"wait").hide(),$("#"+v+"canvas").show()},success:function(t){if(void 0!==e.inpara&&-1!=e.inpara.indexOf("mols=")||t.atomcount<=t.threshold&&void 0!==t.atoms){var o=void 0!==t.pdbId?t.pdbId:t.mmdbId;h(t,o,"mmdbid"),g.setAtomStyleByOptions(y),g.setColorByOptions(y,g.atoms,!0),g.draw(y),void 0!==e.rotate&&e.rotate&&i("right")}if(void 0!==e.inpara&&-1==e.inpara.indexOf("mols=")&&t.atomcount>t.threshold&&void 0!==t.molid2rescount){var r=40;g.bSSOnly=!0;var o=void 0!==t.pdbId?t.pdbId:t.mmdbId;h(t,o,"mmdbid"),y.nucleotides="phosphorus lines",g.setAtomStyleByOptions(y),g.setColorByOptions(y,g.atoms,!0);var n=t.molid2rescount,s={},a={},c={},l="<table width='100%'><tr><td></td><th>#</th><th align='center'>Chain</th><th align='center'>Residue Count</th></tr>",d=1;for(var u in n){var p="#"+("000000"+n[u].color.toString(16)).slice(-6);l+="<tr style='color:"+p+"'><td><input type='checkbox' name='"+v+"filter_ckbx' value='"+u+"'/></td><td align='center'>"+d+"</td><td align='center'>"+n[u].chain+"</td><td align='center'>"+n[u].resCount+"</td></tr>",s[u]=p;var m=o+"_"+n[u].chain;a[m]=u,c[u]=m,++d}Object.keys(g.ligands).length>0&&(l+="<tr><td><input type='checkbox' name='"+v+"filter_ckbx' value='ligands'/></td><td align='center'>"+d+"</td><td align='center'>Ligands</td><td align='center'>"+Object.keys(g.ligands).length+" atoms</td></tr>"),l+="</table>";var E={};for(var u in g.chains){var f={},w=g.centerAtoms(g.hash2Atoms(g.chains[u]));f.position=w;var m=u.substr(u.indexOf("_")+1);f.text=m,f.size=r,f.color=s[a[u]],f.background="#FFFFFF",E[a[u]]=f}molid2ss={};for(var u in t.helix)for(var b=0,T=t.helix[u].length;T>b;++b){var R=t.helix[u][b],C={};C.type="helix",C.startResi=R.from,C.endResi=R.to,C.coords=[],C.coords.push(R.end),C.coords.push(R.start),void 0===molid2ss[u]&&(molid2ss[u]=[]),molid2ss[u].push(C)}for(var u in t.brick)for(var b=0,T=t.brick[u].length;T>b;++b){var H=t.brick[u][b],C={};C.type="brick",C.startResi=H.from,C.endResi=H.to,C.coords=[];var x={},S={},A={};x.x=.25*(H["000"][0]+H["010"][0]+H["011"][0]+H["001"][0]),x.y=.25*(H["000"][1]+H["010"][1]+H["011"][1]+H["001"][1]),x.z=.25*(H["000"][2]+H["010"][2]+H["011"][2]+H["001"][2]),S.x=.25*(H[100][0]+H[110][0]+H[111][0]+H[101][0]),S.y=.25*(H[100][1]+H[110][1]+H[111][1]+H[101][1]),S.z=.25*(H[100][2]+H[110][2]+H[111][2]+H[101][2]),A.x=H["010"][0]-H["000"][0],A.y=H["010"][1]-H["000"][1],A.z=H["010"][2]-H["000"][2],C.coords.push(x),C.coords.push(S),C.coords.push(A),void 0===molid2ss[u]&&(molid2ss[u]=[]),molid2ss[u].push(C)}for(var u in molid2ss)molid2ss[u].sort(function(e,t){return parseFloat(e.startResi)-parseFloat(t.startResi)});if(0!==g.cnt)var z=g.pmin,_=g.pmax,M=g.center.multiplyScalar(g.cnt),k=g.cnt;else var z=new THREE.Vector3(9999,9999,9999),_=new THREE.Vector3(-9999,-9999,-9999),M=new THREE.Vector3,k=0;for(var u in molid2ss){for(var O=new THREE.Vector3(9999,9999,9999),L=new THREE.Vector3(-9999,-9999,-9999),j=new THREE.Vector3,V=0,b=0,T=molid2ss[u].length;T>b;++b){var P=molid2ss[u][b].coords[0];z.min(P),_.max(P),M.add(P),O.min(P),L.max(P),j.add(P),++k,++V,P=molid2ss[u][b].coords[1],z.min(P),_.max(P),M.add(P),O.min(P),L.max(P),j.add(P),++k,++V}var D=j.multiplyScalar(1/V),f={},w=new THREE.Vector3;w.x=D.x,w.y=D.y,w.z=D.z,f.position=w;var m=c[u];f.text=m.substr(m.indexOf("_")+1),f.size=r,f.color=s[u],f.background="#FFFFFF",E[u]=f}g.maxD=_.distanceTo(z),g.center=M.multiplyScalar(1/k);for(var u in molid2ss)for(var b=1,T=molid2ss[u].length;T>b;++b){var C={};C.type="coil",C.startResi=molid2ss[u][b-1].endResi,C.endResi=molid2ss[u][b].startResi,C.coords=[],C.coords.push(molid2ss[u][b-1].coords[1]),C.coords.push(molid2ss[u][b].coords[0]),molid2ss[u].push(C)}g.savedLabels=E,g.molid2ss=molid2ss,g.molid2color=s,g.draw(y),void 0!==e.rotate&&e.rotate&&i("right"),$("#"+v+"dl_filter_table").html(l);var F="Select chains to display",I=250,N=/Mac/i.test(navigator.userAgent)&&!/iPhone|iPad|iPod/i.test(navigator.userAgent)?"auto":200,w={my:"left top",at:"left+10 top+93",of:"#"+v+"canvas",collision:"none"};window.dialog=$("#"+v+"dl_filter").dialog({autoOpen:!0,title:F,height:N,width:I,modal:!1,position:w}),$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")}return void 0===t.atoms&&void 0===t.molid2rescount?(alert("invalid MMDB data."),!1):void 0}})}function h(e,t,o,i){g.init();var r=new THREE.Vector3(9999,9999,9999),n=new THREE.Vector3(-9999,-9999,-9999),s=new THREE.Vector3,a=e.atoms,c=0,h=0,l={},d={};if("align"===o)for(var u=0,p=e.aligned_structures.length;p>u;++u)for(var v=e.aligned_structures[u],m=v.range[0];m<=v.range[1];++m){var E=v.pdbid,f=v.mmdbid;l[m]=E.toString(),d[f]=E}var y={},w={};if("mmdbid"===o||"align"===o)if("mmdbid"===o){if(void 0!==e.molid2chain)for(var b in e.molid2chain)y[b]=e.molid2chain[b].chain}else if("align"===o&&void 0!==e.molid2chain)for(var T in e.molid2chain)for(var b in e.molid2chain[T])w[d[T]+"_"+b]=e.molid2chain[T][b].chain;var R={};for(var u in a){++c,R[u]=c;var C=a[u];C.serial=c;var H;if("mmdbid"===o||"mmcif"===o?H=t:"align"===o&&(H=l[c]),void 0!==C.chain||"mmdbid"!==o&&"align"!==o)C.chain=""===C.chain?"?":C.chain;else if("mmdbid"===o){var b=C.ids.m;C.chain=void 0===y[b]?"?":y[b]}else if("align"===o){var b=C.ids.m;C.chain=void 0===w[H+"_"+b]?"?":w[H+"_"+b]}C.resi=parseInt(C.resi),void 0!==C.color&&(C.color=new THREE.Color(C.color)),C.coord=new THREE.Vector3(C.coord.x,C.coord.y,C.coord.z),("mmdbid"===o||"align"===o)&&(C.structure=H),r.min(C.coord),n.max(C.coord),s.add(C.coord),"p"===C.mt||"n"===C.mt?("p"===C.mt?(g.proteins[c]=1,"CA"===C.name&&(g.calphas[c]=1)):"n"===C.mt&&(g.nucleotides[c]=1,"P"==C.name&&(g.nucleotidesP[c]=1)),g.het=!1):"s"===C.mt?(g.water[c]=1,g.het=!0):"l"===C.mt&&(g.ligands[c]=1,0===C.bonds.length&&(g.ions[c]=1),g.het=!0),"HOH"==C.resn&&(g.water[c]=1),g.atoms[c]=C,g.displayAtoms[c]=1,g.highlightAtoms[c]=1,void 0===g.structures[H]&&(g.structures[H]={}),g.structures[H][c]=1;var x=C.structure+"_"+C.chain;void 0===g.chains[x]&&(g.chains[x]={}),g.chains[x][c]=1;var S=C.structure+"_"+C.chain+"_"+C.resi;void 0===g.residues[S]&&(g.residues[S]={}),g.residues[S][c]=1;var A=g.residueName2Abbr(C.resn.substr(0,3));g.residueId2Name[S]=A,C.resi!=h&&(void 0===g.chainsSeq[x]&&(g.chainsSeq[x]=[]),void 0===g.chainsAnno[x]&&(g.chainsAnno[x]=[]),void 0===g.chainsAnno[x][0]&&(g.chainsAnno[x][0]=[]),void 0===g.chainsAnnoTitle[x]&&(g.chainsAnnoTitle[x]=[]),void 0===g.chainsAnnoTitle[x][0]&&(g.chainsAnnoTitle[x][0]=[]),g.chainsSeq[x].push(A),g.chainsAnno[x][0].push(C.resi),g.chainsAnnoTitle[x][0].push(""),("mmdbid"===o||"align"===o)&&(g.chainsColor[x]=C.color)),h=C.resi}if("mmcif"!==o)for(var u in g.atoms)for(var z=void 0===g.atoms[u].bonds?0:g.atoms[u].bonds.length,m=0;z>m;++m)g.atoms[u].bonds[m]=R[g.atoms[u].bonds[m]];if(g.cnt=c,g.pmin=r,g.pmax=n,g.maxD=n.distanceTo(r),g.center=s.multiplyScalar(1/g.cnt),g.maxD<25&&(g.maxD=25),"align"===o&&void 0!==i)for(var u=0,p=i.length;p>u;++u){for(var _=i[u][0],M=e.aligned_structures[0].pdbid,k=_.mid,O=w[M+"_"+k],L=M+"_"+O,j={},V=_.mseq.length,P=-1,m=0,D=_.mseq.length;D>m;++m){var F=_.mseq[m][1],I="~"===_.mseq[m][2]?"-":_.mseq[m][2],N=_.mseq[m][3];1==N&&(V>m&&(V=m),m>P&&(P=m)),j[m]={resi:F,resn:I,aligned:N}}_=i[u][1];var B=e.aligned_structures[1].pdbid,G=_.sid,q=w[B+"_"+G],W=B+"_"+q;void 0===g.alignChainsAnnoTitle[L]&&(g.alignChainsAnnoTitle[L]=[]),void 0===g.alignChainsAnnoTitle[L][0]&&(g.alignChainsAnnoTitle[L][0]=[]),void 0===g.alignChainsAnnoTitle[L][1]&&(g.alignChainsAnnoTitle[L][1]=[]),void 0===g.alignChainsAnnoTitle[L][2]&&(g.alignChainsAnnoTitle[L][2]=[]),void 0===g.alignChainsAnnoTitle[L][3]&&(g.alignChainsAnnoTitle[L][3]=[]),void 0===g.alignChainsAnnoTitle[L][4]&&(g.alignChainsAnnoTitle[L][4]=[]),void 0===g.alignChainsAnnoTitle[L][5]&&(g.alignChainsAnnoTitle[L][5]=[]),g.chainsAnnoTitle[L][0].push(""),g.alignChainsAnnoTitle[L][0].push(""),g.alignChainsAnnoTitle[L][1].push(""),g.alignChainsAnnoTitle[L][2].push(""),g.alignChainsAnnoTitle[L][3].push(W),g.alignChainsAnnoTitle[L][4].push(L),g.alignChainsAnnoTitle[L][5].push("");for(var Y=1,m=V;P>=m;++m){var U,F=_.sseq[m][1],I="~"===_.sseq[m][2]?"-":_.sseq[m][2],N=j[m].aligned+_.sseq[m][3];U=2===N?j[m].resn===I?"#F00":"#00F":"#CCC",void 0===g.alignChainsSeq[L]&&(g.alignChainsSeq[L]=[]);var X={};X.mmdbid=M,X.chain=O,X.resi=j[m].resi,X.resn=j[m].resn,X.aligned=N,X.color=U,g.alignChainsSeq[L].push(X),isNaN(j[m].resi)||(void 0===g.alignChains[L]&&(g.alignChains[L]={}),$.extend(g.alignChains[L],g.residues[L+"_"+j[m].resi])),void 0===g.alignChainsSeq[W]&&(g.alignChainsSeq[W]=[]),X={},X.mmdbid=B,X.chain=q,X.resi=F,X.resn=I,X.aligned=N,X.color=U,g.alignChainsSeq[W].push(X),isNaN(F)||(void 0===g.alignChains[W]&&(g.alignChains[W]={}),$.extend(g.alignChains[W],g.residues[W+"_"+F])),void 0===g.alignChainsAnno[L]&&(g.alignChainsAnno[L]=[]),void 0===g.alignChainsAnno[L][0]&&(g.alignChainsAnno[L][0]=[]),void 0===g.alignChainsAnno[L][1]&&(g.alignChainsAnno[L][1]=[]),m===V&&(void 0===g.alignChainsAnno[L][2]&&(g.alignChainsAnno[L][2]=[]),void 0===g.alignChainsAnno[L][3]&&(g.alignChainsAnno[L][3]=[]),void 0===g.alignChainsAnno[L][4]&&(g.alignChainsAnno[L][4]=[]),void 0===g.alignChainsAnno[L][5]&&(g.alignChainsAnno[L][5]=[]),g.alignChainsAnno[L][2].push(""),g.alignChainsAnno[L][3].push(g.pdbid_chain2title[W]),g.alignChainsAnno[L][4].push(g.pdbid_chain2title[L]),g.alignChainsAnno[L][5].push(""));var Z=".";Y%5===0&&(Z="*"),Y%10===0&&(Z="|"),g.alignChainsAnno[L][0].push(Z);var Q="";Y%10===0&&(Q=Y.toString()),g.alignChainsAnno[L][1].push(Q),++Y}}}function l(){for(var e in g.atoms)g.highlightAtoms[e]=1}function d(e,t){var o={};o[e]=t,l(),g.setColorByOptions(o,g.atoms),g.draw(o)}function u(e,t){var o={};switch(l(),e){case"secondary":o=g.intersectHash(g.highlightAtoms,g.proteins);break;case"sidechains":o=g.intersectHash(g.highlightAtoms,g.proteins);break;case"nucleotides":o=g.intersectHash(g.highlightAtoms,g.nucleotides);break;case"ligands":o=g.intersectHash(g.highlightAtoms,g.ligands);break;case"ions":o=g.intersectHash(g.highlightAtoms,g.ions);break;case"water":o=g.intersectHash(g.highlightAtoms,g.water)}for(var i in o)g.atoms[i].style=t;g.draw(y)}var p=e.divid,v=p+"_";iCn3D.prototype.showPicking=function(t){if(this.removeHighlightObjects(),this.highlightAtoms={},1===this.picking)this.highlightAtoms[t.serial]=1;else if(2===this.picking){var o=t.structure+"_"+t.chain+"_"+t.resi;this.highlightAtoms=this.residues[o]}this.addHighlightObjects();var i,r="."+t.chain+":"+t.resi;i=void 0!==e.cid?t.name:r+"@"+t.name;var n=[],s={};s.position=t.coord,1===this.picking?s.text=i:2===this.picking&&(s.text=r),n.push(s),this.createLabelRepresentation(n)};var m="";m+="<div id='"+v+"viewer' style='position:relative; width:100%; height:100%;'>",m+="<!--div style='height:18px'></div-->",m+="<div id='"+v+"wait' style='width:100%; height: 100%; background-color: rgba(0,0,0, 0.8);'><div style='padding-top:25%; text-align: center; font-size: 2em; color: #FFFF00;'>Loading the structure...</div></div>",m+="<canvas id='"+v+"canvas' style='width:100%; height:100%;'>Your browser does not support WebGL.</canvas>",m+="<div class='tabBox' id='"+v+"toolbox'>",m+="<span class='bottomTab'>Tools</span>",m+="<div class='insideTab' style='overflow: auto;'>",m+="<form action='' id='"+v+"paraform' method='POST'>",void 0===e.cid?(m+="<div class='option'>",m+="<b>&nbsp;&nbsp;Secondary Structure</b>",m+="<select id='"+v+"secondary'>",m+="<option value='ribbon' selected>ribbon</option>",m+="<option value='strand'>strand</option>",m+="<option value='cylinder & plate'>cylinder and plate</option>",m+="<option value='C alpha trace'>C alpha trace</option>",m+="<option value='B factor tube'>B factor tube</option>",m+="<option value='lines'>lines</option>",m+="<option value='stick'>stick</option>",m+="<option value='ball & stick'>ball and stick</option>",m+="<option value='sphere'>sphere</option>",m+="<option value='nothing'>hide</option>",m+="</select>",m+="</div>",m+="<div class='option'>",m+="<b>&nbsp;&nbsp;Nucleotides</b>",m+="<select id='"+v+"nucleotides'>",m+="<option value='nucleotide cartoon'>cartoon</option>",m+="<option value='phosphorus trace' selected>phosphorus trace</option>",m+="<option value='lines'>lines</option>",m+="<option value='stick'>stick</option>",m+="<option value='ball & stick'>ball and stick</option>",m+="<option value='sphere'>sphere</option>",m+="<option value='nothing'>hide</option>",m+="</select>",m+="</div>",m+="<div class='option'>",m+="<b>&nbsp;&nbsp;Ligands</b>",m+="<select id='"+v+"ligands'>",m+="<option value='lines'>lines</option>",m+="<option value='stick' selected>stick</option>",m+="<option value='ball & stick'>ball and stick</option>",m+="<option value='sphere'>sphere</option>",m+="<option value='nothing'>hide</option>",m+="</select>",m+="</div>"):(m+="<div class='option'>",m+="<b>&nbsp;&nbsp;Ligands</b>",m+="<select id='"+v+"ligands'>",m+="<option value='lines'>lines</option>",m+="<option value='stick'>stick</option>",m+="<option value='ball & stick' selected>ball and stick</option>",m+="<option value='sphere'>sphere</option>",m+="<option value='nothing'>hide</option>",m+="</select>",m+="</div>"),m+="<div class='option'>",m+="<b>&nbsp;&nbsp;Color</b>",m+="<select id='"+v+"color'>",void 0===e.cid&&(m+="<option value='spectrum' selected>spectrum</option>",m+="<option value='secondary structure'>secondary structure</option>",m+="<option value='charge'>charge</option>",m+="<option value='chain'>chain</option>",m+="<option value='residue'>residue</option>"),m+="<option value='atom'>atom</option>",m+="<option value='red'>red</option>",m+="<option value='green'>green</option>",m+="<option value='blue'>blue</option>",m+="<option value='magenta'>magenta</option>",m+="<option value='yellow'>yellow</option>",m+="<option value='cyan'>cyan</option>",m+="</select>",m+="</div>",m+="<div class='option'>",m+="&nbsp;&nbsp;<button class='enablepick'>Picking</button> <button class='disablepick'>No Picking</button>",m+="</div>",m+="<div class='option'>",m+="&nbsp;&nbsp;<button id='"+v+"reset'>Reset</button>",m+="</div>",m+="</form>",m+="</div>",m+="</div>",m+="</div>",m+="<!-- dialog will not be part of the form -->",m+="<div id='"+v+"allselections' class='hidden'>",m+="<div id='"+v+"dl_filter' style='overflow:auto; position:relative'>",m+="  <div style='text-align:center; margin-bottom:10px;'><button id='"+v+"filter'><span style='white-space:nowrap'><b>Show Structure</b></span></button>",m+="<button id='"+v+"label_3d_diagram' style='margin-left:10px;'><span style='white-space:nowrap'><b>Show Labels</b></span></button></div>",m+="  <div id='"+v+"dl_filter_table' class='box'>",m+="  </div>",m+="</div>",m+="</div>",$("#"+p).html(m);var E=window.innerWidth,f=window.innerHeight;E=-1!==e.width.toString().indexOf("%")?E*e.width.substr(0,e.width.toString().indexOf("%"))/100-20:e.width,f=-1!==e.height.toString().indexOf("%")?f*e.height.substr(0,e.height.toString().indexOf("%"))/100-20:e.height,$("#"+v+"viewer").width(E).height(f),$("#"+v+"canvas").width(E).height(f),parseInt(E)<=200&&$("#"+v+"toolbox").hide(),$(".bottomTab").click(function(e){var t=$(".insideTab").height();0===t?$(".insideTab").height(200):$(".insideTab").height(0)});var g=new iCn3D(v+"canvas");void 0!==e.bCalphaOnly&&(g.bCalphaOnly=e.bCalphaOnly);var y={};y.camera="perspective",y.background="black",y.color="spectrum",y.sidechains="nothing",y.secondary="ribbon",y.surface="nothing",y.opacity="0.8",y.wireframe="no",y.ligands="stick",y.water="nothing",y.ions="sphere",y.hbonds="no",y.labels="no",y.lines="no",y.rotationcenter="molecule center",y.axis="no",y.picking="residue",y.nucleotides="phosphorus trace",y.surfaceregion="nothing",void 0!==e.cid&&(y.picking="atom",y.ligands="ball & stick"),g.cloneHash(y,g.options),t(),$(".enablepick").click(function(t){t.preventDefault(),void 0!==e.cid?(g.picking=1,g.options.picking="atom"):(g.picking=2,g.options.picking="residue")}),$(".disablepick").click(function(e){e.preventDefault(),g.picking=0,g.options.picking="no",g.draw(void 0,void 0,!1),g.removeHighlightObjects()}),$("#"+v+"reset").click(function(e){e.preventDefault(),t()}),$("#"+v+"filter_ckbx_all").click(function(e){var t=document.getElementsByName(v+"filter_ckbx");if(1==$(this)[0].checked)for(var o=0,i=t.length;i>o;++o)t[o].checked=!0;else for(var o=0,i=t.length;i>o;++o)t[o].checked=!1}),$("#"+v+"filter").click(function(e){e.preventDefault();for(var t=document.getElementsByName(v+"filter_ckbx"),o="",i="&het=0",r=0,n=t.length;n>r;++r)t[r].checked&&("ligands"==t[r].value?i="&het=2":o+=t[r].value+",");""==o&&(o=t[0].value);var s=document.URL+"&mols="+o+"&complexity=2"+i;window.open(s,"_self")}),$("#"+v+"label_3d_diagram").click(function(e){for(var t=document.getElementsByName(v+"filter_ckbx"),o=[],i=0,r=t.length;r>i;++i)t[i].checked&&"ligands"!=t[i].value&&o.push(g.savedLabels[t[i].value]);g.labels=o,g.createLabelRepresentation(g.labels),g.render()}),void 0!==e.resize&&e.resize&&!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&$(window).resize(function(){void 0!==e.resize&&e.resize&&($("#"+v+"canvas").width($(window).width()-20).height($(window).height()-20),$("#"+v+"viewer").width($(window).width()-20).height($(window).height()-20),g.setWidthHeight($(window).width()-20,$(window).height()-20),g.draw(y))}),["color","sidechains","secondary","ligands","water","ions","nucleotides"].forEach(function(e){$("#"+v+e).change(function(t){"color"===e?d(e,$("#"+v+e).val()):u(e,$("#"+v+e).val())})})};